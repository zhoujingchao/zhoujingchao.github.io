[{"title":"æ·±å…¥ç†è§£Promise","date":"2018-01-07T05:32:38.000Z","path":"2018/01/07/æ·±å…¥ç†è§£Promise/","text":"å‰è¨€æœ¬ç€å¯¹Promiseå†…éƒ¨çš„ä¸€äº›å¥½å¥‡ï¼Œè¶å·¥ä½œé—²æš‡ï¼Œåˆ†æåˆ†æpromiseçš„è¿™ç§è§„åˆ™æœºåˆ¶æ˜¯å¦‚ä½•å®ç°çš„ã€‚ æœ¬æ–‡çš„promiseæºç æ˜¯æŒ‰ç…§Promise/A+è§„èŒƒæ¥ç¼–å†™çš„ å¼•å­ä¸‹é¢ä¸€æ­¥ä¸€æ­¥è·Ÿç€æ€è·¯èµ°å§ è¿™æ˜¯ä¸€ç§æ™®éçš„è·å–ç”¨æˆ·ä¿¡æ¯çš„è¯·æ±‚å¤„ç†12345678910111213// example 1function getUserInfo() &#123; return new Promise(function (resolve) &#123; // an asynchronous request http.get(url, function (res) &#123; resolve(res) &#125;) &#125;)&#125;getUserInfo().then(function (res) &#123; // handle&#125;) getUserInfoæ–¹æ³•è¿”å›ä¸€ä¸ªpromiseï¼Œå¯ä»¥é€šè¿‡å®ƒçš„thenæ–¹æ³•æ³¨å†Œåœ¨promiseå¼‚æ­¥æ“ä½œæˆåŠŸæ—¶æ‰§è¡Œçš„å›è°ƒã€‚è¿™ç§æ‰§è¡Œæ–¹å¼ï¼Œä½¿å¾—å¼‚æ­¥è°ƒç”¨å˜å¾—é¡ºæ‰‹. åŸç†åˆ†æé‚£ä¹ˆç±»ä¼¼è¿™ç§åŠŸèƒ½çš„Promiseæ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿé¦–å…ˆçœ‹ä¸€ä¸‹æœ€åŸºç¡€çš„é›å½¢æ–¹æ³•å§ã€‚ æç®€çš„promiseé›å½¢12345678910111213141516function Promise(fn) &#123; var value = null, callbacks = []; // why array -&gt; there are a lot of callbacks sometimes this.then = function (onFulfilled) &#123; callbacks.push(onFulfilled) &#125; function resolve(value) &#123; callbacks.forEach(function(callback) &#123; callback(value) &#125;) &#125; fn(resolve)&#125; ä¸Šé¢çš„ä»£ç é€»è¾‘å¤§è‡´è¿™æ ·: è°ƒç”¨thenæ–¹æ³•ï¼Œå°†æƒ³è¦åœ¨Promiseå¼‚æ­¥æ“ä½œæˆåŠŸæ—¶æ‰§è¡Œå›è°ƒæ”¾å…¥callbacksé˜Ÿåˆ—ï¼Œå¯ä»¥ç†è§£ä¸ºæ³¨å†Œå›è°ƒå‡½æ•°ï¼Œå»¶ä¼¸ä¸‹å»å‘è§‚å¯Ÿè€…æ¨¡å¼æ€è€ƒ åˆ›å»ºPromiseå®ä¾‹æ—¶ä¼ å…¥çš„å‡½æ•°ä¼šè¢«èµ‹äºˆä¸€ä¸ªå‡½æ•°ç±»å‹çš„å‚æ•°ï¼Œå³resolveï¼Œä»–æ¥å—ä¸€ä¸ªå‚æ•°valueï¼Œä»£è¡¨å¼‚æ­¥æ“ä½œè¿”å›çš„ç»“æœï¼Œå½“å¼‚æ­¥æ“ä½œæ‰§è¡ŒæˆåŠŸåï¼Œä¼šè°ƒç”¨resolveæ–¹æ³•ï¼Œè¿™æ—¶å€™å…¶å®çœŸæ­£æ‰§è¡Œçš„æ“ä½œæ˜¯å°†callbacksé˜Ÿåˆ—ä¸­çš„å›è°ƒä¸€ä¸€æ‰§è¡Œç»“åˆä¸­example 1çš„ä»£ç æ¥çœ‹ï¼Œé¦–å…ˆnew Promiseæ—¶ï¼Œä¼ ç»™promiseçš„å‡½æ•°å‘é€å¼‚æ­¥è¯·æ±‚ï¼Œæ¥ç€è°ƒç”¨promiseå¯¹è±¡çš„thenå±æ€§ï¼Œæ³¨å†Œè¯·æ±‚æˆåŠŸçš„å›è°ƒå‡½æ•°ï¼Œç„¶åå½“å¼‚æ­¥è¯·æ±‚å‘é€æˆåŠŸæ—¶ï¼Œè°ƒç”¨resolve(res)æ–¹æ³•, è¯¥æ–¹æ³•æ‰§è¡Œthenæ–¹æ³•æ³¨å†Œçš„å›è°ƒæ•°ç»„ã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†æœ‰åŒå­¦ä¼šé—®ï¼Œthenæ–¹æ³•åº”è¯¥èƒ½å¤Ÿé“¾å¼è°ƒç”¨ï¼Œä½†æ˜¯ä¸Šé¢çš„æœ€åŸºç¡€ç®€å•çš„ç‰ˆæœ¬æ˜¾ç„¶æ— æ³•æ”¯æŒé“¾å¼è°ƒç”¨å•Šã€‚soæƒ³è®©thenæ–¹æ³•æ”¯æŒé“¾å¼è°ƒç”¨ï¼Œæ¥ç€å¾€ä¸‹çœ‹1234this.then = function (onFulfilled) &#123; callbacks.push(onFulfilled) return this&#125; åªè¦è¿™æ ·å°±å¯ä»¥å®ç°é“¾å¼è°ƒç”¨äº†123456// example 2getUserInfo().then(function (res) &#123; // handle&#125;).then(function (res) &#123; // handle&#125;) åŠ å…¥å»¶æ—¶æœºåˆ¶ç»†å¿ƒçš„åŒå­¦åº”è¯¥å‘ç°ï¼Œä¸Šè¿°ä»£ç è¿˜å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœåœ¨thenæ–¹æ³•æ³¨å†Œå›è°ƒä¹‹å‰ï¼Œresolveå‡½æ•°å°±æ‰§è¡Œäº†ï¼Œæ€ä¹ˆåŠï¼Ÿæ¯”å¦‚promiseå†…éƒ¨çš„å‡½æ•°æ˜¯åŒæ­¥å‡½æ•°ï¼š123456789// example 3function getUserId() &#123; return new Promise(function (resolve) &#123; resolve('gg') &#125;)&#125;getUserInfo().then(function (res) &#123; // handle&#125;) è¿™æ˜¾ç„¶æ˜¯ä¸å…è®¸çš„ï¼ŒPromises/A+è§„èŒƒæ˜ç¡®è¦æ±‚å›è°ƒéœ€è¦é€šè¿‡å¼‚æ­¥æ–¹å¼æ‰§è¡Œï¼Œç”¨ä»¥ä¿è¯ä¸€è‡´å¯é çš„æ‰§è¡Œé¡ºåºã€‚å› æ­¤æˆ‘ä»¬è¦åŠ å…¥ä¸€äº›å¤„ç†ï¼Œä¿è¯åœ¨resolveæ‰§è¡Œä¹‹å‰ï¼Œthenæ–¹æ³•å·²ç»æ³¨å†Œå®Œæ‰€æœ‰çš„å›è°ƒã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·æ”¹é€ ä¸‹resolveå‡½æ•°:1234567function resolve(value) &#123; setTimeout(function() &#123; callbacks.forEach(function (callback) &#123; callback(value) &#125;); &#125;, 0)&#125; ä¸Šé¢çš„ä»£ç çš„æ€è·¯å¤§å®¶éƒ½æ˜ç™½ï¼Œå°±æ˜¯é€šè¿‡setTimeoutæœºåˆ¶ï¼Œå°†resolveä¸­æ‰§è¡Œå›è°ƒçš„é€»è¾‘æ”¾ç½®åˆ°JSä»»åŠ¡é˜Ÿåˆ—æœ«å°¾ï¼Œä»¥ä¿è¯åœ¨resolveæ‰§è¡Œæ—¶ï¼Œthenæ–¹æ³•çš„å›è°ƒå‡½æ•°å·²ç»æ³¨å†Œå®Œæˆ.é‚£ä¹ˆé—®é¢˜åˆæ¥äº†æŸäº›åŒå­¦åˆå‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œå¯ä»¥ç»†æƒ³ä¸€ä¸‹ï¼šå¦‚æœPromiseå¼‚æ­¥æ“ä½œå·²ç»æˆåŠŸï¼Œè¿™æ—¶ï¼Œåœ¨å¼‚æ­¥æ“ä½œæˆåŠŸä¹‹å‰æ³¨å†Œçš„å›è°ƒéƒ½ä¼šæ‰§è¡Œï¼Œä½†æ˜¯åœ¨Promiseå¼‚æ­¥æ“ä½œæˆåŠŸè¿™ä¹‹åè°ƒç”¨çš„thenæ³¨å†Œçš„å›è°ƒå°±å†ä¹Ÿä¸ä¼šæ‰§è¡Œäº†ï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚ åŠ å…¥çŠ¶æ€æ©ï¼Œä¸ºäº†è§£å†³ä¸Šä¸€èŠ‚æŠ›å‡ºçš„é—®é¢˜ï¼Œæˆ‘ä»¬å¿…é¡»åŠ å…¥çŠ¶æ€æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯å¤§å®¶ç†ŸçŸ¥çš„pendingã€fulfilledã€rejectedã€‚ Promises/A+è§„èŒƒä¸­çš„2.1Promise Statesä¸­æ˜ç¡®è§„å®šäº†ï¼Œpendingå¯ä»¥è½¬åŒ–ä¸ºfulfilledæˆ–rejectedå¹¶ä¸”åªèƒ½è½¬åŒ–ä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœpendingè½¬åŒ–åˆ°fulfilledçŠ¶æ€ï¼Œé‚£ä¹ˆå°±ä¸èƒ½å†è½¬åŒ–åˆ°rejectedã€‚å¹¶ä¸”fulfilledå’ŒrejectedçŠ¶æ€åªèƒ½ç”±pendingè½¬åŒ–è€Œæ¥ï¼Œä¸¤è€…ä¹‹é—´ä¸èƒ½äº’ç›¸è½¬æ¢ã€‚æ”¹è¿›åçš„ä»£ç å¦‚ä¸‹ï¼š12345678910111213141516171819202122232425function Promise(fn) &#123; var state = 'pendding', value = null, callbacks = []; this.then = function (onFulfilled) &#123; if (state === 'pendding') &#123; callbacks.push(onFulfilled) return this &#125; onFulfilled(value) return &#125; function resolve(newValue) &#123; value = newValue, state = 'fulfilled'; setTimeout(function() &#123; callbacks.forEach(function (callback) &#123; callback(value) &#125;) &#125;, 0) &#125; fn(resolve)&#125; ä¸Šé¢çš„ä»£ç çš„æ€è·¯æ˜¯è¿™æ ·çš„ï¼šresolveæ‰§è¡Œæ—¶ï¼Œä¼šå°†çŠ¶æ€è®¾ç½®ä¸ºfulfilledï¼Œåœ¨æ­¤ä¹‹åè°ƒç”¨thenæ·»åŠ çš„æ–°å›è°ƒï¼Œéƒ½ä¼šç«‹å³æ‰§è¡Œã€‚è¿™é‡Œæ²¡æœ‰ä»»ä½•åœ°æ–¹å°†stateè®¾ä¸ºrejectedï¼Œä¸ºäº†è®©å¤§å®¶èšç„¦åœ¨æ ¸å¿ƒä»£ç ä¸Šï¼Œè¿™ä¸ªé—®é¢˜åé¢ä¼šæœ‰ä¸€å°èŠ‚ä¸“é—¨åŠ å…¥ã€‚ é“¾å¼Promiseé‚£ä¹ˆè¿™é‡Œé—®é¢˜åˆæ¥äº†æŸäº›åŒå­¦è¿˜ä¼šé—®ï¼Œå¦‚æœç”¨æˆ·åœ¨thenå‡½æ•°é‡Œé¢æ³¨å†Œçš„ä»ç„¶æ˜¯ä¸€ä¸ªPromiseï¼Œè¯¥å¦‚ä½•è§£å†³ï¼Ÿæ¯”å¦‚ä¸‹é¢çš„example 4ï¼š12345678910111213getUserInfo() .then(getUserDad) .then(function (res) &#123; // handle &#125;)function getUserDad(userInfoObj) &#123; return new Promise(function (resolve) &#123; http.get(url + userInfoObj.id, function (res) &#123; resolve(res) &#125;) &#125;)&#125; è¿™ç§åœºæ™¯ç›¸ä¿¡ç”¨è¿‡promiseçš„äººéƒ½çŸ¥é“ä¼šæœ‰å¾ˆå¤šï¼Œé‚£ä¹ˆç±»ä¼¼è¿™ç§å°±æ˜¯æ‰€è°“çš„é“¾å¼Promiseã€‚ é“¾å¼Promiseæ˜¯æŒ‡åœ¨å½“å‰promiseè¾¾åˆ°fulfilledçŠ¶æ€åï¼Œå³å¼€å§‹è¿›è¡Œä¸‹ä¸€ä¸ªpromiseï¼ˆåé‚»promiseï¼‰ã€‚é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•è¡”æ¥å½“å‰promiseå’Œåé‚»promiseå‘¢ï¼Ÿæ¥ç€æˆ‘é‚£ä¼šä¸‹çœ‹ï¼šåªè¦åœ¨thenæ–¹æ³•é‡Œé¢returnä¸€ä¸ªpromiseå°±å¥½å•¦ã€‚Promises/A+è§„èŒƒä¸­çš„2.2.7å°±æ˜¯è¿™ä¹ˆè¯´å“’ğŸ˜Š ä¸‹é¢æ¥çœ‹çœ‹è¿™æ®µæš—è—ç„æœºçš„thenæ–¹æ³•å’Œresolveæ–¹æ³•æ”¹é€ ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748function Promise(fn) &#123; var state = 'pendding', value = null, callbacks = []; this.then = function (onFulfilled) &#123; return new Promise(function (resolve) &#123; handle(&#123; onFulfilled: onFulfilled || null, resolve: resolve &#125;) &#125;) &#125; function handle(callback) &#123; if (state === 'pendding') &#123; callbacks.push(onFulfilled) return this &#125; // nothing in then if(!callback.onFulfilled) &#123; callback.resolve(value) return &#125; var ret = callback.onFulfilled(value) callback.resolve(ret) &#125; function resolve (newValue) &#123; if (newValue &amp;&amp; (typeof newValue === 'object' || typeof newValue === 'function')) &#123; var then = newValue.then if (typeof then === 'function') &#123; then.call(newValue, resolve) return &#125; &#125; value = newValue, state = 'fulfilled'; setTimeout(function() &#123; callbacks.forEach(function (callback) &#123; handle(callback) &#125;) &#125;, 0) &#125; fn(resolve)&#125; ä¸‹é¢ç»“åˆexample 4çš„ä»£ç ï¼Œåˆ†æä¸‹ä¸Šé¢çš„ä»£ç é€»è¾‘ï¼š example 4çš„thenæ–¹æ³•ä¸­ï¼Œåˆ›å»ºå¹¶è¿”å›äº†æ–°çš„Promiseå®ä¾‹ï¼Œè¿™æ˜¯ä¸²è¡ŒPromiseçš„åŸºç¡€ï¼Œå¹¶ä¸”æ”¯æŒé“¾å¼è°ƒç”¨ã€‚ handleæ–¹æ³•æ˜¯promiseå†…éƒ¨çš„æ–¹æ³•ã€‚thenæ–¹æ³•ä¼ å…¥çš„å½¢å‚onFulfilledä»¥åŠåˆ›å»ºæ–°Promiseå®ä¾‹æ—¶ä¼ å…¥çš„resolveå‡è¢«pushåˆ°å½“å‰promiseçš„callbacksé˜Ÿåˆ—ä¸­ï¼Œè¿™æ˜¯è¡”æ¥å½“å‰promiseå’Œåé‚»promiseçš„å…³é”®æ‰€åœ¨ï¼ˆè¿™é‡Œä¸€å®šè¦å¥½å¥½çš„åˆ†æä¸‹handleçš„ä½œç”¨ï¼‰ã€‚ getUserInfoç”Ÿæˆçš„promiseå¼‚æ­¥æ“ä½œæˆåŠŸï¼Œæ‰§è¡Œå…¶å†…éƒ¨æ–¹æ³•resolveï¼Œä¼ å…¥çš„å‚æ•°æ­£æ˜¯å¼‚æ­¥æ“ä½œçš„ç»“æœå³ç”¨æˆ·ä¿¡æ¯çš„å¯¹è±¡userInfoObj è°ƒç”¨handleæ–¹æ³•å¤„ç†callbacksé˜Ÿåˆ—ä¸­çš„å›è°ƒï¼šgetUserDadæ–¹æ³•ï¼Œç”Ÿæˆæ–°çš„promiseï¼ˆgetUserDad promiseï¼‰ æ‰§è¡Œä¹‹å‰ç”±getUserInfo promiseçš„thenæ–¹æ³•ç”Ÿæˆçš„æ–°promise(ç§°ä¸ºbridge promise)çš„resolveæ–¹æ³•ï¼Œä¼ å…¥å‚æ•°ä¸ºgetUserDad promiseã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä¼šå°†è¯¥resolveæ–¹æ³•ä¼ å…¥getUserDad promiseçš„thenæ–¹æ³•ä¸­ï¼Œå¹¶ç›´æ¥è¿”å›ã€‚ getUserDad promiseå¼‚æ­¥æ“ä½œæˆåŠŸæ—¶ï¼Œæ‰§è¡Œå…¶callbacksä¸­çš„å›è°ƒï¼šgetUserInfo bridge promiseä¸­çš„resolveæ–¹æ³• æœ€åæ‰§è¡ŒgetUserDad bridge promiseçš„åé‚»promiseçš„callbacksä¸­çš„å›è°ƒã€‚å¤±è´¥å¤„ç†åœ¨å¼‚æ­¥æ“ä½œå¤±è´¥æ—¶ï¼Œæ ‡è®°å…¶çŠ¶æ€ä¸ºrejectedï¼Œå¹¶æ‰§è¡Œæ³¨å†Œçš„å¤±è´¥å›è°ƒ:1234567891011121314151617// example 5function getUserInfo() &#123; return new Promise(function (resolve, reject) &#123; http.get(url, function (err, res) &#123; if (err) &#123; reject(err) &#125; resolve(res) &#125;) &#125;)&#125;getUserInfo().then(function (res) &#123; // handle res&#125;, function (err) &#123; console.log(err)&#125;) æœ‰äº†ä¹‹å‰å¤„ç†fulfilledçŠ¶æ€çš„ç»éªŒï¼Œæ”¯æŒé”™è¯¯å¤„ç†å˜å¾—å¾ˆå®¹æ˜“,åªéœ€è¦åœ¨æ³¨å†Œå›è°ƒã€å¤„ç†çŠ¶æ€å˜æ›´ä¸Šéƒ½è¦åŠ å…¥æ–°çš„é€»è¾‘ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061function Promise(fn) &#123; var state = 'pendding', value = null, callbacks = []; this.then = function (onFulfilled, onRejected) &#123; return new Promise(function (resolve, reject) &#123; handle(&#123; onFulfilled: onFulfilled || null, resolve: resolve, onRejected: onRejected || null, reject: reject &#125;) &#125;) &#125; function handle(callback) &#123; if (state === 'pendding') &#123; callbacks.push(onFulfilled) return this &#125; var ret, cb = state === 'fulfilled' ? callback.onFulfilled : callback.onRejected; if (cb === null) &#123; cb = state === 'fulfilled' ? callback.resolve : callback.reject cb(value) return &#125; ret = cb(value) callback.resolve(ret) &#125; function resolve (newValue) &#123; if (newValue &amp;&amp; (typeof newValue === 'object' || typeof newValue === 'function')) &#123; var then = newValue.then if (typeof then === 'function') &#123; then.call(newValue, resolve, reject) return &#125; &#125; value = newValue, state = 'fulfilled'; execute() &#125; function reject (reason) &#123; value = reason, state = 'rejected'; execute() &#125; execute() &#123; setTimeout(function() &#123; callbacks.forEach(function (callback) &#123; handle(callback) &#125;) &#125;, 0) &#125; fn(resolve, reject)&#125; ä¸Šé¢çš„ä»£ç å¢åŠ äº†æ–°çš„rejectæ–¹æ³•ï¼Œä¾›å¼‚æ­¥æ“ä½œå¤±è´¥æ—¶è°ƒç”¨ï¼ŒåŒæ—¶æŠ½å‡ºäº†resolveå’Œrejectå…±ç”¨çš„éƒ¨åˆ†ï¼Œå½¢æˆexecuteæ–¹æ³•ã€‚ é”™è¯¯å†’æ³¡æ˜¯ä¸Šè¿°ä»£ç å·²ç»æ”¯æŒï¼Œä¸”éå¸¸å®ç”¨çš„ä¸€ä¸ªç‰¹æ€§ã€‚åœ¨handleä¸­å‘ç°æ²¡æœ‰æŒ‡å®šå¼‚æ­¥æ“ä½œå¤±è´¥çš„å›è°ƒæ—¶ï¼Œä¼šç›´æ¥å°†bridge promise(thenå‡½æ•°è¿”å›çš„promiseï¼ŒååŒ)è®¾ä¸ºrejectedçŠ¶æ€ï¼Œå¦‚æ­¤è¾¾æˆæ‰§è¡Œåç»­å¤±è´¥å›è°ƒçš„æ•ˆæœã€‚è¿™æœ‰åˆ©äºç®€åŒ–ä¸²è¡ŒPromiseçš„å¤±è´¥å¤„ç†æˆæœ¬ï¼Œå› ä¸ºä¸€ç»„å¼‚æ­¥æ“ä½œå¾€å¾€ä¼šå¯¹åº”ä¸€ä¸ªå®é™…åŠŸèƒ½ï¼Œå¤±è´¥å¤„ç†æ–¹æ³•é€šå¸¸æ˜¯ä¸€è‡´çš„ï¼š12345678getUserInfo() .then(getUserDad) .then(function(res) &#123; // handle res &#125; function(err) &#123; // there is something wrong in getUserInfo or getUserDad console.log(err) &#125;) å¼‚å¸¸å¤„ç†ç»†å¿ƒçš„åŒå­¦åˆä¼šæƒ³åˆ°ï¼šå¦‚æœåœ¨æ‰§è¡ŒæˆåŠŸå›è°ƒã€å¤±è´¥å›è°ƒæ—¶ä»£ç å‡ºé”™æ€ä¹ˆåŠï¼Ÿå¯¹äºè¿™ç±»å¼‚å¸¸ï¼Œå¯ä»¥ä½¿ç”¨try-catchæ•è·é”™è¯¯ï¼Œå¹¶å°†bridge promiseè®¾ä¸ºrejectedçŠ¶æ€ã€‚handleæ–¹æ³•æ”¹é€ å¦‚ä¸‹ï¼š12345678910111213141516171819202122function handle(callback) &#123; if (state === 'pendding') &#123; callbacks.push(onFulfilled) return this &#125; var ret, cb = state === 'fulfilled' ? callback.onFulfilled : callback.onRejected; if (cb === null) &#123; cb = state === 'fulfilled' ? callback.resolve : callback.reject cb(value) return &#125; try &#123; ret = cb(value) callback.resolve(ret) &#125; catch(e) &#123; callback.reject(e) &#125;&#125; å¦‚æœåœ¨å¼‚æ­¥æ“ä½œä¸­ï¼Œå¤šæ¬¡æ‰§è¡Œresolveæˆ–è€…rejectä¼šé‡å¤å¤„ç†åç»­å›è°ƒï¼Œå¯ä»¥é€šè¿‡å†…ç½®ä¸€ä¸ªæ ‡å¿—ä½è§£å†³ã€‚ æ€»ç»“åˆšå¼€å§‹çœ‹promiseæºç çš„æ—¶å€™æ€»ä¸èƒ½å¾ˆå¥½çš„ç†è§£thenå’Œresolveå‡½æ•°çš„è¿è¡Œæœºç†ï¼Œä½†æ˜¯å¦‚æœä½ é™ä¸‹å¿ƒæ¥ï¼Œåè¿‡æ¥æ ¹æ®æ‰§è¡Œpromiseæ—¶çš„é€»è¾‘æ¥æ¨æ¼”ï¼Œå°±ä¸éš¾ç†è§£äº†ã€‚è¿™é‡Œä¸€å®šè¦æ³¨æ„çš„ç‚¹æ˜¯ï¼špromiseé‡Œé¢çš„thenå‡½æ•°ä»…ä»…æ˜¯æ³¨å†Œäº†åç»­éœ€è¦æ‰§è¡Œçš„ä»£ç ï¼ŒçœŸæ­£çš„æ‰§è¡Œæ˜¯åœ¨resolveæ–¹æ³•é‡Œé¢æ‰§è¡Œçš„ï¼Œç†æ¸…äº†è¿™å±‚ï¼Œå†æ¥åˆ†ææºç ä¼šçœåŠ›çš„å¤šã€‚ ç°åœ¨å›é¡¾ä¸‹Promiseçš„å®ç°è¿‡ç¨‹ï¼Œå…¶ä¸»è¦ä½¿ç”¨äº†è®¾è®¡æ¨¡å¼ä¸­çš„è§‚å¯Ÿè€…æ¨¡å¼ï¼š é€šè¿‡Promise.prototype.thenå’ŒPromise.prototype.catchæ–¹æ³•å°†è§‚å¯Ÿè€…æ–¹æ³•æ³¨å†Œåˆ°è¢«è§‚å¯Ÿè€…Promiseå¯¹è±¡ä¸­ï¼ŒåŒæ—¶è¿”å›ä¸€ä¸ªæ–°çš„Promiseå¯¹è±¡ï¼Œä»¥ä¾¿å¯ä»¥é“¾å¼è°ƒç”¨ã€‚ è¢«è§‚å¯Ÿè€…ç®¡ç†å†…éƒ¨pendingã€fulfilledå’Œrejectedçš„çŠ¶æ€è½¬å˜ï¼ŒåŒæ—¶é€šè¿‡æ„é€ å‡½æ•°ä¸­ä¼ é€’çš„resolveå’Œrejectæ–¹æ³•ä»¥ä¸»åŠ¨è§¦å‘çŠ¶æ€è½¬å˜å’Œé€šçŸ¥è§‚å¯Ÿè€…ã€‚å‚è€ƒæ–‡çŒ®https://github.com/git-lt/MPromise","tags":[]},{"title":"JSåŸºæœ¬é¢è¯•é¢˜","date":"2017-09-13T07:32:31.000Z","path":"2017/09/13/JSåŸºæœ¬é¢è¯•é¢˜/","text":"1ã€typeof a === â€˜objectâ€™ æ¥ç¡®å®šaæ˜¯å¦æ˜¯å¯¹è±¡çš„é—®é¢˜?åœ¨jsä¸­ï¼Œnullè¿™ä¸ªæ•°æ®ç±»å‹ä¹Ÿè¢«è®¤ä¸ºæ˜¯å¯¹è±¡12let a = nullconsole.log(typeof a === 'object') // true 2ã€ä¸‹é¢ä»£ç æ§åˆ¶å°è¾“å‡ºä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆï¼Ÿ12345(function()&#123; let a = b = 3&#125;)()console.log(\"a: \" + (typeof a !== 'undefined'))console.log(\"b: \" + (typeof b !== 'undefined')) å¤§éƒ¨åˆ†å¼€å‘äººå‘˜ä¼šç†è§£æˆ12let b = 3let a = b äº‹å®ä¸Šæ˜¯12b = 3let a = b æ‰€ä»¥ä½ ä¸ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼çš„è¯ï¼Œè¯¥ä»£ç è¾“å‡º12a: falseb: true use strictä¸‹ï¼Œå°±ä¼šæŠ¥errorï¼ŒReferenceError: b is not defined 3ã€ä¸‹é¢ä»£ç æ§åˆ¶å°è¾“å‡ºä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆï¼Ÿ12345678910111213let obj = &#123; a: 'a', func: function() &#123; var _this = this console.log(\"outer func: this.a = \" + this.a) console.log(\"outer func: _this.a = \" + _this.a) (function() &#123; console.log(\"inner func: this.a = \" + this.a) console.log(\"inner func: _this.a = \" + _this.a) &#125;()) &#125;&#125;obj.func() è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š1234outer func: this.a = aouter func: _this.a = ainner func: this.a = undefinedinner func: _this.a = a åœ¨outerå‡½æ•°ä¸­ï¼Œthiså’Œ_thiséƒ½æŒ‡å‘äº†objï¼Œæ‰€ä»¥èƒ½æ­£ç¡®å¼•ç”¨ï¼Œåœ¨innerå‡½æ•°ä¸­ï¼Œthisçš„æŒ‡å‘æ˜¯windowï¼Œ_thisçš„æŒ‡å‘è¿˜æ˜¯objã€‚ 4ã€å°è£…JavaScriptæºæ–‡ä»¶çš„å…¨éƒ¨å†…å®¹åˆ°ä¸€ä¸ªå‡½æ•°å—æœ‰ä»€ä¹ˆæ„ä¹‰åŠç†ç”±ï¼Ÿè¿™æ˜¯å¿…é¡»è¿™ä¹ˆåšçš„ï¼Œç°åœ¨çš„jsåº“å®åœ¨æ˜¯å¤ªå¤šäº†å¹¶ä¸”è¿˜ä¼šè¶Šæ¥è¶Šå¤šï¼Œåƒè¿™æ ·åˆ›å»ºçš„é—­åŒ…ï¼Œå°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªç§æœ‰çš„å‘½åç©ºé—´ï¼Œä»è€Œé¿å…æ¨¡å—ä¸åº“ä¹‹é—´çš„å‘½åå†²çªã€‚ç‰¹ç‚¹æ˜¯ï¼Œå…è®¸ä¸€ä¸ªæ˜“äºå¼•ç”¨çš„åˆ«åç”¨äºå…¨å±€å˜é‡ï¼Œä¾‹å¦‚1(function(yourSymbol) &#123; /* yourPluginName plugin code */ &#125; )(yourPluginName) 5ã€åœ¨JavaScriptæºæ–‡ä»¶çš„å¼€å¤´åŒ…å« â€˜use strictâ€™ æœ‰ä»€ä¹ˆæ„ä¹‰å’Œå¥½å¤„ï¼Ÿuse strict æ˜¯ä¸€ç§åœ¨jsä»£ç è¿è¡Œæ—¶è‡ªåŠ¨å®è¡Œæ›´ä¸¥æ ¼è§£æå’Œé”™è¯¯å¤„ç†çš„æ–¹æ³•ã€‚ä¼˜ç‚¹ï¼š ä½¿è°ƒè¯•æ›´åŠ å®¹æ˜“ï¼Œé‚£äº›è¢«å¿½ç•¥æˆ–é»˜é»˜å¤±è´¥äº†çš„ä»£ç é”™è¯¯ï¼Œä¼šäº§ç”Ÿé”™è¯¯æˆ–æŠ›å‡ºå¼‚å¸¸ï¼Œå› æ­¤å°½æ—©æé†’ä½ ä»£ç ä¸­çš„é—®é¢˜ï¼Œä½ æ‰èƒ½æ›´å¿«åœ°æŒ‡å¼•åˆ°å®ƒä»¬çš„æºä»£ç ã€‚ é˜²æ­¢æ„å¤–çš„å…¨å±€å˜é‡ã€‚å¦‚æœæ²¡æœ‰ä¸¥æ ¼æ¨¡å¼ï¼Œå°†å€¼åˆ†é…ç»™ä¸€ä¸ªæœªå£°æ˜çš„å˜é‡ä¼šè‡ªåŠ¨åˆ›å»ºè¯¥åç§°çš„å…¨å±€å˜é‡ã€‚è¿™æ˜¯JavaScriptä¸­æœ€å¸¸è§çš„é”™è¯¯ä¹‹ä¸€ã€‚åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œè¿™æ ·åšçš„è¯ä¼šæŠ›å‡ºé”™è¯¯ã€‚ æ¶ˆé™¤ this å¼ºåˆ¶ã€‚å¦‚æœæ²¡æœ‰ä¸¥æ ¼æ¨¡å¼ï¼Œå¼•ç”¨nullæˆ–æœªå®šä¹‰çš„å€¼åˆ° this å€¼ä¼šè‡ªåŠ¨å¼ºåˆ¶åˆ°å…¨å±€å˜é‡ã€‚åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå¼•ç”¨ nullæˆ–æœªå®šä¹‰çš„ this å€¼ä¼šæŠ›å‡ºé”™è¯¯ã€‚ ä¸å…è®¸é‡å¤çš„å±æ€§åç§°æˆ–å‚æ•°å€¼ã€‚å½“æ£€æµ‹åˆ°å¯¹è±¡ï¼ˆä¾‹å¦‚ï¼Œvar obj = {foo: â€œbarâ€, foo: â€œbazâ€}ï¼‰ä¸­é‡å¤å‘½åçš„å±æ€§ï¼Œæˆ–æ£€æµ‹åˆ°å‡½æ•°ä¸­ï¼ˆä¾‹å¦‚ï¼Œfunction foo(val1, val2, val1){}ï¼‰é‡å¤å‘½åçš„å‚æ•°æ—¶ï¼Œä¸¥æ ¼æ¨¡å¼ä¼šæŠ›å‡ºé”™è¯¯ï¼Œå› æ­¤æ•æ‰å‡ ä¹å¯ä»¥è‚¯å®šæ˜¯ä»£ç ä¸­çš„bugå¯ä»¥é¿å…æµªè´¹å¤§é‡çš„è·Ÿè¸ªæ—¶é—´ã€‚ ä½¿eval() æ›´å®‰å…¨ã€‚åœ¨ä¸¥æ ¼æ¨¡å¼å’Œéä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œeval() çš„è¡Œä¸ºæ–¹å¼æœ‰æ‰€ä¸åŒã€‚æœ€æ˜¾è€Œæ˜“è§çš„æ˜¯ï¼Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå˜é‡å’Œå£°æ˜åœ¨eval() è¯­å¥å†…éƒ¨çš„å‡½æ•°ä¸ä¼šåœ¨åŒ…å«èŒƒå›´å†…åˆ›å»ºï¼ˆå®ƒä»¬ä¼šåœ¨éä¸¥æ ¼æ¨¡å¼ä¸‹çš„åŒ…å«èŒƒå›´ä¸­è¢«åˆ›å»ºï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¸¸è§çš„é—®é¢˜æºï¼‰ã€‚ åœ¨deleteä½¿ç”¨æ— æ•ˆæ—¶æŠ›å‡ºé”™è¯¯ã€‚deleteæ“ä½œç¬¦ï¼ˆç”¨äºä»å¯¹è±¡ä¸­åˆ é™¤å±æ€§ï¼‰ä¸èƒ½ç”¨åœ¨å¯¹è±¡ä¸å¯é…ç½®çš„å±æ€§ä¸Šã€‚å½“è¯•å›¾åˆ é™¤ä¸€ä¸ªä¸å¯é…ç½®çš„å±æ€§æ—¶ï¼Œéä¸¥æ ¼ä»£ç å°†é»˜é»˜åœ°å¤±è´¥ï¼Œè€Œä¸¥æ ¼æ¨¡å¼å°†åœ¨è¿™æ ·çš„æƒ…å†µä¸‹æŠ›å‡ºå¼‚å¸¸ã€‚ 6ã€ä»¥ä¸‹ä¸¤ä¸ªå‡½æ•°ã€‚å®ƒä»¬ä¼šè¿”å›ç›¸åŒçš„ä¸œè¥¿å—ï¼Ÿ ä¸ºä»€ä¹ˆç›¸åŒæˆ–ä¸ºä»€ä¹ˆä¸ç›¸åŒï¼Ÿ12345678910111213function fn1() &#123; return &#123; dog: 'hello' &#125;&#125;function fn2() &#123; return &#123; dog: 'hello' &#125;&#125;console.log(fn1())console.log(fn2()) ç»“æœå¦‚ä¸‹ï¼š12&#123;dog: \"hello\"&#125;undefined åŸå› æ˜¯åœ¨jsä¸­ï¼Œreturnè¯­å¥çš„ä»£ç è¡Œ\båé¢æ²¡æœ‰å…¶ä»–ä»£ç çš„æ—¶å€™ï¼Œåˆ†å·ä¼šè‡ªåŠ¨æ’å…¥åˆ°è¿”å›è¯­å¥ä¹‹åï¼Œå› æ­¤ä¹Ÿä¸ä¼šæŠ›å‡ºé”™è¯¯ï¼Œfn2()é‡Œreturnä¸‹é¢çš„ä»£ç å°±æ˜¯ä¸€ä¸ªæœªä½¿ç”¨å¾—ä»£ç å—ã€‚ 7ã€ä¸‹åˆ—ä»£ç è¾“å‡ºä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ12console.log(0.1 + 0.2)console.log(0.1 + 0.2 == 0.3) æœ¬é¢˜è€ƒæŸ¥çš„æ˜¯jsä¸­æµ®ç‚¹æ•°çš„è®¡ç®—ç²¾åº¦é—®é¢˜å…ˆçœ‹ä¸‹è¾“å‡º120.30000000000000004false è¿™ä¸æ˜¯è¯­è¨€çš„bugæˆ–è€…å®¿ä¸»ç¯å¢ƒçš„bugã€‚ç›®å‰æ‰€æœ‰çš„ç¨‹åºè®¾è®¡è¯­è¨€åœ¨å¯¹æµ®ç‚¹æ•°è¿›è¡Œå››åˆ™è¿ç®—æ—¶ï¼Œéƒ½ä¼šæ¶‰åŠåˆ°æµ®ç‚¹æ•°ç²¾ç¡®åº¦çš„é—®é¢˜ã€‚æˆ‘ä»¬çŸ¥é“åœ¨è®¡ç®—æœºçš„ä¸–ç•Œä¸­ï¼Œè®¡ç®—æœºåªè®¤è¯†0ï¼Œ1ï¼Œæˆ‘ä»¬ä¼ å…¥çš„åè¿›åˆ¶æ•°å­—å¹¶ä¸ä¼šè¢«è®¡ç®—æœºç›´æ¥è¯†åˆ«ã€‚è®¡ç®—æœºä¼šå…ˆå°†å…¶è½¬æ¢æˆäºŒè¿›åˆ¶ï¼Œç„¶åä½¿ç”¨è½¬æ¢åçš„äºŒè¿›åˆ¶è¿›è¡Œè®¡ç®—ã€‚é‚£ä¹ˆ0.1å’Œ0.2è½¬æ¢æˆäºŒè¿›åˆ¶åˆ†åˆ«æ˜¯ï¼Œ (0.1) =&gt; 0.0001 1001 1001 1001 1001 1001 1001 1001 1001 1001 1001 1001 1001 101 (0.2) =&gt; 0.0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 01 ç„¶åå¯¹ä¸Šé¢çš„ä¸¤ä¸ªäºŒè¿›åˆ¶æ•°å­—åšåŠ æ³•ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ï¼Œ 0.0100 1100 1100 1100 1100 1100 1100 1100 1100 1100 1100 1100 1101 01 å†æŠŠè¿™ä¸ªäºŒè¿›åˆ¶è½¬æ¢æˆåè¿›åˆ¶ï¼Œå°±æ˜¯æˆ‘ä»¬å‰é¢çš„ç»“æœ0.30000000000000004äº†ã€‚ 8ã€ ä¸‹åˆ—ä»£ç è¡Œ1-4å¦‚ä½•æ’åºï¼Œä¸ºä»€ä¹ˆï¼Ÿ123456(function() &#123; console.log(1) setTimeout(function()&#123;console.log(2)&#125;, 1000) setTimeout(function()&#123;console.log(3)&#125;, 0) console.log(4)&#125;)() ç»“æœå¦‚ä¸‹ï¼š12341432 \bsetTimeout() ä¼šæŠŠå…¶å¼•ç”¨çš„å‡½æ•°çš„æ‰§è¡Œæ”¾åˆ°äº‹ä»¶é˜Ÿåˆ—ä¸­ï¼Œå½“å®ƒçš„ç¬¬äºŒä¸ªå‚æ•°ä¸º0æ—¶ï¼Œæ„æ€æ˜¯å°½å¿«æ‰§è¡ŒæŒ‡å®šçš„å‡½æ•°ï¼Œå…·ä½“è€Œè¨€ï¼Œå‡½æ•°çš„æ‰§è¡Œä¼šæ”¾ç½®åœ¨äº‹ä»¶é˜Ÿåˆ—çš„ä¸‹ä¸€ä¸ªè®¡æ—¶å™¨å¼€å§‹ï¼Œä½†æ˜¯è¯·æ³¨æ„ï¼Œè¿™ä¸æ˜¯ç«‹å³æ‰§è¡Œï¼Œå‡½æ•°ä¸ä¼šè¢«æ‰§è¡Œé™¤éä¸‹ä¸€ä¸ªè®¡æ—¶å™¨å¼€å§‹ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨ä¸Šè¿°çš„ä¾‹å­ä¸­ï¼Œç”¨ console.log(4) å‘ç”Ÿåœ¨è°ƒç”¨ console.log(3) ä¹‹å‰ï¼ˆå› ä¸ºè°ƒç”¨ console.log(3) æ˜¯é€šè¿‡setTimeoutè¢«è°ƒç”¨çš„ï¼Œå› æ­¤ä¼šç¨å¾®å»¶è¿Ÿï¼‰ 9ã€å†™ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼ˆè¶Šç®€æ´è¶Šå¥½ï¼‰ï¼Œè¦æ±‚è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼æŒ‡æ˜å­—ç¬¦ä¸²æ˜¯å¦ä¸ºå›æ–‡ç»“æ„ã€‚123456\bfunction isPalindrome(str) &#123; // æ’é™¤\béå•è¯å­—ç¬¦ str = str.replace(/W/g, '').toLowerCaxe() str.split('').reverse().join('') return str&#125; 10ã€å†™ä¸€ä¸ªaddæ–¹æ³•ï¼Œä¸‹é¢çš„è°ƒç”¨ï¼Œéƒ½èƒ½æ­£å¸¸è¾“å‡º12console.log(add(2, 3)) //5console.log(add(2)(3)) //5 123456789function add(x, y) &#123; if (y) &#123; return x + y &#125; else &#123; return function(y) &#123; return x + y &#125; &#125;&#125; 11ã€\bè¯·çœ‹ä¸‹é¢ä»£ç ç‰‡æ®µ12345678for (var i = 0; i &lt; 5; i++) &#123; let btn = document.createElement('button') btn.appendChild(document.createTextNode('button ' + i)) btn.addEventListener('click', function() &#123; console.log(i) &#125;) document.body.appendChild(btn)&#125; 1)å½“ç”¨æˆ·ç‚¹å‡»\bbutton4çš„æ—¶å€™ä¼šè¾“å‡ºä»€ä¹ˆåˆ°æ§åˆ¶å°ï¼Œä¸ºä»€ä¹ˆï¼Ÿ æ— è®ºç‚¹å‡»å“ªä¸ªæŒ‰é’®ï¼Œæ•°å­—5å°†æ€»ä¼šè¾“å‡ºåˆ°æ§åˆ¶å°ã€‚è¿™æ˜¯å› ä¸ºï¼Œå½“ onclick æ–¹æ³•è¢«è°ƒç”¨ï¼ˆå¯¹äºä»»ä½•æŒ‰é’®ï¼‰çš„æ—¶å€™ï¼Œ for å¾ªç¯å·²ç»ç»“æŸï¼Œå˜é‡ i å·²ç»è·å¾—äº†5çš„å€¼ 2ï¼‰æä¾›ä¸€ä¸ªæˆ–å¤šä¸ªå¤‡ç”¨çš„å¯æŒ‰é¢„æœŸå·¥ä½œçš„å®ç°æ–¹æ¡ˆã€‚ è¦è®©ä»£ç å·¥ä½œçš„å…³é”®æ˜¯ï¼Œé€šè¿‡ä¼ é€’åˆ°ä¸€ä¸ªæ–°åˆ›å»ºçš„å‡½æ•°å¯¹è±¡ï¼Œåœ¨æ¯æ¬¡ä¼ é€’é€šè¿‡ for å¾ªç¯æ—¶ï¼Œæ•æ‰åˆ° i å€¼ã€‚ä¸‹é¢æ˜¯ä¸‰ç§å¯èƒ½å®ç°çš„æ–¹æ³•ï¼š12345btn.addEventListener('click', (function(i) &#123; return function() &#123; console.log(i) &#125;&#125;)(i)) 12345(function(i) &#123; brn.addEventListener('click', function() &#123; console.log(i) &#125;)&#125;)(i) 123456['a', 'b', 'c', 'd', 'e'].forEach(function (value, i) &#123; let btn = document.createElement('button') btn.appendChild(document.createTextNode('button ' + i)) btn.addEventListener('click', function() &#123; console.log(i) &#125;) document.body.appendChild(btn)&#125;); 12ã€ä¸‹é¢çš„ä»£ç è¾“å‡ºä»€ä¹ˆåˆ°æ§åˆ¶å°ï¼Œä¸ºä»€ä¹ˆï¼Ÿ123456let arr1 = 'john'.split('')let arr2 = arr1.reverse()let arr3 = 'jones'.split('')arr2.push(arr3)console.log('arr1.length: ' + arr1.length + ' last=' + arr1.slice(-1))console.log('arr2.length: ' + arr2.length + ' last=' + arr2.slice(-1)) ç»“æœå¦‚ä¸‹ï¼š12arr1.length: last=j,o,n,e,sarr2.length: last=j,o,n,e,s \barr1å’Œarr2æ‰§è¡Œå®Œåï¼Œä¸¤è€…ç›¸åŒï¼ŒåŸå› å¦‚ä¸‹ï¼š è°ƒç”¨æ•°ç»„å¯¹è±¡çš„ reverse() æ–¹æ³•å¹¶ä¸åªè¿”å›åé¡ºåºçš„é˜µåˆ—ï¼Œå®ƒä¹Ÿåè½¬äº†æ•°ç»„æœ¬èº«çš„é¡ºåº reverse() æ–¹æ³•è¿”å›ä¸€ä¸ªåˆ°æ•°ç»„æœ¬èº«çš„å¼•ç”¨ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹å³ï¼Œarr1ï¼‰ã€‚å…¶ç»“æœä¸ºï¼Œarr2 ä»…ä»…æ˜¯ä¸€ä¸ªåˆ° arr1çš„å¼•ç”¨ï¼ˆè€Œä¸æ˜¯å‰¯æœ¬ï¼‰ã€‚å› æ­¤ï¼Œå½“å¯¹ arr2åšäº†ä»»ä½•äº‹æƒ…ï¼ˆå³å½“æˆ‘ä»¬è°ƒç”¨ arr2.push(arr3);ï¼‰æ—¶ï¼Œarr1 ä¹Ÿä¼šå—åˆ°å½±å“ï¼Œå› ä¸º arr1 å’Œ arr2 å¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚ 13ã€ä¸‹é¢çš„ä»£ç è¾“å‡ºä»€ä¹ˆåˆ°æ§åˆ¶å°ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ123456console.log(1 + '2' + '2')console.log(1 + +'2' + '2')console.log(1 + -'1' + '2')console.log(+'1' + '1' + '2')console.log( 'A' - 'B' + '2')console.log( 'A' - 'B' + 2) ç»“æœå¦‚ä¸‹ï¼š123456\b1223202112NaN2NaN","tags":[]},{"title":"ç§»åŠ¨ç«¯webAppè¸©å‘ä¹‹è®°","date":"2017-07-06T15:32:02.000Z","path":"2017/07/06/ç§»åŠ¨ç«¯webAppè¸©å‘ä¹‹è®°/","text":"è®°å½•ä¸€ä¸‹æœ€è¿‘ç§»åŠ¨ç«¯webAppé¡¹ç›®å¼€å‘ä¸­ï¼Œé‡åˆ°çš„ä¸€äº›å‘ã€‚ ä¸€ã€WebView æ€§èƒ½ä¼˜åŒ–1. WebViewçš„å¯åŠ¨åˆ°jsè§£æï¼Œç¼–è¯‘ï¼Œæ‰§è¡Œï¼Œæ¶ˆè€—çš„æ—¶é—´æ¯”è¾ƒä¹…ï¼Œç„¶åå‘ˆç°åœ¨çœ¼å‰å°±æ˜¯è¿™ä¹ˆå‡ ä¸ªçŠ¶æ€ï¼š äº¤äº’æ— åé¦ˆ åˆ°è¾¾æ–°çš„é¡µé¢ï¼Œé¡µé¢ç™½å± é¡µé¢åŸºæœ¬æ¡†æ¶å‡ºç°ï¼Œä½†æ˜¯æ²¡æœ‰æ•°æ®ï¼›é¡µé¢å¤„äºloadingçŠ¶æ€ æœ€åå‡ºç°æ‰€éœ€çš„æ•°æ® è§£å†³æ€è·¯ï¼š h5åšçš„æ˜¯å•é¡µé¢ï¼Œæ‰€ä»¥h5é¦–å…ˆåšäº†æŒ‰éœ€åŠ è½½ï¼Œæ¥ç€WebViewä¹Ÿåšäº†æŒ‰éœ€åŠ è½½ï¼Œè¿™æ ·å°±å¿«å¾ˆå¤šäº†ï¼Œæ—¶é—´å¤§æ¦‚åœ¨1-2sï¼Œ åˆšå¯åŠ¨çš„æ—¶å€™å°±è¡¥äº†ä¸ªåŠ¨ç”»é¡µå¼¥è¡¥è¿™1-2sçš„åŠ è½½ åŸç”Ÿå’Œh5éƒ½éœ€è¦åšæœ¬åœ°ç¼“å­˜ä½¿é¡µé¢å’Œå›¾ç‰‡å‘ˆç°çš„æ›´å¿«ï¼Œå†åšæ•°æ®è¯·æ±‚æ›´æ–° 2. ç‚¹å‡»å»¶è¿Ÿåœ¨WebViewä¸­ï¼Œclické€šå¸¸ä¼šæœ‰å¤§çº¦300msçš„å»¶è¿Ÿï¼ˆåŒ…æ‹¬é“¾æ¥çš„ç‚¹å‡»ï¼Œè¡¨å•çš„æäº¤ï¼Œæ§ä»¶çš„äº¤äº’ç­‰ä»»ä½•ç”¨æˆ·ç‚¹å‡»è¡Œä¸ºï¼‰ã€‚ è§£å†³æ€è·¯å‚è€ƒé“¾æ¥: fastclick äºŒã€åœ¨iosä¸­ï¼Œè¾“å…¥çŠ¶æ€æ—¶ï¼Œh5å®šä½å±æ€§fixedå¤±æ•ˆ```12345678910111213141516171819&lt;div&gt; &lt;!-- fixedå®šä½çš„å¤´éƒ¨ --&gt; &lt;header class=\"header\"&gt; æˆ‘æ˜¯å¤´éƒ¨ &lt;/header&gt; &lt;!-- å¯ä»¥æ»šåŠ¨çš„åŒºåŸŸ --&gt; &lt;main class=\"main\"&gt; &lt;!-- å†…å®¹åœ¨è¿™é‡Œ... --&gt; &lt;/main&gt; &lt;!-- fixedå®šä½çš„åº•éƒ¨ --&gt; &lt;footer class=\"footer\"&gt; &lt;div class=\"textarea needsclick\" contentEditable=\"true\" suppressContentEditableWarning&gt;&lt;/div&gt; &lt;button onclick=\"handleClick()\"&gt;å‘é€&lt;/button&gt; &lt;/footer&gt;&lt;/div&gt; ç½‘ä¸Šä¹ŸæŸ¥å¾—åˆ°ç›¸å…³è§£å†³æ–¹æ¡ˆæ¯”å¦‚ï¼šhttp://efe.baidu.com/blog/mobile-fixed-layout/ä½†æ˜¯æˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘æŒ‰è¿™ä¸ªæ€è·¯æ¥ï¼Œè¿˜æ˜¯è§£å†³ä¸äº†è¿™ä¸ªé—®é¢˜ï¼Œæœ‰äº›äººè¯´å¯ä»¥è§£å†³ï¼Œæœ‰äº›äººè¯´è§£å†³ä¸äº†ï¼Œå°±æ˜¯è¿™ä¹ˆçš„å¥‡è‘©ï¼Œæˆ–è®¸æ˜¯æˆ‘å§¿åŠ¿ä¸å¯¹å§ã€‚=_=!! soï¼Œè¿˜æ˜¯è‡ªå·±å°è¯•æ‘¸ç´¢è§£å†³ï¼Œæˆ‘çš„å¸ƒå±€headerå’Œfooteræ˜¯fixedï¼Œä¸­é—´å¯æ»šåŠ¨çš„åŒºåŸŸæ˜¯relativeï¼Œç®—äº†ä¸è¯´äº†ï¼Œç›´æ¥ä¸Šä»£ç å§ã€‚12345678910111213141516171819202122232425262728// listenFocuså’ŒlistenBluræ˜¯ç»™å¯ç¼–è¾‘divæ·»åŠ çš„èšç„¦å’Œå¤±ç„¦çš„äº‹ä»¶ç›‘å¬listenFocus = () =&gt; &#123; if (isiOS) &#123; let clientHeight = document.querySelector('.main').clientHeight // é«˜ä¿çœŸç»™çš„æ˜¯2xçš„å›¾ï¼Œå¤´éƒ¨å’Œåº•éƒ¨çš„é«˜åº¦éƒ½æ˜¯100pxï¼Œæ‰€ä»¥ä¸­é—´çš„å¯è§†é«˜åº¦å¦‚ä¸‹ let availHeight = (clientHeight - 200) / 2 // æ­¤å®šä½è§£å†³æ–¹æ¡ˆï¼Œå½“å†…å®¹è¾¾ä¸åˆ°æ»šåŠ¨æ—¶ï¼Œè¾“å…¥æ¡†å°±ä¼šç§»åŠ¨ï¼Œæ‰€ä»¥åˆ¤æ–­ä¸‹å†…å®¹é«˜åº¦æ˜¯å¦è¾¾åˆ°æ»šåŠ¨æ¡ä»¶ if (availHeight &gt; window.screen.availHeight) &#123; // å·¨å‘å•Šï¼fuck thisï¼fixedå±æ€§å¤±æ•ˆï¼Œåƒè¾›ä¸‡è‹¦æ‘¸ç´¢å®šä½è§£å†³ document.querySelector('.footer').style.position = 'relative' document.querySelector('.main').style.paddingBottom = '0' &#125; // åŸç”Ÿé”®ç›˜å¼¹èµ·å, æ“ä½œæ—¶é«˜åº¦ä¼šä¸ä¸€æ ·ï¼Œä½¿è¾“å…¥æ¡†å§‹ç»ˆä¸ä¼šè¢«é”®ç›˜é®æŒ¡ timerId = setInterval(function() &#123; document.body.scrollTop = document.body.scrollHeight &#125;, 100) &#125;&#125; listenBlur = () =&gt; &#123; if (isiOS) &#123; let clientHeight = document.querySelector('.main').clientHeight let availHeight = (clientHeight - 200) / 2 if (availHeight &gt; window.screen.availHeight) &#123; document.querySelector('.footer').style.position = 'fixed' document.querySelector('.main').style.paddingBottom = '1rem' &#125; clearInterval(timerId) &#125; å»ºè®®ç§»åŠ¨ç«¯å¤§å¤šç”¨flexå¸ƒå±€","tags":[]},{"title":"Hello World","date":"2017-01-05T14:59:57.000Z","path":"2017/01/05/hello-world/","text":"åœ¨æœ‹å‹çš„ä»‹ç»ä¸‹ï¼Œè¿™ä¸ªåšå®¢å¾ˆå¿«å°±æ­å»ºèµ·æ¥äº†ã€‚ å½“çœ‹è§å®ƒåŠ è½½ä¸‹æ¥çš„æ—¶å€™ï¼Œå†…å¿ƒè¿˜æ˜¯å¾ˆå–œæ‚¦çš„ï¼Œæœ‰äº†è‡ªå·±çš„ä¸€å°å—é¢†åœ°ï¼Œè¿™ç§æ„Ÿè§‰å¾ˆå¥‡å¦™ï¼Œç°åœ¨æƒ³æƒ³éƒ½è¿˜æœ‰ç‚¹å°åˆºæ¿€å‘¢ã€‚å¯¹æˆ‘è¿™ç§è¯­æ–‡æ˜¯ä½“è‚²è€å¸ˆæ•™çš„å®å®ï¼Œæƒ³æƒ³è¦å†™ä½œï¼Œæˆ‘å°±ä¸è‡ªè§‰çš„åœ¨å·ç¬‘ï¼Œå•Šå“ˆå“ˆ =_=å¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´ï¼Œè¯·æ‰“å¼€å­¦ä¹ æ—…ç¨‹å§ï¼ å½“ç„¶è¿™ä¸ªè‰²è°ƒå’Œä¸»é¢˜ç”šæ˜¯å–œæ¬¢å•Šï¼Œæ„Ÿè°¢littenå¤§è™¾çš„ç¥ä½œã€‚","tags":[]}]