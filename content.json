[{"title":"å®Œå…¨ç†è§£call()ã€apply()ã€bind()çš„ç”¨æ³•å’Œå®ç°","date":"2019-08-26T02:16:13.000Z","path":"2019/08/26/å®Œå…¨ç†è§£call()ã€apply()ã€bind()çš„ç”¨æ³•å’Œå®ç°/","text":"é¦–å…ˆæˆ‘ä»¬éƒ½çŸ¥é“è¿™ä¸‰å…„å¼Ÿéƒ½æ˜¯ä¸ºäº†æ”¹å˜å‡½æ•°è¿è¡Œæ—¶ä¸Šä¸‹æ–‡(thisæŒ‡å‘)è€Œå­˜åœ¨çš„ã€‚ é‚£ä¹ˆåˆ°åº•æ˜¯ä¸ªæ€ä¹ˆå›äº‹å‘¢ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹ä¸‹é¢å¾—ä¾‹å­ï¼Œæ¥ä½“éªŒä¸‹ï¼š 123456789101112131415const name = 'Kobe', age = 18;const player = &#123; name: 'Irving', age: this.age, func: function() &#123; console.log(`$&#123;this.name&#125; is $&#123;this.age&#125; years old`) &#125;&#125;function getName() &#123; console.log(this.name)&#125;player.age // this æŒ‡å‘ player -&gt; 18player.func() // this æŒ‡å‘ player -&gt; Irving is 18 years oldgetName() // this æŒ‡å‘ window -&gt; Kobe ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹ä¸‰å…„å¼Ÿçš„ç”¨æ³• 12345678910111213141516const name = 'Kobe', age = 18;const player = &#123; name: 'Irving', age: this.age || 16, func: function() &#123; console.log(`$&#123;this.name&#125; is $&#123;this.age&#125; years old`) &#125;&#125;const otherPlayer = &#123; name: 'Wade', age: 17&#125;player.func.call(otherPlayer) // Wade is 17 years oldplayer.func.apply(otherPlayer) // Wade is 17 years oldplayer.func.bind(otherPlayer)() // Wade is 17 years old è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œä¸€ä¸ªå‚æ•°çš„æƒ…å†µä¸‹ï¼Œcallå’Œapplyè¿”å›äº†ç›¸åŒçš„ç»“æœï¼Œbindå‘¢åˆ™æ˜¯è¿”å›äº†ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œä½ è¦æ‰§è¡Œå®ƒåœ¨è¿”å›ç»“æœã€‚ æ¥ç€çœ‹ä¸‹å¤šä¸ªå‚æ•°çš„æƒ…å†µï¼š 1234567891011121314151617const name = 'Kobe', age = 18;const player = &#123; name: 'Irving', age: this.age || 16, func: function(from, team) &#123; console.log(`$&#123;this.name&#125; is $&#123;this.age&#125; years old, from $&#123;from&#125;, play in the $&#123;team&#125;`) &#125;&#125;const otherPlayer = &#123; name: 'Wade', age: 17&#125;player.func.call(otherPlayer, 'Chicago', 'Heat') // Wade is 17 years old, from Chicago, play in the Heatplayer.func.apply(otherPlayer, ['Chicago', 'Heat']) // Wade is 17 years old, from Chicago, play in the Heatplayer.func.bind(otherPlayer, 'Chicago', 'Heat')() // Wade is 17 years old, from Chicago, play in the Heatplayer.func.bind(otherPlayer, ['Chicago', 'Heat'])() // Wade is 17 years old, from Chicago,Heat, play in undefined æˆ‘ä»¬åˆå‘ç° call æ˜¯ä¸€ä¸ªä¸€ä¸ªå‚æ•°æ¥æ¥æ”¶çš„ï¼Œapply åˆ™æ˜¯æ¥å—äº†ä¸€ä¸ªåˆ—è¡¨ï¼Œbind åˆ™æ˜¯é™¤äº†è¿”å›å‡½æ•°ä»¥å¤–ï¼Œå…¶ä»–å‚æ•°å’Œ call ä¸€æ ·ã€‚æ‰€ä»¥çœ‹è‡ªå·±çš„åº”ç”¨åœºæ™¯æ¥å–æ‹©å³å¯ï¼Œä½ æƒ³è¦ç€é‡å±•ç°å‚æ•°çš„æ„ä¹‰å°±å¯ä»¥é€‰ callï¼Œå½“ç„¶å‚æ•°ä¸ä»…ä»…æ˜¯ä¾‹å­ä¸Šçš„ string ç±»å‹ï¼Œå…¶ä»–å‡å¯ä»¥ã€‚ çœ‹åˆ°è¿™é‡Œæ˜¯ä¸æ˜¯å¯¹è¿™ä¸‰å…„å¼Ÿæ˜¯å’‹ç©çš„æœ‰äº†ä¸€å®šçš„äº†è§£å•¦ï¼Œæ¥ä¸‹å»æˆ‘ä»¬å°±å»è‡ªå·±æ¨¡æ‹Ÿå®ç°å®ƒä»¬ï¼Œä»è€Œå¯¹ä»–ä»¬åŠ æ·±ç†è§£ã€‚ æ¨¡æ‹Ÿå®ç° call 12345678910111213Function.prototype._call = function(context = window) &#123; // å‡å¦‚æ²¡ä¼ ä¸Šä¸‹æ–‡ context é»˜è®¤å– window if (this === Function.prototype) return; // ç”¨äºé˜²æ­¢ Function.prototype._call() ç›´æ¥è°ƒç”¨ // æ–°å»ºä¸€ä¸ªä¸ä¼šé‡åçš„å±æ€§ï¼Œé˜²æ­¢é‡å†™ const attr = Symbol() context[attr] = this // æŠŠç±»æ•°ç»„å˜ä¸ºæ•°ç»„ï¼Œè¿‡æ»¤ window å‚æ•° const args = [...arguments].slice(1) const result = context[attr](args) delete context[attr] return result&#125; æ¨¡æ‹Ÿå®ç° apply 123456789101112131415Function.prototype._apply = function(context = window) &#123; if (this === Function.prototype) return; const attr = Symbol() context[attr] = this // å–å‡ºå‚æ•°åˆ—è¡¨ const args = [...arguments][1] let result; if (!args) &#123; result = context[attr]() &#125; else &#123; result = context[attr](...args) &#125; delete context[attr] return result&#125; æ¨¡æ‹Ÿå®ç° bind 12345678Function.prototype._bind = function(context = window) &#123; const self = this const args = [...arguments].slice(1) return function() &#123; const newArg = [...arguments] return self.apply(context, args.concat(newArg)) &#125;&#125; è¿™ä¸‹æ˜¯ä¸æ˜¯å®Œå…¨ç†è§£è¿™ä¸‰å…„å¼Ÿäº†å‘¢ï¼Œä»–ä»¬å°±æ˜¯ä¸ºäº†æ”¹å˜å‡½æ•°è¿è¡Œæ—¶ä¸Šä¸‹æ–‡è€Œæ¥çš„ï¼Œæ ¹æ®å®é™…æƒ…å†µæ¥é€‰æ‹©ä½¿ç”¨å³å¯ã€‚","tags":[{"name":"js","slug":"js","permalink":"//zhoujingchao.github.io/tags/js/"}]},{"title":"Reactæºç è§£æ-ç»„ä»¶çš„åˆå§‹åŒ–ä¸æŒ‚è½½ï¼ˆä¸€ï¼‰","date":"2019-08-19T08:03:14.000Z","path":"2019/08/19/Reactæºç è§£æ-ç»„ä»¶çš„å®ç°ä¸æŒ‚è½½ï¼ˆä¸€ï¼‰/","text":"React æ˜¯ç¬”è€…çš„ä¸»è¦æŠ€æœ¯æ ˆä¹‹ä¸€ï¼Œéš¾å…æƒ³æ¢ç´¢ä¸€ä¸‹å†…éƒ¨çš„ä¸€äº›æœºåˆ¶å®ç°ï¼Œç¬”è€…ä¼šä»ç»„ä»¶çš„åˆå§‹åŒ–ä¸æŒ‚è½½ã€ä»»åŠ¡è°ƒåº¦ã€ç»„ä»¶ç±»å‹å’Œç”Ÿå‘½å‘¨æœŸã€äº‹åŠ¡ã€äº‹ä»¶ã€hookç­‰æ–¹å‘è¿›è¡Œå­¦ä¹ è§£æï¼Œä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡è¿›è¡Œæºç è§£æçš„å†™ä½œï¼Œå¦‚æœ‰æ¬ å¦¥ä¹‹å¤„ï¼Œæ¬¢è¿æœ‹å‹ä»¬ä¸åæŒ‡æ­£å’Œè®¨è®ºï¼Œå…±åŒå­¦ä¹ è¿›æ­¥ã€‚ ä¸‹é¢ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ React ç»„ä»¶çš„å®ç° ä¸€ã€ç»„ä»¶æ˜¯ä»€ä¹ˆé¦–å…ˆç¼–å†™ä¸€ä¸ªæœ€ç®€å•çš„ç»„ä»¶ 12345678910111213import React, &#123; Component &#125; from 'react';class App extends Component &#123; render() &#123; return ( &lt;div&gt;This is Component App&lt;/div&gt; ); &#125;&#125;console.log(&lt;App /&gt;)export default App; è¿™æ®µä»£ç æˆ‘ä»¬å®ç°äº† &lt;App /&gt; ç»„ä»¶ï¼Œæˆ‘ä»¬æ‰“å°å‡ºæ¥çœ‹çœ‹æ˜¯ä¸ªå•¥ï¼š å¯ä»¥çœ‹å‡ºï¼Œ&lt;App /&gt; å…¶å®æ˜¯jså¯¹è±¡ä¸æ˜¯çœŸå®çš„DOMï¼Œæ³¨æ„æ­¤æ—¶çš„ props æ˜¯ç©ºå¯¹è±¡ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ‰“å° &lt;App&gt;&lt;div&gt;This is Component App&lt;/div&gt;&lt;/App&gt;: æˆ‘ä»¬çœ‹åˆ°ï¼Œprops å‘ç”Ÿäº†å˜åŒ–ï¼Œç”±äº &lt;App /&gt; ç»„ä»¶ä¸­åµŒå¥—äº†ä¸€ä¸ª divï¼Œdiv ä¸­åˆåµŒå¥—äº†æ–‡å­—ï¼Œæ‰€ä»¥åœ¨æè¿° &lt;App /&gt; å¯¹è±¡çš„ props ä¸­å¢åŠ äº† children å±æ€§ï¼Œå…¶å€¼ä¸ºæè¿° div çš„jså¯¹è±¡ã€‚åŒç†ï¼Œå¦‚æœæˆ‘ä»¬è¿›è¡Œå¤šå±‚çš„ç»„ä»¶åµŒå¥—ï¼Œå…¶å®å°±æ˜¯åœ¨çˆ¶å¯¹è±¡çš„ props ä¸­å¢åŠ  children å­—æ®µåŠå¯¹åº”çš„æè¿°å€¼ï¼Œä¹Ÿå°±æ˜¯jså¯¹è±¡çš„å¤šå±‚åµŒå¥—ã€‚ é‚£ä¹ˆå±•ç°åœ¨æˆ‘ä»¬çœ¼å‰çš„htmlæ ‡ç­¾ï¼Œå®é™…ä¸Šå´æ˜¯å¯¹è±¡çš„Reactç»„ä»¶æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ æˆ‘ä»¬ä»ä»£ç çš„ç»„ä»¶å£°æ˜ä¸ºæºå¤´è¿›è¡Œæ¢ç´¢ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰“å¼€reactå†…umdè§„èŒƒä¸‹çš„ react.development.jsï¼Œçœ‹åˆ°å¦‚ä¸‹ä»£ç ï¼š 12345678910111213141516var React = &#123; Children: &#123; map: mapChildren, forEach: forEachChildren, count: countChildren, toArray: toArray, only: onlyChild &#125;, createRef: createRef, Component: Component, PureComponent: PureComponent, // ...&#125; æˆ‘ä»¬åœ¨ import React, { Component } from &#39;react&#39; æ—¶ï¼Œå¼•å…¥çš„å°±æ˜¯æºç ä¸­æä¾›çš„ React å¯¹è±¡ã€‚åœ¨ extends Component æ—¶ï¼Œç»§æ‰¿äº† Component ç±»ã€‚å› ä¸º Component æ˜¯ React.Component çš„å¼•ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ Component === React.Componentï¼Œåœ¨å®é™…é¡¹ç›®ä¸­éƒ½å¯ä»¥å†™ã€‚ æ²¿ç€ Component çº¿ç´¢æˆ‘ä»¬ç»§ç»­åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œæœå¯»ä¸€ä¸‹å®ƒçš„è¸ªè¿¹ï¼š 12345678910111213function Component(props, context, updater) &#123; this.props = props; this.context = context; this.refs = emptyObject; this.updater = updater || ReactNoopUpdateQueue;&#125;Component.prototype.isReactComponent = &#123;&#125;;Component.prototype.setState = function (partialState, callback) &#123; // ...&#125;;Component.prototype.forceUpdate = function (callback) &#123; // ...&#125;; ä¸Šè¿°ä»£ç å¤§å®¶å†ç†Ÿæ‚‰ä¸è¿‡äº†ã€‚åŒæ—¶æˆ‘ä»¬ä¹Ÿå‘ç° setState æ˜¯å®šä¹‰åœ¨åŸå‹ä¸Šå…·æœ‰ä¸¤ä¸ªå‚æ•°çš„æ–¹æ³•ï¼Œå…·ä½“åŸç†æˆ‘ä»¬å°†åœ¨åç»­çš„ç¯‡ç« è¿›è¡Œè§£æã€‚ ä¸Šè¿°ä»£ç è¡¨æ˜ï¼Œæˆ‘ä»¬åœ¨æœ€å¼€å§‹å£°æ˜çš„ç»„ä»¶Appï¼Œå…¶å®æ˜¯ç»§æ‰¿ Componentç±»ï¼Œå®ƒçš„åŸå‹å…·æœ‰ setState ç­‰æ–¹æ³•ã€‚è¿™æ ·ç»„ä»¶Appå·²ç»æœ‰äº†æœ€åŸºæœ¬çš„é›å½¢ã€‚ äºŒã€ç»„ä»¶çš„åˆå§‹åŒ–å£°æ˜Appåï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶å†…éƒ¨è‡ªå®šä¹‰æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸçš„æ–¹æ³•ï¼Œè¿™äº›å’Œæˆ‘ä»¬åœ¨å†™â€ç±»â€çš„æ—¶å€™æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚å”¯ä¸€ä¸åŒçš„æ˜¯ç»„ä»¶ç±»å¿…é¡»æ‹¥æœ‰ render æ–¹æ³•è¾“å‡ºç±»ä¼¼ &lt;div&gt;This is Component App&lt;/div&gt;çš„ç»“æ„å¹¶æŒ‚è½½åˆ°çœŸå®DOMä¸Šï¼Œæ‰èƒ½è§¦å‘ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå¹¶æˆä¸ºDOMæ ‘çš„ä¸€éƒ¨åˆ†ã€‚é¦–å…ˆæˆ‘ä»¬è§‚å¯ŸES6çš„â€ç±»â€æ˜¯å¦‚ä½•åˆå§‹åŒ–ä¸€ä¸ªreactç»„ä»¶çš„ã€‚ å°†æœ€åˆçš„ä»£ç æ”¾å…¥ babel ä¸­123456789101112131415161718192021var App =function (_Component) &#123; _inherits(App, _Component); function App() &#123; _classCallCheck(this, App); return _possibleConstructorReturn(this, _getPrototypeOf(App).apply(this, arguments)); &#125; _createClass(App, [&#123; key: \"render\", value: function render() &#123; return _react.default.createElement(\"div\", null, \"This is Component App\"); &#125; &#125;]); return App;&#125;(_react.Component);exports.default = App; å…¶ä¸­ _Component æ˜¯å¯¹è±¡ Componentï¼Œ_inherit æ–¹æ³•æ˜¯ extends å…³é”®å­—çš„å‡½æ•°å®ç°ï¼Œè¿™äº›éƒ½æ˜¯ES6ç›¸å…³å†…å®¹ï¼Œæˆ‘ä»¬æš‚æ—¶ä¸ç®¡ã€‚å…³é”®åœ¨äºæˆ‘ä»¬å‘ç° render æ–¹æ³•å®é™…ä¸Šæ˜¯è°ƒç”¨äº† _react.default.createElement æ–¹æ³•ã€‚ç„¶åæˆ‘ä»¬ç»§ç»­åœ¨æˆ‘ä»¬çš„æºç æ–‡ä»¶ä¸­æœå¯» createElementï¼š 1234567891011121314function createElement(type, config, children) &#123; var propName = void 0; var props = &#123;&#125;; var key = null; var ref = null; var self = null; var source = null; // ... return ReactElement(type, key, ref, self, source, ReactCurrentOwner.current, props);&#125; æ¥ç€æœå¯» ReactElement: 12345678910111213141516var ReactElement = function (type, key, ref, self, source, owner, props) &#123; var element = &#123; $$typeof: REACT_ELEMENT_TYPE, type: type, key: key, ref: ref, props: props, _owner: owner &#125;; // ... return element;&#125;; çœ‹åˆ°è¿™é‡Œæˆ‘ä»¬å‘ç°ï¼Œæ¯ä¸€ä¸ªç»„ä»¶å¯¹è±¡éƒ½æ˜¯é€šè¿‡ ReactElement æ–¹æ³•åˆ›å»ºå‡ºæ¥çš„å¯¹è±¡ã€‚æ¢å¥è¯è¯´ï¼ŒReactElment æ˜¯ä¸€ç§å†…éƒ¨è®°å½•ç»„ä»¶ç‰¹å¾çš„å¯¹è±¡ã€‚åœ¨ ReactElement ä¸­: $$typeof: ä½¿ç”¨ç¬¦å·æ ‡è®°æ¯ä¸ªReactElement type: ç”¨äºåˆ¤æ–­å¦‚ä½•åˆ›å»ºèŠ‚ç‚¹ key: DOMç»“æ„æ ‡è¯†ï¼Œæå‡updateæ€§èƒ½ ref: çœŸå®DOMçš„ props: å­ç»“æ„ç›¸å…³ä¿¡æ¯(æœ‰åˆ™å¢åŠ childrenå­—æ®µ/æ²¡æœ‰ä¸ºç©º)å’Œç»„ä»¶å±æ€§(å¦‚styleç­‰ç­‰) _owner: _owner === ReactCurrentOwner.current, å€¼ä¸ºåˆ›å»ºå½“å‰ç»„ä»¶çš„å¯¹è±¡ï¼Œé»˜è®¤å€¼ä¸ºnull æ€»çš„æ¥è¯´ï¼ŒReactElement å°±æ˜¯ä¸€ä¸ªç”¨æ¥æ‰¿è½½ä¿¡æ¯çš„å®¹å™¨ï¼Œå¯¹äºåæœŸæ„å»ºåº”ç”¨çš„æ ‘ç»“æ„æ˜¯éå¸¸é‡è¦çš„ã€‚ äºŒã€ç»„ä»¶çš„æŒ‚è½½æˆ‘ä»¬çŸ¥é“å¯ä»¥é€šè¿‡ ReactDOM.render(component, mountNode)çš„å½¢å¼å¯¹è‡ªå®šä¹‰ç»„ä»¶/åŸç”ŸDOM/å­—ç¬¦ä¸²è¿›è¡ŒæŒ‚è½½ã€‚ æˆ‘ä»¬çœ‹ä¸‹æºç å®ç°ï¼Œæ‰¾åˆ°react-domå†…umdè§„èŒƒä¸‹çš„ react-dom.development.jsï¼Œæ‰¾åˆ° render æ–¹æ³•çœ‹ä¸€ä¸‹ï¼š 1234render: function (element, container, callback) &#123; // ... return legacyRenderSubtreeIntoContainer(null, element, container, false, callback); &#125; 1234567891011121314151617181920212223242526272829303132333435363738function legacyRenderSubtreeIntoContainer(parentComponent, children, container, forceHydrate, callback) &#123; // ... var root = container._reactRootContainer; if (!root) &#123; // Initial mount root = container._reactRootContainer = legacyCreateRootFromDOMContainer(container, forceHydrate); if (typeof callback === 'function') &#123; var originalCallback = callback; callback = function () &#123; var instance = getPublicRootInstance(root._internalRoot); originalCallback.call(instance); &#125;; &#125; // Initial mount should not be batched. unbatchedUpdates(function () &#123; if (parentComponent != null) &#123; root.legacy_renderSubtreeIntoContainer(parentComponent, children, callback); &#125; else &#123; root.render(children, callback); &#125; &#125;); &#125; else &#123; if (typeof callback === 'function') &#123; var _originalCallback = callback; callback = function () &#123; var instance = getPublicRootInstance(root._internalRoot); _originalCallback.call(instance); &#125;; &#125; // Update if (parentComponent != null) &#123; root.legacy_renderSubtreeIntoContainer(parentComponent, children, callback); &#125; else &#123; root.render(children, callback); &#125; &#125; return getPublicRootInstance(root._internalRoot);&#125; å› ä¸ºæ˜¯é¦–æ¬¡æ¸²æŸ“æ›´æ–°ï¼Œæ‰€ä»¥ root æ˜¯ nullï¼Œåªéœ€çœ‹ !root çš„æƒ…å†µï¼Œå®ƒè°ƒç”¨äº† legacyCreateRootFromDOMContainerï¼Œæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹ï¼š 1234567891011121314151617181920212223242526function legacyCreateRootFromDOMContainer(container, forceHydrate) &#123; var shouldHydrate = forceHydrate || shouldHydrateDueToLegacyHeuristic(container); // First clear any existing content. if (!shouldHydrate) &#123; var warned = false; var rootSibling = void 0; while (rootSibling = container.lastChild) &#123; &#123; if (!warned &amp;&amp; rootSibling.nodeType === ELEMENT_NODE &amp;&amp; rootSibling.hasAttribute(ROOT_ATTRIBUTE_NAME)) &#123; warned = true; warningWithoutStack$1(false, 'render(): Target node has markup rendered by React, but there ' + 'are unrelated nodes as well. This is most commonly caused by ' + 'white-space inserted around server-rendered markup.'); &#125; &#125; container.removeChild(rootSibling); &#125; &#125; &#123; if (shouldHydrate &amp;&amp; !forceHydrate &amp;&amp; !warnedAboutHydrateAPI) &#123; warnedAboutHydrateAPI = true; lowPriorityWarning$1(false, 'render(): Calling ReactDOM.render() to hydrate server-rendered markup ' + 'will stop working in React v17. Replace the ReactDOM.render() call ' + 'with ReactDOM.hydrate() if you want React to attach to the server HTML.'); &#125; &#125; // Legacy roots are not async by default. var isConcurrent = false; return new ReactRoot(container, isConcurrent, shouldHydrate);&#125; æ­¤æ—¶ forceHydrate æ˜¯ falseï¼Œæ‰€ä»¥çœ‹ shouldHydrateDueToLegacyHeuristic(container) è¿”å›çš„æ˜¯å•¥ï¼Ÿ 123456789// åˆ¤æ–­æ˜¯å¦ä¸ºæœåŠ¡ç«¯æ¸²æŸ“function shouldHydrateDueToLegacyHeuristic(container) &#123; //è·å–containerçš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆæ ¹èŠ‚ç‚¹ï¼‰ï¼Œä¹Ÿå°±æ˜¯ id='root' çš„èŠ‚ç‚¹ var rootElement = getReactRootElementInContainer(container); return !!(rootElement &amp;&amp; rootElement.nodeType === ELEMENT_NODE &amp;&amp; // åˆ¤æ–­æ˜¯å¦æ˜¯æœåŠ¡ç«¯æ¸²æŸ“ rootElement.hasAttribute(ROOT_ATTRIBUTE_NAME));&#125; 1var ROOT_ATTRIBUTE_NAME = 'data-reactroot'; 1234567891011function getReactRootElementInContainer(container) &#123; if (!container) &#123; return null; &#125; if (container.nodeType === DOCUMENT_NODE) &#123; return container.documentElement; &#125; else &#123; return container.firstChild; &#125;&#125; container çš„é¦–èŠ‚ç‚¹æ˜¯æ²¡æœ‰ data-reactroot å±æ€§çš„ï¼Œæ‰€ä»¥ä¼šè¿›è¡Œwhileå¾ªç¯ï¼Œä¾æ¬¡åˆ é™¤ container çš„å­èŠ‚ç‚¹ï¼Œåˆ é™¤å®Œæ¯•åï¼Œnew ä¸€ä¸ª ReactRoot çš„å®ä¾‹ã€‚æ‰€ä»¥è¯´åˆ¤æ–­æ˜¯å¦æ˜¯æœåŠ¡ç«¯æ¸²æŸ“çš„æ ‡å¿—æ˜¯ï¼šåœ¨è·å– container ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆæˆ–æ–‡æ¡£èŠ‚ç‚¹ï¼‰åï¼Œçœ‹è¯¥èŠ‚ç‚¹æ˜¯å¦æœ‰å±æ€§ ROOT_ATTRIBUTE_NAMEã€‚ æ¥ç€ ReactRoot çš„çº¿ç´¢å¾€ä¸‹çœ‹ï¼Œé€šè¿‡ createContainer å»åˆ›å»º FiberRoot, è¿™ä¸ª FiberRoot å¯¹è±¡åœ¨åæœŸè°ƒåº¦æ›´æ–°çš„è¿‡ç¨‹ä¸­éå¸¸éå¸¸é‡è¦ï¼Œä¹Ÿæ˜¯æ–°ç‰ˆReactçš„æ ¸å¿ƒã€‚ 1234function ReactRoot(container, isConcurrent, hydrate) &#123; var root = createContainer(container, isConcurrent, hydrate); this._internalRoot = root;&#125; 123function createContainer(containerInfo, isConcurrent, hydrate) &#123; return createFiberRoot(containerInfo, isConcurrent, hydrate);&#125; 12345678910111213ReactRoot.prototype.render = function (children, callback) &#123; var root = this._internalRoot; var work = new ReactWork(); callback = callback === undefined ? null : callback; &#123; warnOnInvalidCallback(callback, 'render'); &#125; if (callback !== null) &#123; work.then(callback); &#125; updateContainer(children, root, null, work._onCommit); return work;&#125;; 12345678910function updateContainer(element, container, parentComponent, callback) &#123; var current$$1 = container.current; // è¿”å›çš„æ—¶é—´æ˜¯ä»¥ä¸‹è¿™ç§æ•°æ®ç±»å‹ // æ˜¯ä»¥V8å¼•æ“ä¸Šæœ€å¤§31ä½æ•´æ•°1073741823ä¸ºæ ¹æ®çš„ // å¯ä»¥è¿½æº¯è¿™ä¸ªrequestCurrentTimeå‡½æ•°ï¼Œå°±èƒ½çœ‹è§æºç æ³¨é‡Šäº† var currentTime = requestCurrentTime(); // è®¡ç®—è¿‡æœŸæ—¶é—´ï¼Œè¿™æ˜¯Reactä¼˜å…ˆçº§æ›´æ–°éå¸¸é‡è¦çš„ç‚¹ var expirationTime = computeExpirationForFiber(currentTime, current$$1); return updateContainerAtExpirationTime(element, container, parentComponent, expirationTime, callback);&#125; æˆ‘ä»¬å‘ç°è°ƒç”¨äº† updateContainer æ–¹æ³•åï¼Œå†…éƒ¨å¼€å§‹è®¡ç®—æ—¶é—´ requestCurrentTime(), computeExpirationForFiber()æš‚ä¸”å…ˆä¸ç®¡å…·ä½“ç»†èŠ‚ã€‚ 12345function updateContainerAtExpirationTime(element, container, parentComponent, expirationTime, callback) &#123; var current$$1 = container.current; // ... return scheduleRootUpdate(current$$1, element, expirationTime, callback);&#125; 1234567891011121314151617181920212223242526272829function scheduleRootUpdate(current$$1, element, expirationTime, callback) &#123; &#123; if (phase === 'render' &amp;&amp; current !== null &amp;&amp; !didWarnAboutNestedUpdates) &#123; didWarnAboutNestedUpdates = true; warningWithoutStack$1(false, 'Render methods should be a pure function of props and state; ' + 'triggering nested component updates from render is not allowed. ' + 'If necessary, trigger nested updates in componentDidUpdate.\\n\\n' + 'Check the render method of %s.', getComponentName(current.type) || 'Unknown'); &#125; &#125; // åˆ›å»ºæ›´æ–°çš„æ—¶é—´èŠ‚ç‚¹ var update = createUpdate(expirationTime); // Caution: React DevTools currently depends on this property // being called \"element\". update.payload = &#123; element: element &#125;; callback = callback === undefined ? null : callback; if (callback !== null) &#123; !(typeof callback === 'function') ? warningWithoutStack$1(false, 'render(...): Expected the last optional `callback` argument to be a ' + 'function. Instead received: %s.', callback) : void 0; update.callback = callback; &#125; flushPassiveEffects(); // æ•´ä¸ªReactåº”ç”¨ä¸­ï¼Œä¼šæœ‰å¤šæ¬¡æ›´æ–°ï¼Œè€Œè¿™å¤šæ¬¡æ›´æ–°éƒ½åœ¨è¿™ä¸ªæ›´æ–°é˜Ÿåˆ—ä¸­ enqueueUpdate(current$$1, update); // è¿›è¡Œä»»åŠ¡è°ƒåº¦ï¼Œå½“Reactè¿›è¡ŒUpdateåï¼Œå°±è¦è¿›è¡Œè°ƒåº¦ // å³æ ¹æ®ä»»åŠ¡çš„ä¼˜å…ˆçº§å»è°ƒåº¦ä»»åŠ¡ï¼Œå…ˆæ‰§è¡Œä¼˜å…ˆçº§é«˜çš„ä»»åŠ¡ï¼Œ scheduleWork(current$$1, expirationTime); return expirationTime;&#125; enqueueUpdate() å’Œ scheduleWork()ï¼Œè¿™ä¸ªä»»åŠ¡è°ƒåº¦æ˜¯æœ€é‡è¦ä¸”æœ€å¤æ‚çš„å†…å®¹äº†ï¼Œåç»­æ…¢æ…¢æ¥è§£æã€‚ä»¥ä¸Šæˆ‘ä»¬çœ‹è§è¿™ä¸ªè®¡åˆ’æ›´æ–°rootçš„å‡½æ•°æœ€ç»ˆè¿”å›äº†ä¸€ä¸ª expirationTime, å°±æ˜¯è¯´ updateContainer() è¿”å›äº† expirationTimeã€‚ åˆ°è¿™å…ˆå‘Šä¸€æ®µè½äº†ï¼Œæˆ‘ä»¬æ¥ç€å›åˆ° legacyRenderSubtreeIntoContainer å‡½æ•°å¾€ä¸‹çœ‹æœ€ç»ˆè¿”å›äº† getPublicRootInstanceï¼š 123456789101112function getPublicRootInstance(container) &#123; var containerFiber = container.current; if (!containerFiber.child) &#123; return null; &#125; switch (containerFiber.child.tag) &#123; case HostComponent: return getPublicInstance(containerFiber.child.stateNode); default: return containerFiber.child.stateNode; &#125;&#125; Reactåˆå§‹åŒ–çš„æ—¶å€™ï¼Œcontainer.current æ˜¯æ²¡æœ‰å­èŠ‚ç‚¹çš„ï¼Œæ‰€ä»¥è¿”å› nullã€‚ æœ€åæˆ‘ä»¬å¯¹ä¹‹å‰çš„æ€ç»´å›¾å†è¿›è¡Œè¡¥å……ï¼š å·²ç»æœ‰ç‚¹é•¿äº†ï¼Œæš‚æ—¶å…ˆè§£æåˆ°è¿™é‡Œã€‚ç»„ä»¶æ˜¯å¦‚ä½•æŒ‚è½½åˆ°çœŸæ­£çš„DOMä¸Šä»¥åŠå®ƒçš„ä»»åŠ¡è°ƒåº¦åˆæ˜¯å¦‚ä½•ï¼Œç¬”è€…åœ¨ä¸‹ä¸€ç¯‡å†æ¥è§£æã€‚","tags":[{"name":"react","slug":"react","permalink":"//zhoujingchao.github.io/tags/react/"}]},{"title":"egg-rocketmqæ¶ˆæ¯ä¸­é—´ä»¶","date":"2019-08-13T03:52:15.000Z","path":"2019/08/13/egg-rocketmqæ¶ˆæ¯ä¸­é—´ä»¶/","text":"å‰ä¸€é˜µå­çš„ä¸šåŠ¡é©±ä½¿ä¸‹ï¼Œå‡ºäºè€ƒè™‘ç³»ç»Ÿç¨³å®šæ€§ä»¥åŠ java å’Œ node çš„è§£è€¦æ€§ï¼Œnodeç«¯æ¥å…¥äº†ä¸­å°å·²æœ‰çš„ rocketmq æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œæˆ‘ä»¬ node ä¸šåŠ¡æ¶å­ç”¨çš„æ˜¯ eggï¼Œåœ¨è¿™åŸºç¡€ä¸Šç»“åˆä¸­å°å’Œç›¸å…³ä¸šåŠ¡ï¼Œåšè¿‡äºŒæ¬¡æ¡†æ¶å¼€å‘ã€‚è¿™å›æ¥å…¥ rocketmq ä½¿å¾—ç¼–ç æ–¹å¼ä¸€ç‚¹éƒ½ä¸å‹å¥½ï¼Œæ‰€æœ‰çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¸šåŠ¡ä»£ç ç»Ÿç»Ÿä¸ç¬¦åˆ egg æœ¬èº«ç¼–ç è§„èŒƒã€‚å› æ­¤åé¢åˆ©ç”¨ç¢ç‰‡åŒ–æ—¶é—´ï¼Œæ’¸äº†ä¸€ä¸ª egg-rocketmq æ’ä»¶ï¼Œæ˜¯åŸºäº rocketmq-client-nodejs æ‰©å±•çš„ï¼Œæœ‰éœ€è¦çš„æˆ–è€…æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è¯•ä¸€è¯•ã€‚","tags":[{"name":"eggjs","slug":"eggjs","permalink":"//zhoujingchao.github.io/tags/eggjs/"}]},{"title":"puppeteerå®æˆ˜ç³»åˆ—-ç½‘é¡µæ€§èƒ½åˆ†æï¼ˆä¸‰ï¼‰","date":"2019-07-14T08:53:18.000Z","path":"2019/07/14/puppeteerå®æˆ˜ç³»åˆ—-ç½‘é¡µæ€§èƒ½åˆ†æï¼ˆä¸‰ï¼‰/","text":"å‰ä¸¤ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®²äº†å®‰è£…å’Œæˆªå›¾ï¼Œè¿™ç¯‡æˆ‘ä»¬æ¥è®²è®²é¡µé¢æ€§èƒ½åˆ†æçš„ç›¸å…³ä½“ç³»ã€‚ ä¼—æ‰€å‘¨çŸ¥ï¼Œé¡µé¢æ€§èƒ½ä¼˜åŒ–è¦è®²èµ·æ¥å¯è°“æ˜¯æ•´å¤§æ¡é“¾è·¯ä¸Šçš„äº‹æƒ…ï¼Œåœ¨è¿™é‡Œç¬”è€…å°†ä¸å¼€å±•æè¿°ï¼Œåç»­ç¬”è€…ä¼šå‡ºä¸ªå…¨é¢çš„æ€§èƒ½ä¼˜åŒ–ç³»åˆ—æ–‡ç« å†è¿›è¡Œè®²è§£ã€‚å›åˆ°æˆ‘ä»¬çš„æ­£é¢˜ï¼Œæˆ‘ä»¬æ˜¯åˆ©ç”¨ puppeteer å¯¹é¡µé¢è¿›è¡Œæ€§èƒ½æ•°æ®é‡‡é›†å¹¶åˆ†æï¼Œè¾¾åˆ°ä¸€ä¸ªæ€§èƒ½ç›‘æ§çš„æ•ˆæœã€‚ è¿™é‡Œç¬”è€…æ˜¯ç”¨çš„ Web performance æ”¶é›†çš„ï¼Œæ¯•ç«Ÿæ˜¯åŸç”Ÿå¯¹å§ã€‚ GoogleChrome æ¨çš„ lighthouse ä¹Ÿæ˜¯ä¸ªä¸é”™çš„å·¥å…·ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯è‡ªè¡Œç ”ç©¶ ä¼ é€é—¨ å½“ç„¶äº†ï¼Œå’±ä»¬è¦åˆ†æçš„é¡µé¢åœ¨è¿™é‡Œä¸æ˜¯å’±è‡ªå®¶äº§çš„ï¼Œå‡å¦‚æ˜¯è‡ªå®¶é¡µé¢ï¼Œé‚£æˆ‘ä»¬åªéœ€è¦å°†ä»£ç åŒ…è£…æˆsdkï¼Œç”¨æˆ·è®¿é—®çš„æ—¶å€™æ”¶é›†çœŸå®æ•°æ®ï¼Œå†åˆ†æå³å¯ã€‚æ‰€ä»¥è¿™é‡Œä¸»è¦æ˜¯æ¨¡æ‹Ÿåˆ†æç¬¬ä¸‰æ–¹çš„é¡µé¢ã€‚åœ¨è®²å…·ä½“æ“ä½œå‰ï¼Œæˆ‘ä»¬å…ˆæ¥è®¤è¯†ä¸€ä¸‹ performanceï¼Œçœ‹ä¸‹å›¾ ç›¸å…³æ—¶é—´ç‚¹åœ¨ timing é‡Œï¼ŒåŠ è½½çš„èµ„æºåˆ—è¡¨åœ¨ getEntries é‡Œï¼Œç¬”è€…ä¹Ÿæ˜¯æ ¹æ®ä¸‹é¢è¿™å¼ å›¾æ¥å½’ç»“ç›¸å…³æ—¶é—´èŠ‚ç‚¹æ•°æ®çš„ï¼Œæœ‰ä¸å¯¹çš„åœ°æ–¹åŒå­¦ä»¬å¸®å¿™æŒ‡æ­£ä¸‹ æ‰€ä»¥æœ‰äº†ä¸‹é¢æ ¸å¿ƒä»£ç  1234567891011121314151617181920212223242526272829function performance() &#123; const data = &#123; cache: ['domainLookupStart', 'fetchStart'], // è¯»å–ç¼“å­˜æ—¶é—´ dns: ['domainLookupEnd', 'domainLookupStart'], // DNS è§£æè€—æ—¶ tcp: ['connectEnd', 'connectStart'], // TCP è¿æ¥è€—æ—¶ req: ['responseStart', 'requestStart'], // ç½‘ç»œè¯·æ±‚è€—æ—¶ res: ['responseEnd', 'responseStart'], // æ•°æ®ä¼ è¾“è€—æ—¶ dom: ['domContentLoadedEventStart', 'domLoading'], // DOM è§£æè€—æ—¶ readycb: ['domContentLoadedEventEnd', 'domContentLoadedEventStart'], // domContentLoadedå›è°ƒå‡½æ•°è€—æ—¶ fasrt: ['domComplete', 'domContentLoadedEventEnd'], // é¦–å±å¼‚æ­¥èµ„æºåŠ è½½è€—æ—¶ï¼Œå³domContentLoadedå’Œloadä¹‹é—´åŠ è½½çš„èµ„æºï¼Œä¸€èˆ¬ä¸ºå›¾ç‰‡åŠ è½½ï¼ŒJSå¼‚æ­¥åŠ è½½çš„èµ„æº loadcb: ['loadEventEnd', 'loadEventStart'], // loadå›è°ƒå‡½æ•°è€—æ—¶ ready: ['domContentLoadedEventEnd', 'fetchStart'], // DOM Readyè€—æ—¶ï¼Œç™½å±æ—¶é—´ load: ['loadEventEnd', 'fetchStart'] // é¡µé¢å®Œå…¨åŠ è½½æ—¶é—´ &#125;; const getData = &#123;&#125;; const performance = window.performance || window.msPerformance || window.webkitPerformance; if (!performance || !performance.timing) &#123; return null; &#125; const timing = performance.timing; Object.keys(data).map(item =&gt; &#123; const firstParams = timing[data[item][0]]; const secondParams = timing[data[item][1]]; const value = Math.round(firstParams - secondParams); value &gt;= 0 &amp;&amp; value &lt; 36e5 &amp;&amp; (getData[item] = value); &#125;); getData.resourceList = performance.getEntries(); return getData;&#125; æ‰€ä»¥å½“æˆ‘ä»¬åŠ è½½ç¬¬ä¸‰æ–¹é¡µé¢çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ’å…¥æ­¤è„šæœ¬ï¼ŒæŠŠæ•°æ®æå‡ºæ¥ï¼Œä¸‹é¢ä¸¾ä¸ªğŸŒ° 12345678910111213141516171819202122232425262728const browser = await puppeteer.launch(&#123; headless: true, args: [ '--no-sandbox', '--disable-setuid-sandbox' ],&#125;);const page = await browser.newPage();await page.goto('https://juejin.im', &#123; waitUntil: [ 'load' ]&#125;);const monitorData = await page.evaluate(() =&gt; &#123; // è¿™é‡Œå°±æ‹¿æˆ‘ä»¬æœ€å¸¸è§ä¹Ÿæœ€å…³å¿ƒçš„æ•°æ®ï¼Œæ›´å…¨çš„çœ‹ä¸Šé¢æ ¸å¿ƒä»£ç å›¾å³å¯ const data = &#123; ready: [ 'domContentLoadedEventEnd', 'fetchStart' ], // DOM Readyè€—æ—¶ï¼Œç™½å±æ—¶é—´ load: [ 'loadEventEnd', 'fetchStart' ] // é¡µé¢å®Œå…¨åŠ è½½æ—¶é—´ &#125;; const getData = &#123;&#125;; const performance = window.performance || window.msPerformance || window.webkitPerformance; const timing = performance.timing; Object.keys(data).map(item =&gt; &#123; const firstParams = timing[data[item][0]]; const secondParams = timing[data[item][1]]; const value = Math.round(firstParams - secondParams); value &gt;= 0 &amp;&amp; value &lt; 36e5 &amp;&amp; (getData[item] = value); &#125;); getData.resourceList = performance.getEntries(); return Promise.resolve(getData);&#125;);console.log(monitorData); æ‹¿åˆ°è¿™äº›æ•°æ®åï¼Œå°±å¯ä»¥å¼€å±•å„è‡ªçš„ä¸šåŠ¡çš„åœºæ™¯äº†ï¼Œæ¯”å¦‚åå°ç³»ç»Ÿä¸Šçš„å±•ç¤ºç›‘æ§ï¼Œé’‰é’‰æŠ¥è­¦ä¼˜åŒ–ç­‰ç­‰ã€‚å†å¤æ‚ä¸€ç‚¹çš„åœºæ™¯å¯èƒ½éœ€è¦æ¨¡æ‹Ÿç½‘ç»œç¯å¢ƒï¼Œæˆ‘ä»¬éœ€è¦å†æ·»åŠ ä¸€äº›ä»£ç ï¼Œå¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374const NETWORK_PRESETS = &#123; // æ‰€æœ‰é€Ÿåº¦ / 8 æ˜¯å› ä¸ºç½‘ç»œé€Ÿåº¦é€šå¸¸ä»¥æ¯”ç‰¹/ç§’,è€Œ DevTools é¢„è®¡ååé‡åœ¨å­—èŠ‚/ç§’! ï¼ˆ1å­—èŠ‚ = 8æ¯”ç‰¹ï¼‰ GPRS: &#123; offline: false, // æ˜¯å¦è¿æ¥ downloadThroughput: (50 * 1024) / 8, // æ¨¡æ‹Ÿä¸‹è½½é€Ÿåº¦ uploadThroughput: (20 * 1024) / 8, // æ¨¡æ‹Ÿä¸Šä¼ é€Ÿåº¦ latency: 500 // æ¨¡æ‹Ÿå»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰ &#125;, Regular2G: &#123; offline: false, downloadThroughput: (250 * 1024) / 8, uploadThroughput: (50 * 1024) / 8, latency: 300 &#125;, Good2G: &#123; offline: false, downloadThroughput: (450 * 1024) / 8, uploadThroughput: (150 * 1024) / 8, latency: 150 &#125;, Regular3G: &#123; offline: false, downloadThroughput: (750 * 1024) / 8, uploadThroughput: (250 * 1024) / 8, latency: 100 &#125;, Good3G: &#123; offline: false, downloadThroughput: (1.5 * 1024 * 1024) / 8, uploadThroughput: (750 * 1024) / 8, latency: 40 &#125;, Regular4G: &#123; offline: false, downloadThroughput: (4 * 1024 * 1024) / 8, uploadThroughput: (3 * 1024 * 1024) / 8, latency: 20 &#125;, DSL: &#123; offline: false, downloadThroughput: (2 * 1024 * 1024) / 8, uploadThroughput: (1 * 1024 * 1024) / 8, latency: 5 &#125;, WiFi: &#123; offline: false, downloadThroughput: (30 * 1024 * 1024) / 8, uploadThroughput: (15 * 1024 * 1024) / 8, latency: 2 &#125;&#125;;async function start(url, network) &#123; const browser = await puppeteer.launch(&#123; headless: true, args: [ '--no-sandbox', '--disable-setuid-sandbox' ], &#125;); const page = await browser.newPage(); await page.goto(url, &#123; waitUntil: [ 'load' ]&#125;); // æ·»åŠ ç½‘ç»œç¯å¢ƒ if (network !== 'default') &#123; // Connect to Chrome DevTools const client = await page.target().createCDPSession(); // Set throttling property await client.send('Network.emulateNetworkConditions', NETWORK_PRESETS[network]); &#125; const monitorData = await page.evaluate(() =&gt; &#123; // ...åŒä¸Š &#125;); console.log(monitorData);&#125; æ€»ç»“window.performance.getEntries() çš„æ–¹å¼æ‹¿åˆ°çš„èµ„æºï¼Œä¸æ˜¯æœ¬åŸŸä¸‹é¢çš„è¯ï¼Œä¸€èˆ¬æ˜¯æ‹¿ä¸åˆ°èµ„æºå¤§å°çš„ï¼Œè¿™ä¸ªæ˜¯ç”±ç¬¬ä¸‰æ–¹cdnæˆ–è€…æœåŠ¡å™¨æ‰€æ§åˆ¶çš„ã€‚lighthouse æ˜¯æ‹¿å¾—åˆ°çš„ï¼Œæ‰€ä»¥æ ¹æ®å„è‡ªåœºæ™¯ï¼Œç»“åˆèµ·æ¥ä½¿ç”¨ä¹Ÿæ˜¯æ²¡é—®é¢˜çš„ã€‚å¦å¤– puppeteer æœ¬èº«ä¹Ÿæä¾›ä¸€äº›é¡µé¢æ•°æ®åœ¨ page.metrics() æ–¹æ³•é‡Œï¼ŒåŒå­¦ä»¬å¯è‡ªè¡ŒæŸ¥çœ‹ã€‚","tags":[{"name":"puppeteer","slug":"puppeteer","permalink":"//zhoujingchao.github.io/tags/puppeteer/"}]},{"title":"puppeteerå®æˆ˜ç³»åˆ—-æˆªå›¾çš„è¯±æƒ‘ï¼ˆäºŒï¼‰","date":"2019-07-12T09:37:51.000Z","path":"2019/07/12/puppeteerå®æˆ˜ç³»åˆ—-æˆªå›¾çš„è¯±æƒ‘ï¼ˆäºŒï¼‰/","text":"å‰é¢ä¸€ç¯‡æ–‡ç« è®²äº† puppeteer çš„å‰æœŸå¼€å±•å·¥ä½œï¼Œè¿™ç¯‡æˆ‘ä»¬æ¥è®²ä¸‹æˆªå›¾æ“ä½œ å®˜æ–¹å…¥é—¨ demo 12345678const puppeteer = require(\"puppeteer\");(async () =&gt; &#123; const browser = await puppeteer.launch(); const page = await browser.newPage(); await page.goto(\"http://www.baidu.com\"); await page.screenshot(&#123; path: \"baidu.png\" &#125;); await browser.close();&#125;)(); ä¸šåŠ¡åœºæ™¯ä¸€ã€æˆªå…¨å±å›¾1234567891011121314151617181920212223242526272829const puppeteer = require(\"puppeteer\");(async () =&gt; &#123; const options = &#123; headless: true, timeout: 0, args: [\"--no-sandbox\", \"--disable-setuid-sandbox\"], ignoreHTTPSErrors: true &#125;; const browser = await puppeteer.launch(options); const page = await browser.newPage(); await page.goto(\"http://www.baidu.com\", &#123; waitUntil: [\"networkidle2\"], // https://pptr.dev/#?product=Puppeteer&amp;version=v1.18.1&amp;show=api-pagegotourl-options timeout: 20 * 1000 &#125;); // å¦‚æœ waitUntil ä¸º'networkidle2'çš„æ–¹å¼è¿˜æ˜¯ä¼šå‡ºç°ä¸èƒ½å®Œå…¨åŠ è½½å¼‚æ­¥çš„å†…å®¹ // å¯ä»¥æ‰‹åŠ¨æ·»åŠ æ»‘åŠ¨æ“ä½œä»¥åŠå»¶æ—¶ç­‰å¾…å»å¤„ç† await page.evaluate(() =&gt; &#123; return Promise.resolve(window.scrollTo(0, window.innerHeight)); &#125;); // await page.waitFor(2000); await page.screenshot(&#123; path: \"baidu.png\", fullPage: true &#125;); await browser.close();&#125;)(); äºŒã€å…ƒç´ ç²¾ç¡®æˆªå›¾æˆ–è€…æŒ‡å®šèŒƒå›´å°ºå¯¸æˆªå›¾1234567891011121314151617181920212223242526272829303132333435363738394041const puppeteer = require(\"puppeteer\");(async () =&gt; &#123; async function getElementBounding(page, element) &#123; const pos = await page.$eval(element, e =&gt; &#123; // ç›¸å½“äºåœ¨evaluateçš„pageFunctionå†…æ‰§è¡Œ // document.querySelector(element).getBoundingClientRect() // https://pptr.dev/#?product=Puppeteer&amp;version=v1.18.1&amp;show=api-pageevalselector-pagefunction-args-1 const &#123; left, top, width, height &#125; = e.getBoundingClientRect(); return &#123; left, top, width, height &#125;; &#125;); return pos; &#125; const options = &#123; headless: true, timeout: 0, args: [\"--no-sandbox\", \"--disable-setuid-sandbox\"], ignoreHTTPSErrors: true &#125;; const browser = await puppeteer.launch(options); const page = await browser.newPage(); await page.goto(\"http://www.baidu.com\", &#123; waitUntil: [\"networkidle2\"], timeout: 20 * 1000 &#125;); await page.evaluate(() =&gt; &#123; return Promise.resolve(window.scrollTo(0, window.innerHeight)); &#125;); const pos = await getElementBounding(page, \".head_wrapper\"); await page.screenshot(&#123; path: \"baidu.png\", // æ ¹æ®ä¸šåŠ¡åº”ç”¨åœºæ™¯çµæ´»è¿ç”¨ clip: &#123; x: pos.left, y: pos.top, width: pos.width, height: pos.height &#125; &#125;); await browser.close();&#125;)(); æ€§èƒ½ä¼˜åŒ–ä¸šåŠ¡å¤æ‚ä¸”é‡å¤§çš„æƒ…å†µä¸‹ï¼Œä¸€èˆ¬éƒ½æ˜¯å‡ ç™¾ä¸ªæˆ–è€…ä¸Šåƒä¸ªé¡µé¢éœ€è¦å¤„ç†ã€‚æˆ‘ä»¬é€šå¸¸éƒ½æ˜¯ Promise.all() å¹¶è¡Œå¤„ç†å¼‚æ­¥ï¼Œè¿›è¡Œæ‰¹é‡æˆªå›¾ï¼Œä½†æ ‡ç­¾é¡µä¸€å¤šï¼Œå°±ä¼šå¯¼è‡´æœºå™¨æ€§èƒ½æ€¥å‰§ä¸‹é™ã€‚ äºæ˜¯æˆ‘ä»¬å¯ä»¥æŠŠæ‰“å¼€æµè§ˆå™¨çš„ä¸ªæ•°å’Œæ¯ä¸ªæµè§ˆå™¨çš„æ ‡ç­¾é¡µæ•°éƒ½æŠ½å‡ºæ¥ï¼Œå¯çµæ´»è°ƒæ•´ï¼Œä¾¿äºä¸åŒé…ç½®çš„æœºå™¨åœ¨æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™æ–¹ä¾¿è°ƒæ•´ï¼Œé¿å…æœºå™¨å´©æ‰ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778/** * startBrowser å¯åŠ¨æµè§ˆå™¨ * @param &#123;array&#125; urlList æ•°æ®æº * @param &#123;number&#125; browserNum æ‰“å¼€çš„æµè§ˆå™¨ä¸ªæ•° * @param &#123;number&#125; tabNum æ¯ä¸ªæµè§ˆå™¨æ‰“å¼€çš„æ ‡ç­¾é¡µ * @return &#123;array&#125; */ async startBrowser(urlList, browserNum, tabNum) &#123; // å•ä¸ªæµè§ˆå™¨æ‰§è¡Œæµç¨‹ const action = async (startPosition, length) =&gt; &#123; const options = &#123; headless: true, timeout: 0, args: [ '--no-sandbox', '--disable-setuid-sandbox' ], ignoreHTTPSErrors: true &#125;; const platform = os.platform().toLocaleLowerCase(); if (platform === 'linux') &#123; // ç¯å¢ƒä¸Šchromiumå¯¹åº”çš„å®‰è£…è·¯å¾„ options.executablePath = path.join(__dirname, '../../../chrome-linux/chrome'); &#125; const browser = await puppeteer.launch(options); // å¤„ç†æ•°æ®æº urlList const promises = []; for (let i = 0; i &lt; length; i++) &#123; const groupIndex = parseInt(i / tabNum, 10); promises[groupIndex] = promises[groupIndex] ? promises[groupIndex] : []; promises[parseInt(i / tabNum, 10)].push(urlList[i + startPosition]); &#125; const pagesGroups = []; for (let i = 0; i &lt; promises.length; i++) &#123; pagesGroups.push( await Promise.all( promises[i].map(async option =&gt; &#123; // è¿™é‡Œå°±ä¸æ‹¿å‡ºæ¥è¯´äº†ï¼Œå•ä¸ªæ ‡ç­¾é¡µçš„æ‰§è¡Œæˆªå›¾é€»è¾‘ï¼Œæ ¹æ®å„è‡ªä¸šåŠ¡åœºæ™¯å¤„ç†åï¼Œå¹¶è¿”å›æ•°æ®å³å¯ return await this.startPage(browser, option); &#125;) ) ); &#125; // å¤„ç†å›è°ƒæ•°æ® const pages = []; pagesGroups.map(pagesGroup =&gt; &#123; pagesGroup.map(page =&gt; &#123; pages.push(page); &#125;); &#125;); await browser.close(); return pages; &#125;; // æ ¹æ®æ‰“å¼€çš„æµè§ˆå™¨ä¸ªæ•°ï¼Œæ‹†åˆ†éœ€è¦æˆªå›¾çš„æ•°æ® const result = [], promiseArr = []; for (let i = 0, len = urlList.length; i &lt; browserNum; i++) &#123; let SingleLen = parseInt(len / browserNum, 0); const startPosition = SingleLen * i; if (i === browserNum - 1) &#123; SingleLen = len - SingleLen * i; &#125; promiseArr.push(action(startPosition, SingleLen)); &#125; const allList = await Promise.all(promiseArr); allList.map(item =&gt; &#123; item.map(subItem =&gt; &#123; result.push(subItem); &#125;); &#125;); return result; &#125; å…¶æ¬¡æ˜¯é€šè¿‡ cluster ä¼˜åŒ– puppeteerï¼Œå¤šå¼€ä¸€æ ¸ï¼Œä»»åŠ¡å¤„ç†æ•ˆç‡å°±ä¼šå¤šç¿»ä¸€å€ä½ å¯ä»¥é€šè¿‡è‡ªå·±ç¼–å†™ cluster.js å»å¤„ç†ï¼Œä¸¾ä¸ªä¾‹å­ï¼š12345678910111213141516171819202122const cluster = require('cluster');const startBrowser = require('./startBrowser');const numCPUs = require('os').cpus().length;const urls = require('./testData.js');(async () =&gt; &#123; if (cluster.isMaster) &#123; for (let i = 0; i &lt; numCPUs; i++) &#123; cluster.fork(); &#125; &#125; else &#123; // æ‹†åˆ†æ¯æ ¸è¦è·‘çš„ä¸šåŠ¡æ•°æ® let len = parseInt(urls.length / numCPUs, 0) let start = len * (cluster.worker.id - 1); if (cluster.worker.id === numCPUs) &#123; len = urls.length - len * (numCPUs - 1); &#125; await startBrowser(urls, start, len); cluster.worker.kill(); &#125;&#125;)(); ä¹Ÿå¯ä»¥é€šè¿‡ pm2 æ¥ç®¡ç† node è¿›ç¨‹ï¼Œå°±çœå»äº†è‡ªå·±ç¼–å†™ cluster.js çš„é€»è¾‘ 1234567891011121314151617// http://pm2.keymetrics.io/docs/usage/pm2-doc-single-page/&#123; \"apps\": [ &#123; \"name\": \"screenshot-demo\", \"script\": \"./index.js\", // å…¥å£æ–‡ä»¶ \"env\": &#123; \"NODE_ENV\": \"production\" &#125;, \"error_file\": \"./logs/app-err.log\", \"out_file\": \"./logs/app-out.log\", \"log_date_format\": \"YYYY-MM-DD HH:mm Z\", \"instances\" : 4, // å¯åŠ¨[æ•°é‡]è¿›ç¨‹è‡ªåŠ¨è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚æé«˜æ•´ä½“æ€§èƒ½å’Œæ€§èƒ½ç¨³å®šæ€§ \"exec_mode\" : \"cluster\" &#125;]&#125; å¯åŠ¨æ–¹å¼1pm2 start pm2.json","tags":[{"name":"puppeteer","slug":"puppeteer","permalink":"//zhoujingchao.github.io/tags/puppeteer/"}]},{"title":"puppeteerå®æˆ˜ç³»åˆ—-ä»‹ç»åŠå®‰è£…ï¼ˆä¸€ï¼‰","date":"2019-07-12T05:27:11.000Z","path":"2019/07/12/puppeteerå®æˆ˜ç³»åˆ—-ä»‹ç»åŠå®‰è£…ï¼ˆä¸€ï¼‰/","text":"å‰è¨€Puppeteer æ˜¯ä¸€ä¸ª Node åº“ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªé«˜çº§APIæ¥æ§åˆ¶DevToolsåè®®ä¸Šçš„Chromeæˆ–Chromiumã€‚ Puppeteeré»˜è®¤è¿è¡Œæ— å¤´ï¼Œä½†å¯ä»¥é…ç½®ä¸ºè¿è¡Œå®Œæ•´ï¼ˆéæ— å¤´ï¼‰Chromeæˆ–Chromium ç”¨å¤„å¯ä»¥åœ¨æµè§ˆå™¨ä¸­æ‰‹åŠ¨æ‰§è¡Œçš„å¤§å¤šæ•°äº‹æƒ…éƒ½å¯ä»¥ä½¿ç”¨ Puppeteer å®Œæˆï¼ä»¥ä¸‹æ˜¯ä¸€äº›å¯ä»¥å…¥é—¨çš„ç¤ºä¾‹ï¼š ç”Ÿæˆé¡µé¢çš„å±å¹•æˆªå›¾å’ŒPDF çˆ¬å–SPAåº”ç”¨ï¼Œå¹¶ç”Ÿæˆé¢„æ¸²æŸ“å†…å®¹ï¼ˆå³ SSR æœåŠ¡ç«¯æ¸²æŸ“ï¼‰ è‡ªåŠ¨åŒ–è¡¨å•æäº¤ï¼ŒUIæµ‹è¯•ï¼Œé”®ç›˜è¾“å…¥ç­‰ åˆ›å»ºæœ€æ–°çš„è‡ªåŠ¨åŒ–æµ‹è¯•ç¯å¢ƒã€‚ä½¿ç”¨æœ€æ–°çš„ JavaScript å’Œæµè§ˆå™¨åŠŸèƒ½ç›´æ¥åœ¨æœ€æ–°ç‰ˆæœ¬çš„Chromeä¸­è¿è¡Œæµ‹è¯• æ•è·ç½‘ç«™çš„æ—¶é—´çº¿è·Ÿè¸ªï¼Œä»¥å¸®åŠ©è¯Šæ–­æ€§èƒ½é—®é¢˜ æµ‹è¯•Chromeæ‰©å±•ç¨‹åº å®‰è£…åŠéƒ¨ç½² æœ¬åœ° MacOS ï¼š1yarn add puppeteer downä¸ä¸‹æ¥å°±è¯•è¯•æ¢æºï¼Œæ¨è nrm å·¥å…·1yarn global add nrm 1nrm use taobao Centos 7 ï¼šéœ€è¦å®‰è£…ä»¥ä¸‹ä¾èµ–ï¼Œç¡®ä¿ä»»åŠ¡å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼Œç›¸å…³å­—ä½“ä¾èµ–æ˜¯è§£å†³æˆªå›¾åä¸­æ–‡ä¹±ç é—®é¢˜çš„ã€‚ï¼ˆæ›´å¤šè¿è¡Œä¸Šçš„é—®é¢˜ä¹Ÿå¯ä»¥æŸ¥çœ‹æ­¤é“¾æ¥ï¼‰1yum install pango.x86_64 libXcomposite.x86_64 libXcursor.x86_64 libXdamage.x86_64 libXext.x86_64 libXi.x86_64 libXtst.x86_64 cups-libs.x86_64 libXScrnSaver.x86_64 libXrandr.x86_64 GConf2.x86_64 alsa-lib.x86_64 atk.x86_64 gtk3.x86_64 ipa-gothic-fonts xorg-x11-fonts-100dpi xorg-x11-fonts-75dpi xorg-x11-utils xorg-x11-fonts-cyrillic xorg-x11-fonts-Type1 xorg-x11-fonts-misc å†è®¾ç½®123const browser = await puppeteer.launch(&#123; args: [ '--no-sandbox', '--disable-setuid-sandbox' ]&#125;) Docker : å®˜æ–¹æ¨èä½¿ç”¨argså‚æ•°ï¼šâ€“disable-dev-shm-usageé»˜è®¤æƒ…å†µä¸‹ï¼ŒDockerè¿è¡Œä¸€ä¸ª/dev/shmå…±äº«å†…å­˜ç©ºé—´ä¸º64MB çš„å®¹å™¨ã€‚è¿™é€šå¸¸å¯¹Chromeæ¥è¯´å¤ªå°ï¼Œå¹¶ä¸”ä¼šå¯¼è‡´Chromeåœ¨æ¸²æŸ“å¤§é¡µé¢æ—¶å´©æºƒã€‚è¦ä¿®å¤ï¼Œå¿…é¡»è¿è¡Œå®¹å™¨ docker run â€“shm-size=1gb ä»¥å¢åŠ /dev/shmçš„å®¹é‡ã€‚ä»Chrome 65å¼€å§‹ï¼Œä½¿ç”¨â€“disable-dev-shm-usageæ ‡å¿—å¯åŠ¨æµè§ˆå™¨å³å¯ï¼Œè¿™å°†ä¼šå†™å…¥å…±äº«å†…å­˜æ–‡ä»¶/tmpè€Œä¸æ˜¯/dev/shm æ³¨âš ï¸ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚åœ¨Dockerä¸­ï¼‰å¾ˆéš¾æ­£ç¡®ç»ˆæ­¢Chromeã€‚å¦‚æœä½ é‡åˆ°å¾ˆå¤šåƒµå°¸Chromeè¿›ç¨‹ï¼Œé‚£ä¹ˆ dumb-init å€¼å¾—ä¸€è¯•ã€‚å¯¹äºPID = 1çš„è¿›ç¨‹æœ‰ç‰¹æ®Šå¤„ç†ï¼Œ æœ€åå¦‚æœè¿˜æ˜¯downä¸ä¸‹æ¥puppeteerï¼Œé‚£ä¹ˆè¯·æˆ³è¿™é‡Œä¸‹è½½Chromiumï¼Œæ”¾å…¥å¯¹åº”çš„ç¯å¢ƒæˆ–è€…é¡¹ç›®é‡Œã€‚å†è®¾ç½® .npmrc è·³è¿‡ä¸‹è½½ Chromium1puppeteer_skip_chromium_download = true å†å¯åŠ¨æµè§ˆå™¨123456789101112131415const options = &#123; headless: true, timeout: 0, args: [ '--no-sandbox', '--disable-setuid-sandbox' ], ignoreHTTPSErrors: true&#125;;const platform = os.platform().toLocaleLowerCase();// ä½ æ‰€å­˜æ”¾çš„è·¯å¾„if (platform === 'linux') &#123; options.executablePath = path.join(__dirname, '../../../chrome-linux/chrome');&#125;const browser = await puppeteer.launch(options); Have fun ï¼","tags":[{"name":"puppeteer","slug":"puppeteer","permalink":"//zhoujingchao.github.io/tags/puppeteer/"}]},{"title":"JSå¸¸ç”¨è®¾è®¡æ¨¡å¼è¯¦è§£[es5ä¸es6]-å·¥å‚æ¨¡å¼ï¼ˆäºŒï¼‰","date":"2018-12-17T08:27:26.000Z","path":"2018/12/17/JSå¸¸ç”¨è®¾è®¡æ¨¡å¼è¯¦è§£-es5ä¸es6-å·¥å‚æ¨¡å¼ï¼ˆäºŒï¼‰/","text":"ä»€ä¹ˆæ˜¯å·¥å‚æ¨¡å¼ï¼Ÿå·¥å‚æ¨¡å¼æ˜¯ç”¨æ¥åˆ›å»ºå¯¹è±¡çš„ä¸€ç§æœ€å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œæˆ‘ä»¬ä¸æš´éœ²åˆ›å»ºå¯¹è±¡çš„å…·ä½“é€»è¾‘ï¼Œè€Œæ˜¯æä¾›ä¸€ä¸ªç”¨äºåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè¿™ä¸ªæ¥å£ç”±å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸€ä¸ªç±»ã€‚è¯¥æ¨¡å¼ä½¿ä¸€ä¸ªç±»çš„å®ä¾‹åŒ–å»¶è¿Ÿåˆ°äº†å­ç±»ï¼Œè€Œå­ç±»å¯ä»¥é‡å†™æ¥å£æ–¹æ³•ä»¥ä¾¿åˆ›å»ºçš„æ—¶å€™æŒ‡å®šè‡ªå·±çš„å¯¹è±¡ç±»å‹ã€‚æ‰€ä»¥è¿™ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£å‡½æ•°å°±å¯ä»¥è§†ä¸ºä¸€ä¸ªå·¥å‚ã€‚å·¥å‚æ¨¡å¼æ ¹æ®æŠ½è±¡ç¨‹åº¦çš„ä¸åŒå¯ä»¥åˆ†ä¸ºï¼šç®€å•å·¥å‚ï¼Œå·¥å‚æ–¹æ³•å’ŒæŠ½è±¡å·¥å‚ã€‚ ä¸‹é¢ï¼Œæˆ‘ä»¬å…ˆä»¥ä¸€ä¸ªåœºæ™¯å»ç®€å•çš„ç†è§£ä¸‹æŠ½è±¡å’Œå·¥å‚çš„æ¦‚å¿µ æƒ³è±¡ä¸€ä¸‹ä½ çš„å¥³æœ‹å‹ç”Ÿæ—¥è¦åˆ°äº†ï¼Œä½ æƒ³çŸ¥é“å¥¹æƒ³è¦ä»€ä¹ˆç¤¼ç‰©ï¼Œäºæ˜¯ä½ é—®ä»–ï¼šâ€œäº²çˆ±å“’ï¼Œç”Ÿæ—¥è¦åˆ°äº†å‘¢ï¼Œä½ æƒ³è¦ä»€ä¹ˆç”Ÿæ—¥ç¤¼ç‰©å’©ï¼Ÿâ€ äºæ˜¯å¥¹å›ç­”ä½ è¯´ï¼šâ€œäº²çˆ±çš„ï¼Œæˆ‘æƒ³è¦ä¸€åªåŠ¨ç‰©ã€‚â€ ä½ å¿ƒå¹³æ°”å’Œï¼ˆé»‘äººé—®å·ï¼Ÿï¼Ÿï¼Ÿï¼‰çš„é—®å¥¹ï¼šâ€œæƒ³è¦ä»€ä¹ˆåŠ¨ç‰©å•Šï¼Ÿâ€ ä½ å¥³å‹è¯´ï¼šâ€œæˆ‘æƒ³è¦çŒ«ç§‘åŠ¨ç‰©ã€‚â€ è¿™æ—¶ä½ å†…å¿ƒå°±çº³é—·äº†ï¼ŒçŒ«ç§‘åŠ¨ç‰©æœ‰è€è™ï¼Œç‹®å­ï¼Œè±¹å­ï¼Œè¿˜æœ‰å„ç§å°çŒ«ï¼Œæˆ‘å“ªé‡ŒçŸ¥é“ä½ è¦ä»€ä¹ˆï¼Ÿ äºæ˜¯ä½ æ¥ç€é—®å¥³å‹ï¼šâ€œä½ è¦å“ªç§çŒ«ç§‘åŠ¨ç‰©å•Šï¼Ÿâ€ â€œç¬¨æ­»äº†ï¼Œè¿˜è¦å“ªç§ï¼Œè‚¯å®šæ˜¯å°çŒ«å’ªå•Šï¼Œéš¾é“æˆ‘ä»¬å®¶è¿˜èƒ½åƒè¿ªæ‹œåœŸè±ªé‚£æ ·å…»è€è™å•Šï¼â€ä½ å¥³æœ‹å‹ç­”é“ã€‚ â€œå¥½å¥½ï¼Œ é‚£ä½ æƒ³è¦å“ªä¸ªå“ç§çš„çŒ«å‘¢ï¼Ÿâ€ä½ é—®é“ã€‚ â€œæˆ‘æƒ³è¦å›½å¤–çš„å“ç§, ä¸è¦ä¸­å›½çš„åœŸçŒ«â€ ä½ å¥³å‹å‚²å¨‡çš„å›ç­”åˆ°ã€‚ è¿™æ—¶ä½ å·²ç»å¿«å¥”æºƒäº†ï¼Œä½œä¸ºç¨‹åºå‘˜çš„ä½ å†ä¹Ÿå—ä¸äº†è¿™ç§æŒ¤ç‰™è†å¼çš„æé—®ï¼Œäºæ˜¯ä½ å“€æ±‚åˆ°ï¼šâ€œäº²çˆ±çš„ï¼Œä½ å°±ç›´æ¥å‘Šè¯‰æˆ‘ä½ åˆ°åº•æƒ³è¦å“ªä¸ªå“ç§ï¼Œå“ªä¸ªé¢œè‰²ï¼Œå¤šå¤§çš„çŒ«ï¼Ÿâ€ ä½ å¥³å‹æƒ³äº†æƒ³æŠ–éŸ³çš„é‚£åªçŒ«ï¼Œå›ç­”é“ï¼šâ€œæˆ‘æƒ³è¦ä¸€åªé“¶è‰²çš„ï¼Œä¸è¶…è¿‡1å²çš„è‹±çŸ­æŠ˜è€³çŒ«ï¼â€ äºæ˜¯ï¼Œä½ åœ¨å¥³å‹ç”Ÿæ—¥å½“å¤©åˆ°æ–‡äºŒè·¯èŠ±é¸Ÿå¸‚åœºé‡Œé¢å»ï¼ŒæŒ‘äº†ä¸€åªâ€œé“¶è‰²çš„ï¼Œä¸è¶…è¿‡1å²çš„è‹±çŸ­æŠ˜è€³çŒ«â€å›å®¶é€ç»™äº†ä½ å¥³å‹, åœ†äº†ä½ å¥³å‹æ‹¥æœ‰ç½‘çº¢åŒæ¬¾çŒ«çš„æ¢¦! ä¸Šé¢ä½ æœ€ç»ˆä¹°åˆ°å¹¶é€ç»™å¥³å‹é‚£åªçŒ«å¯ä»¥è¢«çœ‹ä½œæ˜¯ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼ŒèŠ±é¸Ÿå¸‚åœºå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå·¥å‚ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå·¥å‚å‡½æ•°é‡Œé¢æœ‰ç€å„ç§å„æ ·çš„åŠ¨ç‰©ï¼Œé‚£ä¹ˆä½ æ˜¯å¦‚ä½•è·å–åˆ°å®ä¾‹çš„å‘¢ï¼Ÿå› ä¸ºä½ ç»™èŠ±é¸Ÿå¸‚åœºä¼ é€’äº†æ­£ç¡®çš„å‚æ•°, â€œcolor: é“¶è‰²â€ï¼Œâ€œage: ä¸è¶…è¿‡1å²â€ï¼Œâ€breed:è‹±çŸ­æŠ˜è€³â€ï¼Œâ€œcategory: çŒ«â€ã€‚å‰é¢çš„å¯¹è¯ä¸­, ä½ å¥³æœ‹å‹å›ç­”åŠ¨ç‰©ï¼ŒçŒ«ç§‘åŠ¨ç‰©ï¼Œå›½å¤–çš„å“ç§è®©ä½ ä¸æ˜ç™½å¥¹åˆ°åº•æƒ³è¦ä»€ä¹ˆï¼Œå°±æ˜¯å› ä¸ºå¥¹è¯´å¾—å¤ªæŠ½è±¡äº†ã€‚å¥¹å›ç­”çš„æ˜¯ä¸€å¤§ç±»åŠ¨ç‰©çš„å…±æœ‰ç‰¹å¾è€Œä¸æ˜¯å…·ä½“åŠ¨ç‰©ï¼Œè¿™ç§å°†å¤æ‚äº‹ç‰©çš„ä¸€ä¸ªæˆ–å¤šä¸ªå…±æœ‰ç‰¹å¾æŠ½å–å‡ºæ¥çš„æ€ç»´è¿‡ç¨‹å°±æ˜¯æŠ½è±¡ã€‚ æ—¢ç„¶å·²ç»æ˜ç™½äº†æŠ½è±¡çš„æ¦‚å¿µï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¹‹å‰æåˆ°çš„å·¥å‚æ¨¡å¼çš„ä¸‰ç§å®ç°æ–¹æ³•ï¼š ç®€å•å·¥å‚æ¨¡å¼ã€å·¥å‚æ–¹æ³•æ¨¡å¼ã€æŠ½è±¡å·¥å‚æ¨¡å¼ã€‚ ç®€å•å·¥å‚æ¨¡å¼ç®€å•å·¥å‚æ¨¡å¼åˆå«é™æ€å·¥å‚æ¨¡å¼ï¼Œç”±ä¸€ä¸ªå·¥å‚å¯¹è±¡å†³å®šåˆ›å»ºæŸä¸€ç§äº§å“å¯¹è±¡ç±»çš„å®ä¾‹ã€‚ä¸»è¦ç”¨æ¥åˆ›å»ºåŒä¸€ç±»å¯¹è±¡ã€‚ å°±ä»¥ä¸Šé¢çš„å¯¹è¯ä¾‹å­åšä¸ªæ‰©å±•ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223var petMarketFactory = function(pet) &#123; function Pet(opt) &#123; this.name = opt.name &#125; switch(pet) &#123; case 'cat': return new Pet(&#123; name: 'cat'&#125;) break; case 'fish': return new Pet(&#123; name: 'fish'&#125;) break; case 'dog': return new Pet(&#123; name: 'dog'&#125;) break; default: throw new Error('å‚æ•°é”™è¯¯, å¯é€‰å‚æ•°:cat, fish, dog') &#125;&#125;var cat = petMarketFactory('cat')var fish = petMarketFactory('fish')var dog = petMarketFactory('dog') å®ƒçš„ä¼˜ç‚¹åœ¨äºä½ åªéœ€è¦ä¸€ä¸ªæ­£ç¡®å‚æ•°ï¼Œå°±å¯ä»¥è·å¾—ä½ æ‰€éœ€è¦çš„å¯¹è±¡ï¼Œè€Œæ— éœ€çŸ¥é“å¯¹è±¡åˆ›å»ºçš„å…·ä½“é€»è¾‘ã€‚ä½†æ˜¯åœ¨å‡½æ•°å†…åŒ…å«äº†æ‰€æœ‰å¯¹è±¡çš„åˆ›å»ºé€»è¾‘ï¼ˆPetæ„é€ å‡½æ•°ï¼‰å’Œåˆ¤æ–­é€»è¾‘çš„ä»£ç ï¼Œæ¯å¢åŠ æ–°çš„æ„é€ å‡½æ•°è¿˜éœ€è¦ä¿®æ”¹åˆ¤æ–­é€»è¾‘ä»£ç ã€‚å½“æˆ‘ä»¬çš„å¯¹è±¡ä¸æ˜¯ä¸Šé¢çš„3ä¸ªè€Œæ˜¯æ›´å¤šæ—¶ï¼Œè¿™ä¸ªå‡½æ•°ä¼šæˆä¸ºä¸€ä¸ªåºå¤§çš„è¶…çº§å‡½æ•°ï¼Œä¾¿å¾—éš¾ä»¥ç»´æŠ¤ã€‚æ‰€ä»¥ï¼Œç®€å•å·¥å‚åªèƒ½ä½œç”¨äºåˆ›å»ºçš„å¯¹è±¡æ•°é‡è¾ƒå°‘ï¼Œå¯¹è±¡çš„åˆ›å»ºé€»è¾‘ä¸å¤æ‚æ—¶ä½¿ç”¨ã€‚ å·¥å‚æ–¹æ³•æ¨¡å¼å·¥å‚æ–¹æ³•æ¨¡å¼å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå®ä¾‹åŒ–å¯¹è±¡çš„å·¥å‚ç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829// å®‰å…¨æ¨¡å¼åˆ›å»ºçš„å·¥å‚æ–¹æ³•å‡½æ•°var petMarketFactory = function(name, pet) &#123; if (this instanceof petMarketFactory) &#123; var o = new this[name](pet) return o &#125; else &#123; return new petMarketFactory(name, pet) &#125;&#125;// å·¥å‚æ–¹æ³•å‡½æ•°çš„åŸå‹ä¸­è®¾ç½®æ‰€æœ‰å¯¹è±¡çš„æ„é€ å‡½æ•°petMarketFactory.prototype = &#123; Cat: function(pet) &#123; this.name = \"cat\" this.type = pet &#125;, Fish: function(pet) &#123; this.name = \"fish\" this.type = pet &#125;, Dog: function(pet) &#123; this.name = 'dog' this.type = pet &#125;&#125;var cat = petMarketFactory('Cat', 'animal')var fish = petMarketFactory('Fish', 'animal')var dog = petMarketFactory('Dog', 'animal') ä½¿ç”¨ä¸Šé¢çš„æ¨¡å¼å»è¿›è¡Œå®ä¾‹åŒ–ï¼Œå°±ä¸ç”¨æ‹…å¿ƒæŸä¸ªé˜¶æ®µé—å¿˜ä½¿ç”¨ new æ“ä½œå¯¼è‡´å¯¹è±¡å–ä¸åˆ°çš„é—®é¢˜äº†ã€‚ æŠ½è±¡å·¥å‚æ¨¡å¼ä¸Šé¢ä»‹ç»äº†ç®€å•å·¥å‚æ¨¡å¼å’Œå·¥å‚æ–¹æ³•æ¨¡å¼éƒ½æ˜¯ç›´æ¥ç”Ÿæˆå®ä¾‹ï¼Œä½†æ˜¯æŠ½è±¡å·¥å‚æ¨¡å¼ä¸åŒï¼ŒæŠ½è±¡å·¥å‚æ¨¡å¼å¹¶ä¸ç›´æ¥ç”Ÿæˆå®ä¾‹ï¼Œ è€Œæ˜¯ç”¨äºå¯¹äº§å“ç±»ç°‡çš„åˆ›å»ºã€‚ ä¸Šé¢ä¾‹å­ä¸­çš„catï¼Œfishï¼Œdogä¸‰ç§å® ç‰©ï¼Œå…¶ä¸­ cat å•†å®¶æä¾›äº†ä¸åŒçš„å“ç§ï¼Œä¾‹å¦‚ï¼šè‹±çŸ­ï¼Œç¾çŸ­ã€‚é‚£ä¹ˆè¿™ä¸¤ä¸ªç§ç±»å°±æ˜¯å¯¹åº”çš„ç±»ç°‡ã€‚åœ¨æŠ½è±¡å·¥å‚ä¸­ï¼Œç±»ç°‡ä¸€èˆ¬ç”¨çˆ¶ç±»å®šä¹‰ï¼Œå¹¶åœ¨çˆ¶ç±»ä¸­å®šä¹‰ä¸€äº›æŠ½è±¡æ–¹æ³•ï¼Œå†é€šè¿‡æŠ½è±¡å·¥å‚è®©å­ç±»ç»§æ‰¿çˆ¶ç±»ã€‚æ‰€ä»¥ï¼ŒæŠ½è±¡å·¥å‚å…¶å®æ˜¯å®ç°å­ç±»ç»§æ‰¿çˆ¶ç±»çš„æ–¹æ³•ã€‚ ä¸Šé¢æåˆ°çš„æŠ½è±¡æ–¹æ³•æ˜¯æŒ‡å£°æ˜ä½†ä¸èƒ½ä½¿ç”¨çš„æ–¹æ³•ã€‚åœ¨å…¶ä»–ä¼ ç»Ÿé¢å‘å¯¹è±¡çš„è¯­è¨€ä¸­å¸¸ç”¨abstractè¿›è¡Œå£°æ˜ï¼Œä½†æ˜¯åœ¨JavaScriptä¸­ï¼Œabstractæ˜¯å±äºä¿ç•™å­—ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ç±»çš„æ–¹æ³•ä¸­æŠ›å‡ºé”™è¯¯æ¥æ¨¡æ‹ŸæŠ½è±¡ç±»ã€‚ 123456var UsaShorthair = function() &#123;&#125;UsaShorthair.prototype = &#123; getName: function() &#123; return new Error('æŠ½è±¡æ–¹æ³•ä¸èƒ½è°ƒç”¨'); &#125;&#125; ä¸Šè¿°ä»£ç ä¸­çš„ getName å°±æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œæˆ‘ä»¬å®šä¹‰å®ƒä½†æ˜¯å´æ²¡æœ‰å»å®ç°ã€‚å¦‚æœå­ç±»ç»§æ‰¿ UsaShorthair ä½†æ˜¯å¹¶æ²¡æœ‰å»é‡å†™ getNameï¼Œé‚£ä¹ˆå­ç±»çš„å®ä¾‹åŒ–å¯¹è±¡å°±ä¼šè°ƒç”¨çˆ¶ç±»çš„ getName æ–¹æ³•å¹¶æŠ›å‡ºé”™è¯¯æç¤ºã€‚ ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«æ¥å®ç°çŒ«ç§ç±»ç®¡ç†çš„æŠ½è±¡å·¥å‚æ–¹æ³•: 12345678910111213141516171819202122232425262728293031323334var TypeCatFactory = function(subType, superType) &#123; // æŠ½è±¡å·¥å‚ä¸­æ˜¯å¦æœ‰è¯¥æŠ½è±¡ç±» if (typeof TypeCatFactory[superType] === 'function') &#123; function F() &#123;&#125; // ç»§æ‰¿çˆ¶ç±»å±æ€§å’Œæ–¹æ³• F.prototype = new TypeCatFactory[superType] () // å­ç±»åŸå‹ç»§æ‰¿çˆ¶ç±» subType.prototype = new F() // å­ç±»constructoræŒ‡å‘è‡ªå·± subType.prototype.constructor = subType &#125; else &#123; throw new Error('æŠ½è±¡ç±»ä¸å­˜åœ¨') &#125;&#125;// ç¾çŸ­çŒ«æŠ½è±¡ç±»TypeCatFactory.UsaShorthair = function() &#123; this.type = 'USA'&#125;TypeCatFactory.UsaShorthair.prototype = &#123; getName: function() &#123; return new Error('æŠ½è±¡æ–¹æ³•ä¸èƒ½è°ƒç”¨') &#125;&#125;// è‹±çŸ­çŒ«æŠ½è±¡ç±»TypeCatFactory.BritishShorthair = function() &#123; this.type = 'UK'&#125;TypeCatFactory.BritishShorthair.prototype = &#123; getName: function() &#123; return new Error('æŠ½è±¡æ–¹æ³•ä¸èƒ½è°ƒç”¨') &#125;&#125; TypeCatFactory å°±æ˜¯ä¸€ä¸ªæŠ½è±¡å·¥å‚æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨å‚æ•°ä¸­ä¼ é€’å­ç±»å’Œçˆ¶ç±»ï¼Œåœ¨æ–¹æ³•ä½“å†…éƒ¨å®ç°äº†å­ç±»å¯¹çˆ¶ç±»çš„ç»§æ‰¿ã€‚å¯¹æŠ½è±¡å·¥å‚æ–¹æ³•æ·»åŠ æŠ½è±¡ç±»çš„æ–¹æ³•æˆ‘ä»¬æ˜¯é€šè¿‡ç‚¹è¯­æ³•è¿›è¡Œæ·»åŠ çš„ã€‚ ä¸‹é¢æˆ‘ä»¬æ¥å®šä¹‰çŒ«çš„å­ç±»: 123456789101112131415161718192021// ç¾çŸ­çŒ«å­ç±»function CatOfUsa(name) &#123; this.name = name&#125;// æŠ½è±¡å·¥å‚å®ç° UsaShorthair ç±»çš„ç»§æ‰¿TypeCatFactory(CatOfUsa, 'UsaShorthair')// å­ç±»ä¸­é‡å†™æŠ½è±¡æ–¹æ³•CatOfUsa.prototype.getName = function() &#123; return this.name&#125;// è‹±çŸ­çŒ«å­ç±»function CatOfUk(name) &#123; this.name = name&#125;// æŠ½è±¡å·¥å‚å®ç° BritishShorthair ç±»çš„ç»§æ‰¿TypeCatFactory(CatOfUk, 'BritishShorthair')// å­ç±»ä¸­é‡å†™æŠ½è±¡æ–¹æ³•CatOfUk.prototype.getName = function() &#123; return this.name&#125; ä¸Šè¿°ä»£ç æˆ‘ä»¬åˆ†åˆ«å®šä¹‰äº†CatOfUsaï¼ŒCatOfUkä¸¤ç§ç±»ã€‚è¿™ä¸¤ä¸ªç±»ä½œä¸ºå­ç±»é€šè¿‡æŠ½è±¡å·¥å‚æ–¹æ³•å®ç°ç»§æ‰¿ã€‚ç‰¹åˆ«éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè°ƒç”¨æŠ½è±¡å·¥å‚æ–¹æ³•åä¸è¦å¿˜è®°é‡å†™æŠ½è±¡æ–¹æ³•ï¼Œå¦åˆ™åœ¨å­ç±»çš„å®ä¾‹ä¸­è°ƒç”¨æŠ½è±¡æ–¹æ³•ä¼šæŠ¥é”™ã€‚ æˆ‘ä»¬æ¥åˆ†åˆ«å¯¹è¿™ä¸¤ç§ç±»è¿›è¡Œå®ä¾‹åŒ–ï¼Œæ£€æµ‹æŠ½è±¡å·¥å‚æ–¹æ³•æ˜¯å®ç°äº†ç±»ç°‡çš„ç®¡ç†ã€‚ 1234567891011// å®ä¾‹åŒ–ç¾çŸ­çŒ«var UsaCatA = new CatOfUsa('ç¾çŸ­é€—é€—')console.log(UsaCatA.getName(), UsaCatA.type) // ç¾çŸ­é€—é€— USAvar UsaCatB = new CatOfUsa('ç¾çŸ­é›ªé¥¼')console.log(UsaCatB.getName(), UsaCatB.type) // ç¾çŸ­é›ªé¥¼ USA// å®ä¾‹åŒ–è‹±çŸ­çŒ«var UkCatA = new CatOfUk('è‹±çŸ­é€—é€—')console.log(UkCatA.getName(), UkCatA.type) // è‹±çŸ­é€—é€— UKvar UkCatB = new CatOfUk('è‹±çŸ­é›ªé¥¼')console.log(UkCatB.getName(), UkCatB.type) // è‹±çŸ­é›ªé¥¼ UK ä»æ‰“å°ç»“æœä¸Šçœ‹ï¼ŒTypeCatFactory è¿™ä¸ªæŠ½è±¡å·¥å‚å¾ˆå¥½çš„å®ç°äº†å®ƒçš„ä½œç”¨ï¼Œå°†çŒ«æŒ‰ç…§ä¸åŒå“ç§è¿™ä¸€ä¸ªç±»ç°‡è¿›è¡Œäº†åˆ†ç±»ã€‚è¿™å°±æ˜¯æŠ½è±¡å·¥å‚çš„ä½œç”¨ï¼Œå®ƒä¸ç›´æ¥åˆ›å»ºå®ä¾‹ï¼Œè€Œæ˜¯é€šè¿‡ç±»çš„ç»§æ‰¿è¿›è¡Œç±»ç°‡çš„ç®¡ç†ã€‚æŠ½è±¡å·¥å‚æ¨¡å¼ä¸€èˆ¬ç”¨åœ¨å¤šäººåä½œçš„è¶…å¤§å‹é¡¹ç›®ä¸­ï¼Œå¹¶ä¸”ä¸¥æ ¼çš„è¦æ±‚é¡¹ç›®ä»¥é¢å‘å¯¹è±¡çš„æ€æƒ³è¿›è¡Œå®Œæˆã€‚ ES6ä¸­çš„å·¥å‚æ¨¡å¼ES6ä¸­ç»™æˆ‘ä»¬æä¾›äº† class æ–°è¯­æ³•ï¼Œè™½ç„¶ class æœ¬è´¨ä¸Šæ˜¯ä¸€é¢—è¯­æ³•ç³–ï¼Œå¹¶ä¹Ÿæ²¡æœ‰æ”¹å˜ JavaScript æ˜¯ä½¿ç”¨åŸå‹ç»§æ‰¿çš„è¯­è¨€ï¼Œä½†æ˜¯ç¡®å®è®©å¯¹è±¡çš„åˆ›å»ºå’Œç»§æ‰¿çš„è¿‡ç¨‹å˜å¾—æ›´åŠ çš„æ¸…æ™°å’Œæ˜“è¯»ã€‚ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨ES6çš„æ–°è¯­æ³•æ¥é‡å†™ä¸Šé¢çš„ä¾‹å­ã€‚ ES6é‡å†™ç®€å•å·¥å‚æ¨¡å¼12345678910111213141516171819202122232425class PetMarket &#123; constructor(opt) &#123; this.name = opt.name &#125; getInstance(pet) &#123; switch(pet) &#123; case 'cat': return new Pet(&#123; name: 'cat'&#125;) break; case 'fish': return new Pet(&#123; name: 'fish'&#125;) break; case 'dog': return new Pet(&#123; name: 'dog'&#125;) break; default: throw new Error('å‚æ•°é”™è¯¯, å¯é€‰å‚æ•°:cat, fish, dog') &#125; &#125; &#125;let cat = PetMarket.getInstance('cat')let fish = PetMarket.getInstance('fish')let dog = PetMarket.getInstance('dog') ES6é‡å†™å·¥å‚æ–¹æ³•æ¨¡å¼123456789101112131415161718192021222324252627282930313233class PetMarket &#123; constructor(name) &#123; // new.target æŒ‡å‘ç›´æ¥è¢« new æ‰§è¡Œçš„æ„é€ å‡½æ•° if (new.target === PetMarket) &#123; throw new Erorr('æŠ½è±¡ç±»ä¸èƒ½å®ä¾‹åŒ–') &#125; this.name = name &#125;&#125;class PetMarketFactory extends PetMarket &#123; constructor(name) &#123; super(name) &#125; create(pet) &#123; case 'cat': return new PetMarketFactory('cat') break; case 'fish': return new PetMarketFactory('fish') break; case 'dog': return new PetMarketFactory('dog') break; default: throw new Error('å‚æ•°é”™è¯¯, å¯é€‰å‚æ•°:cat, fish, dog') &#125;&#125;let petMarketFactory = new PetMarketFactory()let cat = petMarketFactory.create('cat')let fish = petMarketFactory.create('fish')let dog = petMarketFactory.create('dog') ES6é‡å†™æŠ½è±¡å·¥å‚æ¨¡å¼1234567891011121314151617181920212223242526272829303132333435363738394041class PetMarket &#123; constructor(type) &#123; if (new.target === PetMarket) &#123; throw new Error('æŠ½è±¡ç±»ä¸èƒ½å®ä¾‹åŒ–') &#125; this.type = type &#125;&#125;class CatOfUsa extends PetMarket &#123; constructor(name) &#123; super('UsaShorthair') this.name = name &#125;&#125;class CatOfUk extends PetMarket &#123; constructor(name) &#123; super('BritishShorthair') this.name = name &#125;&#125;const petMarketFactory = (type) =&gt; &#123; switch (type) &#123; case 'UsaShorthair': return CatOfUsa break; case 'BritishShorthair': return CatOfUk break; default: throw new Error('å‚æ•°é”™è¯¯, å¯é€‰å‚æ•°:UsaShorthair, BritishShorthair') &#125;&#125;let UsaCatClass = petMarketFactory('UsaShorthair')let UkCatClass = petMarketFactory('BritishShorthair')let UsaCatA = new UsaCatClass('ç¾çŸ­é›ªé¥¼')let UkCatA = new UkCatClass('è‹±çŸ­é›ªé¥¼')","tags":[]},{"title":"JSå¸¸ç”¨è®¾è®¡æ¨¡å¼è¯¦è§£[es5ä¸es6]-æ„é€ å‡½æ•°æ¨¡å¼ï¼ˆä¸€ï¼‰","date":"2018-12-17T06:32:11.000Z","path":"2018/12/17/JSå¸¸ç”¨è®¾è®¡æ¨¡å¼è¯¦è§£-es5ä¸es6-æ„é€ å‡½æ•°æ¨¡å¼ï¼ˆä¸€ï¼‰/","text":"åŸºæœ¬ç”¨æ³•jsæ²¡æœ‰ç±»çš„æ¦‚å¿µï¼Œé€šå¸¸è®¤ä¸ºæ„é€ å‡½æ•°æ˜¯ç”¨æ¥å®ç°å®ä¾‹çš„ï¼Œé€šè¿‡ new å…³é”®å­—æ¥è°ƒç”¨æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ã€‚æ„é€ å‡½æ•°å†…éƒ¨çš„ this å¼•ç”¨çš„æ˜¯æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚ 12345678910111213function Player(name, age) &#123; this.name = name this.age = age this.output = function () &#123; return this.name + ' is ' + this.age + ' years old' &#125;&#125;var Irving = new Player('Irving', 18)var Kobe = new Player('Kobe', 18)console.log(Irving.output())console.log(Kobe.output()) è¿™æ˜¯ä¸ªç°å¸¸ç®€å•çš„æ„é€ å‡½æ•°ï¼Œæ‰€ä»¥é—®é¢˜ä¸€ä¸‹å°±æš´æ¼äº†ã€‚é¦–å…ˆç»§æ‰¿å°±éº»çƒ¦äº†ï¼Œå…¶æ¬¡ output() æ¯æ¬¡åˆ›å»ºå¯¹è±¡çš„æ—¶å€™éƒ½é‡æ–°å®šä¹‰äº†ï¼Œå¦‚æœæœ‰å¤§æ‰¹é‡å®ä¾‹çš„è¯ï¼Œå†…å­˜å¼€é”€å°±å¾ˆå¤§ï¼Œæ‰€ä»¥æœ€å¥½çš„æ–¹æ³•æ˜¯è®© Player å®ä¾‹å…±äº«è¿™ä¸ª output() æ–¹æ³• æ„é€ å‡½æ•°ä¸åŸå‹123456789101112131415161718function Player(name, age) &#123; // å¼ºåˆ¶ä½¿ç”¨new if (!(this instanceof Player)) &#123; return new Player(name, age) &#125; this.name = name this.age = age&#125;Player.prototype.output = function () &#123; return this.name + ' is ' + this.age + ' years old' &#125;var Irving = new Player('Irving', 18)var Kobe = new Player('Kobe', 18)console.log(Irving.output())console.log(Kobe.output()) ES6123456789101112131415// ç±»çš„å£°æ˜class Player &#123; constructor(name, age) &#123; this.name = name this.age = age &#125; output() &#123; return this.name + ' is ' + this.age + ' years old' &#125;&#125;// ç±»å®ä¾‹åŒ–let Irving = new Player('Irving', 18)Irving.output()","tags":[{"name":"js","slug":"js","permalink":"//zhoujingchao.github.io/tags/js/"}]},{"title":"Koa2ä¸­é—´ä»¶åŸç†","date":"2018-11-28T08:04:42.000Z","path":"2018/11/28/Koa2ä¸­é—´ä»¶åŸç†/","text":"å‰è¨€æœ€è¿‘ä¸€ç›´åœ¨ç”¨koaï¼Œå°±å¾ˆå¥½å¥‡koaçš„ä¸­é—´ä»¶æ˜¯å¦‚ä½•å®ç°çš„ï¼Œå¤šä¸ªä¸­é—´ä»¶ä¹‹é—´çš„å…³ç³»å’Œæ‰§è¡Œé¡ºåºåˆæ˜¯æ€æ ·çš„ï¼Ÿä¸‹é¢æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹å§ã€‚ ä¸¾ä¸ª ğŸŒ° è¾“å‡ºå°±ä¸å†™äº†ï¼Œè¿˜ä¸æ¸…æ¥šçš„åŒå­¦è‡ªè¡Œå°è¯•ä¸‹ app.useåšäº†ä»€ä¹ˆè¿‡æ»¤æ‰ä¸€äº›æš‚æ—¶ç”¨ä¸åˆ°çš„ä»£ç é¢„å…ˆé€šè¿‡useæ–¹æ³•ï¼Œå°†è¯·æ±‚å¯èƒ½ä¼šç»è¿‡çš„ä¸­é—´ä»¶è£…åœ¨äº†ä¸€ä¸ªæ•°ç»„é‡Œ callbacké€šè¿‡ compose() è¿™ä¸ªæ–¹æ³•ï¼Œå°±å°†æˆ‘ä»¬ä¼ å…¥çš„ä¸­é—´ä»¶æ•°ç»„å…³è”èµ·æ¥äº†ï¼Œæœ€å callback() è¿”å› this.handleRequest() çš„æ‰§è¡Œç»“æœï¼Œæš‚ä¸ç®¡è¿”å›ä»€ä¹ˆå§ï¼Œå…ˆçœ‹çœ‹è¿™ä¸ªç¥å¥‡çš„compose() æ–¹æ³•åšäº†ä»€ä¹ˆä½¿å¾—æ–‡ç« æœ€å¼€å§‹çš„ä¾‹å­å¯ä»¥é‚£æ ·æ‰§è¡Œ compose é¦–å…ˆä¼šé»˜è®¤æ‰§è¡Œç¬¬ä¸€ä¸ªä¸­é—´ä»¶ï¼Œè¿”å› Promiseï¼Œè¢« Koa ç›‘å¬ï¼Œæ‰§è¡Œå¯¹åº”é€»è¾‘ åœ¨æ‰§è¡Œç¬¬ä¸€ä¸ªä¸­é—´ä»¶çš„é€»è¾‘æ—¶ï¼Œé‡åˆ° await next()æ—¶ï¼Œä¼šç»§ç»­æ‰§è¡Œ dispatch(i+1)ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œ dispatch(1)ï¼Œä¼šæ‰‹åŠ¨è§¦å‘æ‰§è¡Œç¬¬äºŒä¸ªä¸­é—´ä»¶ã€‚è¿™æ—¶å€™ï¼Œç¬¬ä¸€ä¸ªä¸­é—´ä»¶ await next() åé¢çš„ä»£ç å°±ä¼šè¢« pendingï¼Œç­‰å¾… await next() è¿”å› Promiseï¼Œæ‰ä¼šç»§ç»­æ‰§è¡Œç¬¬ä¸€ä¸ªä¸­é—´ä»¶ await next() åé¢çš„ä»£ç ã€‚ ä»¥æ­¤ç±»æ¨ï¼Œå¦‚æœæœ‰å¤šä¸ªä¸­é—´ä»¶çš„æ—¶å€™ï¼Œä¼šä¾ç…§ä¸Šé¢çš„é€»è¾‘ä¸æ–­æ‰§è¡Œï¼Œå…ˆæ‰§è¡Œç¬¬ä¸€ä¸ªä¸­é—´ä»¶ï¼Œåœ¨ await next() å‡º pendingï¼Œç»§ç»­æ‰§è¡Œç¬¬äºŒä¸ªä¸­é—´ä»¶ï¼Œç»§ç»­åœ¨ await next() å‡º pendingï¼Œç»§ç»­æ‰§è¡Œç¬¬ä¸‰ä¸ªä¸­é—´ï¼Œç›´åˆ°æœ€åä¸€ä¸ªä¸­é—´ä»¶æ‰§è¡Œå®Œï¼Œç„¶åè¿”å› Promiseï¼Œç„¶åå€’æ•°ç¬¬äºŒä¸ªä¸­é—´ä»¶æ‰æ‰§è¡Œåç»­çš„ä»£ç å¹¶è¿”å›Promiseï¼Œç„¶åæ˜¯å€’æ•°ç¬¬ä¸‰ä¸ªä¸­é—´ä»¶ï¼Œæ¥ç€ä¸€ç›´ä»¥è¿™ç§æ–¹å¼æ‰§è¡Œç›´åˆ°ç¬¬ä¸€ä¸ªä¸­é—´ä»¶æ‰§è¡Œå®Œï¼Œå¹¶è¿”å› Promiseï¼Œä»è€Œå®ç°å¼€å¤´ä¾‹å­çš„æ‰§è¡Œé¡ºåºï¼Œå°±å¥½æ¯”ä¸‹é¢ç½‘ä¸Šå¾ˆç«çš„ä¸€å¼ æ´‹è‘±å›¾ æ€»ç»“koa çœŸé¦™ï¼Œè¿™ compose() å‡½æ•°çœŸéªšï¼Œæ‰€ä»¥è¯´è¯„ä»·ä¸€ä¸ªå¥½çš„ç¨‹åºå‘˜ä¸æ˜¯ç”±ä»£ç é‡å†³å®šçš„","tags":[]},{"title":"reactæœåŠ¡ç«¯æ¸²æŸ“","date":"2018-10-06T02:23:02.000Z","path":"2018/10/06/reactæœåŠ¡ç«¯æ¸²æŸ“/","text":"å‰è¨€æœ€è¿‘æƒ³äº†è§£å°è¯•ä¸‹æœåŠ¡ç«¯æ¸²æŸ“ï¼Œå°±ä»ç†Ÿæ‚‰çš„ react ä¸‹æ‰‹è¿›è¡Œ demo ä»€ä¹ˆæ˜¯æœåŠ¡ç«¯æ¸²æŸ“æœåŠ¡ç«¯æ¸²æŸ“æ˜¯æŒ‡é¡µé¢çš„æ¸²æŸ“å’Œç”Ÿæˆç”±æœåŠ¡å™¨æ¥å®Œæˆï¼Œå¹¶å°†æ¸²æŸ“å¥½çš„é¡µé¢è¿”å›å®¢æˆ·ç«¯ã€‚è€Œå®¢æˆ·ç«¯æ¸²æŸ“æ˜¯é¡µé¢çš„ç”Ÿæˆå’Œæ•°æ®çš„æ¸²æŸ“è¿‡ç¨‹æ˜¯åœ¨å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨æˆ–APPï¼‰å®Œæˆã€‚ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æœåŠ¡ç«¯æ¸²æŸ“ SEOå‹å¥½ åŠ å¿«é¦–å±æ¸²æŸ“ï¼Œå‡å°‘ç™½å±æ—¶é—´ SEOåˆæ˜¯ä»€ä¹ˆç°åœ¨çš„ç½‘ç«™å¤§å¤šéƒ½æ˜¯SPAï¼Œé¡µé¢æ•°æ®éƒ½é€šè¿‡ajaxæ¥çš„ï¼Œæœç´¢å¼•æ“çš„spideræ¥æ”¶å½•ç½‘é¡µçš„æ—¶å€™ï¼Œå‘ç°å…¨æ˜¯ç©ºçš„è¯ï¼Œé‚£ä¹ˆä½ çš„ç½‘ç«™æ”¶å½•çš„æƒé‡è·Ÿæ•ˆæœè‚¯å®šæ˜¯ä¸å¥½çš„ æ ¸å¿ƒæ€æƒ³ èµ·ä¸€ä¸ª node æœåŠ¡ æŠŠ react æ ¹ç»„ä»¶ renderToString æ¸²æŸ“æˆå­—ç¬¦ä¸²ä¸€èµ·è¿”å›å‰ç«¯ å‰ç«¯å†é‡æ–° render ä¸€æ¬¡ ä¸ºä»€ä¹ˆéœ€è¦å‰ç«¯å† render ä¸€æ¬¡äº‹ä»¶æ˜¯åœ¨æµè§ˆå™¨æ¸²æŸ“é¡µé¢çš„æ—¶å€™è¿›è¡ŒæŒ‚è½½çš„ï¼ŒæœåŠ¡å™¨è¿”å›çš„å†…å®¹HTMLå­—ç¬¦ä¸²ï¼Œä¸åœ¨æµè§ˆå™¨é‡Œå†æ¸²æŸ“ä¸€æ¬¡çš„è¯ï¼Œäº‹ä»¶æ˜¯ä¸ä¼šæŒ‚è½½çš„ ä»¥ä¸‹ç¤ºä¾‹ä»£ç ä» demo é‡Œå–å‡ºï¼Œå¦‚éœ€æŸ¥çœ‹å®Œæ•´è¯·ç§»æ­¥ demo ç¤ºä¾‹ä»£ç babel çš„å…¥å£ï¼Œindex.jsä»£ç å¦‚ä¸‹ 123require('babel-core/register')();require('babel-polyfill');require('./app'); é¡¹ç›®å…¥å£ app.jsä»£ç å¦‚ä¸‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758import Koa from 'koa';import React from 'react';import &#123; renderToString &#125; from 'react-dom/server';import views from 'koa-views'; // é…ç½®æ¨¡æ¿çš„ä¸­é—´ä»¶import Static from 'koa-static'; // å¤„ç†é™æ€æ–‡ä»¶çš„ä¸­é—´ä»¶import ip from 'ip';import path from 'path';import webpack from 'webpack';import webpackConfig from './webpack.config';import koaWebpack from 'koa-webpack';import Home from './client/components/home';const app = new Koa();const port = 3000;const host = ip.address();// dev æ¨¡å¼çƒ­åŠ è½½app.use(koaWebpack(&#123; compiler: webpack(webpackConfig), hot: &#123; log: () =&gt; &#123;&#125; &#125;, dev: &#123; noInfo: true, serverSideRender: true, hot: true, logLevel: 'error', stats: &#123; colors : true &#125;, publicPath: '' &#125;,&#125;));// distæ–‡ä»¶å¤¹è®¾ç½®ä¸ºé™æ€è·¯å¾„app.use(Static(__dirname + '/dist'));// ä½¿ç”¨æ¨¡æ¿å¼•æ“æ¥æ¸²æŸ“app.use(views(path.resolve(__dirname, './views'), &#123; map: &#123; html: 'ejs' &#125; &#125;));app.use(async (ctx) =&gt; &#123; let str = renderToString(&lt;Home /&gt;); await ctx.render('index', &#123; root: str &#125;);&#125;);app.listen(port, host, (error) =&gt; &#123; if (error) &#123; console.error(error); &#125; else &#123; console.info('==&gt; ğŸŒ Listening on port %s. Open up http://%s:%s/ in your browser.', port, host, port); &#125;&#125;); Home ç»„ä»¶ä»£ç å¦‚ä¸‹ï¼š 1234567891011import React, &#123; Component &#125; from 'react';class Home extends Component &#123; render() &#123; return ( &lt;div onClick=&#123;() =&gt; window.alert('home')&#125;&gt;home!&lt;/div&gt; ) &#125;&#125;export default Home; æˆ‘ä»¬çš„æ¸²æŸ“æ¨¡æ¿ï¼Œæ–°å»ºä¸€ä¸ª views æ–‡ä»¶å¤¹é‡Œé¢æ–°å»ºä¸€ä¸ª index.htmlï¼š 1234567891011121314&lt;!DOCTYPE html&gt;&lt;html lang=\"en\"&gt;&lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt; &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt; &lt;title&gt;SSR&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;div id=\"root\"&gt;&lt;%- root %&gt;&lt;/div&gt; &lt;!-- æ„å»ºå‡ºæ¥çš„ä»£ç --&gt; &lt;script src=\"/main.js\"&gt;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt; webpack é…ç½® 123456789101112131415161718192021222324252627282930313233343536373839404142const path = require('path');const webpack = require('webpack');module.exports = &#123; devtool: 'source-map', entry: [ 'react-hot-loader/patch', 'webpack/hot/only-dev-server', `$&#123;__dirname&#125;/client/index.js` ], output: &#123; filename: '[name].js', path: path.join(__dirname, 'dist'), publicPath: '/' &#125;, resolve: &#123; extensions: ['.js', '.jsx'] &#125;, module: &#123; rules: [&#123; test: /\\.jsx?$/, loaders: ['babel-loader'], &#125;, &#123; test: /\\.css$/, include: [path.join(__dirname, 'client')], use: ['style-loader', 'css-loader', 'postcss-loader'] &#125;] &#125;, plugins: [ // new webpack.HotModuleReplacementPlugin(), // å¯ç”¨ HMR new webpack.NamedModulesPlugin(), new webpack.NoEmitOnErrorsPlugin() ], devServer: &#123; hot: true, inline: true, host: 'localhost', port: 3333, contentBase: path.resolve(__dirname, 'dist') &#125;&#125; è¿™é‡Œé¢æ”¯æŒ react-router é…ç½®æ˜¯å’Œå®¢æˆ·ç«¯æœ‰äº›å·®åˆ«çš„ï¼Œè¿™é‡Œå°±ä¸æ‹¿å‡ºæ¥å¤šè®²äº†ï¼Œè¯¦æƒ…è¯·æŸ¥çœ‹ demoï¼Œçƒ­æ›´æ–°å’Œå®æ—¶æ„å»ºä¹Ÿå·²é…ç½®å¥½ï¼Œåç»­è¡¥ä¸Š redux æˆ–è€… mobx çš„æ”¯æŒï¼Œä½¿è¿™ä¸ªå·¥å…·é“¾æ›´å®Œå–„ä¸€ç‚¹ã€‚","tags":[{"name":"react","slug":"react","permalink":"//zhoujingchao.github.io/tags/react/"}]},{"title":"JSæ‰§è¡Œæœºåˆ¶è¯¦è§£","date":"2018-06-28T00:57:19.000Z","path":"2018/06/28/JSæ‰§è¡Œæœºåˆ¶è¯¦è§£/","text":"å‰è¨€å‰ä¸€é˜µå­é‡åˆ°çš„é¢è¯•é¢˜ï¼Œæ­¤æ—¶å†å·©å›ºä¸€ä¸‹ javasrcipt çš„æ‰§è¡Œæœºåˆ¶ã€‚ 12345678910111213141516171819202122232425262728console.log(1)setTimeout(() =&gt; &#123; console.log(2) new Promise(resolve =&gt; &#123; console.log(3) resolve() &#125;).then(() =&gt; &#123; console.log(4) &#125;)&#125;)new Promise(resolve =&gt; &#123; console.log(5) resolve()&#125;).then(() =&gt; &#123; console.log(6)&#125;)setTimeout(() =&gt; &#123; console.log(7) new Promise(resolve =&gt; &#123; console.log(8) resolve() &#125;).then(() =&gt; &#123; console.log(9) &#125;)&#125;) ç«¥é‹ä»¬å¯ä»¥å…ˆè‡ªå·±æ€è€ƒï¼Œç­”æ¡ˆåé¢å†ç»™ã€‚ ä»ä»£ç å¯ä»¥çœ‹å‡ºï¼Œç†è§£è¿™ä¸ªéœ€è¦ä»¥ä¸‹çŸ¥è¯†ç‚¹ï¼š javascriptjavascript æ˜¯ä¸€é—¨ å•çº¿ç¨‹ è¯­è¨€ï¼Œä½œä¸ºæµè§ˆå™¨è„šæœ¬è¯­è¨€ï¼Œå®ƒçš„ä¸»è¦ç”¨é€”å°±æ˜¯ä¸ç”¨æˆ·äº¤äº’ï¼Œä»¥åŠæ“ä½œ DOM ï¼Œè¿™ä¸ªæ€§è´¨ä¹Ÿå†³å®šäº†å®ƒæ˜¯å•çº¿ç¨‹ï¼Œä¸ç„¶å¤šçº¿ç¨‹çš„è¯ï¼Œå°±ä¼šæœ‰å¾ˆå¤šå¤æ‚æ€§çš„åŒæ­¥é—®é¢˜ã€‚ä¸ºåˆ©ç”¨å¤šæ ¸ CPU çš„è®¡ç®—èƒ½åŠ›ï¼Œæœ€æ–°çš„ HTML5 ä¸­æå‡ºçš„ Web-Worker æ ‡å‡†ï¼Œå…è®¸ javascript åˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œä½†å­çº¿ç¨‹å®Œå…¨å—ä¸»çº¿ç¨‹æ§åˆ¶ï¼Œä¸”ä¸å¾—æ“ä½œ DOMã€‚æ‰€ä»¥ javascript æ˜¯å•çº¿ç¨‹çš„æ ¸å¿ƒä»æœªæ”¹å˜ï¼Œä¸€åˆ‡ javascript ç‰ˆçš„ â€œå¤šçº¿ç¨‹â€ éƒ½æ˜¯å•çº¿ç¨‹æ¨¡æ‹Ÿå‡ºæ¥çš„ã€‚ äº‹ä»¶å¾ªç¯æ—¢ç„¶æ˜¯å•çº¿ç¨‹å°±æ„å‘³ç€ï¼Œæ‰€æœ‰ä»»åŠ¡éƒ½éœ€è¦æ’é˜Ÿï¼Œå‰ä¸€ä¸ªä»»åŠ¡ç»“æŸï¼Œæ‰èƒ½æ‰§è¡Œåä¸€ä¸ªä»»åŠ¡ã€‚å¦‚æœå‰ä¸€ä¸ªä»»åŠ¡è€—æ—¶å¾ˆé•¿ï¼Œé‚£ä¹ˆåä¸€ä¸ªä»»åŠ¡å°±ä¸å¾—ä¸ä¸€ç›´ç­‰å¾…ã€‚å› æ­¤å¤§ä½¬ä»¬å°±æŠŠä»»åŠ¡åˆ†æˆäº†ä¸¤ç±»ï¼š åŒæ­¥: åªæœ‰å‰ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œæ‰èƒ½æ‰§è¡Œåä¸€ä¸ªä»»åŠ¡ å¼‚æ­¥: å½“åŒæ­¥ä»»åŠ¡æ‰§è¡Œåˆ°æŸä¸ª WebAPI æ—¶ï¼Œä¼šè§¦å‘å¼‚æ­¥æ“ä½œï¼Œæ­¤æ—¶æµè§ˆå™¨ä¼šå•ç‹¬å¼€çº¿ç¨‹å»å¤„ç†è¿™äº›å¼‚æ­¥ä»»åŠ¡ ä¸‹é¢ç”¨æœ€ç«çš„å¯¼å›¾æ¥è¡¥å……è¯´æ˜ä¸‹ï¼š ç”¨æ–‡å­—æ¥è¡¨è¿°çš„è¯ï¼š åŒæ­¥ä»»åŠ¡è¿›å…¥ä¸»çº¿ç¨‹ï¼Œå¼‚æ­¥ä»»åŠ¡è¿›å…¥ Event Table æ³¨å†Œç«™è¿›è¡Œæ³¨å†Œå‡½æ•° å½“æŒ‡å®šçš„äº‹æƒ…å®Œæˆæ—¶ï¼ŒEvent Table ä¼šå°†è¿™ä¸ªäº‹æƒ…å¯¹åº”çš„å‡½æ•°ç§»å…¥ Event Queue è¿™ä¸ªç¼“å†²åŒº ä¸»çº¿ç¨‹å†…çš„ä»»åŠ¡æ‰§è¡Œå®Œä¸ºç©ºæ—¶ï¼Œå°±ä¼šå» Event Queue è¯»å–å¯¹åº”çš„å‡½æ•°ï¼Œè¿›å…¥ä¸»çº¿ç¨‹æ‰§è¡Œ jså¼•æ“çš„ monitoring process è¿›ç¨‹ä¼šæŒç»­ä¸æ–­çš„æ£€æŸ¥ä¸»çº¿ç¨‹æ‰§è¡Œæ ˆæ˜¯å¦ä¸ºç©ºï¼Œä¸€æ—¦ä¸ºç©ºï¼Œå°±ä¼šå»ç¼“å†²åŒºæ£€æŸ¥æ˜¯å¦æœ‰ç­‰å¾…è¢«è°ƒç”¨çš„å‡½æ•°ï¼Œä¸Šè¿°è¿‡ç¨‹ä¼šä¸æ–­é‡å¤ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„ Event Loop (äº‹ä»¶å¾ªç¯) è¯´äº†è¿™ä¹ˆå¤šï¼Œä¸å¦‚æ¥çœ‹ä¸€æ®µä»£ç ï¼š 12345console.log('1')setTimeout(() =&gt; &#123; console.log('2')&#125;, 0)console.log('3') ä¸Šé¢ä¸€æ®µç®€æ˜“çš„ setTimeout ä»£ç ï¼š è¾“å‡º1 é‡åˆ° setTimeout è¿›å…¥ Event Tableï¼Œæ³¨å†Œå›è°ƒå‡½æ•° () =&gt; { console.log(â€˜2â€™) } è¾“å‡º3 ä¸»çº¿ç¨‹ä» Event Queue è¯»å–å›è°ƒå‡½æ•°å¹¶æ‰§è¡Œè¾“å‡º2 micro task ä¸ macro taskå¼‚æ­¥ä»»åŠ¡çš„ä¼˜å…ˆçº§å¹¶ä¸ç›¸åŒï¼Œå®ƒä»¬è¢«åˆ†ä¸ºä¸¤ç±»ï¼š å¾®ä»»åŠ¡ï¼ˆmicro taskï¼‰: åŒ…æ‹¬æ•´ä½“ä»£ç scriptï¼ŒsetTimeoutï¼ŒserInterval å®ä»»åŠ¡ï¼ˆmacro taskï¼‰ï¼šPromiseï¼Œprocess.nextTick æ ¹æ®å¼‚æ­¥äº‹ä»¶çš„ç±»å‹ï¼Œè¿™äº›äº‹ä»¶ä¼šè¢«æ´¾å‘åˆ°å¯¹åº”çš„å¾®ä»»åŠ¡å’Œå®ä»»åŠ¡ä¸­ï¼Œåœ¨å½“å‰ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åï¼š é¦–å…ˆåœ¨ å®ä»»åŠ¡ çš„é˜Ÿåˆ—ä¸­å–å‡ºç¬¬ä¸€ä¸ªä»»åŠ¡ï¼Œæ‰§è¡Œå®Œæ¯•åå–å‡º å¾®ä»»åŠ¡ é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰ä»»åŠ¡é¡ºåºæ‰§è¡Œ å†å– å®ä»»åŠ¡ å‘¨è€Œå¤å§‹ï¼Œç›´è‡³ä¸¤ä¸ªé˜Ÿåˆ—çš„ä»»åŠ¡éƒ½å–å®Œ è€è§„çŸ©æœ€ç«çš„å¯¼å›¾æ¥è¯´æ˜ï¼š æ¥çœ‹ä¸€æ®µä»£ç ç†è§£ä¸‹ï¼š 123456789101112setTimeout(() =&gt; &#123; console.log('setTimeout')&#125;)new Promise((resolve) =&gt; &#123; console.log('promise') resolve()&#125;).then(() =&gt; &#123; console.log('then')&#125;)console.log('console') ç¬¬ä¸€è½®äº‹ä»¶å¾ªç¯ å®ä»»åŠ¡ æ•´ä½“script å¾®ä»»åŠ¡ then é¦–å…ˆæ•´ä½“scriptä½œä¸ºå®ä»»åŠ¡ï¼Œè¿›å…¥ä¸»çº¿ç¨‹ å…ˆé‡åˆ° setTimeout æ³¨å†Œåæ´¾å‘åˆ°å®ä»»åŠ¡ å†é‡åˆ° Promiseï¼Œnew Promise ç«‹å³æ‰§è¡Œï¼Œthen å‡½æ•°æ´¾å‘åˆ°å¾®ä»»åŠ¡ console.log(&#39;console&#39;)ï¼Œç«‹å³æ‰§è¡Œ å¼€å§‹ç¬¬äºŒè½® å®ä»»åŠ¡ setTimeout å¾®ä»»åŠ¡ æ—  ç¬¬ä¸€è½®äº‹ä»¶å¾ªç¯ç»“æŸäº†ï¼Œæˆ‘ä»¬å¼€å§‹ç¬¬äºŒè½®å¾ªç¯ï¼Œå½“ç„¶è¦ä»å®ä»»åŠ¡Event Queue å¼€å§‹å‘ç° setTimeout ç«‹å³æ‰§è¡Œ ç»“æœè¾“å‡ºï¼š 1234promiseconsolethensetTimeout æœ€åå›è¿‡å¤´æ¥ï¼Œè®©æˆ‘ä»¬å†åˆ†æä¸‹æœ€å¼€å§‹çš„ä»£ç  123456789101112131415161718192021222324252627282930313233console.log(1)// setTimeout1setTimeout(() =&gt; &#123; console.log(2) new Promise(resolve =&gt; &#123; console.log(3) resolve() &#125;).then(() =&gt; &#123; // then4 console.log(4) &#125;)&#125;)new Promise(resolve =&gt; &#123; console.log(5) resolve()&#125;).then(() =&gt; &#123; // then6 console.log(6)&#125;)// setTimeout2setTimeout(() =&gt; &#123; console.log(7) new Promise(resolve =&gt; &#123; console.log(8) resolve() &#125;).then(() =&gt; &#123; // then9 console.log(9) &#125;)&#125;) ä¸ºäº†æ–¹ä¾¿ä¸‹é¢è®°å½•åˆ†æï¼Œå…ˆåœ¨ä»£ç ä¸Šåšä¸ªæ ‡è®° ç¬¬ä¸€è½®äº‹ä»¶å¾ªç¯ å®ä»»åŠ¡ï¼š æ•´ä½“script å¾®ä»»åŠ¡ï¼šthen6 è¾“å‡º1ï¼Œ5ï¼Œ6 ç¬¬äºŒè½®äº‹ä»¶å¾ªç¯ å®ä»»åŠ¡ï¼š setTimeout1 å¾®ä»»åŠ¡ï¼šthen4 è¾“å‡º2ï¼Œ3ï¼Œ4 ç¬¬ä¸‰è½®äº‹ä»¶å¾ªç¯ å®ä»»åŠ¡ï¼š setTimeout2 å¾®ä»»åŠ¡ï¼šthen9 è¾“å‡º7ï¼Œ8ï¼Œ9 æ€»ç»“ä¸æ€è€ƒ javascript æ˜¯ä¸€é—¨å•çº¿ç¨‹è¯­è¨€ Event Loopæ˜¯ javascript çš„æ‰§è¡Œæœºåˆ¶ åœ¨ node ä¸­æ‰§è¡Œæœºåˆ¶åˆæ˜¯å¦‚ä½•ï¼Ÿ","tags":[{"name":"js","slug":"js","permalink":"//zhoujingchao.github.io/tags/js/"}]},{"title":"å‰ç«¯å®‰å…¨CSRF && XSS","date":"2018-04-23T09:04:56.000Z","path":"2018/04/23/å‰ç«¯å®‰å…¨CSRF&&XSS/","text":"å‰è¨€ éšç€äº’è”ç½‘çš„å‘è¾¾ï¼Œå„ç§WEBåº”ç”¨ä¹Ÿå˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œæ»¡è¶³äº†ç”¨æˆ·çš„å„ç§éœ€æ±‚ï¼Œä½†æ˜¯éšä¹‹è€Œæ¥çš„å°±æ˜¯å„ç§ç½‘ç»œå®‰å…¨çš„é—®é¢˜ã€‚ä½œä¸ºå‰ç«¯å·¥ç¨‹å¸ˆçš„æˆ‘ä»¬ä¹Ÿé€ƒä¸å¼€è¿™ä¸ªé—®é¢˜ã€‚æ‰€ä»¥ä»Šå¤©ï¼Œå°±å’Œå¤§å®¶ä¸€èµ·èŠä¸€èŠWEBå‰ç«¯çš„å®‰å…¨é‚£äº›äº‹å„¿ã€‚è¿™é‡Œå°±ä¸å»è¯´é‚£äº›åç«¯çš„æ”»å‡»(SQLæ³¨å…¥ã€DDOSæ”»å‡»ç­‰)ã€‚ ä¸ºä»€ä¹ˆè¦æ”»å‡»ï¼Ÿ å…¶å®çœŸæ­£ä¸ºäº†ç©çš„å¿ƒæ€å»è¿›è¡Œé»‘ç½‘ç«™çš„äººï¼Œè¿˜æ˜¯å°‘æ•°ã€‚å¤šæ•°æ”»å‡»è¿˜æ˜¯æœ‰åˆ©ç›Šçš„æˆåˆ†åœ¨é‡Œé¢çš„ã€‚å¼€å‘è€…ä¸å¯èƒ½ç¡®ä¿è‡ªå·±çš„åº”ç”¨ç»å¯¹æ— æ³•è¢«æ”»å‡»ï¼Œä½†æ˜¯åªè¦æ”»å‡»æˆ‘ä»¬çš„æ—¶å€™ï¼Œéª‡å®¢èŠ±è´¹çš„æˆæœ¬è¿œæ¯”ä»–å¯ä»¥è·å–çš„åˆ©ç›Šå¤§å¾—å¤šï¼Œéª‡å®¢å°±ä¸ä¼šå»æ”»å‡»ã€‚é˜²èŒƒå¼ºå¦‚æ”¯ä»˜å®ã€QQç­‰äº§å“ï¼Œä¹Ÿéƒ½æ›¾è¢«æŠ¥è¿‡æ¼æ´ï¼Œçœ‹æ¥é˜²å¾¡ä¸æ˜¯ç»å¯¹çš„ï¼Œæˆ‘ä»¬åªèƒ½æƒ³åŠæ³•è®©æˆ‘ä»¬çš„åº”ç”¨æ›´åŠ å®‰å…¨ã€‚ å‰ç«¯æ”»å‡»å½¢å¼ä»¥åŠå¦‚ä½•é˜²èŒƒ CSRFï¼ˆCross-site request forgeryï¼‰ï¼Œé€šå¸¸ç§°ä¸ºè·¨ç«™è¯·æ±‚ä¼ªé€  XSSï¼ˆCross-site scriptingï¼‰ï¼Œé€šå¸¸ç§°ä¸ºè·¨åŸŸè„šæœ¬æ”»å‡» CSRF æ”»å‡»åŸç† å¦‚å›¾æ‰€ç¤ºï¼Œè¢«æ”»å‡»çš„å‰æå°±å¾ˆæ˜äº†äº†ï¼Œç”¨æˆ·éœ€è¦åœ¨Aç½‘ç«™ç™»å½•è¿‡ï¼Œå¹¶ä¸”ç½‘ç«™Aå­˜åœ¨æ¥å£æ¼æ´ CSRF é˜²èŒƒå› æ­¤æ ¹æ®ä¸Šè¿°è¿›è¡Œå¯¹ç—‡ä¸‹è¯è¿›è¡Œé˜²èŒƒ TokenéªŒè¯ è®¿é—®æ¥å£çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨ä¸Šä¼ cookieï¼Œä¸ä¼šä¸Šä¼ tokenï¼Œæ‰€ä»¥è¿›è¡ŒtokenéªŒè¯ RefereréªŒè¯ æœåŠ¡å™¨åˆ¤æ–­æ˜¯å¦æ˜¯è¯¥ç«™ç‚¹ä¸‹çš„é¡µé¢ï¼Œæ˜¯çš„è¯æ‰§è¡Œï¼Œåä¹‹æ‹¦æˆª éšè—ä»¤ç‰Œ è·Ÿtokenæœ‰ç‚¹åƒï¼Œæ¯”å¦‚æŠŠéªŒè¯ä¿¡æ¯éšè—åœ¨headerä¸Š XSS æ”»å‡»åŸç†XSS æ”»å‡»æ˜¯ Web æ”»å‡»ä¸­æœ€å¸¸è§çš„æ”»å‡»æ–¹æ³•ä¹‹ä¸€ï¼Œå®ƒæ˜¯é€šè¿‡å¯¹ç½‘é¡µæ³¨å…¥å¯æ‰§è¡Œä»£ç ä¸”æˆåŠŸåœ°è¢«æµè§ˆå™¨æ‰§è¡Œï¼Œè¾¾åˆ°æ”»å‡»çš„ç›®çš„ï¼Œå½¢æˆäº†ä¸€æ¬¡æœ‰æ•ˆXSSæ”»å‡»ï¼Œä¸€æ—¦æ”»å‡»æˆåŠŸï¼Œå®ƒå¯ä»¥è·å–ç”¨æˆ·çš„è”ç³»äººåˆ—è¡¨ï¼Œç„¶åå‘è”ç³»äººå‘é€è™šå‡è¯ˆéª—ä¿¡æ¯ï¼Œå¯ä»¥åˆ é™¤ç”¨æˆ·çš„æ—¥å¿—ç­‰ç­‰ï¼Œæœ‰æ—¶å€™è¿˜å’Œå…¶ä»–æ”»å‡»æ–¹å¼åŒæ—¶å®æ–½æ¯”å¦‚ SQL æ³¨å…¥æ”»å‡»æœåŠ¡å™¨å’Œæ•°æ®åº“ã€ClickåŠ«æŒã€ç›¸å¯¹é“¾æ¥åŠ«æŒç­‰å®æ–½é’“é±¼ï¼Œå®ƒå¸¦æ¥çš„å±å®³æ˜¯å·¨å¤§çš„ï¼Œæ˜¯webå®‰å…¨çš„å¤´å·å¤§æ•Œã€‚ Web åº”ç”¨ç¨‹åºçš„æŠ€æœ¯åŸºç¡€æ˜¯ç”± HTTP å’Œ HTML ç»„æˆçš„ã€‚HTTP åè®®æ˜¯ HTML çš„ä¼ è¾“æœºåˆ¶ï¼Œå¯ä½¿ç”¨ä»£ç è®¾è®¡ Web é¡µé¢å¸ƒå±€å’Œç”Ÿæˆé¡µé¢ã€‚å¦‚æœ Web åº”ç”¨ç¨‹åºæ¥å—ç”¨æˆ·é€šè¿‡ HTTP è¯·æ±‚ï¼ˆå¦‚ GET æˆ– POSTï¼‰æäº¤çš„è¾“å…¥ä¿¡æ¯ï¼Œç„¶åä½¿ç”¨è¾“å‡º HTML ä»£ç åœ¨æŸäº›åœ°æ–¹æ˜¾ç¤ºè¿™äº›ä¿¡æ¯ï¼Œä¾¿å¯èƒ½å­˜åœ¨ XSS æ¼æ´ã€‚ å®æ–½ XSS æ”»å‡»éœ€è¦å…·å¤‡ä¸¤ä¸ªæ¡ä»¶ï¼š éœ€è¦å‘webé¡µé¢æ³¨å…¥æ¶æ„ä»£ç  è¿™äº›æ¶æ„ä»£ç èƒ½å¤Ÿè¢«æµè§ˆå™¨æˆåŠŸçš„æ‰§è¡Œ XSS æ”»å‡»ç±»å‹ åå°„å‹æ”»å‡» æ¶æ„ä»£ç å¹¶æ²¡æœ‰ä¿å­˜åœ¨ç›®æ ‡ç½‘ç«™ï¼Œé€šè¿‡å¼•è¯±ç”¨æˆ·ç‚¹å‡»ä¸€ä¸ªé“¾æ¥åˆ°ç›®æ ‡ç½‘ç«™çš„æ¶æ„é“¾æ¥æ¥å®æ–½æ”»å‡»çš„ å­˜å‚¨å‹æ”»å‡» æ¶æ„ä»£ç è¢«ä¿å­˜åˆ°ç›®æ ‡ç½‘ç«™çš„æœåŠ¡å™¨ä¸­ï¼Œè¿™ç§æ”»å‡»å…·æœ‰è¾ƒå¼ºçš„ç¨³å®šæ€§å’ŒæŒä¹…æ€§ï¼Œæ¯”è¾ƒå¸¸è§åœºæ™¯æ˜¯åœ¨åšå®¢ï¼Œè®ºå›ç­‰ç¤¾äº¤ç½‘ç«™ä¸Šï¼Œä½†OAç³»ç»Ÿï¼Œå’ŒCRMç³»ç»Ÿä¸Šä¹Ÿèƒ½çœ‹åˆ°å®ƒèº«å½±ï¼Œæ¯”å¦‚ï¼šæŸCRMç³»ç»Ÿçš„å®¢æˆ·æŠ•è¯‰åŠŸèƒ½ä¸Šå­˜åœ¨XSSå­˜å‚¨å‹æ¼æ´ï¼Œéª‡å®¢æäº¤äº†æ¶æ„æ”»å‡»ä»£ç ï¼Œå½“ç³»ç»Ÿç®¡ç†å‘˜æŸ¥çœ‹æŠ•è¯‰ä¿¡æ¯æ—¶æ¶æ„ä»£ç æ‰§è¡Œï¼Œçªƒå–äº†å®¢æˆ·çš„èµ„æ–™ï¼Œç„¶è€Œç®¡ç†å‘˜æ¯«ä¸çŸ¥æƒ…ï¼Œè¿™å°±æ˜¯å…¸å‹çš„XSSå­˜å‚¨å‹æ”»å‡» äº†è§£äº† XSS çš„åŸç†ï¼Œæ¥ä¸‹å»çœ‹çœ‹æ€ä¹ˆé˜²èŒƒå§ XSS é˜²èŒƒ åœ¨è¡¨å•æäº¤æˆ–è€…urlå‚æ•°ä¼ é€’å‰ï¼Œå¯¹éœ€è¦çš„å‚æ•°è¿›è¡Œè¿‡æ»¤ è¿‡æ»¤ç”¨æˆ·è¾“å…¥çš„ï¼Œæ£€æŸ¥ç”¨æˆ·è¾“å…¥çš„å†…å®¹ä¸­æ˜¯å¦æœ‰éæ³•å†…å®¹ã€‚å¦‚&lt;&gt;ã€â€ã€ â€˜ã€%ã€;ã€()ã€&amp;ã€+ç­‰ã€‚ä¸¥æ ¼æ§åˆ¶è¾“å‡º å¯ä»¥åˆ©ç”¨ä¸‹é¢è¿™äº›å‡½æ•°å¯¹å‡ºç° xss æ¼æ´çš„å‚æ•°è¿›è¡Œè¿‡æ»¤1ã€htmlspecialchars() å‡½æ•°,ç”¨äºè½¬ä¹‰å¤„ç†åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºçš„æ–‡æœ¬ã€‚2ã€htmlentities() å‡½æ•°,ç”¨äºè½¬ä¹‰å¤„ç†åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºçš„æ–‡æœ¬ã€‚3ã€strip_tags() å‡½æ•°,è¿‡æ»¤æ‰è¾“å…¥ã€è¾“å‡ºé‡Œé¢çš„æ¶æ„æ ‡ç­¾ã€‚4ã€header() å‡½æ•°,ä½¿ç”¨header(â€œContent-type:application/jsonâ€); ç”¨äºæ§åˆ¶ json æ•°æ®çš„å¤´éƒ¨ï¼Œä¸ç”¨äºæµè§ˆã€‚5ã€urlencode() å‡½æ•°,ç”¨äºè¾“å‡ºå¤„ç†å­—ç¬¦å‹å‚æ•°å¸¦å…¥é¡µé¢é“¾æ¥ä¸­ã€‚6ã€intval() å‡½æ•°ç”¨äºå¤„ç†æ•°å€¼å‹å‚æ•°è¾“å‡ºé¡µé¢ä¸­ã€‚7ã€è‡ªå®šä¹‰å‡½æ•°,åœ¨å¤§å¤šæƒ…å†µä¸‹ï¼Œè¦ä½¿ç”¨ä¸€äº›å¸¸ç”¨çš„ html æ ‡ç­¾ï¼Œä»¥ç¾åŒ–é¡µé¢æ˜¾ç¤ºï¼Œå¦‚ç•™è¨€ã€å°çº¸æ¡ã€‚é‚£ä¹ˆåœ¨è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œè¦é‡‡ç”¨ç™½åå•çš„æ–¹æ³•ä½¿ç”¨åˆæ³•çš„æ ‡ç­¾æ˜¾ç¤ºï¼Œè¿‡æ»¤æ‰éæ³•çš„å­—ç¬¦ã€‚","tags":[{"name":"å®‰å…¨","slug":"å®‰å…¨","permalink":"//zhoujingchao.github.io/tags/å®‰å…¨/"}]},{"title":"vue+vuex+vue-router+express+mongooseç¼–å†™ç®€å•çš„todolist-demo","date":"2018-01-05T03:38:59.000Z","path":"2018/01/05/vue-vuex-vue-router-express-mongooseç¼–å†™ç®€å•çš„todolist-demo/","text":"æœ€è¿‘å¯¹vueå’Œexpressæ„Ÿå…´è¶£ï¼Œè¶é—²æš‡æ—¶é—´ï¼Œå†™äº†ä¸‹å‰åç«¯åˆ†ç¦»çš„todolistã€‚å†™è¿™ç¯‡åšæ–‡æ¥æ€»ç»“æ€è€ƒä¸‹ï¼Œé¡¹ç›®åœ°å€å¦‚ä¸‹å‰ç«¯ï¼šhttps://github.com/zhoujingchao/vue-router-vuex-todoliståç«¯ï¼šhttps://github.com/zhoujingchao/express-mongoose-todolist æ€»ä½“æ¦‚è§ˆ ç›¸ä¿¡å¤§å®¶ä¹Ÿçœ‹åˆ°äº†ï¼Œå®ç°çš„åŠŸèƒ½è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œæ•´ä¸ªtodolistç•Œé¢åˆ†ä¸ºå·¦ä¾§å¯¼èˆªæ å’Œå³ä¾§å†…å®¹ï¼Œç”¨æˆ·å¯ä»¥åˆ‡æ¢å¯¼èˆªï¼Œå¯ä»¥æ·»åŠ ä»»åŠ¡å’Œåˆ é™¤ä»»åŠ¡ã€‚è¡¥å……è¯´æ˜ä¸‹è¿™ä¸ªdemoåªæ˜¯è‡ªå·±æ‘¸ç´¢vueå’Œexpressè¿‡ç¨‹ä¸­åšå‡ºçš„ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šä¸è¶³çš„åœ°æ–¹ï¼Œå¸Œæœ›å¤§å®¶å¤šå¤šæŒ‡æ•™ã€‚ å‰ç«¯ç”±äºè¿™æ¬¡ä¸»è¦æ˜¯æƒ³ç©ä¸‹vueï¼Œå°±ç›´æ¥ç”¨äº†vue-cliï¼Œæ²¡æœ‰å»ä»å¤´å¼€å§‹é…webpackäº†ï¼Œæƒ³è‡ªå·±å®ç°ä¸€è¾¹çš„ç«¥é‹ä»¬ï¼Œå¯ä»¥å‚è€ƒç€è„šæ‰‹æ¶æ‘¸ç´¢ä¸€ä¸‹ã€‚ vuexç®€å•ä»‹ç»vuexæ˜¯ç»™vueå¼€å‘è€…æä¾›çš„çŠ¶æ€ç®¡ç†æ¨¡å¼ï¼Œä»–é‡‡ç”¨é›†ä¸­å¼å­˜å‚¨ç®¡ç†åº”ç”¨çš„æ‰€ç”¨ç»„ä»¶çŠ¶æ€ï¼Œé€šè¿‡actionæ¥å˜åŒ–ã€‚æ­¤çŠ¶æ€è‡ªç®¡ç†åŒ…å«ä¸‹é¢ä¸‰ä¸ªéƒ¨åˆ†ï¼š stateï¼šåº”ç”¨æ•°æ®æº viewï¼šå°†stateæ˜ å°„åˆ°è¯•å›¾ actionsï¼šå“åº”viewå¯¼è‡´çš„çŠ¶æ€å˜åŒ– è¿™å¼ å•ä¸€çš„æ•°æ®æµç¤ºæ„å›¾å¾ˆå¥½åœ°å±•ç°äº†å®ƒä»¬ä¹‹é—´çš„å…³ç³» è¿™æ—¶æœ‰è¿‡ç»„ä»¶ç¼–å†™ç»éªŒçš„ç«¥é‹å°±ä¼šæé—®ï¼Œåº”ç”¨ä¸­å¤šä¸ªç»„ä»¶å…±äº«çŠ¶æ€æ—¶ï¼Œè¿™ä¸ªå•å‘æ•°æ®æµä¸å°±è¢«ç ´åäº†ï¼Ÿ 1.å¤šä¸ªè§†å›¾ä¾èµ–åŒä¸€çŠ¶æ€2.æ¥è‡ªä¸åŒè§†å›¾çš„è¡Œä¸ºéœ€è¦å˜æ›´åŒä¸€çŠ¶æ€ é—®é¢˜1ï¼Œä¼ å‚çš„æ–¹å¼å¯¹äºå¤šå±‚åµŒå¥—çš„ç»„ä»¶å°†ä¼šéå¸¸ç¹çå¹¶ä¸”å¯¹äºå…„å¼Ÿç»„ä»¶é—´çš„çŠ¶æ€ä¼ é€’ä¹Ÿæ— èƒ½ä¸ºåŠ›ã€‚é—®é¢˜2ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡‡ç”¨çˆ¶å­ç»„ä»¶ç›´æ¥å¼•ç”¨æˆ–è€…é€šè¿‡äº‹ä»¶æ¥å˜æ›´å’ŒåŒæ­¥çŠ¶æ€ã€‚ä»¥ä¸Šçš„è¿™äº›æ¨¡å¼éƒ½éå¸¸è„†å¼±ï¼Œé€šå¸¸ä¼šå¯¼è‡´æ— æ³•ç»´æŠ¤çš„ä»£ç ã€‚ å› æ­¤vuexå°±æ˜¯ç”¨æ¥æŠŠç»„ä»¶çš„å…±äº«çŠ¶æ€æŠ½å–å‡ºæ¥ï¼Œä»¥ä¸€ä¸ªå…¨å±€å•ä¾‹æ¨¡å¼ç®¡ç†ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œç»„ä»¶æ ‘æ„æˆäº†ä¸€ä¸ªå·¨å¤§çš„â€œè§†å›¾â€ï¼Œä¸ç®¡åœ¨æ ‘çš„å“ªä¸ªä½ç½®ï¼Œä»»ä½•ç»„ä»¶éƒ½èƒ½è·å–çŠ¶æ€æˆ–è€…è§¦å‘è¡Œä¸ºï¼å¦å¤–ï¼Œé€šè¿‡å®šä¹‰å’Œéš”ç¦»çŠ¶æ€ç®¡ç†ä¸­çš„å„ç§æ¦‚å¿µå¹¶å¼ºåˆ¶éµå®ˆä¸€å®šçš„è§„åˆ™ï¼Œä»£ç ä¹Ÿä¼šå˜å¾—æ›´ç»“æ„åŒ–ä¸”æ˜“ç»´æŠ¤ã€‚ é™„ä¸Šç»å…¸å›¾ä¾‹ å¤§è‡´å°±ä»‹ç»åˆ°è¿™é‡Œäº†ï¼Œæƒ³è¦æ·±å…¥äº†è§£çš„ç«¥é‹ä»¬è¯·ç§»æ­¥ https://vuex.vuejs.org/zh-cn/ä¸‹é¢ä»‹ç»ä¸‹todolist-demoçš„vuex statedemoé€»è¾‘å¾ˆç®€å•ï¼Œåªå†™äº†ä¸€ä¸ªã€‚ 123export const state = &#123; todoList: []&#125; mutationsmutationsåªè®¾è®¡çŠ¶æ€çš„æ”¹å˜ï¼Œä¸è¦åœ¨è¿™é‡Œåšå¼‚æ­¥ã€‚ 12345678910111213export const mutations = &#123; getTodo (state, todo) &#123; state.todoList = todo &#125;, addTodo (state, todo) &#123; state.todoList.push(todo) &#125;, deleteTodo (state, id) &#123; state.todoList = state.todoList.filter((item) =&gt; item.id !== id) &#125;&#125; actionsè¿™é‡Œæ‰æ˜¯ä¸åå°äº¤äº’ï¼Œè¿›è¡Œå¼‚æ­¥æ“ä½œçš„åœ°æ–¹ 1234567891011121314151617181920212223242526272829303132333435import axios from 'axios'const host = 'http://localhost:9000'export const getTodo = (&#123; commit &#125;) =&gt; &#123; axios.get(`$&#123;host&#125;/todo/get`) .then(res =&gt; &#123; console.log(res) commit('getTodo', res.data.data) &#125;).catch(err =&gt; &#123; console.log(err) &#125;)&#125;export const addTodo = (&#123; commit &#125;, data) =&gt; &#123; axios.post(`$&#123;host&#125;/todo/create`, &#123; data: data &#125;).then(res =&gt; &#123; console.log(res) commit('addTodo', data) &#125;).catch(err =&gt; &#123; console.log(err) &#125;)&#125;export const deleteTodo = (&#123; commit &#125;, id) =&gt; &#123; axios.post(`$&#123;host&#125;/todo/delete`, &#123; id: id &#125;).then(res =&gt; &#123; console.log(res) commit('deleteTodo', id) &#125;).catch(err =&gt; &#123; console.log(err) &#125;)&#125; gettersdemoé‡Œæ²¡å†™ï¼Œä½†æ˜¯è¿™ä¸€å—ä¸»è¦æ˜¯å°†storeä¸­çš„stateæ´¾ç”Ÿå‡ºä¸€äº›çŠ¶æ€ï¼Œç”¨æ¥å¤ç”¨ é¡µé¢ç»„ä»¶ç©äº†ä¸€ä¸‹ä¸‹element-ui index.vue 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364&lt;template&gt; &lt;el-container&gt; &lt;el-header&gt;&#123;&#123; header &#125;&#125;&lt;/el-header&gt; &lt;el-container&gt; &lt;menus&gt;&lt;/menus&gt; &lt;el-container&gt; &lt;el-main&gt; &lt;router-view /&gt; &lt;/el-main&gt; &lt;el-footer&gt;&#123;&#123; footer &#125;&#125;&lt;/el-footer&gt; &lt;/el-container&gt; &lt;/el-container&gt; &lt;/el-container&gt;&lt;/template&gt;&lt;script&gt;import Menus from './menus'export default &#123; name: 'index', data () &#123; return &#123; header: 'header', footer: 'footer' &#125; &#125;, components: &#123; Menus &#125;&#125;&lt;/script&gt;&lt;!-- Add \"scoped\" attribute to limit CSS to this component only --&gt;&lt;style scoped&gt; .el-container &#123; height: 100%; &#125; .el-header, .el-footer &#123; background-color: #B3C0D1; color: #333; text-align: center; line-height: 60px; &#125; .el-aside &#123; background-color: #545c64; color: #333; text-align: center; line-height: 200px; &#125; .el-main &#123; background-color: #E9EEF3; color: #333; text-align: left; line-height: 50px; &#125; body &gt; .el-container &#123; margin-bottom: 40px; &#125;&lt;/style&gt; menus.vue 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172&lt;template&gt; &lt;el-aside width=\"300px\"&gt; &lt;el-menu style=\"width: 100%;\" default-active=\"2\" router class=\"el-menu-vertical-demo\" @open=\"handleOpen\" @close=\"handleClose\" background-color=\"#545c64\" text-color=\"#fff\" active-text-color=\"#ffd04b\"&gt; &lt;el-submenu index=\"1\"&gt; &lt;template slot=\"title\"&gt; &lt;i class=\"el-icon-location\"&gt;&lt;/i&gt; &lt;span&gt;å¯¼èˆªä¸€&lt;/span&gt; &lt;/template&gt; &lt;el-menu-item-group&gt; &lt;router-link to=\"/1-1\"&gt; &lt;el-menu-item index=\"1-1\"&gt;é€‰é¡¹1&lt;/el-menu-item&gt; &lt;/router-link&gt; &lt;router-link to=\"/1-2\"&gt; &lt;el-menu-item index=\"1-2\"&gt;é€‰é¡¹2&lt;/el-menu-item&gt; &lt;/router-link&gt; &lt;/el-menu-item-group&gt; &lt;router-link to=\"/1-3\"&gt; &lt;el-menu-item index=\"1-3\"&gt;é€‰é¡¹3&lt;/el-menu-item&gt; &lt;/router-link&gt; &lt;el-submenu index=\"1-4\"&gt; &lt;template slot=\"title\"&gt; &lt;i class=\"el-icon-location\"&gt;&lt;/i&gt; &lt;span&gt;é€‰é¡¹4&lt;/span&gt; &lt;/template&gt; &lt;router-link to=\"/1-4-1\"&gt; &lt;el-menu-item index=\"1-4-1\"&gt;é€‰é¡¹1&lt;/el-menu-item&gt; &lt;/router-link&gt; &lt;/el-submenu&gt; &lt;/el-submenu&gt; &lt;router-link to=\"/2\"&gt; &lt;el-menu-item index=\"2\"&gt; &lt;i class=\"el-icon-menu\"&gt;&lt;/i&gt; &lt;span slot=\"title\"&gt;å¯¼èˆªäºŒ&lt;/span&gt; &lt;/el-menu-item&gt; &lt;/router-link&gt; &lt;router-link to=\"/3\"&gt; &lt;el-menu-item index=\"3\"&gt; &lt;i class=\"el-icon-setting\"&gt;&lt;/i&gt; &lt;span slot=\"title\"&gt;å¯¼èˆªä¸‰&lt;/span&gt; &lt;/el-menu-item&gt; &lt;/router-link&gt; &lt;/el-menu&gt; &lt;/el-aside&gt;&lt;/template&gt;&lt;script&gt;export default &#123; name: 'menus', data () &#123; return &#123;&#125; &#125;, methods: &#123; handleOpen (key, keyPath) &#123; console.log(key, keyPath) &#125;, handleClose (key, keyPath) &#123; console.log(key, keyPath) &#125; &#125;&#125;&lt;/script&gt;&lt;style scoped&gt;&lt;/style&gt; todo.vue 1234567891011121314151617181920212223242526272829303132333435363738394041&lt;template&gt; &lt;div class=\"todo\"&gt; &lt;el-input type=\"text\" v-model=\"taskInput\" @keyup.enter.native=\"addTask($event)\" placeholder=\"è¯·æ·»åŠ ä»»åŠ¡\"&gt;&lt;/el-input&gt; &lt;div class=\"list\" v-for=\"todo in todoList\" :todo=\"todo\" :key=\"todo.id\"&gt; &lt;span&gt;&#123;&#123;todo.text&#125;&#125;&lt;/span&gt; &lt;el-button type=\"danger\" size=\"mini\" round @click.native=\"deleteTodo(todo.id)\"&gt;åˆ é™¤è¯¥ä»»åŠ¡&lt;/el-button&gt; &lt;/div&gt; &lt;/div&gt;&lt;/template&gt;&lt;script&gt;import &#123; mapState, mapActions &#125; from 'vuex'export default &#123; name: 'todo', data () &#123; return &#123; taskInput: '' &#125; &#125;, created () &#123; this.getTodo() &#125;, computed: &#123; ...mapState(['todoList']) &#125;, methods: &#123; addTask (e) &#123; this.$store.dispatch('addTodo', &#123; text: this.taskInput &#125;) this.taskInput = '' &#125;, ...mapActions([ 'getTodo', 'deleteTodo' ]) &#125;&#125;&lt;/script&gt;&lt;style scoped&gt;&lt;/style&gt; åç«¯é¦–å…ˆå‡†å¤‡mongoose 123456789101112131415// https://www.npmjs.com/package/limboconst limbo = require('limbo')const mongoose = require('mongoose')const todoSchema = require('./todo')const url = 'mongodb://127.0.0.1:27017/vue-todo'db = limbo.use('vueTodo', &#123; conn: mongoose.createConnection(url), schemas: &#123; Todo: todoSchema &#125;&#125;)module.exports = limbo todo.jsæ¨¡å‹ 123456789const mongoose = require('mongoose')const Schema = mongoose.Schemaconst todoSchema = Schema(&#123; todoList: &#123; type: Array, &#125;&#125;)module.exports = todoSchema index.js 12345678910111213141516171819202122232425262728293031323334const express = require('express')const mongoose = require('mongoose')const bodyParser = require('body-parser')const port = 9000const app = express()const todo = require('./router/todo')app.use(bodyParser.urlencoded(&#123; extended: true &#125;))app.use(bodyParser.json())// å¤„ç†è·¨åŸŸapp.use(function(req, res, next) &#123; res.header('Access-Control-Allow-Origin', '*') res.header('Access-Control-Allow-Methods', 'GET, PUT, POST, DELETE, OPTIONS') res.header('Access-Control-Allow-Headers', 'Origin, Content-Type, X-Requested-With, Authorization, Content-Length') if ('OPTIONS' === req.method) &#123; return res.send(200) &#125; else &#123; return next() &#125;&#125;)app.use('/todo', todo)app.listen(port, function (err) &#123; if (err) &#123; console.error(err) &#125; else &#123; console.info(\"server is running port %s\", port) &#125;&#125;) routerè¿™é‡Œ_idç›´æ¥ä»æ•°æ®åº“é‡Œæ‹¿äº†è¿™å¼ è¡¨çš„idæ¥æŸ¥è¯¢äº†ï¼Œå„ä½å¤§ä½¬ä¸ç”¨ç†ä¼šæˆ‘è¿™å°ç™½å†™æ³•ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243const express = require('express')const router = express.Router()const db = require('../db')const uuidv1 = require('uuid/v1')const &#123; TodoModel&#125; = db.use('vueTodo')router.post('/create', (req, res) =&gt; &#123; const &#123; data &#125; = req.body data.id = uuidv1() const todo = &#123; todoList: data &#125; TodoModel.findOneAndUpdate(&#123; _id: '5a7026137f927103bdad780d' &#125;, &#123; $push: todo &#125;, &#123; upsert: true, new: true &#125;, (err, result) =&gt; &#123; if (err) &#123; return res.status(400).json(&#123; statusCode: 400, msg: 'save todo failure' &#125;) &#125; return res.status(200).json(&#123; statusCode: 200, msg: 'save todo success' &#125;) &#125;) &#125;)router.get('/get', (req, res) =&gt; &#123; TodoModel.findOne(&#123; _id: '5a7026137f927103bdad780d' &#125;, (err, result) =&gt; &#123; if (err) &#123; return res.status(400).json(&#123; statusCode: 400, msg: 'get todo failure' &#125;) &#125; return res.status(200).json(&#123; statusCode: 200, data: result &amp;&amp; result.todoList ? result.todoList : [] &#125;) &#125;)&#125;)router.post('/delete', (req, res) =&gt; &#123; const &#123; id &#125; = req.body TodoModel.findOneAndUpdate(&#123; _id: '5a7026137f927103bdad780d' &#125;, &#123; $pull: &#123; todoList: &#123; id: id &#125; &#125; &#125;, (err, result) =&gt; &#123; if (err) &#123; return res.status(400).json(&#123; statusCode: 400, msg: 'delete todo failure' &#125;) &#125; return res.status(200).json(&#123; statusCode: 200, msg: 'delete todo success' &#125;) &#125;)&#125;)module.exports = router æ€»ç»“è‡³æ­¤ï¼Œdemoç»“æ„å·²ç»è®²çš„å·®ä¸å¤šäº†ï¼Œè¯´çš„ä¸å¯¹çš„åœ°æ–¹ï¼Œå¸Œæœ›å„ç«¥é‹æŒ‡å‡ºäº’ç›¸å­¦ä¹ ã€‚ä¸å¾—ä¸è¯´ï¼Œvueæ¡†æ¶ç”¨æ¥çœŸçš„ä¸é”™ï¼Œå¤§å®¶åœ¨å¼€å‘çš„æ—¶å€™ï¼Œè®°ä½ï¼šè¦ä»æ•°æ®çš„è§’åº¦æ€è€ƒé—®é¢˜ï¼Œä¸€åˆ‡å°±ä¼šå˜å¾—å¦‚æ­¤ç®€å•ã€‚","tags":[{"name":"vue","slug":"vue","permalink":"//zhoujingchao.github.io/tags/vue/"}]},{"title":"æ·±å…¥ç†è§£Promise","date":"2017-11-07T05:32:38.000Z","path":"2017/11/07/æ·±å…¥ç†è§£Promise/","text":"å¼•å­è¿™æ˜¯ä¸€ç§æ™®éçš„è·å–ç”¨æˆ·ä¿¡æ¯çš„è¯·æ±‚å¤„ç† 12345678910111213// example 1function getUserInfo() &#123; return new Promise(function (resolve) &#123; // an asynchronous request http.get(url, function (res) &#123; resolve(res) &#125;) &#125;)&#125;getUserInfo().then(function (res) &#123; // handle&#125;) getUserInfoæ–¹æ³•è¿”å›ä¸€ä¸ªpromiseï¼Œå¯ä»¥é€šè¿‡å®ƒçš„thenæ–¹æ³•æ³¨å†Œåœ¨promiseå¼‚æ­¥æ“ä½œæˆåŠŸæ—¶æ‰§è¡Œçš„å›è°ƒã€‚è¿™ç§æ‰§è¡Œæ–¹å¼ï¼Œä½¿å¾—å¼‚æ­¥è°ƒç”¨å˜å¾—é¡ºæ‰‹. åŸç†åˆ†æé‚£ä¹ˆç±»ä¼¼è¿™ç§åŠŸèƒ½çš„Promiseæ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿé¦–å…ˆçœ‹ä¸€ä¸‹æœ€åŸºç¡€çš„é›å½¢æ–¹æ³•å§ã€‚ æç®€çš„promiseé›å½¢12345678910111213141516function Promise(fn) &#123; var value = null, callbacks = []; // why array -&gt; there are a lot of callbacks sometimes this.then = function (onFulfilled) &#123; callbacks.push(onFulfilled) &#125; function resolve(value) &#123; callbacks.forEach(function(callback) &#123; callback(value) &#125;) &#125; fn(resolve)&#125; ä¸Šé¢çš„ä»£ç é€»è¾‘å¤§è‡´è¿™æ ·: è°ƒç”¨thenæ–¹æ³•ï¼Œå°†æƒ³è¦åœ¨Promiseå¼‚æ­¥æ“ä½œæˆåŠŸæ—¶æ‰§è¡Œå›è°ƒæ”¾å…¥callbacksé˜Ÿåˆ—ï¼Œå¯ä»¥ç†è§£ä¸ºæ³¨å†Œå›è°ƒå‡½æ•°ï¼Œå»¶ä¼¸ä¸‹å»å‘è§‚å¯Ÿè€…æ¨¡å¼æ€è€ƒ åˆ›å»ºPromiseå®ä¾‹æ—¶ä¼ å…¥çš„å‡½æ•°ä¼šè¢«èµ‹äºˆä¸€ä¸ªå‡½æ•°ç±»å‹çš„å‚æ•°ï¼Œå³resolveï¼Œä»–æ¥å—ä¸€ä¸ªå‚æ•°valueï¼Œä»£è¡¨å¼‚æ­¥æ“ä½œè¿”å›çš„ç»“æœï¼Œå½“å¼‚æ­¥æ“ä½œæ‰§è¡ŒæˆåŠŸ åï¼Œä¼šè°ƒç”¨resolveæ–¹æ³•ï¼Œè¿™æ—¶å€™å…¶å®çœŸæ­£æ‰§è¡Œçš„æ“ä½œæ˜¯å°†callbacksé˜Ÿåˆ—ä¸­çš„å›è°ƒä¸€ä¸€æ‰§è¡Œ ç»“åˆä¸­example 1çš„ä»£ç æ¥çœ‹ï¼Œé¦–å…ˆnew Promiseæ—¶ï¼Œä¼ ç»™promiseçš„å‡½æ•°å‘é€å¼‚æ­¥è¯·æ±‚ï¼Œæ¥ç€è°ƒç”¨promiseå¯¹è±¡çš„thenå±æ€§ï¼Œæ³¨å†Œè¯·æ±‚æˆåŠŸçš„å›è°ƒå‡½æ•°ï¼Œç„¶åå½“å¼‚æ­¥è¯·æ±‚å‘é€æˆåŠŸæ—¶ï¼Œè°ƒç”¨resolve(res)æ–¹æ³•, è¯¥æ–¹æ³•æ‰§è¡Œthenæ–¹æ³•æ³¨å†Œçš„å›è°ƒæ•°ç»„ã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†æœ‰åŒå­¦ä¼šé—®ï¼Œthenæ–¹æ³•åº”è¯¥èƒ½å¤Ÿé“¾å¼è°ƒç”¨ï¼Œä½†æ˜¯ä¸Šé¢çš„æœ€åŸºç¡€ç®€å•çš„ç‰ˆæœ¬æ˜¾ç„¶æ— æ³•æ”¯æŒé“¾å¼è°ƒç”¨å•Šã€‚soæƒ³è®©thenæ–¹æ³•æ”¯æŒé“¾å¼è°ƒç”¨ï¼Œæ¥ç€å¾€ä¸‹çœ‹ 1234this.then = function (onFulfilled) &#123; callbacks.push(onFulfilled) return this&#125; åªè¦è¿™æ ·å°±å¯ä»¥å®ç°é“¾å¼è°ƒç”¨äº† 123456// example 2getUserInfo().then(function (res) &#123; // handle&#125;).then(function (res) &#123; // handle&#125;) åŠ å…¥å»¶æ—¶æœºåˆ¶ç»†å¿ƒçš„åŒå­¦åº”è¯¥å‘ç°ï¼Œä¸Šè¿°ä»£ç è¿˜å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœåœ¨thenæ–¹æ³•æ³¨å†Œå›è°ƒä¹‹å‰ï¼Œresolveå‡½æ•°å°±æ‰§è¡Œäº†ï¼Œæ€ä¹ˆåŠï¼Ÿæ¯”å¦‚promiseå†…éƒ¨çš„å‡½æ•°æ˜¯åŒæ­¥å‡½æ•°ï¼š 123456789// example 3function getUserId() &#123; return new Promise(function (resolve) &#123; resolve('gg') &#125;)&#125;getUserInfo().then(function (res) &#123; // handle&#125;) è¿™æ˜¾ç„¶æ˜¯ä¸å…è®¸çš„ï¼ŒPromises/A+è§„èŒƒæ˜ç¡®è¦æ±‚å›è°ƒéœ€è¦é€šè¿‡å¼‚æ­¥æ–¹å¼æ‰§è¡Œï¼Œç”¨ä»¥ä¿è¯ä¸€è‡´å¯é çš„æ‰§è¡Œé¡ºåºã€‚å› æ­¤æˆ‘ä»¬è¦åŠ å…¥ä¸€äº›å¤„ç†ï¼Œä¿è¯åœ¨resolveæ‰§è¡Œä¹‹å‰ï¼Œthenæ–¹æ³•å·²ç»æ³¨å†Œå®Œæ‰€æœ‰çš„å›è°ƒã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·æ”¹é€ ä¸‹resolveå‡½æ•°: 1234567function resolve(value) &#123; setTimeout(function() &#123; callbacks.forEach(function (callback) &#123; callback(value) &#125;); &#125;, 0)&#125; ä¸Šé¢çš„ä»£ç çš„æ€è·¯å¤§å®¶éƒ½æ˜ç™½ï¼Œå°±æ˜¯é€šè¿‡setTimeoutæœºåˆ¶ï¼Œå°†resolveä¸­æ‰§è¡Œå›è°ƒçš„é€»è¾‘æ”¾ç½®åˆ°JSä»»åŠ¡é˜Ÿåˆ—æœ«å°¾ï¼Œä»¥ä¿è¯åœ¨resolveæ‰§è¡Œæ—¶ï¼Œthenæ–¹æ³•çš„å›è°ƒå‡½æ•°å·²ç»æ³¨å†Œå®Œæˆ.é‚£ä¹ˆé—®é¢˜åˆæ¥äº†æŸäº›åŒå­¦åˆå‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œå¯ä»¥ç»†æƒ³ä¸€ä¸‹ï¼šå¦‚æœPromiseå¼‚æ­¥æ“ä½œå·²ç»æˆåŠŸï¼Œè¿™æ—¶ï¼Œåœ¨å¼‚æ­¥æ“ä½œæˆåŠŸä¹‹å‰æ³¨å†Œçš„å›è°ƒéƒ½ä¼šæ‰§è¡Œï¼Œä½†æ˜¯åœ¨Promiseå¼‚æ­¥æ“ä½œæˆåŠŸè¿™ä¹‹åè°ƒç”¨çš„thenæ³¨å†Œçš„å›è°ƒå°±å†ä¹Ÿä¸ä¼šæ‰§è¡Œäº†ï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚ åŠ å…¥çŠ¶æ€æ©ï¼Œä¸ºäº†è§£å†³ä¸Šä¸€èŠ‚æŠ›å‡ºçš„é—®é¢˜ï¼Œæˆ‘ä»¬å¿…é¡»åŠ å…¥çŠ¶æ€æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯å¤§å®¶ç†ŸçŸ¥çš„pendingã€fulfilledã€rejectedã€‚ Promises/A+è§„èŒƒä¸­çš„2.1Promise Statesä¸­æ˜ç¡®è§„å®šäº†ï¼Œpendingå¯ä»¥è½¬åŒ–ä¸ºfulfilledæˆ–rejectedå¹¶ä¸”åªèƒ½è½¬åŒ–ä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœpendingè½¬åŒ–åˆ°fulfilledçŠ¶æ€ï¼Œé‚£ä¹ˆå°±ä¸èƒ½å†è½¬åŒ–åˆ°rejectedã€‚å¹¶ä¸”fulfilledå’ŒrejectedçŠ¶æ€åªèƒ½ç”±pendingè½¬åŒ–è€Œæ¥ï¼Œä¸¤è€…ä¹‹é—´ä¸èƒ½äº’ç›¸è½¬æ¢ã€‚æ”¹è¿›åçš„ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425function Promise(fn) &#123; var state = 'pendding', value = null, callbacks = []; this.then = function (onFulfilled) &#123; if (state === 'pendding') &#123; callbacks.push(onFulfilled) return this &#125; onFulfilled(value) return &#125; function resolve(newValue) &#123; value = newValue, state = 'fulfilled'; setTimeout(function() &#123; callbacks.forEach(function (callback) &#123; callback(value) &#125;) &#125;, 0) &#125; fn(resolve)&#125; ä¸Šé¢çš„ä»£ç çš„æ€è·¯æ˜¯è¿™æ ·çš„ï¼šresolveæ‰§è¡Œæ—¶ï¼Œä¼šå°†çŠ¶æ€è®¾ç½®ä¸ºfulfilledï¼Œåœ¨æ­¤ä¹‹åè°ƒç”¨thenæ·»åŠ çš„æ–°å›è°ƒï¼Œéƒ½ä¼šç«‹å³æ‰§è¡Œã€‚è¿™é‡Œæ²¡æœ‰ä»»ä½•åœ°æ–¹å°†stateè®¾ä¸ºrejectedï¼Œä¸ºäº†è®©å¤§å®¶èšç„¦åœ¨æ ¸å¿ƒä»£ç ä¸Šï¼Œè¿™ä¸ªé—®é¢˜åé¢ä¼šæœ‰ä¸€å°èŠ‚ä¸“é—¨åŠ å…¥ã€‚ é“¾å¼Promiseé‚£ä¹ˆè¿™é‡Œé—®é¢˜åˆæ¥äº†æŸäº›åŒå­¦è¿˜ä¼šé—®ï¼Œå¦‚æœç”¨æˆ·åœ¨thenå‡½æ•°é‡Œé¢æ³¨å†Œçš„ä»ç„¶æ˜¯ä¸€ä¸ªPromiseï¼Œè¯¥å¦‚ä½•è§£å†³ï¼Ÿæ¯”å¦‚ä¸‹é¢çš„example 4ï¼š 12345678910111213getUserInfo() .then(getUserDad) .then(function (res) &#123; // handle &#125;)function getUserDad(userInfoObj) &#123; return new Promise(function (resolve) &#123; http.get(url + userInfoObj.id, function (res) &#123; resolve(res) &#125;) &#125;)&#125; è¿™ç§åœºæ™¯ç›¸ä¿¡ç”¨è¿‡promiseçš„äººéƒ½çŸ¥é“ä¼šæœ‰å¾ˆå¤šï¼Œé‚£ä¹ˆç±»ä¼¼è¿™ç§å°±æ˜¯æ‰€è°“çš„é“¾å¼Promiseã€‚ é“¾å¼Promiseæ˜¯æŒ‡åœ¨å½“å‰promiseè¾¾åˆ°fulfilledçŠ¶æ€åï¼Œå³å¼€å§‹è¿›è¡Œä¸‹ä¸€ä¸ªpromiseï¼ˆåé‚»promiseï¼‰ã€‚é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•è¡”æ¥å½“å‰promiseå’Œåé‚»promiseå‘¢ï¼Ÿæ¥ç€æˆ‘é‚£ä¼šä¸‹çœ‹ï¼šåªè¦åœ¨thenæ–¹æ³•é‡Œé¢returnä¸€ä¸ªpromiseå°±å¥½å•¦ã€‚Promises/A+è§„èŒƒä¸­çš„2.2.7å°±æ˜¯è¿™ä¹ˆè¯´å“’ğŸ˜Š ä¸‹é¢æ¥çœ‹çœ‹è¿™æ®µæš—è—ç„æœºçš„thenæ–¹æ³•å’Œresolveæ–¹æ³•æ”¹é€ ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748function Promise(fn) &#123; var state = 'pendding', value = null, callbacks = []; this.then = function (onFulfilled) &#123; return new Promise(function (resolve) &#123; handle(&#123; onFulfilled: onFulfilled || null, resolve: resolve &#125;) &#125;) &#125; function handle(callback) &#123; if (state === 'pendding') &#123; callbacks.push(onFulfilled) return this &#125; // nothing in then if(!callback.onFulfilled) &#123; callback.resolve(value) return &#125; var ret = callback.onFulfilled(value) callback.resolve(ret) &#125; function resolve (newValue) &#123; if (newValue &amp;&amp; (typeof newValue === 'object' || typeof newValue === 'function')) &#123; var then = newValue.then if (typeof then === 'function') &#123; then.call(newValue, resolve) return &#125; &#125; value = newValue, state = 'fulfilled'; setTimeout(function() &#123; callbacks.forEach(function (callback) &#123; handle(callback) &#125;) &#125;, 0) &#125; fn(resolve)&#125; ä¸‹é¢ç»“åˆexample 4çš„ä»£ç ï¼Œåˆ†æä¸‹ä¸Šé¢çš„ä»£ç é€»è¾‘ï¼š example 4çš„thenæ–¹æ³•ä¸­ï¼Œåˆ›å»ºå¹¶è¿”å›äº†æ–°çš„Promiseå®ä¾‹ï¼Œè¿™æ˜¯ä¸²è¡ŒPromiseçš„åŸºç¡€ï¼Œå¹¶ä¸”æ”¯æŒé“¾å¼è°ƒç”¨ã€‚ handleæ–¹æ³•æ˜¯promiseå†…éƒ¨çš„æ–¹æ³•ã€‚thenæ–¹æ³•ä¼ å…¥çš„å½¢å‚onFulfilledä»¥åŠåˆ›å»ºæ–°Promiseå®ä¾‹æ—¶ä¼ å…¥çš„resolveå‡è¢«pushåˆ°å½“å‰promiseçš„callbacksé˜Ÿåˆ—ä¸­ï¼Œè¿™æ˜¯è¡”æ¥å½“å‰promiseå’Œåé‚»promiseçš„å…³é”®æ‰€åœ¨ï¼ˆè¿™é‡Œä¸€å®šè¦å¥½å¥½çš„åˆ†æä¸‹handleçš„ä½œç”¨ï¼‰ã€‚ getUserInfoç”Ÿæˆçš„promiseå¼‚æ­¥æ“ä½œæˆåŠŸï¼Œæ‰§è¡Œå…¶å†…éƒ¨æ–¹æ³•resolveï¼Œä¼ å…¥çš„å‚æ•°æ­£æ˜¯å¼‚æ­¥æ“ä½œçš„ç»“æœå³ç”¨æˆ·ä¿¡æ¯çš„å¯¹è±¡userInfoObj è°ƒç”¨handleæ–¹æ³•å¤„ç†callbacksé˜Ÿåˆ—ä¸­çš„å›è°ƒï¼šgetUserDadæ–¹æ³•ï¼Œç”Ÿæˆæ–°çš„promiseï¼ˆgetUserDad promiseï¼‰ æ‰§è¡Œä¹‹å‰ç”±getUserInfo promiseçš„thenæ–¹æ³•ç”Ÿæˆçš„æ–°promise(ç§°ä¸ºbridge promise)çš„resolveæ–¹æ³•ï¼Œä¼ å…¥å‚æ•°ä¸ºgetUserDad promiseã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä¼šå°†è¯¥resolveæ–¹æ³•ä¼ å…¥getUserDad promiseçš„thenæ–¹æ³•ä¸­ï¼Œå¹¶ç›´æ¥è¿”å›ã€‚ getUserDad promiseå¼‚æ­¥æ“ä½œæˆåŠŸæ—¶ï¼Œæ‰§è¡Œå…¶callbacksä¸­çš„å›è°ƒï¼šgetUserInfo bridge promiseä¸­çš„resolveæ–¹æ³• æœ€åæ‰§è¡ŒgetUserDad bridge promiseçš„åé‚»promiseçš„callbacksä¸­çš„å›è°ƒã€‚ å¤±è´¥å¤„ç†åœ¨å¼‚æ­¥æ“ä½œå¤±è´¥æ—¶ï¼Œæ ‡è®°å…¶çŠ¶æ€ä¸ºrejectedï¼Œå¹¶æ‰§è¡Œæ³¨å†Œçš„å¤±è´¥å›è°ƒ: 1234567891011121314151617// example 5function getUserInfo() &#123; return new Promise(function (resolve, reject) &#123; http.get(url, function (err, res) &#123; if (err) &#123; reject(err) &#125; resolve(res) &#125;) &#125;)&#125;getUserInfo().then(function (res) &#123; // handle res&#125;, function (err) &#123; console.log(err)&#125;) æœ‰äº†ä¹‹å‰å¤„ç†fulfilledçŠ¶æ€çš„ç»éªŒï¼Œæ”¯æŒé”™è¯¯å¤„ç†å˜å¾—å¾ˆå®¹æ˜“,åªéœ€è¦åœ¨æ³¨å†Œå›è°ƒã€å¤„ç†çŠ¶æ€å˜æ›´ä¸Šéƒ½è¦åŠ å…¥æ–°çš„é€»è¾‘ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061function Promise(fn) &#123; var state = 'pendding', value = null, callbacks = []; this.then = function (onFulfilled, onRejected) &#123; return new Promise(function (resolve, reject) &#123; handle(&#123; onFulfilled: onFulfilled || null, resolve: resolve, onRejected: onRejected || null, reject: reject &#125;) &#125;) &#125; function handle(callback) &#123; if (state === 'pendding') &#123; callbacks.push(onFulfilled) return this &#125; var ret, cb = state === 'fulfilled' ? callback.onFulfilled : callback.onRejected; if (cb === null) &#123; cb = state === 'fulfilled' ? callback.resolve : callback.reject cb(value) return &#125; ret = cb(value) callback.resolve(ret) &#125; function resolve (newValue) &#123; if (newValue &amp;&amp; (typeof newValue === 'object' || typeof newValue === 'function')) &#123; var then = newValue.then if (typeof then === 'function') &#123; then.call(newValue, resolve, reject) return &#125; &#125; value = newValue, state = 'fulfilled'; execute() &#125; function reject (reason) &#123; value = reason, state = 'rejected'; execute() &#125; execute() &#123; setTimeout(function() &#123; callbacks.forEach(function (callback) &#123; handle(callback) &#125;) &#125;, 0) &#125; fn(resolve, reject)&#125; ä¸Šé¢çš„ä»£ç å¢åŠ äº†æ–°çš„rejectæ–¹æ³•ï¼Œä¾›å¼‚æ­¥æ“ä½œå¤±è´¥æ—¶è°ƒç”¨ï¼ŒåŒæ—¶æŠ½å‡ºäº†resolveå’Œrejectå…±ç”¨çš„éƒ¨åˆ†ï¼Œå½¢æˆexecuteæ–¹æ³•ã€‚ é”™è¯¯å†’æ³¡æ˜¯ä¸Šè¿°ä»£ç å·²ç»æ”¯æŒï¼Œä¸”éå¸¸å®ç”¨çš„ä¸€ä¸ªç‰¹æ€§ã€‚åœ¨handleä¸­å‘ç°æ²¡æœ‰æŒ‡å®šå¼‚æ­¥æ“ä½œå¤±è´¥çš„å›è°ƒæ—¶ï¼Œä¼šç›´æ¥å°†bridge promise(thenå‡½æ•°è¿”å›çš„promiseï¼ŒååŒ)è®¾ä¸ºrejectedçŠ¶æ€ï¼Œå¦‚æ­¤è¾¾æˆæ‰§è¡Œåç»­å¤±è´¥å›è°ƒçš„æ•ˆæœã€‚è¿™æœ‰åˆ©äºç®€åŒ–ä¸²è¡ŒPromiseçš„å¤±è´¥å¤„ç†æˆæœ¬ï¼Œå› ä¸ºä¸€ç»„å¼‚æ­¥æ“ä½œå¾€å¾€ä¼šå¯¹åº”ä¸€ä¸ªå®é™…åŠŸèƒ½ï¼Œå¤±è´¥å¤„ç†æ–¹æ³•é€šå¸¸æ˜¯ä¸€è‡´çš„ï¼š 12345678getUserInfo() .then(getUserDad) .then(function(res) &#123; // handle res &#125; function(err) &#123; // there is something wrong in getUserInfo or getUserDad console.log(err) &#125;) å¼‚å¸¸å¤„ç†ç»†å¿ƒçš„åŒå­¦åˆä¼šæƒ³åˆ°ï¼šå¦‚æœåœ¨æ‰§è¡ŒæˆåŠŸå›è°ƒã€å¤±è´¥å›è°ƒæ—¶ä»£ç å‡ºé”™æ€ä¹ˆåŠï¼Ÿå¯¹äºè¿™ç±»å¼‚å¸¸ï¼Œå¯ä»¥ä½¿ç”¨try-catchæ•è·é”™è¯¯ï¼Œå¹¶å°†bridge promiseè®¾ä¸ºrejectedçŠ¶æ€ã€‚handleæ–¹æ³•æ”¹é€ å¦‚ä¸‹ï¼š 12345678910111213141516171819202122function handle(callback) &#123; if (state === 'pendding') &#123; callbacks.push(onFulfilled) return this &#125; var ret, cb = state === 'fulfilled' ? callback.onFulfilled : callback.onRejected; if (cb === null) &#123; cb = state === 'fulfilled' ? callback.resolve : callback.reject cb(value) return &#125; try &#123; ret = cb(value) callback.resolve(ret) &#125; catch(e) &#123; callback.reject(e) &#125;&#125; å¦‚æœåœ¨å¼‚æ­¥æ“ä½œä¸­ï¼Œå¤šæ¬¡æ‰§è¡Œresolveæˆ–è€…rejectä¼šé‡å¤å¤„ç†åç»­å›è°ƒï¼Œå¯ä»¥é€šè¿‡å†…ç½®ä¸€ä¸ªæ ‡å¿—ä½è§£å†³ã€‚ æ€»ç»“è¿™é‡Œä¸€å®šè¦æ³¨æ„çš„ç‚¹æ˜¯ï¼špromiseé‡Œé¢çš„thenå‡½æ•°ä»…ä»…æ˜¯æ³¨å†Œäº†åç»­éœ€è¦æ‰§è¡Œçš„ä»£ç ï¼ŒçœŸæ­£çš„æ‰§è¡Œæ˜¯åœ¨resolveæ–¹æ³•é‡Œé¢æ‰§è¡Œçš„ï¼Œç†æ¸…äº†è¿™å±‚ï¼Œå†æ¥åˆ†ææºç ä¼šçœåŠ›çš„å¤šã€‚ ç°åœ¨å›é¡¾ä¸‹Promiseçš„å®ç°è¿‡ç¨‹ï¼Œå…¶ä¸»è¦ä½¿ç”¨äº†è®¾è®¡æ¨¡å¼ä¸­çš„è§‚å¯Ÿè€…æ¨¡å¼ï¼š é€šè¿‡Promise.prototype.thenå’ŒPromise.prototype.catchæ–¹æ³•å°†è§‚å¯Ÿè€…æ–¹æ³•æ³¨å†Œåˆ°è¢«è§‚å¯Ÿè€…Promiseå¯¹è±¡ä¸­ï¼ŒåŒæ—¶è¿”å›ä¸€ä¸ªæ–°çš„Promiseå¯¹è±¡ï¼Œä»¥ä¾¿å¯ä»¥é“¾å¼è°ƒç”¨ã€‚ è¢«è§‚å¯Ÿè€…ç®¡ç†å†…éƒ¨pendingã€fulfilledå’Œrejectedçš„çŠ¶æ€è½¬å˜ï¼ŒåŒæ—¶é€šè¿‡æ„é€ å‡½æ•°ä¸­ä¼ é€’çš„resolveå’Œrejectæ–¹æ³•ä»¥ä¸»åŠ¨è§¦å‘çŠ¶æ€è½¬å˜å’Œé€šçŸ¥è§‚å¯Ÿè€…ã€‚","tags":[{"name":"js","slug":"js","permalink":"//zhoujingchao.github.io/tags/js/"}]},{"title":"æµè§ˆå™¨è¾“å…¥URLåˆ°é¡µé¢åŠ è½½çš„è¿‡ç¨‹","date":"2017-10-13T02:45:16.000Z","path":"2017/10/13/æµè§ˆå™¨è¾“å…¥URLåˆ°é¡µé¢åŠ è½½çš„è¿‡ç¨‹/","text":"æˆ‘ä»¬å¹³å¸¸è¾“å…¥ç½‘å€åˆ°é¡µé¢å±•ç°è¿™é‡Œé¢ç©¶ç«Ÿå‘ç”Ÿäº†å“ªäº›äº‹æƒ…ï¼Ÿ æ€»ä½“æ¥è¯´å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªè¿‡ç¨‹ï¼š DNSåŸŸåè§£æ TCPè¿æ¥ æœåŠ¡å™¨å¤„ç†è¯·æ±‚ æµè§ˆå™¨è§£æ ç»˜åˆ¶é¡µé¢ å…·ä½“è¿‡ç¨‹DNSè§£æDNSè§£æè¿‡ç¨‹å°±æ˜¯å¯»æ‰¾å“ªå°æœºå™¨ä¸Šæœ‰ä½ éœ€è¦çš„èµ„æºçš„è¿‡ç¨‹ã€‚å½“ä½ åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ä¸€ä¸ªåœ°å€æ—¶ï¼Œä¾‹å¦‚ www.baidu.comï¼Œ å…¶å®ä¸æ˜¯ç™¾åº¦ç½‘ç«™çœŸæ­£æ„ä¹‰ä¸Šçš„åœ°å€ã€‚äº’è”ç½‘ä¸Šæ¯ä¸€å°è®¡ç®—æœºçš„å”¯ä¸€æ ‡è¯†æ˜¯å®ƒçš„IPåœ°å€ï¼Œç”±äºIPåœ°å€å¹¶ä¸æ–¹ä¾¿è®°å¿†ï¼Œç”¨æˆ·æ›´å–œæ¬¢ç”¨æ–¹ä¾¿è®°å¿†çš„ç½‘å€å»å¯»æ‰¾äº’è”ç½‘ä¸Šçš„å…¶ä»–è®¡ç®—æœºï¼Œä¹Ÿå°±æ—¶ä¸Šé¢æåˆ°çš„ www.baidu.comã€‚æ‰€ä»¥äº’è”ç½‘è®¾è®¡è€…éœ€è¦åœ¨ç”¨æˆ·çš„æ–¹ä¾¿æ€§ä¸å¯ç”¨æ€§æ–¹é¢åšä¸€ä¸ªæƒè¡¡ï¼Œè¿™ä¸ªæƒè¡¡å°±æ˜¯ä¸€ä¸ªç½‘å€åˆ°IPåœ°å€çš„è½¬æ¢ï¼Œæ­¤è¿‡ç¨‹å³æ˜¯DNSè§£æã€‚å®ƒå®é™…ä¸Šå……å½“äº†ä¸€ä¸ªç¿»è¯‘çš„è§’è‰²ï¼Œå®ç°äº†ç½‘å€åˆ°IPåœ°å€çš„è½¬æ¢ã€‚é‚£ä¹ˆç½‘å€åˆ°IPåœ°å€è½¬æ¢çš„è¿‡ç¨‹æ˜¯å¦‚ä½•è¿›è¡Œçš„å‘¢ï¼Ÿ è§£æè¿‡ç¨‹DNSè§£ææ˜¯ä¸€ä¸ªé€’å½’æŸ¥è¯¢çš„è¿‡ç¨‹ã€‚ ä¸Šè¿°å›¾ç‰‡æ˜¯æŸ¥æ‰¾www.baidu.comçš„IPåœ°å€è¿‡ç¨‹ã€‚é¦–å…ˆåœ¨æœ¬åœ°åŸŸåæœåŠ¡å™¨ä¸­æŸ¥è¯¢IPåœ°å€ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°çš„æƒ…å†µä¸‹ï¼Œæœ¬åœ°åŸŸåæœåŠ¡å™¨ä¼šå‘æ ¹åŸŸåæœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œå¦‚æœæ ¹åŸŸåæœåŠ¡å™¨ä¹Ÿä¸å­˜åœ¨è¯¥åŸŸåæ—¶ï¼Œæœ¬åœ°åŸŸåä¼šå‘comé¡¶çº§åŸŸåæœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œä¾æ¬¡ç±»æ¨ä¸‹å»ã€‚ç›´åˆ°æœ€åæœ¬åœ°åŸŸåæœåŠ¡å™¨å¾—åˆ°baiduçš„IPåœ°å€å¹¶æŠŠå®ƒç¼“å­˜åˆ°æœ¬åœ°ï¼Œä¾›ä¸‹æ¬¡æŸ¥è¯¢ä½¿ç”¨ã€‚ä»ä¸Šè¿°è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥çœ‹å‡ºç½‘å€çš„è§£ææ˜¯ä¸€ä¸ªä»å³å‘å·¦çš„è¿‡ç¨‹: com -&gt; baidu.com -&gt; www.baidu.comã€‚ä½†æ˜¯ä½ æ˜¯å¦å‘ç°å°‘äº†ç‚¹ä»€ä¹ˆï¼Œæ ¹åŸŸåæœåŠ¡å™¨çš„è§£æè¿‡ç¨‹å‘¢ï¼Ÿäº‹å®ä¸Šï¼ŒçœŸæ­£çš„ç½‘å€æ˜¯www.baidu.com.ï¼Œå¹¶ä¸æ˜¯æˆ‘å¤šæ‰“äº†ä¸€ä¸ª.ï¼Œè¿™ä¸ª.å¯¹åº”çš„å°±æ˜¯æ ¹åŸŸåæœåŠ¡å™¨ï¼Œé»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰çš„ç½‘å€çš„æœ€åä¸€ä½éƒ½æ˜¯.ï¼Œæ—¢ç„¶æ˜¯é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸ºäº†æ–¹ä¾¿ç”¨æˆ·ï¼Œé€šå¸¸éƒ½ä¼šçœç•¥ï¼Œæµè§ˆå™¨åœ¨è¯·æ±‚DNSçš„æ—¶å€™ä¼šè‡ªåŠ¨åŠ ä¸Šï¼Œæ‰€æœ‰ç½‘å€çœŸæ­£çš„è§£æè¿‡ç¨‹ä¸º: . -&gt; .com -&gt; baidu.com. -&gt; www.baidu.com.ã€‚ DNSä¼˜åŒ–äº†è§£äº†DNSçš„è¿‡ç¨‹ï¼Œå¯ä»¥ä¸ºæˆ‘ä»¬å¸¦æ¥å“ªäº›ï¼Ÿä¸Šæ–‡ä¸­è¯·æ±‚åˆ°baiduçš„IPåœ°å€æ—¶ï¼Œç»å†äº†8ä¸ªæ­¥éª¤ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­å­˜åœ¨å¤šä¸ªè¯·æ±‚(åŒæ—¶å­˜åœ¨UDPå’ŒTCPè¯·æ±‚ï¼Œä¸ºä»€ä¹ˆæœ‰ä¸¤ç§è¯·æ±‚æ–¹å¼ï¼Œè¯·è‡ªè¡ŒæŸ¥æ‰¾)ã€‚å¦‚æœæ¯æ¬¡éƒ½ç»è¿‡è¿™ä¹ˆå¤šæ­¥éª¤ï¼Œæ˜¯å¦å¤ªè€—æ—¶é—´ï¼Ÿå¦‚ä½•å‡å°‘è¯¥è¿‡ç¨‹çš„æ­¥éª¤å‘¢ï¼Ÿé‚£å°±æ˜¯DNSç¼“å­˜ã€‚ DNSç¼“å­˜DNSå­˜åœ¨ç€å¤šçº§ç¼“å­˜ï¼Œä»ç¦»æµè§ˆå™¨çš„è·ç¦»æ’åºçš„è¯ï¼Œæœ‰ä»¥ä¸‹å‡ ç§: æµè§ˆå™¨ç¼“å­˜ï¼Œç³»ç»Ÿç¼“å­˜ï¼Œè·¯ç”±å™¨ç¼“å­˜ï¼ŒIPSæœåŠ¡å™¨ç¼“å­˜ï¼Œæ ¹åŸŸåæœåŠ¡å™¨ç¼“å­˜ï¼Œé¡¶çº§åŸŸåæœåŠ¡å™¨ç¼“å­˜ï¼Œä¸»åŸŸåæœåŠ¡å™¨ç¼“å­˜ã€‚ åœ¨ä½ çš„chromeæµè§ˆå™¨ä¸­è¾“å…¥:chrome://dns/ï¼Œä½ å¯ä»¥çœ‹åˆ°chromeæµè§ˆå™¨çš„DNSç¼“å­˜ã€‚ ç³»ç»Ÿç¼“å­˜ä¸»è¦å­˜åœ¨/etc/hosts(Linuxç³»ç»Ÿ)ä¸­ã€‚ â€¦ DNSè´Ÿè½½å‡è¡¡ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰æ€è€ƒè¿‡ä¸€ä¸ªé—®é¢˜: DNSè¿”å›çš„IPåœ°å€æ˜¯å¦æ¯æ¬¡éƒ½ä¸€æ ·ï¼Ÿå¦‚æœæ¯æ¬¡éƒ½ä¸€æ ·æ˜¯å¦è¯´æ˜ä½ è¯·æ±‚çš„èµ„æºéƒ½ä½äºåŒä¸€å°æœºå™¨ä¸Šé¢ï¼Œé‚£ä¹ˆè¿™å°æœºå™¨éœ€è¦å¤šé«˜çš„æ€§èƒ½å’Œå‚¨å­˜æ‰èƒ½æ»¡è¶³äº¿ä¸‡è¯·æ±‚å‘¢ï¼Ÿå…¶å®çœŸå®çš„äº’è”ç½‘ä¸–ç•ŒèƒŒåå­˜åœ¨æˆåƒä¸Šç™¾å°æœåŠ¡å™¨ï¼Œå¤§å‹çš„ç½‘ç«™ç”šè‡³æ›´å¤šã€‚ä½†æ˜¯åœ¨ç”¨æˆ·çš„çœ¼ä¸­ï¼Œå®ƒéœ€è¦çš„åªæ˜¯å¤„ç†ä»–çš„è¯·æ±‚ï¼Œå“ªå°æœºå™¨å¤„ç†è¯·æ±‚å¹¶ä¸é‡è¦ã€‚DNSå¯ä»¥è¿”å›ä¸€ä¸ªåˆé€‚çš„æœºå™¨çš„IPç»™ç”¨æˆ·ï¼Œä¾‹å¦‚å¯ä»¥æ ¹æ®æ¯å°æœºå™¨çš„è´Ÿè½½é‡ï¼Œè¯¥æœºå™¨ç¦»ç”¨æˆ·åœ°ç†ä½ç½®çš„è·ç¦»ç­‰ç­‰ï¼Œè¿™ç§è¿‡ç¨‹å°±æ˜¯DNSè´Ÿè½½å‡è¡¡ï¼Œåˆå«åšDNSé‡å®šå‘ã€‚å¤§å®¶è€³ç†Ÿèƒ½è¯¦çš„CDN(Content Delivery Network)å°±æ˜¯åˆ©ç”¨DNSçš„é‡å®šå‘æŠ€æœ¯ï¼ŒDNSæœåŠ¡å™¨ä¼šè¿”å›ä¸€ä¸ªè·Ÿç”¨æˆ·æœ€æ¥è¿‘çš„ç‚¹çš„IPåœ°å€ç»™ç”¨æˆ·ï¼ŒCDNèŠ‚ç‚¹çš„æœåŠ¡å™¨è´Ÿè´£å“åº”ç”¨æˆ·çš„è¯·æ±‚ï¼Œæä¾›æ‰€éœ€çš„å†…å®¹ã€‚ TCPè¿æ¥TCPæ˜¯äº’è”ç½‘ä¸­çš„ä¼ è¾“å±‚åè®®ï¼Œæä¾›å¯é çš„é“¾æ¥æœåŠ¡ï¼Œé‡‡ç”¨ä¸‰æ¬¡æ¡æ‰‹ç¡®è®¤ä¸€ä¸ªè¿æ¥ï¼š æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€å»ºç«‹è¿æ¥çš„è¯·æ±‚ã€‚ æœåŠ¡å™¨æ¥æ”¶åˆ°æµè§ˆå™¨å‘é€çš„è¯·æ±‚åï¼Œåƒæµè§ˆå™¨å‘é€ç»Ÿä¸€è¿æ¥çš„ä¿¡å·ã€‚ æµè§ˆå™¨æ¥å—åˆ°æœåŠ¡å™¨å‘å‡ºçš„åŒæ„è¿æ¥çš„ä¿¡å·åï¼Œå†æ¬¡å‘æœåŠ¡å™¨å‘å‡ºç¡®è®¤è¿æ¥çš„ä¿¡å·ã€‚ å½“ä¸‰æ¬¡æ¡æ‰‹è¿”ç¨‹ï¼ŒTCPå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æˆåŠŸçš„å»ºç«‹è¿æ¥ï¼Œå°±å¯ä»¥å¼€å§‹ä¼ è¾“æ•°æ®äº†ã€‚ æœåŠ¡å™¨å¤„ç†è¯·æ±‚æ¯å°æœåŠ¡å™¨ä¸Šéƒ½ä¼šå®‰è£…å¤„ç†è¯·æ±‚çš„åº”ç”¨â€”â€”Web serverã€‚å¸¸è§çš„web serveräº§å“æœ‰apacheã€nginxã€IISã€Lighttpdç­‰ã€‚ å½“web serveræ¥æ”¶åˆ°ä¸€ä¸ªHTTPè¯·æ±‚(request)ï¼Œä¼šè¿”å›ä¸€ä¸ªHTTPå“åº”(response)ï¼Œä¾‹å¦‚é€å›ä¸€ä¸ªHTMLé¡µé¢ã€‚å¯¹äºä¸åŒç”¨æˆ·å‘é€çš„è¯·æ±‚ï¼Œä¼šç»“åˆé…ç½®æ–‡ä»¶ï¼ŒæŠŠä¸åŒè¯·æ±‚å§”æ‰˜ç»™æœåŠ¡å™¨ä¸Šå¤„ç†å¯¹åº”è¯·æ±‚çš„ç¨‹åºè¿›è¡Œå¤„ç†ï¼ˆä¾‹å¦‚CGIè„šæœ¬ï¼ŒJSPè„šæœ¬ï¼Œservletsï¼ŒASPè„šæœ¬ï¼ŒæœåŠ¡å™¨ç«¯JavaScriptï¼Œæˆ–è€…ä¸€äº›å…¶å®ƒçš„æœåŠ¡å™¨ç«¯æŠ€æœ¯ç­‰ï¼‰ã€‚ æ— è®ºå®ƒä»¬(è„šæœ¬)çš„ç›®çš„å¦‚ä½•ï¼Œè¿™äº›æœåŠ¡å™¨ç«¯(server-side)çš„ç¨‹åºé€šå¸¸äº§ç”Ÿä¸€ä¸ªHTMLçš„å“åº”(response)æ¥è®©æµè§ˆå™¨å¯ä»¥æµè§ˆã€‚ é‚£ä¹ˆå¦‚ä½•å¤„ç†è¯·æ±‚ï¼Ÿå®é™…ä¸Šå°±æ˜¯åå°å¤„ç†çš„å·¥ä½œã€‚åå°å¼€å‘ç°åœ¨æœ‰å¾ˆå¤šæ¡†æ¶ï¼Œä½†å¤§éƒ¨åˆ†éƒ½è¿˜æ˜¯æŒ‰ç…§MVCè®¾è®¡æ¨¡å¼è¿›è¡Œæ­å»ºçš„ã€‚ å¤„ç†è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š å¯¹äºæ¯ä¸€ä¸ªç”¨æˆ·è¾“å…¥çš„è¯·æ±‚ï¼Œé¦–å…ˆè¢«æ§åˆ¶å™¨æ¥æ”¶ï¼Œæ§åˆ¶å™¨å†³å®šç”¨å“ªä¸ªæ¨¡å‹æ¥è¿›è¡Œå¤„ç†ï¼Œç„¶åæ¨¡å‹ç”¨ä¸šåŠ¡é€»è¾‘æ¥å¤„ç†ç”¨æˆ·çš„è¯·æ±‚å¹¶è¿”å›æ•°æ®ï¼Œæœ€åæ§åˆ¶å™¨ç¡®å®šç”¨å“ªä¸ªè§†å›¾æ¨¡å‹ï¼Œç”¨ç›¸åº”çš„è§†å›¾æ ¼å¼åŒ–æ¨¡å‹è¿”å›htmlå­—ç¬¦ä¸²ç»™æµè§ˆå™¨ï¼Œå¹¶é€šè¿‡æ˜¾ç¤ºé¡µé¢å‘ˆç°ç»™ç”¨æˆ·ã€‚ æµè§ˆå™¨è§£ææ¥ä¸‹æ¥å°±æ˜¯æµè§ˆå™¨è¿›è¡Œå¤„ç†ï¼Œé€šè¿‡åå°å¤„ç†è¿”å›çš„HTMLå­—ç¬¦ä¸²è¢«æµè§ˆå™¨æ¥å—åè¢«ä¸€å¥å¥è¯»å–è§£æï¼Œhtmlé¡µé¢ç»å†åŠ è½½ã€è§£æã€æ¸²æŸ“ã€‚ åŠ è½½æµè§ˆå™¨å¯¹ä¸€ä¸ªhtmlé¡µé¢çš„åŠ è½½é¡ºåºæ˜¯ä»ä¸Šè€Œä¸‹çš„ã€‚å¦‚æœåŠ è½½è¿‡ç¨‹ä¸­é‡åˆ°å¤–éƒ¨cssæ–‡ä»¶ï¼Œæµè§ˆå™¨å¦å¤–å‘å‡ºä¸€ä¸ªè¯·æ±‚ï¼Œæ¥è·å–cssæ–‡ä»¶ã€‚é‡åˆ°å›¾ç‰‡èµ„æºï¼Œæµè§ˆå™¨ä¹Ÿä¼šå¦å¤–å‘å‡ºä¸€ä¸ªè¯·æ±‚ï¼Œæ¥è·å–å›¾ç‰‡èµ„æºã€‚ä½†æ˜¯å½“æ–‡æ¡£åŠ è½½è¿‡ç¨‹ä¸­é‡åˆ°jsæ–‡ä»¶ï¼Œhtmlæ–‡æ¡£ä¼šæŒ‚èµ·æ¸²æŸ“ï¼ˆåŠ è½½è§£ææ¸²æŸ“åŒæ­¥ï¼‰çš„çº¿ç¨‹ï¼Œä¸ä»…è¦ç­‰å¾…æ–‡æ¡£ä¸­jsæ–‡ä»¶åŠ è½½å®Œæ¯•ï¼Œè¿˜è¦ç­‰å¾…è§£ææ‰§è¡Œå®Œæ¯•ï¼Œæ‰å¯ä»¥æ¢å¤htmlæ–‡æ¡£çš„æ¸²æŸ“çº¿ç¨‹ã€‚ è§£æè§£ææ–‡æ¡£æ˜¯æŒ‡å°†æ–‡æ¡£è½¬åŒ–æˆä¸ºæœ‰æ„ä¹‰çš„ç»“æ„ï¼Œä¹Ÿå°±æ˜¯å¯è®©ä»£ç ç†è§£å’Œä½¿ç”¨çš„ç»“æ„ã€‚è§£æå¾—åˆ°çš„ç»“æœé€šå¸¸æ˜¯ä»£è¡¨äº†æ–‡æ¡£ç»“æ„çš„èŠ‚ç‚¹æ ‘ï¼Œå®ƒç§°ä½œè§£ææ ‘æˆ–è€…è¯­æ³•æ ‘ï¼Œä¹Ÿå°±æ˜¯DOMæ ‘ã€‚å¦‚ä¸‹å›¾ï¼š cssè§£ææ˜¯æŒ‡å°†cssæ–‡ä»¶è§£æä¸ºæ ·å¼è¡¨å¯¹è±¡ã€‚å¦‚ä¸‹å›¾ï¼š jsè§£ææ˜¯æ–‡ä»¶åœ¨åŠ è½½çš„åŒæ—¶ä¹Ÿè¿›è¡Œè§£æå¦‚æœæƒ³æ·±å…¥å¦‚ä½•è§£æçš„è¯å¯ä»¥çœ‹æµè§ˆå™¨çš„å·¥ä½œåŸç†ï¼šæ–°å¼ç½‘ç»œæµè§ˆå™¨å¹•åæ­ç§˜è¿™ç¯‡æ–‡ç«  æ¸²æŸ“å³ä¸ºæ„å»ºæ¸²æŸ“æ ‘çš„è¿‡ç¨‹ï¼Œå°±æ˜¯å°†DOMæ ‘è¿›è¡Œå¯è§†åŒ–è¡¨ç¤ºã€‚æ„å»ºè¿™æ£µæ ‘æ˜¯ä¸ºäº†ä»¥æ­£ç¡®çš„é¡ºåºç»˜åˆ¶æ–‡æ¡£å†…å®¹ã€‚ ç»˜åˆ¶é¡µé¢æµè§ˆå™¨æ ¹æ® HTML å’Œ CSS è®¡ç®—å¾—åˆ°æ¸²æŸ“æ ‘ï¼Œæœ€ç»ˆç»˜åˆ¶åˆ°å±å¹•ä¸Š","tags":[{"name":"æµè§ˆå™¨","slug":"æµè§ˆå™¨","permalink":"//zhoujingchao.github.io/tags/æµè§ˆå™¨/"}]},{"title":"JSåŸå‹","date":"2017-09-29T12:03:22.000Z","path":"2017/09/29/JSåŸå‹/","text":"åŸå‹1ã€åŸå‹æ˜¯ä»€ä¹ˆï¼Ÿjsæ˜¯ä¸€é—¨åŸºäºå¯¹è±¡çš„è„šæœ¬è¯­è¨€ï¼Œä½†ä»–æ²¡æœ‰ç±»çš„æ¦‚å¿µã€‚jsä¸­çš„å¯¹è±¡æ˜¯æ— åºå±æ€§çš„é›†åˆï¼Œå…¶å±æ€§å¯ä»¥åŒ…å«åŸºæœ¬å€¼ï¼Œå¯¹è±¡æˆ–è€…å‡½æ•°ï¼Œç±»ä¼¼äºé”®å€¼å¯¹çš„é›†åˆã€‚æœ‰äº†å¯¹è±¡ï¼ŒæŒ‰ç†è¯´å¾—æœ‰ç»§æ‰¿å•Šï¼Œä¸ç„¶å¯¹è±¡ä¹‹é—´æ²¡æœ‰ä»»ä½•è”ç³»äº†ï¼Œä¹Ÿå°±çœŸçš„æ²¦ä¸ºé”®å€¼å¯¹çš„é›†åˆäº†ã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨jsä¸­å¯ä»¥ä½¿ç”¨æ„é€ å‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œåƒä¸‹é¢è¿™æ ·ï¼š 123456// æ„é€ å‡½æ•°æ— è¿”å›å€¼function Person(name) &#123; this.name = name;&#125;// é€šè¿‡ new åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡var person = new Person('Zhoujc'); newåé¢è·Ÿçš„ä¸æ˜¯ç±»ï¼Œè€Œæ˜¯æ„é€ å‡½æ•°ã€‚è¿™é‡Œçš„æ„é€ å‡½æ•°å¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§ç±»å‹ï¼Œå°±åƒé¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€ä¸­çš„ç±»ï¼Œä½†æ˜¯è¿™æ ·åˆ›å»ºçš„å¯¹è±¡é™¤äº†å±æ€§ä¸€æ ·å¤–ï¼Œå¹¶æ²¡æœ‰å…¶ä»–çš„ä»»ä½•è”ç³»ï¼Œå¯¹è±¡ä¹‹é—´æ— æ³•å…±äº«å±æ€§å’Œæ–¹æ³•ã€‚æ¯å½“æˆ‘ä»¬æ–°å»ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œéƒ½ä¼šåˆ†é…ä¸€å—æ–°çš„å†…å­˜ï¼Œè¿™æ˜¯æå¤§çš„èµ„æºæµªè´¹ã€‚è€ƒè™‘åˆ°è¿™ç‚¹ï¼Œjsçš„è®¾è®¡è€…Brendan Eichå†³å®šä¸ºæ„é€ å‡½æ•°è®¾ç½®ä¸€ä¸ªå±æ€§ã€‚è¿™ä¸ªå±æ€§æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€æœ‰å®ä¾‹å¯¹è±¡éœ€è¦å…±äº«çš„å±æ€§å’Œæ–¹æ³•ï¼Œéƒ½æ”¾åœ¨è¿™ä¸ªå¯¹è±¡é‡Œï¼Œé‚£äº›ä¸éœ€è¦å…±äº«çš„å±æ€§å’Œæ–¹æ³•ï¼Œå°±æ”¾åœ¨æ„é€ å‡½æ•°é‡Œã€‚å®ä¾‹å¯¹è±¡ä¸€æ—¦åˆ›å»ºï¼Œå°†è‡ªåŠ¨å¼•ç”¨è¿™ä¸ªå¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´å®ä¾‹å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•åˆ†æˆä¸¤ç§ï¼Œä¸€ç§æœ¬åœ°çš„ï¼Œä¸å…±äº«çš„ï¼Œå¦ä¸€ç§æ˜¯å¼•ç”¨çš„ï¼Œå…±äº«çš„ã€‚è¿™ä¸ªå°±å¯¹è±¡å°±æ˜¯åŸå‹ï¼ˆprototypeï¼‰å¯¹è±¡ï¼Œç®€ç§°ä¸ºåŸå‹ã€‚ æˆ‘ä»¬é€šè¿‡å‡½æ•°å£°æ˜æˆ–å‡½æ•°è¡¨è¾¾å¼åˆ›å»ºçš„å‡½æ•°éƒ½æœ‰ä¸€ä¸ªprototypeï¼ˆåŸå‹ï¼‰å±æ€§ï¼Œè¿™ä¸ªå±æ€§æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯è°ƒç”¨æ„é€ å‡½æ•°è€Œåˆ›å»ºçš„å¯¹è±¡å®ä¾‹çš„åŸå‹ã€‚æœ‰ä¸€ä¸ªç‰¹åˆ«çš„ï¼Œåœ¨ECMA-262è§„èŒƒä¸­ï¼Œé€šè¿‡Function.prototype.bindåˆ›å»ºçš„å‡½æ•°æ²¡æœ‰prototypeå±æ€§ã€‚åŸå‹å¯ä»¥åŒ…å«æ‰€æœ‰å®ä¾‹å…±äº«çš„å±æ€§å’Œæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦æ˜¯åŸå‹æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼Œé€šè¿‡è°ƒç”¨æ„é€ å‡½æ•°è€Œç”Ÿæˆçš„å¯¹è±¡å®ä¾‹éƒ½ä¼šæ‹¥æœ‰è¿™äº›å±æ€§å’Œæ–¹æ³•ã€‚çœ‹ä¸‹é¢ä»£ç ï¼š 12345678910111213141516function Person(name) &#123; this.name = name;&#125;Person.prototype.age = 20;Person.prototype.sayName = function () &#123; console.log(this.name);&#125;var person1 = new Person('Kobe');var person2 = new Person('Irving');person1.sayName(); // Kobeperson2.sayName(); // Irvingconsole.log(person1.age); // 20console.log(person2.age); // 20 è¿™æ®µä»£ç æˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªPersonå‡½æ•°ï¼Œå¹¶åœ¨è¿™ä¸ªå‡½æ•°çš„åŸå‹ä¸Šæ·»åŠ äº†ageå±æ€§å’ŒsayNameæ–¹æ³•ï¼Œç„¶åç”Ÿæˆäº†ä¸¤ä¸ªå¯¹è±¡å®ä¾‹Person1å’ŒPerson2ï¼Œè¿™ä¸¤ä¸ªå®ä¾‹åˆ†åˆ«æ‹¥æœ‰è‡ªå·±çš„å±æ€§nameå’ŒåŸå‹çš„å±æ€§ageä»¥åŠæ–¹æ³•sayNameã€‚æ‰€æœ‰çš„å®ä¾‹å¯¹è±¡å…±äº«åŸå‹å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ï¼Œé‚£ä¹ˆçœ‹èµ·æ¥ï¼ŒåŸå‹å¯¹è±¡å°±åƒæ˜¯ç±»ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨åŸå‹æ¥å®ç°ç»§æ‰¿äº†ã€‚ 2ã€constructorä¸[[Prototype]]æˆ‘ä»¬çŸ¥é“æ¯ä¸ªå‡½æ•°éƒ½æœ‰ä¸€ä¸ªprototypeå±æ€§ï¼ŒæŒ‡å‘å‡½æ•°çš„åŸå‹ï¼Œå› æ­¤å½“æˆ‘ä»¬æ‹¿åˆ°ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç¡®å®šå‡½æ•°çš„åŸå‹ã€‚åä¹‹ï¼Œå¦‚æœç»™æˆ‘ä»¬ä¸€ä¸ªå‡½æ•°çš„åŸå‹ï¼Œæˆ‘ä»¬æ€ä¹ˆçŸ¥é“è¿™ä¸ªåŸå‹å±äºå“ªä¸ªå‡½æ•°çš„å‘¢ï¼Ÿè¿™å°±è¦è¯´è¯´constructorå±æ€§äº†ï¼š åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰åŸå‹å¯¹è±¡éƒ½ä¼šè‡ªåŠ¨è·å¾—ä¸€ä¸ªconstructorï¼ˆæ„é€ å‡½æ•°ï¼‰å±æ€§ï¼Œè¿™ä¸ªå±æ€§åŒ…å«ä¸€ä¸ªæŒ‡å‘prototypeå±æ€§æ‰€åœ¨å‡½æ•°çš„æŒ‡é’ˆ ä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªåŸå‹éƒ½æœ‰ä¸€ä¸ªconstructorå±æ€§ï¼ŒæŒ‡å‘äº†åŸå‹æ‰€åœ¨çš„å‡½æ•°ï¼Œæ‹¿å‰é¢çš„ä¾‹å­æ¥è¯´Person.prototype.constructoræŒ‡å‘Personã€‚ä¸‹é¢æ˜¯æ„é€ å‡½æ•°å’ŒåŸå‹çš„å…³ç³»å›¾ï¼š ç»§ç»­ï¼Œè®©æˆ‘ä»¬è¯´è¯´[[prototype]]ã€‚ å½“æˆ‘ä»¬è°ƒç”¨æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ä¹‹åï¼Œæ¯”å¦‚ä¸Šé¢ä¾‹å­ä¸­çš„person1ï¼Œå®ä¾‹çš„å†…éƒ¨ä¼šåŒ…å«ä¸€ä¸ªæŒ‡é’ˆï¼ˆå†…éƒ¨å±æ€§ï¼‰ï¼ŒæŒ‡å‘æ„é€ å‡½æ•°çš„åŸå‹ã€‚ECMA-262ç¬¬5ç‰ˆä¸­ç®¡è¿™ä¸ªæŒ‡é’ˆå«[[prototype]]ã€‚æˆ‘ä»¬å¯ä»¥æ›´æ–°å‡½æ•°å’ŒåŸå‹çš„å…³ç³»å›¾ï¼š ä¸è¿‡åœ¨è„šæœ¬ä¸­æ²¡æœ‰æ ‡å‡†çš„æ–¹å¼è®¿é—®[[prototype]]ï¼Œä½†åœ¨Firefoxï¼ŒSafariå’ŒChromeä¸­å¯ä»¥é€šè¿‡__proto__å±æ€§è®¿é—®ã€‚è€Œåœ¨å…¶ä»–å®ç°ä¸­ï¼Œè¿™ä¸ªå±æ€§å¯¹è„šæœ¬åˆ™æ˜¯å®Œå…¨ä¸å¯è§çš„ã€‚ä¸è¿‡ï¼Œè¦æ˜ç¡®çš„çœŸæ­£é‡è¦ä¸€ç‚¹å°±æ˜¯ï¼Œè¿™ä¸ªè¿æ¥å­˜åœ¨äºå®ä¾‹ä¸æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ä¹‹é—´ï¼Œè€Œä¸æ˜¯å­˜åœ¨äºå®ä¾‹ä¸æ„é€ å‡½æ•°ä¹‹é—´ã€‚ åœ¨VSCodeä¸­å¼€å¯è°ƒè¯•æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™äº›å…³ç³»ï¼š ä»ä¸Šå›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°Personçš„prototypeå±æ€§å’Œperson1çš„__proto__å±æ€§æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼ŒPerson.prototypeåŒ…å«äº†ä¸€ä¸ªconstructorå±æ€§ï¼ŒæŒ‡å‘äº†Personå‡½æ•°ã€‚è¿™äº›å¯ä»¥å¾ˆå¥½çš„å°è¯æˆ‘ä»¬ä¸Šé¢æ‰€è¯´çš„æ„é€ å‡½æ•°ã€åŸå‹ã€constructorä»¥åŠ__proto__ä¹‹é—´çš„å…³ç³»ã€‚ 3ã€å¯¹è±¡å®ä¾‹ä¸åŸå‹äº†è§£å®Œæ„é€ å‡½æ•°ã€åŸå‹ã€å¯¹è±¡ä¹‹é—´çš„å…³ç³»åï¼Œä¸‹é¢æˆ‘ä»¬æ¥æ¢è®¨ä¸€ä¸‹å¯¹è±¡å®ä¾‹å’ŒåŸå‹ä¹‹é—´çš„å…³ç³»ã€‚ 1ã€åˆ¤æ–­å¯¹è±¡å®ä¾‹å’ŒåŸå‹ä¹‹é—´çš„å…³ç³»å› ä¸ºæˆ‘ä»¬æ— æ³•ç›´æ¥è®¿é—®å®ä¾‹å¯¹è±¡çš„__proto__å±æ€§ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬æƒ³è¦ç¡®å®šä¸€ä¸ªå¯¹è±¡å®ä¾‹å’ŒæŸä¸ªåŸå‹ä¹‹é—´æ˜¯å¦å­˜åœ¨å…³ç³»æ—¶ï¼Œå¯èƒ½ä¼šæœ‰äº›å›°éš¾ï¼Œå¥½åœ¨æˆ‘ä»¬æœ‰ä¸€äº›æ–¹æ³•å¯ä»¥åˆ¤æ–­ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡isPrototypeOf()æ–¹æ³•åˆ¤æ–­æŸä¸ªåŸå‹å’Œå¯¹è±¡å®ä¾‹æ˜¯å¦å­˜åœ¨å…³ç³»ï¼Œæˆ–è€…ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ ES5 æ–°å¢çš„æ–¹æ³•Object.getPrototypeOf()è·å–ä¸€ä¸ªå¯¹è±¡å®ä¾‹ __proto__å±æ€§çš„å€¼ã€‚çœ‹ä¸‹é¢çš„ä¾‹å­: 12console.log(Person.prototype.isPrototypeOf(person1)); // trueconsole.log(Object.getPrototypeOf(person1) === Person.prototype); // true 2ã€å¯¹è±¡å®ä¾‹å±æ€§å’Œæ–¹æ³•çš„è·å–æ¯å½“ä»£ç è¯»å–æŸä¸ªå¯¹è±¡çš„æŸä¸ªå±æ€§æ—¶ï¼Œéƒ½ä¼šæ‰§è¡Œä¸€æ¬¡æœç´¢ï¼Œç›®æ ‡æ˜¯å…·æœ‰ç»™å®šåå­—çš„å±æ€§ã€‚æœç´¢é¦–å…ˆä»å¯¹è±¡å®ä¾‹æœ¬èº«å¼€å§‹ã€‚å¦‚æœåœ¨å®ä¾‹å¯¹è±¡ä¸­æ‰¾åˆ°äº†å…·æœ‰ç»™å®šåå­—çš„å±æ€§ï¼Œåˆ™è¿”å›è¯¥å±æ€§çš„å€¼ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ç»§ç»­æœç´¢__proto__æŒ‡é’ˆæŒ‡å‘çš„åŸå‹å¯¹è±¡ï¼Œåœ¨åŸå‹å¯¹è±¡ä¸­æŸ¥æ‰¾å…·æœ‰ç»™å®šåå­—çš„å±æ€§ï¼Œå¦‚æœåœ¨åŸå‹å¯¹è±¡ä¸­æ‰¾åˆ°äº†è¿™ä¸ªå±æ€§ï¼Œåˆ™è¿”å›è¯¥å±æ€§çš„å€¼ã€‚å¦‚æœè¿˜æ‰¾ä¸åˆ°ï¼Œå°±ä¼šæ¥ç€æŸ¥æ‰¾åŸå‹çš„åŸå‹ï¼Œç›´åˆ°æœ€é¡¶å±‚ä¸ºæ­¢ã€‚è¿™æ­£æ˜¯å¤šä¸ªå¯¹è±¡å®ä¾‹å…±äº«åŸå‹æ‰€ä¿å­˜çš„å±æ€§å’Œæ–¹æ³•çš„åŸºæœ¬åŸç†ã€‚ è™½ç„¶å¯ä»¥é€šè¿‡å¯¹è±¡å®ä¾‹è®¿é—®ä¿å­˜åœ¨åŸå‹ä¸­çš„å€¼ï¼Œä½†å´ä¸èƒ½é€šè¿‡å¯¹è±¡å®ä¾‹é‡å†™åŸå‹ä¸­çš„å€¼ã€‚æˆ‘ä»¬åœ¨å®ä¾‹ä¸­æ·»åŠ çš„ä¸€ä¸ªå±æ€§ï¼Œä¼šå±è”½åŸå‹ä¸­çš„åŒåçš„å¯å†™å±æ€§ï¼Œå¦‚æœå±æ€§æ˜¯åªè¯»çš„ï¼Œä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šè§¦å‘é”™è¯¯ï¼Œéä¸¥æ ¼æ¨¡å¼ä¸‹åˆ™æ— æ³•å±è”½ã€‚å¦å¤–ï¼Œé€šè¿‡hasOwnPropertyæ–¹æ³•èƒ½åˆ¤æ–­å¯¹è±¡å®ä¾‹ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªå±æ€§ï¼ˆä¸èƒ½åˆ¤æ–­å¯¹è±¡åŸå‹ä¸­æ˜¯å¦å­˜åœ¨è¯¥å±æ€§ï¼‰ã€‚æ¥çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142function Person() &#123; Person.prototype.name = 'Kobe'; Person.prototype.age = 18; Person.prototype.job = 'NBA player'; Person.prototype.sayName = function () &#123; console.log(this.name); &#125;;&#125;var person1 = new Person();var person2 = new Person();// è®¾ç½® phone å±æ€§ä¸ºä¸å¯å†™Object.defineProperty(person1, 'phone', &#123; write: false, value: '100'&#125;);// æ–°å¢ä¸€ä¸ªè®¿é—®å™¨å±æ€§ addressObject.defineProperty(person1, 'address', &#123; set: function (value) &#123; console.log('set'); address = value; &#125;, get: function () &#123; return address; &#125;&#125;);// æ³¨æ„ï¼Œæ­¤å¤„ä¸èƒ½ç”¨ nameï¼Œå› ä¸ºå‡½æ•°æœ¬èº«å­˜åœ¨ name å±æ€§console.log(person1.hasOwnProperty('age')); // falseconsole.log(Person.hasOwnProperty('age')); // falseperson1.name = 'Irving';console.log(person1.hasOwnProperty('name')); // trueconsole.log(person1.name); //'Irving'â€”æ¥è‡ªå®ä¾‹console.log(person2.name); //'Kobe'â€”æ¥è‡ªåŸå‹person1.phone = '123'; // ä¸¥æ ¼æ¨¡å¼ä¸‹æŠ¥é”™person1.address = 'china'; // è°ƒç”¨ set æ–¹æ³•ï¼Œè¾“å‡º 'set'console.log(person1.address); // 'china'console.log(person1.phone); // 100 3ã€in æ“ä½œç¬¦æœ‰ä¸¤ç§æ–¹å¼ä½¿ç”¨ in æ“ä½œç¬¦ï¼š å•ç‹¬ä½¿ç”¨ åœ¨å•ç‹¬ä½¿ç”¨æ—¶ï¼Œin æ“ä½œç¬¦ä¼šåœ¨é€šè¿‡å¯¹è±¡èƒ½å¤Ÿè®¿é—®ç»™å®šå±æ€§æ—¶è¿”å› trueï¼Œæ— è®ºè¯¥å±æ€§å­˜åœ¨äºå®ä¾‹ä¸­è¿˜æ˜¯åŸå‹ä¸­ã€‚ for-in å¾ªç¯ä¸­ä½¿ç”¨ åœ¨ä½¿ç”¨ for-in å¾ªç¯æ—¶ï¼Œè¿”å›çš„æ˜¯æ‰€æœ‰èƒ½å¤Ÿé€šè¿‡å¯¹è±¡è®¿é—®çš„ã€å¯æšä¸¾çš„ï¼ˆenumeratedï¼‰å±æ€§ï¼Œå…¶ä¸­æ—¢åŒ…æ‹¬å­˜åœ¨äºå®ä¾‹ä¸­çš„å±æ€§ï¼Œ ä¹ŸåŒ…æ‹¬å­˜åœ¨äºåŸå‹ä¸­çš„å±æ€§ã€‚å¦‚æœéœ€è¦è·å–æ‰€æœ‰çš„å±æ€§ï¼ˆåŒ…æ‹¬ä¸å¯æšä¸¾çš„å±æ€§ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ Object.getOwnPropertyNames() æ–¹æ³•ã€‚ çœ‹ä¸‹é¢ä¾‹å­ï¼š 1234567891011121314151617function Person() &#123; this.name = 'Kobe'; Person.prototype.age = 18; Person.prototype.job = 'NBA player'; Person.prototype.sayName = function () &#123; console.log(this.name); &#125;;&#125;var person = new Person();for (var i in person) &#123; console.log(i); // name age job sayName &#125;console.log('name' in person); // true-æ¥è‡ªå®ä¾‹console.log('age' in person); // true-æ¥è‡ªåŸå‹ 4ã€åŸå‹çš„åŠ¨æ€æ€§ç”±äºåœ¨å¯¹è±¡ä¸­æŸ¥æ‰¾å±æ€§çš„è¿‡ç¨‹æ˜¯ä¸€æ¬¡æœç´¢ï¼Œè€Œå®ä¾‹ä¸åŸå‹ä¹‹é—´çš„è¿æ¥åªä¸è¿‡æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œè€Œéä¸€ä¸ªå‰¯æœ¬ï¼Œå› æ­¤æˆ‘ä»¬å¯¹åŸå‹å¯¹è±¡æ‰€åšçš„ä»»ä½•ä¿®æ”¹éƒ½èƒ½å¤Ÿç«‹å³ä»å®ä¾‹ä¸Šåæ˜ å‡ºæ¥â€”â€”å³ä½¿æ˜¯å…ˆåˆ›å»ºäº†å®ä¾‹åä¿®æ”¹åŸå‹ä¹Ÿç…§æ ·å¦‚æ­¤ï¼š 12345var person = new Person();Person.prototype.sayHi = function () &#123; console.log('hi');&#125;;person.sayHi(); // hi ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå…ˆåˆ›å»ºäº†Personçš„ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶å°†å…¶ä¿å­˜åœ¨personä¸­ã€‚ç„¶åï¼Œä¸‹ä¸€æ¡è¯­å¥åœ¨Person.prototypeä¸­æ·»åŠ äº†ä¸€ä¸ªæ–¹æ³•sayHi()ã€‚å³ä½¿personå®ä¾‹æ˜¯åœ¨æ·»åŠ æ–°æ–¹æ³•ä¹‹å‰åˆ›å»ºçš„ï¼Œä½†å®ƒä»ç„¶å¯ä»¥è®¿é—®è¿™ä¸ªæ–°æ–¹æ³•ã€‚åœ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œé¦–å…ˆä¼šæŸ¥æ‰¾personå®ä¾‹ä¸­æ˜¯å¦æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œå‘ç°æ²¡æœ‰ï¼Œç„¶ååˆ°personçš„åŸå‹å¯¹è±¡ä¸­æŸ¥æ‰¾ï¼ŒåŸå‹ä¸­å­˜åœ¨è¿™ä¸ªæ–¹æ³•ï¼ŒæŸ¥æ‰¾ç»“æŸã€‚ ä½†æ˜¯ä¸‹é¢è¿™ç§ä»£ç æ‰€å¾—åˆ°çš„ç»“æœå°±å®Œå…¨ä¸ä¸€æ ·äº†ï¼š 123456789101112function Person() &#123;&#125;;var person = new Person();Person.prototype = &#123; constructor: Person, name: \"kobe\", age: 18, job: \"NBA player\", sayName: function () &#123; console.log(this.name); &#125;&#125;;person.sayName(); // error ä»”ç»†è§‚å¯Ÿä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨å¯¹è±¡å­—é¢é‡è¯­æ³•ç»™Person.prototypeèµ‹å€¼ï¼Œè¿™ä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚ä½†æ˜¯æˆ‘ä»¬è¦çŸ¥é“å­—é¢é‡è¯­æ³•ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™é‡Œçš„ Person.prototypeæ˜¯ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå’Œpersonçš„__proto__å±æ€§ä¸å†æœ‰ä»»ä½•å…³ç³»äº†ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å†å°è¯•è°ƒç”¨sayNameæ–¹æ³•å°±ä¼šæŠ¥é”™ï¼Œå› ä¸ºpersonçš„ __proto__ å±æ€§æŒ‡å‘çš„è¿˜æ˜¯åŸæ¥çš„åŸå‹å¯¹è±¡ï¼Œè€ŒåŸæ¥çš„åŸå‹å¯¹è±¡ä¸Šå¹¶æ²¡æœ‰sayNameæ–¹æ³•ï¼Œæ‰€ä»¥å°±ä¼šæŠ¥é”™ã€‚ åŸå‹é“¾1ã€åŸå‹çš„åŸå‹åœ¨å‰é¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬æ˜¯ç›´æ¥åœ¨åŸå‹ä¸Šæ·»åŠ å±æ€§å’Œæ–¹æ³•ï¼Œæˆ–è€…ç”¨ä¸€ä¸ªæ–°çš„å¯¹è±¡èµ‹å€¼ç»™åŸå‹ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬è®©åŸå‹å¯¹è±¡ç­‰äºå¦ä¸€ä¸ªç±»å‹çš„å®ä¾‹ï¼Œç»“æœä¼šæ€æ ·å‘¢ï¼Ÿ 123456789101112131415161718192021function Person() &#123; this.age = '18';&#125;Person.prototype.height = '198cm';function Engineer() &#123; this.work = 'Front-End';&#125;Engineer.prototype = new Person(); // æ­¤æ—¶ Engineer.prototype æ²¡æœ‰ constructor å±æ€§Engineer.prototype.constructor = Engineer;Engineer.prototype.getAge = function () &#123; console.log(this.age);&#125;var person = new Person();var engineer = new Engineer();console.log(person.age); // 18Engineer.getAge(); // 18console.log(Engineer.height); // 198cmconsole.log(Engineer.prototype.__proto__ === Person.prototype); // true åœ¨ä¸Šé¢ä»£ç ä¸­ï¼Œæœ‰ä¸¤ä¸ªæ„é€ å‡½æ•°Personå’ŒEngineerï¼Œå¯ä»¥çœ‹ä½œæ˜¯ä¸¤ä¸ªç±»å‹ï¼ŒEngineerçš„åŸå‹æ˜¯Personçš„ä¸€ä¸ªå®ä¾‹ï¼Œä¹Ÿå°±æ˜¯è¯´Engineerçš„åŸå‹æŒ‡å‘äº†Personçš„åŸå‹ã€‚ ç„¶åæˆ‘ä»¬åˆ†åˆ«æ–°å»ºäº†ä¸€ä¸ªPersonå’ŒEngineerçš„å®ä¾‹å¯¹è±¡ï¼Œå¯ä»¥çœ‹åˆ°engineerå®ä¾‹å¯¹è±¡èƒ½å¤Ÿè®¿é—®åˆ°Personçš„ age å’Œ height å±æ€§ï¼Œè¿™å¾ˆå¥½ç†è§£ï¼š Engineerçš„åŸå‹æ˜¯Personçš„å®ä¾‹å¯¹è±¡ï¼ŒPersonçš„å®ä¾‹å¯¹è±¡åŒ…å«äº† age å±æ€§ï¼Œè€Œ height å±æ€§æ˜¯PersonåŸå‹å¯¹è±¡çš„å±æ€§ï¼ŒPersonçš„å®ä¾‹å¯¹è±¡è‡ªç„¶å¯ä»¥è®¿é—®åŸå‹ä¸­çš„å±æ€§ï¼ŒåŒç†ï¼ŒEngineerçš„å®ä¾‹å¯¹è±¡engineerä¹Ÿèƒ½è®¿é—®EngineeråŸå‹ä¸Šçš„å±æ€§ï¼Œé—´æ¥çš„ä¹Ÿèƒ½è®¿é—®PersonåŸå‹çš„å±æ€§ã€‚ çœ‹èµ·æ¥å…³ç³»æœ‰äº›å¤æ‚ï¼Œä¸è¦ç´§ï¼Œæˆ‘ä»¬ç”¨ä¸€å¼ å›¾æ¥è§£é‡Šè¿™äº›å…³ç³»ï¼š æ˜¯ä¸æ˜¯ä¸€ä¸‹å°±å¾ˆæ¸…æ¥šäº†ï¼Œé¡ºç€å›¾ä¸­çº¢è‰²çš„çº¿ï¼Œengineerå®ä¾‹å¯¹è±¡å¯ä»¥é¡ºåˆ©çš„è·å–Personå®ä¾‹çš„å±æ€§ä»¥åŠPersonåŸå‹çš„å±æ€§ã€‚è‡³æ­¤ï¼Œå·²ç»é“ºå«çš„å·®ä¸å¤šäº†ï¼Œæˆ‘ä»¬ç†è§£äº†åŸå‹çš„åŸå‹ä¹‹åï¼Œä¹Ÿå°±å¾ˆå®¹æ˜“ç†è§£åŸå‹é“¾äº†ã€‚ 2ã€åŸå‹é“¾åŸå‹é“¾å…¶å®ä¸éš¾ç†è§£ï¼Œä¸Šå›¾ä¸­çš„çº¢è‰²çº¿ç»„æˆçš„é“¾å°±å¯ä»¥ç§°ä¹‹ä¸ºåŸå‹é“¾ï¼Œåªä¸è¿‡è¿™æ˜¯ä¸€ä¸ªä¸å®Œæ•´çš„åŸå‹é“¾ã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·å®šä¹‰åŸå‹é“¾ï¼š åŸå‹å¯¹è±¡å¯ä»¥åŒ…å«ä¸€ä¸ªæŒ‡å‘å¦ä¸€ä¸ªåŸå‹ï¼ˆåŸå‹2ï¼‰çš„æŒ‡é’ˆï¼Œç›¸åº”åœ°ï¼Œå¦ä¸€ä¸ªåŸå‹ï¼ˆåŸå‹2ï¼‰ä¸­ä¹Ÿå¯ä»¥åŒ…å«ç€ä¸€ä¸ªæŒ‡å‘å¯¹åº”æ„é€ å‡½æ•°ï¼ˆåŸå‹2 çš„æ„é€ å‡½æ•°ï¼‰çš„æŒ‡é’ˆã€‚å‡å¦‚å¦ä¸€ä¸ªåŸå‹ï¼ˆåŸå‹2ï¼‰åˆæ˜¯å¦ä¸€ä¸ªç±»å‹ï¼ˆåŸå‹3 çš„æ„é€ å‡½æ•°ï¼‰çš„å®ä¾‹ï¼Œé‚£ä¹ˆä¸Šè¿°å…³ç³»ä¾ç„¶æˆç«‹ï¼Œå¦‚æ­¤å±‚å±‚é€’è¿›ï¼Œå°±æ„æˆäº†å®ä¾‹ä¸åŸå‹çš„é“¾æ¡ã€‚è¿™å°±æ˜¯æ‰€è°“åŸå‹é“¾çš„åŸºæœ¬æ¦‚å¿µã€‚ ç»“åˆä¸Šé¢çš„å›¾ï¼Œè¿™ä¸ªæ¦‚å¿µä¸éš¾ç†è§£ã€‚ä¸Šé¢çš„å›¾ä¸­åªæœ‰ä¸¤ä¸ªåŸå‹ï¼Œé‚£ä¹ˆå½“æœ‰æ›´å¤šçš„åŸå‹ä¹‹åï¼Œè¿™ä¸ªçº¢è‰²çš„çº¿ç†è®ºä¸Šå¯ä»¥æ— é™å»¶ä¼¸ï¼Œä¹Ÿå°±æ„æˆäº†åŸå‹é“¾ã€‚ é€šè¿‡å®ç°åŸå‹é“¾ï¼Œæœ¬è´¨ä¸Šæ‰©å±•äº†å‰é¢æåˆ°è¿‡çš„åŸå‹æœç´¢æœºåˆ¶ï¼šå½“ä»¥è¯»å–æ¨¡å¼è®¿é—®ä¸€ä¸ªå®ä¾‹çš„å±æ€§æ—¶ï¼Œé¦–å…ˆä¼šåœ¨å®ä¾‹ä¸­æœç´¢è¯¥å±æ€§ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°è¯¥å±æ€§ï¼Œåˆ™ä¼šç»§ç»­æœç´¢å®ä¾‹çš„åŸå‹ã€‚åœ¨é€šè¿‡åŸå‹é“¾å®ç°ç»§æ‰¿çš„æƒ…å†µä¸‹ï¼Œæœç´¢è¿‡ç¨‹å°±å¾—ä»¥æ²¿ç€åŸå‹é“¾ç»§ç»­å‘ä¸Šã€‚åœ¨æ‰¾ä¸åˆ°å±æ€§æˆ–æ–¹æ³•çš„æƒ…å†µä¸‹ï¼Œæœç´¢è¿‡ç¨‹æ€»æ˜¯è¦ä¸€ç¯ä¸€ç¯åœ°å‰è¡Œåˆ°åŸå‹é“¾æœ«ç«¯æ‰ä¼šåœä¸‹æ¥ã€‚ é‚£ä¹ˆåŸå‹é“¾çš„æœ«ç«¯åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬è¦çŸ¥é“ï¼Œæ‰€æœ‰å‡½æ•°çš„é»˜è®¤åŸå‹éƒ½æ˜¯Objectçš„å®ä¾‹ï¼Œå› æ­¤é»˜è®¤åŸå‹éƒ½ä¼šåŒ…å«ä¸€ä¸ªå†…éƒ¨æŒ‡é’ˆï¼ŒæŒ‡å‘Object.prototypeã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä¸Šé¢ä»£ç çš„å°¾éƒ¨åŠ ä¸Šä¸€è¡Œä»£ç è¿›è¡ŒéªŒè¯ï¼š 1console.log(Person.prototype.__proto__ === Object.prototype); // true é‚£Object.prototypeçš„åŸå‹åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Œä¸å¯èƒ½æ²¡æœ‰ç»ˆç‚¹å•Šï¼Ÿèªæ˜çš„å°ä¼™ä¼´å¯èƒ½å·²ç»çŒœåˆ°äº†ï¼Œæ²¡é”™ï¼Œå°±æ˜¯nullï¼Œnullè¡¨ç¤ºæ­¤å¤„ä¸åº”è¯¥æœ‰å€¼ï¼Œä¹Ÿå°±æ˜¯ç»ˆç‚¹äº†ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ Chrome çš„æ§åˆ¶å°æˆ– Node ä¸­éªŒè¯ä¸€ä¸‹ï¼š 1console.log(Object.prototype.__proto__); // null æˆ‘ä»¬æ›´æ–°ä¸€ä¸‹å…³ç³»å›¾ è‡³æ­¤ï¼Œä¸€åˆ‡å·²ç»å¾ˆæ¸…æ¥šäº†ï¼Œä¸‹é¢æˆ‘ä»¬æ¥è¯´è¯´åŸå‹é“¾çš„ç”¨å¤„ã€‚ ç»§æ‰¿ç»§æ‰¿æ˜¯é¢å‘å¯¹è±¡è¯­è¨€ä¸­çš„ä¸€ä¸ªå¾ˆå¸¸è§çš„æ¦‚å¿µï¼Œåœ¨é˜…è¯»å‰é¢ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å…¶å®å·²ç»å®ç°äº†ç®€å•çš„ç»§æ‰¿å…³ç³»ï¼Œç»†å¿ƒçš„å°ä¼™ä¼´å¯èƒ½å·²ç»å‘ç°äº†ã€‚åœ¨ JavaScript ä¸­ï¼Œå®ç°ç»§æ‰¿ä¸»è¦æ˜¯ä¾é åŸå‹é“¾æ¥å®ç°çš„ã€‚ 1ã€åŸå‹é“¾å®ç°ä¸€ä¸ªç®€å•çš„åŸºäºåŸå‹é“¾çš„ç»§æ‰¿å®ç°çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š 1234567891011121314151617181920function Parent() &#123; this.flag = 'parent';&#125;Parent.prototype.getFlag = function () &#123; return this.flag;&#125;function Child() &#123; this.childFlag = 'child';&#125;Child.prototype = new Parent();Child.prototype.getChildFlag = function () &#123; return this.childFlag;&#125;var instance = new Child();console.log(instance.childFlag); // childconsole.log(instance.flag); // parent åŸå‹é“¾è™½ç„¶å¾ˆå¼ºå¤§ï¼Œå¯ä»¥å®ç°ç»§æ‰¿ï¼Œä½†æ˜¯ä¼šå­˜åœ¨ä¸€äº›é—®é¢˜ï¼š å¼•ç”¨ç±»å‹çš„åŸå‹å±æ€§ä¼šè¢«æ‰€æœ‰å®ä¾‹å…±äº«ã€‚åœ¨é€šè¿‡åŸå‹é“¾æ¥å®ç°ç»§æ‰¿æ—¶ï¼Œå¼•ç”¨ç±»å‹çš„å±æ€§ä¼šè¢«æ‰€æœ‰å®ä¾‹å…±äº«ï¼Œä¸€æ—¦ä¸€ä¸ªå®ä¾‹ä¿®æ”¹äº†å¼•ç”¨ç±»å‹çš„å€¼ï¼Œä¼šç«‹åˆ»ååº”åˆ°å…¶ä»–å®ä¾‹ä¸Šã€‚ç”±äºåŸºæœ¬ç±»å‹ä¸æ˜¯å…±äº«çš„ï¼Œæ‰€ä»¥å½¼æ­¤ä¸ä¼šå½±å“ã€‚ åˆ›å»ºå­ç±»å‹çš„å®ä¾‹æ—¶ï¼Œä¸èƒ½å‘çˆ¶ç±»å‹çš„æ„é€ å‡½æ•°ä¼ é€’å‚æ•°ã€‚å®é™…ä¸Šï¼Œåº”è¯¥è¯´æ˜¯æ²¡æœ‰åŠæ³•åœ¨ä¸å½±å“æ‰€æœ‰å¯¹è±¡å®ä¾‹çš„æƒ…å†µä¸‹ï¼Œç»™çˆ¶ç±»å‹çš„æ„é€ å‡½æ•°ä¼ é€’å‚æ•°ï¼Œæˆ‘ä»¬ä¼ é€’çš„å‚æ•°ä¼šæˆä¸ºæ‰€æœ‰å®ä¾‹çš„å±æ€§ã€‚ åŸºäºä¸Šé¢ä¸¤ä¸ªé—®é¢˜ï¼Œå®è·µä¸­å¾ˆå°‘å•ç‹¬ä½¿ç”¨åŸå‹é“¾å®ç°ç»§æ‰¿ã€‚ 2ã€å€Ÿç”¨æ„é€ å‡½æ•°ä¸ºäº†è§£å†³ä¸Šé¢å‡ºç°çš„é—®é¢˜ï¼Œå‡ºç°äº†ä¸€ç§å«åšå€Ÿç”¨æ„é€ å‡½æ•°çš„æŠ€æœ¯ã€‚è¿™ç§æŠ€æœ¯çš„åŸºæœ¬æ€æƒ³å¾ˆç®€å•ï¼šapply()æˆ–call()æ–¹æ³•ï¼Œåœ¨å­ç±»å‹æ„é€ å‡½æ•°çš„å†…éƒ¨è°ƒç”¨çˆ¶ç±»å‹çš„æ„é€ å‡½æ•°ï¼Œä½¿å¾—å­ç±»å‹æ‹¥æœ‰çˆ¶ç±»å‹çš„å±æ€§å’Œæ–¹æ³•ã€‚ 123456789101112131415161718function Parent(properties) &#123; this.properties = [].concat(properties); this.nums = [1, 2, 3, 4];&#125;function Child(properties) &#123; // ç»§æ‰¿äº† Parentï¼Œä¼ é€’å‚æ•°ï¼Œäº’ä¸å½±å“ Parent.apply(this, properties);&#125;var instance1 = new Child(['instance1']);instance1.nums.push(5);console.log(instance1.nums); // 1,2,3,4,5console.log(instance1.properties[0]); // instance1var instance2 = new Child();console.log(instance2.nums); // 1,2,3,4console.log(instance2.properties[0]); // undefined å€Ÿç”¨æ„é€ å‡½æ•°çš„ç¡®å¯ä»¥è§£å†³ä¸Šé¢æåˆ°çš„ä¸¤ä¸ªé—®é¢˜ï¼Œå®ä¾‹é—´ä¸ä¼šå…±äº«å±æ€§ï¼Œä¹Ÿå¯ä»¥å‘çˆ¶ç±»å‹ä¼ é€’å‚æ•°ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•ä»ç„¶å­˜åœ¨ä¸€äº›é—®é¢˜ï¼šå­ç±»å‹æ— æ³•ç»§æ‰¿çˆ¶ç±»å‹åŸå‹ä¸­çš„å±æ€§ã€‚æˆ‘ä»¬åªåœ¨å­ç±»å‹çš„æ„é€ å‡½æ•°ä¸­è°ƒç”¨äº†çˆ¶ç±»å‹çš„æ„é€ å‡½æ•°ï¼Œæ²¡æœ‰åšå…¶ä»–çš„ï¼Œå­ç±»å‹å’Œçˆ¶ç±»å‹çš„åŸå‹ä¹Ÿå°±æ²¡æœ‰ä»»ä½•è”ç³»ã€‚è€ƒè™‘åˆ°è¿™ä¸ªé—®é¢˜ï¼Œå€Ÿç”¨æ„é€ å‡½æ•°çš„æŠ€æœ¯ä¹Ÿæ˜¯å¾ˆå°‘å•ç‹¬ä½¿ç”¨çš„ã€‚ 3ã€ç»„åˆç»§æ‰¿ä¸Šé¢ä¸¤ä¸ªæ–¹æ³•èƒ½å¤Ÿäº’è¡¥å½¼æ­¤çš„ä¸è¶³ä¹‹å¤„ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸¤ä¸ªæ–¹æ³•ç»“åˆèµ·æ¥ï¼Œå°±èƒ½æ¯”è¾ƒå®Œç¾çš„è§£å†³é—®é¢˜äº†ï¼Œè¿™å°±æ˜¯ç»„åˆç»§æ‰¿ã€‚å…¶èƒŒåçš„æ€è·¯æ˜¯ä½¿ç”¨åŸå‹é“¾å®ç°å¯¹åŸå‹å±æ€§çš„æ–¹æ³•çš„ç»§æ‰¿ï¼Œè€Œé€šè¿‡å€Ÿç”¨æ„é€ å‡½æ•°æ¥å®ç°å¯¹å®ä¾‹å±æ€§çš„ç»§æ‰¿ã€‚è¿™æ ·ï¼Œæ—¢é€šè¿‡åœ¨åŸå‹ä¸Šå®šä¹‰æ–¹æ³•å®ç°äº†å‡½æ•°å¤ç”¨ï¼Œåˆèƒ½å¤Ÿä¿è¯æ¯ä¸ªå®ä¾‹éƒ½æœ‰è‡ªå·±çš„å±æ€§ï¼Œä»è€Œå‘æŒ¥ä¸¤è€…ï¼Œçœ‹ä¸€ä¸ªç®€å•çš„å®ç°ï¼š 123456789101112131415161718192021222324252627function Parent(properties) &#123; this.properties = [].concat(properties); this.nums = [1, 2, 3, 4];&#125;Parent.prototype.sayProperties = function () &#123; console.log(this.properties[0]);&#125;function Child(properties) &#123; // ç»§æ‰¿äº† Parentï¼Œä¼ é€’å‚æ•°ï¼Œäº’ä¸å½±å“ Parent.apply(this, properties);&#125;// ç»§æ‰¿çˆ¶ç±»å‹çš„åŸå‹Child.prototype = new Parent();// isPrototypeOf() å’Œ instance èƒ½æ­£å¸¸ä½¿ç”¨Child.prototype.constructor = Child;var instance1 = new Child(['instance1']);instance1.nums.push(5);console.log(instance1.nums); // 1,2,3,4,5instance1.sayProperties(); // instance1var instance2 = new Child();console.log(instance2.nums); // 1,2,3,4instance2.sayProperties(); // undefined ç»„åˆç»§æ‰¿é¿å…äº†åŸå‹é“¾å’Œå€Ÿç”¨æ„é€ å‡½æ•°çš„ç¼ºé™·ï¼Œèåˆäº†å®ƒä»¬çš„ä¼˜ç‚¹ï¼Œæ˜¯jsä¸­æœ€å¸¸ç”¨çš„ç»§æ‰¿æ¨¡å¼ã€‚ç»„åˆç»§æ‰¿çœ‹èµ·æ¥ä¸é”™ï¼Œä½†æ˜¯ä¹Ÿæœ‰å®ƒçš„ç¼ºç‚¹ï¼šæ— è®ºä»€ä¹ˆæƒ…å†µä¸‹ï¼Œç»„åˆç»§æ‰¿éƒ½ä¼šè°ƒç”¨ä¸¤æ¬¡çˆ¶ç±»å‹çš„æ„é€ å‡½æ•°ï¼šä¸€æ¬¡æ˜¯åœ¨åˆ›å»ºå­ç±»å‹åŸå‹çš„æ—¶å€™ï¼Œå¦ä¸€æ¬¡æ˜¯åœ¨å­ç±»å‹æ„é€ å‡½æ•°å†…éƒ¨ã€‚ 4ã€å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿ä¸ºäº†è§£å†³ä¸Šé¢ç»„åˆç»§æ‰¿çš„é—®é¢˜ï¼Œä¸€ç§æ–°çš„ç»§æ‰¿æ–¹å¼å‡ºç°äº†-å¯„ç”Ÿç»„åˆç»§æ‰¿ï¼Œå¯ä»¥è¯´æ˜¯ JavaScript ä¸­ç»§æ‰¿æœ€ç†æƒ³çš„è§£å†³æ–¹æ¡ˆã€‚ 123456789101112131415161718192021222324252627282930// ç”¨äºç»§æ‰¿çš„å‡½æ•°function extend(child, parent) &#123; var F = function () &#123;&#125; F.prototype = parent.prototype; child.prototype = new F(); child.prototype.constructor = child;&#125;// çˆ¶ç±»å‹function Parent(name) &#123; this.name = name; this.nums = [1, 2, 3, 4];&#125;Parent.prototype.sayName = function () &#123; console.log(this.name);&#125;// å­ç±»å‹function Child(name, age) &#123; Parent.call(this, name); this.age = age;&#125;var parent = new Parent('baba');var child = new Child('erzi', '18');// ç»§æ‰¿åŸå‹ä¸Šçš„å±æ€§å’Œæ–¹æ³•extend(child, parent);Child.prototype.getAge = function () &#123; console.log(this.age);&#125;console.log(parent.name); // babaconsole.log(child.name); // erziconsole.log(child.getAge()); // 18 æ‰€è°“å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿ï¼Œå³é€šè¿‡å€Ÿç”¨æ„é€ å‡½æ•°æ¥ç»§æ‰¿å±æ€§ï¼Œé€šè¿‡å€Ÿç”¨ä¸´æ—¶æ„é€ å‡½æ•°æ¥ç»§æ‰¿åŸå‹ã€‚å…¶èƒŒåçš„åŸºæœ¬æ€è·¯æ˜¯ï¼šä¸å¿…ä¸ºäº†æŒ‡å®šå­ç±»å‹çš„åŸå‹è€Œè°ƒç”¨çˆ¶ç±»å‹çš„æ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬æ‰€éœ€è¦çš„æ— éå°±æ˜¯çˆ¶ç±»å‹åŸå‹çš„ä¸€ä¸ªå‰¯æœ¬è€Œå·²ã€‚","tags":[{"name":"js","slug":"js","permalink":"//zhoujingchao.github.io/tags/js/"}]},{"title":"æ•°ç»„æ‰å¹³åŒ–","date":"2017-09-04T07:18:25.000Z","path":"2017/09/04/æ•°ç»„æ‰å¹³åŒ–/","text":"æ‰å¹³åŒ–æ•°ç»„çš„æ‰å¹³åŒ–ï¼Œå°±æ˜¯å°†ä¸€ä¸ªåµŒå¥—å¤šå±‚çš„ array è½¬æ¢ä¸ºåªæœ‰ä¸€å±‚çš„ array ä¸¾ä¸ª ğŸŒ° ï¼šæœ‰ä¸ª flatten å‡½æ•°åšæ‰å¹³åŒ– 12var arr = [1, [2, [3, 4], 5]];console.log(flatten(arr)) // [1, 2, 3, 4, 5] é€’å½’æˆ‘ä»¬æœ€å¼€å§‹èƒ½æƒ³åˆ°çš„è«è¿‡äºå¾ªç¯æ•°ç»„å…ƒç´ ï¼Œå¦‚æœè¿˜æ˜¯æ•°ç»„ï¼Œå°±é€’å½’è°ƒç”¨è¯¥æ–¹æ³•ï¼š 12345678910111213var arr = [1, [2, [3, 4], 5]];function flatten(arr) &#123; var result = []; for (var i = 0, len = arr.length; i &lt; len; i++) &#123; if (Array.isArray(arr[i])) &#123; result = result.concat(flatten(arr[i])); &#125; else &#123; result.push(arr[i]); &#125; &#125; return result;&#125; reduceæ—¢ç„¶æ˜¯å¯¹æ•°ç»„åšå¤„ç†ï¼Œæœ€ç»ˆè¿”å›å€¼ï¼Œå¯ä»¥è€ƒè™‘ç”¨ reduce æ¥ç®€åŒ–ä»£ç ï¼š 12345function flatten(arr) &#123; return arr.reduce((prev, curr) =&gt; &#123; return prev.concat(Array.isArray(curr) ? flatten(curr) : curr); &#125;, [])&#125; ES6æ‰©å±•è¿ç®—ç¬¦ç”¨äºå–å‡ºå‚æ•°å¯¹è±¡çš„æ‰€æœ‰å¯éå†å±æ€§ï¼Œæ‹·è´åˆ°å½“å‰å¯¹è±¡ä¸­ 12var arr = [1, [2, [3, 4], 5]];console.log([].concat(...arr)); // [1, 2, [3, 4], 5] è¿™ç§æ–¹æ³•åªå¯ä»¥æ‰å¹³ä¸€å±‚ï¼Œæ‰€ä»¥è¦è¿›è¡Œæ‰©å±• 12345678var arr = [1, [2, [3, 4], 5]];function flatten(arr) &#123; while (arr.some((item) =&gt; Array.isArray(item))) &#123; arr = [].concat(...arr); &#125; return arr;&#125;console.log(flatten(arr)); // [1, 2, 3, 4, 5] toStringå¦‚æœæ•°ç»„å…ƒç´ éƒ½æ˜¯æ•°å­—çš„è¯å¯ä»¥å°è¯•ï¼š 1234567[1, [2, [3, 4], 5]].toString() // \"1,2,3,4,5\"var arr = [1, [2, [3, 4], 5]];function flatten(arr) &#123; return arr.toString().split(',').map(item =&gt; +item);&#125;console.log(flatten(arr)); // [1, 2, 3, 4, 5]","tags":[{"name":"js","slug":"js","permalink":"//zhoujingchao.github.io/tags/js/"}]},{"title":"å‡½æ•°èŠ‚æµå’Œé˜²æŠ–äº†è§£ä¸€ä¸‹","date":"2017-08-30T03:28:54.000Z","path":"2017/08/30/å‡½æ•°èŠ‚æµå’Œé˜²æŠ–äº†è§£ä¸€ä¸‹/","text":"é—®é¢˜å¼•å…¥é—®é¢˜1: å®ç°domæ‹–æ‹½åŠŸèƒ½ï¼Œä½†æ˜¯ç»‘å®šåœ¨æ‹–æ‹½äº‹ä»¶çš„æ—¶å€™æ¯å½“å…ƒç´ ç¨å¾®ç§»åŠ¨ä¸€ç‚¹ä¾¿è§¦å‘äº†å¤§é‡çš„æ¯å›è°ƒå‡½æ•°ï¼Œå¯¼è‡´æµè§ˆå™¨å¡æ­»ã€‚é—®é¢˜2: ç”¨æˆ·è¿ç»­è¾“å…¥æ—¶éœ€è¦AJAXè¯·æ±‚é—®é¢˜ã€‚ åƒè¿™ç§åœºæ™¯å®åœ¨æ˜¯å¤ªå¸¸è§äº†ï¼Œä¸ºäº†åº”å¯¹ä¾¿å‡ºç°äº† å‡½æ•°èŠ‚æµ å’Œ å‡½æ•°é˜²æŠ– è¿™ä¸¤ä¸ªæ¦‚å¿µï¼Œæ€»çš„æ¥è¯´ï¼šè¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯åœ¨æ—¶é—´è½´ä¸Šæ§åˆ¶å‡½æ•°çš„æ‰§è¡Œæ¬¡æ•°ã€‚ åº”ç”¨åœºæ™¯å¯¹äºå‡½æ•°èŠ‚æµï¼ˆthrottleï¼‰ï¼š æ¸¸æˆä¸­çš„åˆ·æ–°ç‡ domå…ƒç´ æ‹–æ‹½ ç›‘å¬æ»šåŠ¨äº‹ä»¶åˆ¤æ–­æ˜¯å¦åˆ°é¡µé¢åº•éƒ¨è‡ªåŠ¨åŠ è½½æ›´å¤šå†…å®¹ è®©ä¸€ä¸ªå‡½æ•°ä¸è¦æ‰§è¡Œå¾—å¤ªé¢‘ç¹ï¼Œå‡å°‘ä¸€äº›è¿‡å¿«çš„è°ƒç”¨æ¥èŠ‚æµï¼Œé—´éš”æ—¶é—´æ®µè§¦å‘ï¼Œæœ‰è§„å¾‹çš„æ‰§è¡Œã€‚ 1234567891011121314151617181920212223242526272829303132333435363738&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt; &lt;meta charset=\"utf-8\" /&gt; &lt;title&gt;å‡½æ•°èŠ‚æµ&lt;/title&gt; &lt;style&gt; body &#123; height: 4000px; &#125; &lt;/style&gt;&lt;/head&gt;&lt;body&gt; &lt;script&gt; var time = +new Date(); function count() &#123; console.log(\"å‡½æ•°è°ƒç”¨:\" + (+new Date() - time)); &#125; // èŠ‚æµ æ§åˆ¶æ‰§è¡Œé—´éš”æ—¶é—´ é˜²æ­¢é¢‘ç¹è§¦å‘ scroll resize mousemove let throttle = (fn, delay) =&gt; &#123; let context = this, startTime = 0; return function() &#123; let curTime = new Date(); if (curTime - startTime &gt;= delay) &#123; fn.apply(context, arguments); startTime = curTime; &#125; &#125; &#125; window.onscroll = throttle(count, 1000); &lt;/script&gt;&lt;/body&gt;&lt;/html&gt; å¯¹äºå‡½æ•°é˜²æŠ–ï¼ˆdebounceï¼‰ï¼š é˜²æ­¢è¡¨å•å¤šæ¬¡æäº¤ é˜²æ­¢è¾“å…¥æ¡†è¿ç»­è¾“å…¥è¿›è¡ŒAJAXè¯·æ±‚ çª—å£ç¼©æ”¾ å¯¹äºä¸€å®šæ—¶é—´æ®µçš„è¿ç»­çš„å‡½æ•°è°ƒç”¨ï¼Œåªè®©å…¶æ‰§è¡Œä¸€æ¬¡ï¼Œé€‚åˆå¤šæ¬¡äº‹ä»¶ä¸€æ¬¡å“åº”çš„æƒ…å†µã€‚ 1234567891011121314151617181920212223242526272829303132333435&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt; &lt;meta charset=\"utf-8\" /&gt; &lt;title&gt;å‡½æ•°é˜²æŠ–&lt;/title&gt; &lt;style&gt; body &#123; height: 4000px; &#125; &lt;/style&gt;&lt;/head&gt;&lt;body&gt; &lt;script&gt; window.onscroll = function () &#123; console.log('scrollæ»‘åŠ¨'); debounce(count, 300); &#125; function count() &#123; console.log('å‡½æ•°è°ƒç”¨'); &#125; function debounce(fn, wait) &#123; let context = this; clearTimeout(fn.tId); fn.tId = setTimeout(function () &#123; fn.call(context) &#125;, wait) &#125; &lt;/script&gt;&lt;/body&gt;&lt;/html&gt; æˆ‘ä»¬æ»šåŠ¨é¡µé¢æ—¶ï¼Œé¢‘ç¹è§¦å‘äº†å¤šæ¬¡çš„å‡½æ•°è°ƒç”¨ï¼Œå¦‚æœå‡½æ•°è°ƒç”¨ä¸­æ¶‰åŠåˆ°äº†domæ“ä½œæˆ–è€…æ¥å£è¯·æ±‚çš„è¯ï¼Œé‚£å°±çˆ†ç‚¸äº†ã€‚æ‰€ä»¥ç”¨é˜²æŠ–ï¼Œè®©ä»–åœæ­¢æ»‘åŠ¨åï¼Œå®šæ—¶ç»“æŸæ‰æ‰§è¡Œå‡½æ•°å¤„ç†é€»è¾‘ã€‚ æ€»ä¹‹ï¼Œå·§ç”¨å‡½æ•°èŠ‚æµæ–¹å¼èƒ½å¤Ÿæ˜¾è‘—å¾—æé«˜é¡µé¢æ€§èƒ½ä»¥åŠäº¤äº’ä½“éªŒã€‚","tags":[{"name":"js","slug":"js","permalink":"//zhoujingchao.github.io/tags/js/"}]},{"title":"æŸ¯é‡ŒåŒ–å®ç°","date":"2017-08-14T09:31:45.000Z","path":"2017/08/14/æŸ¯é‡ŒåŒ–å®ç°/","text":"é¦–å…ˆä»‹ç»ä¸‹ä»€ä¹ˆæ˜¯å‡½æ•°æŸ¯é‡ŒåŒ–ã€‚ã€ŠJavascriptå¿è€…ç§˜ç±ã€‹ä¸­ï¼Œå¯¹äºå‡½æ•°æŸ¯é‡ŒåŒ–çš„å®šä¹‰å¦‚ä¸‹ï¼š åœ¨ä¸€ä¸ªå‡½æ•°ä¸­é¦–å…ˆå¡«å……å‡ ä¸ªå‚æ•°(ç„¶åå†è¿”å›ä¸€ä¸ªæ–°å‡½æ•°)çš„æŠ€æœ¯ç§°ä¸ºæŸ¯é‡ŒåŒ–(Currying)ã€‚ åœºæ™¯ä¸€å®ç°ä¸€ä¸ªåŠ æ³•å‡½æ•°ï¼š 1add(1)(2)(3,4)(5,6,7)() // 28 é¦–å…ˆå¯ä»¥çœ‹åˆ°è¿™ä¸ªå‡½æ•°åªæœ‰å½“å‚æ•°ä¸ºç©ºæ—¶ï¼Œæ‰æ‰§è¡Œä¹‹å‰æ‰€æœ‰æ•°å€¼çš„åŠ æ³•ï¼Œå¹¶ä¸”è¿™æ ·çš„åµŒå¥—å¯ä»¥æ— é™è¿›è¡Œã€‚é‚£ä¹ˆï¼Œè¿”å›å€¼åœ¨å‚æ•°ä¸ä¸ºç©ºçš„æ—¶å€™å¿…å®šè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°è¿˜ä¿å­˜äº†ä¹‹å‰çš„å‚æ•°ï¼Œè¿™å°±éœ€è¦é—­åŒ…ã€‚ å®ç°åŸç†ï¼š é—­åŒ…ä¿å­˜argså˜é‡ï¼Œå­˜å‚¨ä¹‹å‰çš„å‚æ•° æ–°å»º_addå‡½æ•°ï¼Œæ— å‚æ•°çš„æ—¶å€™æ‰§è¡Œç®—æ³•ï¼Œå¦åˆ™å­˜å‚¨å‚æ•°åˆ°argsï¼Œç„¶åè¿”å›å‡½æ•°è‡ªèº« 1234567891011121314151617function add() &#123; // åˆ©ç”¨é—­åŒ…ï¼Œä¸æ–­ä¿å­˜arguments let args = [].slice.call(arguments); let _add = function () &#123; // å‚æ•°ä¸ºç©ºæ‰§è¡ŒåŠ æ³• if (arguments.length === 0) &#123; return args.reduce((a, b) =&gt; &#123; return a + b; &#125;) &#125; else &#123; // ä¿å­˜å‚æ•°åˆ°argsï¼Œè¿”å›ä¸€ä¸ªå‡½æ•° [].push.apply(args, arguments); return _add &#125; &#125; return _add&#125; åœºæ™¯äºŒDomæ“ä½œä¸­çš„æ—¶é—´ç»‘å®š 1234567891011let addEvent = function(el, type, fn, capture) &#123; if (window.addEventListener) &#123; el.addEventListener(type, (e) =&gt; &#123; fn,call(el, e); &#125;, capture); &#125; else if (window.attachEvent) &#123; el.attachEvent(`on$&#123;type&#125;`, (e) =&gt; &#123; fn.call(el, e); &#125;); &#125;&#125; è¿™æ ·çš„å®ç°æ— å¯åšéï¼Œä½†æ˜¯æœ‰ä¸ªç¼ºç‚¹ï¼Œæ¯æ¬¡ç»‘å®šéƒ½è¦è¿›è¡Œä¸€æ¬¡ if-else çš„æ“ä½œï¼Œæ˜¾ç„¶æ˜¯æ²¡å¿…è¦çš„ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡å‡½æ•°çš„æŸ¯é‡ŒåŒ–æ”¹é€ ä¸‹ï¼š 123456789101112131415let addEvent = (function() &#123; if (window.addEventListener) &#123; return function(el, type, fn, capture) &#123; el.addEventListener(type, (e) =&gt; &#123; fn.call(el, e); &#125;, capture); &#125;; &#125; else if (window.attachEvent) &#123; return function(el, type, fn, capture) &#123; el.attachEvent(`on$&#123;type&#125;`, (e) =&gt; &#123; fn.call(el, e); &#125;); &#125;; &#125;&#125;)(); é€šç”¨çš„å‡½æ•°æ¥å¯¹æ™®é€šå‡½æ•°è¿›è¡ŒæŸ¯é‡ŒåŒ–æŸ¯é‡ŒåŒ–ç‰¹ç‚¹å¾ˆæ˜æ˜¾éœ€è¦ä¸€ä¸ªé—­åŒ…ä¿å­˜å‚æ•°ï¼Œä¸€ä¸ªå‡½æ•°æ¥è¿›è¡Œé€’å½’ï¼Œè¿™ç§æ¨¡å¼æ˜¯å¯ä»¥é€šè¿‡ä¸€ä¸ªåŒ…è£…å‡½æ•°ï¼Œå¯¹ä¸€äº›åŸºæœ¬çš„å‡½æ•°è¿›è¡ŒåŒ…è£…ä¹‹åå…·æœ‰curryçš„ç‰¹æ€§ã€‚ 1234567891011121314151617181920212223// é€šç”¨çš„å‡½æ•°æŸ¯é‡ŒåŒ–æ„é€ æ–¹æ³•function curry(func) &#123; // ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦è¢«æŸ¯é‡ŒåŒ–çš„å‡½æ•°ï¼Œéœ€è¦æ‹¿æ‰ let args = [].slice.call(arguments, 1); // æ–°å»º_funcå‡½æ•°ä½œä¸ºè¿”å› let _func = function () &#123; if (arguments.length === 0) &#123; return func.apply(this, args); &#125; else &#123; [].push.apply(args, arguments); return _func; &#125; &#125; return _func;&#125;function add() &#123; return [].reduce.call(arguments, (a, b) =&gt; &#123; return a + b; &#125;);&#125;curry(add)(1)(2,3)() æŸ¯é‡ŒåŒ–çš„å¥½å¤„ å»¶è¿Ÿè®¡ç®— å‚æ•°å¤ç”¨ï¼Œå½“åœ¨å¤šæ¬¡è°ƒç”¨åŒä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”ä¼ é€’çš„å‚æ•°ç»å¤§å¤šæ•°æ˜¯ç›¸åŒçš„ï¼Œé‚£ä¹ˆè¯¥å‡½æ•°å¯èƒ½æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æŸ¯é‡ŒåŒ–é€‰æ‹© åŠ¨æ€åˆ›å»ºå‡½æ•°","tags":[{"name":"js","slug":"js","permalink":"//zhoujingchao.github.io/tags/js/"}]},{"title":"å¦‚ä½•æé«˜é¡µé¢æ€§èƒ½","date":"2017-07-23T03:13:30.000Z","path":"2017/07/23/å¦‚ä½•æé«˜é¡µé¢æ€§èƒ½/","text":"å‰è¨€å…³äºwebæ€§èƒ½ï¼Œæœ‰ä¸¤ä¸ªè‘—åè®ºæ–­ï¼š 0.1-0.2s ç”¨æˆ·è®¤ä¸ºæ˜¯å³æ—¶çš„ï¼›1-5s ç”¨æˆ·è§‰å¾—è‡ªå·±èƒ½ä¸ä¿¡æ¯æµç•…åœ°äº¤äº’ï¼›5-10s ç”¨æˆ·å¼€å§‹è½¬ç§»æ³¨æ„åŠ›â€”â€”Robert Miller ç”¨æˆ·æ‰€æ¥å—çš„æ•°æ®ï¼Œæœ‰80~90%çš„æ—¶é—´éƒ½è€—åœ¨å‰ç«¯ä¸Šâ€”â€”Steve Souders å‰è€…è¯´æ˜ï¼Œloadingæ˜¯å¿…è¦çš„ã€‚äººå¤„äºâ€œå¼€å§‹è½¬ç§»æ³¨æ„åŠ›â€æ—¶ï¼Œloadingå°±å¼€å§‹æŒ½ç•™ä½ èºåŠ¨çš„å¿ƒã€‚ä½†webå·¥ç¨‹å¸ˆçš„ä¸€ä¸ªä½¿å‘½ï¼Œå°±æ˜¯é€šè¿‡æå‡æ€§èƒ½ï¼Œä¸è®©ç”¨æˆ·çœ‹åˆ°loadingã€‚loadingè¦æœ‰ï¼Œä½†ä¸èƒ½å¸¸æœ‰ã€‚ åè€…è¯´æ˜ï¼Œèµ„æºçš„åŠ è½½å’Œæ¸²æŸ“å¯ä»¥å¤§åšæ–‡ç« ã€‚å› ä¸ºä¸€ä¸ªhtmlæ–‡ä»¶ï¼Œå‡ ä¹æ˜¯æ‰€æœ‰èµ„æºçš„æ‰¿è½½å™¨ï¼Œå“ªäº›ä¼˜å…ˆåŠ è½½ï¼Œæ€æ ·åŠ è½½ï¼Œéƒ½æ˜¯å‰ç«¯å·¥ç¨‹å¸ˆå¯ä»¥æ§åˆ¶çš„ã€‚ å†è®®æé«˜é¡µé¢æ€§èƒ½çš„æ–¹æ³•æœ‰å“ªäº›å¤§è‡´å¯å½’ç±»ä¸ºä»¥ä¸‹å‡ ç±»ï¼š èµ„æºå‹ç¼©åˆå¹¶ï¼Œå‡å°‘HTTPè¯·æ±‚ å¼‚æ­¥åŠ è½½ åˆ©ç”¨æµè§ˆå™¨ç¼“å­˜ ä½¿ç”¨CDN é¢„è§£æDNS èµ„æºå‹ç¼©åˆå¹¶ï¼Œå‡å°‘HTTPè¯·æ±‚é¡¾åæ€ä¹‰å³æ˜¯å˜å°èµ„æºï¼Œå‡å°‘è¯·æ±‚ å¼‚æ­¥åŠ è½½1ï¼‰åŠ¨æ€è„šæœ¬åŠ è½½2ï¼‰deferï¼Œåœ¨HTMlè§£æå®Œä¹‹åæ‰ä¼šæ‰§è¡Œï¼Œå¦‚æœå¤šä¸ªï¼ŒæŒ‰ç…§åŠ è½½é¡ºåºä¾æ¬¡æ‰§è¡Œ3ï¼‰asyncï¼Œåœ¨åŠ å®Œä¹‹åç«‹å³æ‰§è¡Œï¼Œå¦‚æœæ˜¯å¤šä¸ªï¼Œæ‰§è¡Œé¡ºåºå’ŒåŠ è½½é¡ºåºæ— å…³ æµè§ˆå™¨ç¼“å­˜æµè§ˆå™¨ç¼“å­˜(Brower Caching)æ˜¯æµè§ˆå™¨åœ¨æœ¬åœ°ç£ç›˜å¯¹ç”¨æˆ·æœ€è¿‘è¯·æ±‚è¿‡çš„æ–‡æ¡£è¿›è¡Œå­˜å‚¨ï¼Œå½“è®¿é—®è€…å†æ¬¡è®¿é—®åŒä¸€é¡µé¢æ—¶ï¼Œæµè§ˆå™¨å°±å¯ä»¥ç›´æ¥ä»æœ¬åœ°ç£ç›˜åŠ è½½æ–‡æ¡£ã€‚è¿™ä¸ªç‚¹æ˜¯æå‡æ€§èƒ½æœ€é‡è¦çš„ä¸€ç‚¹äº†ï¼Œå¦‚æœç¼ºå¤±è¿™ä¸ªï¼Œå‰é¢çš„èµ„æºå‹ç¼©åˆå¹¶éƒ½èµ·ä¸åˆ°æ²¡ä»€ä¹ˆä½œç”¨äº†ã€‚ å®ƒåˆæ˜¯å¦‚ä½•åˆ¤æ–­æ˜¯å¦ä½¿ç”¨ç¼“å­˜çš„å‘¢ï¼Ÿè§ä¸‹å›¾ï¼š ä¼˜ç‚¹æœ‰ï¼š å‡å°‘äº†å†—ä½™çš„æ•°æ®ä¼ è¾“ï¼ŒèŠ‚çœäº†ç½‘è´¹ å‡å°‘äº†æœåŠ¡å™¨çš„è´Ÿæ‹…ï¼Œå¤§å¤§æå‡äº†ç½‘ç«™çš„æ€§èƒ½ åŠ å¿«äº†å®¢æˆ·ç«¯åŠ è½½ç½‘é¡µçš„é€Ÿåº¦ ç¼“å­˜çš„åˆ†ç±»ï¼š å¼ºç¼“å­˜ï¼šä¸ä¼šå‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œç›´æ¥ä»ç¼“å­˜ä¸­è¯»å–èµ„æºï¼Œåœ¨chromeæ§åˆ¶å°çš„networké€‰é¡¹ä¸­å¯ä»¥çœ‹åˆ°è¯¥è¯·æ±‚è¿”å›200çš„çŠ¶æ€ç ; åå•†ç¼“å­˜ï¼šå‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨ä¼šæ ¹æ®è¿™ä¸ªè¯·æ±‚çš„request headerçš„ä¸€äº›å‚æ•°æ¥åˆ¤æ–­æ˜¯å¦å‘½ä¸­åå•†ç¼“å­˜ï¼Œå¦‚æœå‘½ä¸­ï¼Œåˆ™è¿”å›304çŠ¶æ€ç å¹¶å¸¦ä¸Šæ–°çš„response headeré€šçŸ¥æµè§ˆå™¨ä»ç¼“å­˜ä¸­è¯»å–èµ„æºï¼› ä¸¤è€…çš„å…±åŒç‚¹æ˜¯ï¼Œéƒ½æ˜¯ä»å®¢æˆ·ç«¯ç¼“å­˜ä¸­è¯»å–èµ„æºï¼›åŒºåˆ«æ˜¯å¼ºç¼“å­˜ä¸ä¼šå‘è¯·æ±‚ï¼Œåå•†ç¼“å­˜ä¼šå‘è¯·æ±‚ã€‚ éƒ½æ˜¯é€šè¿‡http response headerä¸­çš„å‚æ•°æ¥è®¾ç½®çš„ å¼ºåˆ¶ç¼“å­˜Expiresï¼šè¿‡æœŸæ—¶é—´ï¼Œæµè§ˆå™¨å†æ¬¡åŠ è½½èµ„æºæ—¶ï¼Œå¦‚æœåœ¨è¿™ä¸ªè¿‡æœŸæ—¶é—´å†…ï¼Œåˆ™å‘½ä¸­å¼ºç¼“å­˜ã€‚Cache-Controlï¼šå½“å€¼è®¾ä¸ºmax-age=300æ—¶ï¼Œåˆ™ä»£è¡¨åœ¨è¿™ä¸ªè¯·æ±‚æ­£ç¡®è¿”å›æ—¶é—´ï¼ˆæµè§ˆå™¨ä¹Ÿä¼šè®°å½•ä¸‹æ¥ï¼‰çš„5åˆ†é’Ÿå†…å†æ¬¡åŠ è½½èµ„æºï¼Œå°±ä¼šå‘½ä¸­å¼ºç¼“å­˜ã€‚cache-controlé™¤äº†è¯¥å­—æ®µå¤–ï¼Œè¿˜æœ‰ä¸‹é¢å‡ ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„è®¾ç½®å€¼ï¼š-no-cacheï¼šä¸ä½¿ç”¨æœ¬åœ°ç¼“å­˜ã€‚éœ€è¦ä½¿ç”¨ç¼“å­˜åå•†ï¼Œå…ˆä¸æœåŠ¡å™¨ç¡®è®¤è¿”å›çš„å“åº”æ˜¯å¦è¢«æ›´æ”¹ï¼Œå¦‚æœä¹‹å‰çš„å“åº”ä¸­å­˜åœ¨ETagï¼Œé‚£ä¹ˆè¯·æ±‚çš„æ—¶å€™ä¼šä¸æœåŠ¡ç«¯éªŒè¯ï¼Œå¦‚æœèµ„æºæœªè¢«æ›´æ”¹ï¼Œåˆ™å¯ä»¥é¿å…é‡æ–°ä¸‹è½½ã€‚-no-storeï¼šç›´æ¥ç¦æ­¢æµè§ˆå™¨ç¼“å­˜æ•°æ®ï¼Œæ¯æ¬¡ç”¨æˆ·è¯·æ±‚è¯¥èµ„æºï¼Œéƒ½ä¼šå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œæ¯æ¬¡éƒ½ä¼šä¸‹è½½å®Œæ•´çš„èµ„æºã€‚-publicï¼šå¯ä»¥è¢«æ‰€æœ‰çš„ç”¨æˆ·ç¼“å­˜ï¼ŒåŒ…æ‹¬ç»ˆç«¯ç”¨æˆ·å’ŒCDNç­‰ä¸­é—´ä»£ç†æœåŠ¡å™¨ã€‚-privateï¼šåªèƒ½è¢«ç»ˆç«¯ç”¨æˆ·çš„æµè§ˆå™¨ç¼“å­˜ï¼Œä¸å…è®¸CDNç­‰ä¸­ç»§ç¼“å­˜æœåŠ¡å™¨å¯¹å…¶ç¼“å­˜ã€‚ åå•†ç¼“å­˜Last-Modify/If-Modify-Sinceï¼šæµè§ˆå™¨ç¬¬ä¸€æ¬¡è¯·æ±‚ä¸€ä¸ªèµ„æºçš„æ—¶å€™ï¼ŒæœåŠ¡å™¨è¿”å›çš„headerä¸­ä¼šåŠ ä¸ŠLast-Modifyï¼ŒLast-modifyæ˜¯ä¸€ä¸ªæ—¶é—´æ ‡è¯†è¯¥èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´ï¼›å½“æµè§ˆå™¨å†æ¬¡è¯·æ±‚è¯¥èµ„æºæ—¶ï¼Œrequestçš„è¯·æ±‚å¤´ä¸­ä¼šåŒ…å«If-Modify-Sinceï¼Œè¯¥å€¼ä¸ºç¼“å­˜ä¹‹å‰è¿”å›çš„Last-Modifyã€‚æœåŠ¡å™¨æ”¶åˆ°If-Modify-Sinceåï¼Œæ ¹æ®èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´åˆ¤æ–­æ˜¯å¦å‘½ä¸­ç¼“å­˜Etagï¼šwebæœåŠ¡å™¨å“åº”è¯·æ±‚æ—¶ï¼Œå‘Šè¯‰æµè§ˆå™¨å½“å‰èµ„æºåœ¨æœåŠ¡å™¨çš„å”¯ä¸€æ ‡è¯†ï¼ˆç”Ÿæˆè§„åˆ™ç”±æœåŠ¡å™¨å†³å®šï¼‰ã€‚If-None-Matchï¼šå½“èµ„æºè¿‡æœŸæ—¶ï¼ˆä½¿ç”¨Cache-Controlæ ‡è¯†çš„max-ageï¼‰ï¼Œå‘ç°èµ„æºå…·æœ‰Etagå£°æ˜ï¼Œåˆ™å†æ¬¡å‘webæœåŠ¡å™¨è¯·æ±‚æ—¶å¸¦ä¸Šå¤´If-None-Matchï¼ˆEtagçš„å€¼ï¼‰ã€‚webæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åå‘ç°æœ‰å¤´If-None-Matchåˆ™ä¸è¢«è¯·æ±‚èµ„æºçš„ç›¸åº”æ ¡éªŒä¸²è¿›è¡Œæ¯”å¯¹ï¼Œå†³å®šæ˜¯å¦å‘½ä¸­åå•†ç¼“å­˜ã€‚ cdnåŠ é€Ÿç»´åŸºç™¾ç§‘ç»™å‡ºçš„è§£é‡Šæ˜¯ï¼š å†…å®¹åˆ†å‘ç½‘ç»œï¼ˆContent delivery networkæˆ–Content distribution networkï¼Œç¼©å†™ï¼šCDNï¼‰ã€‚ç®€å•æ¥è¯´å®ƒä¸»è¦çš„å·¥ä½œæ˜¯æŠŠæˆ‘ä»¬éœ€è¦è¢«åˆ†å‘çš„å†…å®¹åˆ†å‘åˆ°ä¸–ç•Œå„åœ°çš„å„ä¸ªèŠ‚ç‚¹ä¸Šï¼Œè®©ä¸–ç•Œå„åœ°çš„äººéƒ½å¯ä»¥åœ¨è·ç¦»æœ€è¿‘çš„ç½‘ç»œèŠ‚ç‚¹æ‹¿åˆ°æƒ³è¦æ‹¿åˆ°çš„å†…å®¹ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“è·ç¦»ä»è€Œè¾¾åˆ°åŠ é€Ÿçš„ç›®çš„ã€‚ å‰ç«¯éœ€è¦è¢«åŠ é€Ÿçš„æ–‡ä»¶å¤§è‡´åŒ…æ‹¬ jsã€cssã€å›¾ç‰‡ã€è§†é¢‘ã€å’Œé¡µé¢ç­‰æ–‡ä»¶ï¼Œå…ˆèŠèŠjsã€cssã€å›¾ç‰‡å’Œè§†é¢‘æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶å’Œé¡µé¢ï¼ˆhtml\\jsp\\aspxç­‰ï¼‰æœ€å¤§çš„åŒºåˆ«æ˜¯ï¼šè¿™äº›æ–‡ä»¶éƒ½æ˜¯é™æ€çš„ï¼Œæ”¹åŠ¨è¾ƒå°ï¼Œè¿™ç±»é™æ€æ–‡ä»¶æœ€é€‚åˆåšcdnåŠ é€Ÿã€‚æˆ‘ä»¬æŠŠè¿™äº›é™æ€æ–‡ä»¶é€šè¿‡cdnåˆ†å‘åˆ°å…¨å›½ä¹ƒè‡³ä¸–ç•Œçš„å„ä¸ªèŠ‚ç‚¹ï¼Œç”¨æˆ·å°±å¯ä»¥åœ¨è·ç¦»æœ€è¿‘çš„è¾¹ç¼˜èŠ‚ç‚¹æ‹¿åˆ°æ‰€éœ€è¦çš„å†…å®¹ï¼Œä»è€Œæå‡å†…å®¹ä¸‹è½½é€Ÿåº¦åŠ å¿«ç½‘é¡µæ‰“å¼€é€Ÿåº¦è¾¾åˆ°æ€§èƒ½ä¼˜åŒ–çš„ç›®çš„ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬èŠèŠé¡µé¢ï¼Œé¡µé¢åˆ†åŠ¨æ€é¡µé¢(å¦‚ï¼šjspç­‰)å’Œé™æ€é¡µé¢ï¼ˆhtmlï¼‰ åŠ¨æ€é¡µé¢ï¼šå½“æ”¶åˆ°ç”¨æˆ·è¯·æ±‚æ—¶æœåŠ¡å™¨ä¼šåœ¨æœåŠ¡ç«¯å¯¹é¡µé¢è¿›è¡Œä¸€æ¬¡åå°æ¸²æŸ“æŠŠæ•°æ®æ¸²æŸ“åˆ°é¡µé¢ä¹‹åå†è¿”å›ç»™ç”¨æˆ·ï¼ˆå½“ç„¶ï¼ŒæœåŠ¡ç«¯ä¹Ÿå¯ä»¥åšç¼“å­˜ï¼‰ã€‚é™æ€é¡µé¢ï¼šæ”¶åˆ°ç”¨æˆ·è¯·æ±‚æ—¶ï¼ŒæœåŠ¡ç«¯ä¸åšæ¸²æŸ“å·¥ä½œç›´æ¥è¿”å›ç»™ç”¨æˆ·ã€‚ åŠ¨æ€é¡µé¢æ˜¯ä¸é€‚åˆåšcdnåŠ é€Ÿçš„ã€‚åŸå› ï¼šç”±äºé¡µé¢æ˜¯åŠ¨æ€çš„ï¼Œå†…å®¹çš„æœ‰æ•ˆæœŸå°±æ¯”è¾ƒæ´»è·ƒã€‚å‡å¦‚æˆ‘ä»¬å¯¹åŠ¨æ€é¡µé¢åšäº†cdnåŠ é€Ÿï¼Œé‚£ä¹ˆåœºæ™¯åº”è¯¥æ˜¯è¿™æ ·çš„ï¼šç”¨æˆ·â€”â€”&gt;è¾¹ç¼˜èŠ‚ç‚¹ï¼ˆéªŒè¯æœ‰æ•ˆæœŸå‘ç°å¤±æ•ˆï¼‰â€”â€”&gt;æºç«™ã€‚ç»è¿‡è¿™ä¸ªè¿‡ç¨‹æ‰èƒ½æ‹¿åˆ°é¡µé¢ï¼Œè¿™æ ·å¹¶æ²¡æœ‰èµ·åˆ°åŠ é€Ÿçš„ä½œç”¨åè€Œæ›´æ…¢äº†ï¼Œé‚£æˆ‘ä»¬è¿˜ä¸å¦‚ç›´æ¥å»æºç«™æ‹¿ã€‚ é¢„è§£æDNSDNSè§£ææ—¶é—´å¯èƒ½å¯¼è‡´å¤§é‡ç”¨æˆ·æ„ŸçŸ¥å»¶è¿Ÿï¼ŒDNSè§£ææ‰€éœ€çš„æ—¶é—´å·®å¼‚éå¸¸å¤§ï¼Œå»¶è¿ŸèŒƒå›´å¯ä»¥ä»1msï¼ˆæœ¬åœ°ç¼“å­˜ç»“æœï¼‰åˆ°æ™®éçš„å‡ ç§’é’Ÿæ—¶é—´ã€‚æ‰€ä»¥åˆ©ç”¨DNSé¢„è§£ææ˜¯æœ‰æ„ä¹‰çš„ã€‚ æµè§ˆå™¨å¯¹ç½‘ç«™ç¬¬ä¸€æ¬¡çš„åŸŸåDNSè§£ææŸ¥æ‰¾æµç¨‹ä¾æ¬¡ä¸ºï¼šæµè§ˆå™¨ç¼“å­˜-ç³»ç»Ÿç¼“å­˜-è·¯ç”±å™¨ç¼“å­˜-ISP DNSç¼“å­˜-é€’å½’æœç´¢ å®ç°æ–¹å¼ï¼š ç”¨metaä¿¡æ¯æ¥å‘ŠçŸ¥æµè§ˆå™¨, å½“å‰é¡µé¢è¦åšDNSé¢„è§£æ: &lt;meta http-equiv=&quot;x-dns-prefetch-control&quot; content=&quot;on&quot; /&gt; åœ¨é¡µé¢headerä¸­ä½¿ç”¨linkæ ‡ç­¾æ¥å¼ºåˆ¶å¯¹DNSé¢„è§£æ: &lt;link rel=&quot;dns-prefetch&quot; href=&quot;http://bdimg.share.baidu.com&quot; /&gt; æ³¨ï¼šdns-prefetchéœ€æ…ç”¨ï¼Œå¤šé¡µé¢é‡å¤DNSé¢„è§£æä¼šå¢åŠ é‡å¤DNSæŸ¥è¯¢æ¬¡æ•°ã€‚","tags":[{"name":"æ€§èƒ½","slug":"æ€§èƒ½","permalink":"//zhoujingchao.github.io/tags/æ€§èƒ½/"}]},{"title":"ç§»åŠ¨ç«¯webAppè¸©å‘ä¹‹è®°","date":"2017-07-06T15:32:02.000Z","path":"2017/07/06/ç§»åŠ¨ç«¯webAppè¸©å‘ä¹‹è®°/","text":"è®°å½•ä¸€ä¸‹ç¬¬ä¸€æ¬¡å¼€å‘hybrid appï¼Œé‡åˆ°çš„ä¸€äº›å‘ã€‚ ä¸€ã€H5ä¸Nativeäº¤äº’ç”±äºåˆæœŸé¡¹ç›®æ¯”è¾ƒæ€¥ï¼Œæ²¡æœ‰ä»”ç»†è€ƒè™‘jsbridgeæŠ€æœ¯ã€‚ iosç›´æ¥å¾ˆç²—æš´çš„é€šè¿‡åè®® localtion.href = jsbridge://methodName?param1=value1&amp;param2=value2 æ¥è§£å†³é—®é¢˜ androidå°±è®©åŸç”Ÿæä¾›ä¸€ä¸ªAndroidçš„ç±»ï¼Œæ˜¯æš´éœ²åœ¨windowä¸‹æ¥è°ƒç”¨çš„ ç„¶åå°±balabalabalaâ€¦å¼€å§‹çˆ¬å‘å’¦ï¼Œè¿™ä»€ä¹ˆé¬¼ï¼Ÿæ€ä¹ˆæˆ‘è¿ç»­å¤šæ¬¡å‘èµ·location.hrefçš„åè®®ï¼Œiosåªèƒ½æ¥æ”¶åˆ°æœ€åä¸€æ¬¡è¯·æ±‚ï¼Ÿå¦ˆè›‹ï¼Œé‚£æˆ‘å°±ä¸è¿ç»­å‘å’¯ã€‚æ€ä¹ˆæˆ‘åœ¨è·¯ç”±è·³è½¬çš„æ—¶å€™åšäº›åè®®ä¼šå¶å°”ä¸èµ·ä½œç”¨ï¼Œiosæ¥æ”¶ä¸åˆ°ï¼Ÿå¼ºè¡Œæ·»åŠ 123setTimeout(function() &#123; localtion.href = 'jsbridge://methodName?param1=value1&amp;param2=value2';&#125;, 0); wtfï¼Ÿï¼Ÿï¼Ÿ æƒ³æƒ³å°±ä¸å¯¹åŠ²å‘¢ï¼Œ\båé¢åˆ©ç”¨ä¸šä½™æ—¶é—´æŸ¥æ‰¾äº†ä¸‹jsbridgeç›¸å…³èµ„æ–™ï¼Œæ‰æç„¶å¤§æ‚Ÿã€‚åŸæ¥jsè°ƒç”¨ocæˆ–swiftæœ‰3ä¸¤ç§æ–¹å¼ï¼š é€šè¿‡ localtion.href é€šè¿‡ iframe æ–¹å¼ï¼› ios7æ–°åŠ çš„ JavaScriptCore å‚è€ƒé“¾æ¥ï¼Œæä¾›ä¸€ä¸ªç±»ä¾›jsç›´æ¥è°ƒç”¨ é€šè¿‡location.hrefæœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¦‚æœæˆ‘ä»¬è¿ç»­å¤šæ¬¡ä¿®æ”¹window.location.hrefçš„å€¼ï¼Œåœ¨Nativeå±‚åªèƒ½æ¥æ”¶åˆ°æœ€åä¸€æ¬¡è¯·æ±‚ï¼Œå‰é¢çš„è¯·æ±‚éƒ½ä¼šè¢«å¿½ç•¥æ‰ï¼Œä¸æ¨èä½¿ç”¨ã€‚ jsè°ƒç”¨javaï¼š é€šè¿‡schemaæ–¹å¼ï¼Œä½¿ç”¨shouldOverrideUrlLoadingæ–¹æ³•å¯¹urlåè®®è¿›è¡Œè§£æã€‚è¿™ç§jsçš„è°ƒç”¨æ–¹å¼ä¸iosçš„ä¸€æ ·ï¼Œä½¿ç”¨iframeæ¥è°ƒç”¨nativeä»£ç ã€‚å®Œæ•´çš„URL Schemeåè®®æ ¼å¼ï¼šxl://goods:8888/goodsDetail?goodsId=10011002é€šè¿‡ä¸Šé¢çš„è·¯å¾„ Schemeã€Hostã€portã€pathã€queryå…¨éƒ¨åŒ…å«ï¼ŒåŸºæœ¬ä¸Šå¹³æ—¶ä½¿ç”¨è·¯å¾„å°±æ˜¯è¿™æ ·å­çš„ã€‚xlä»£è¡¨è¯¥Scheme åè®®åç§°goodsä»£è¡¨Schemeä½œç”¨äºå“ªä¸ªåœ°å€åŸŸgoodsDetailä»£è¡¨SchemeæŒ‡å®šçš„é¡µé¢goodsIdä»£è¡¨ä¼ é€’çš„å‚æ•°8888ä»£è¡¨è¯¥è·¯å¾„çš„ç«¯å£å· æä¾›ä¸€ä¸ªç±»ç»™jsç›´æ¥è°ƒç”¨ ç®€å•ç¤ºä¾‹iframeå°è£…ï¼š 123456789101112/** * @param &#123;string&#125; fname */export function postWebviewData(fname) &#123; let wvIframe = document.createElement(â€˜iframeâ€™); wvIframe.style.display = â€˜noneâ€™; waiframe.src = `jsbridge://$&#123;fname&#125;?param1=value1&amp;param2=value2`; document.body.appendChild(wvIframe); setTimeout(function() &#123; document.body.removeChild(wvIframe); &#125;, 0);&#125; å…·ä½“åè®®å’Œnativeå•†é‡å¦‚ä½•ä¼ å‚ï¼Œå†è¿›è¡Œå°è£…å°±å¥½ï¼Œç„¶åå°±èƒ½å¿«ä¹çš„ç©è€äº†è¾£ã€‚å…¶å®æˆ‘è¿˜æ˜¯å»ºè®®ç«¥é‹ä»¬ï¼ŒæŠŠioså’Œandroidéƒ½ç»Ÿä¸€èµ·æ¥ç”¨åŒä¸€ç§æ–¹å¼ã€‚ äºŒã€WebView æ€§èƒ½ä¼˜åŒ–1. WebViewçš„å¯åŠ¨åˆ°jsè§£æï¼Œç¼–è¯‘ï¼Œæ‰§è¡Œï¼Œæ¶ˆè€—çš„æ—¶é—´æ¯”è¾ƒä¹…ï¼Œç„¶åå‘ˆç°åœ¨çœ¼å‰å°±æ˜¯è¿™ä¹ˆå‡ ä¸ªçŠ¶æ€ï¼š äº¤äº’æ— åé¦ˆ åˆ°è¾¾æ–°çš„é¡µé¢ï¼Œé¡µé¢ç™½å± é¡µé¢åŸºæœ¬æ¡†æ¶å‡ºç°ï¼Œä½†æ˜¯æ²¡æœ‰æ•°æ®ï¼›é¡µé¢å¤„äºloadingçŠ¶æ€ æœ€åå‡ºç°æ‰€éœ€çš„æ•°æ® è§£å†³æ€è·¯ï¼š h5åšçš„æ˜¯å•é¡µé¢ï¼Œæ‰€ä»¥h5é¦–å…ˆåšäº†æŒ‰éœ€åŠ è½½ï¼Œæ¥ç€WebViewä¹Ÿåšäº†æŒ‰éœ€åŠ è½½ï¼Œè¿™æ ·å°±å¿«å¾ˆå¤šäº†ï¼Œæ—¶é—´å¤§æ¦‚åœ¨1-2sï¼Œ åˆšå¯åŠ¨çš„æ—¶å€™å°±è¡¥äº†ä¸ªåŠ¨ç”»é¡µå¼¥è¡¥è¿™1-2sçš„åŠ è½½ åŸç”Ÿå’Œh5éƒ½éœ€è¦åšæœ¬åœ°ç¼“å­˜ä½¿é¡µé¢å’Œå›¾ç‰‡å‘ˆç°çš„æ›´å¿«ï¼Œå†åšæ•°æ®è¯·æ±‚æ›´æ–° 2. ç‚¹å‡»å»¶è¿Ÿåœ¨WebViewä¸­ï¼Œclické€šå¸¸ä¼šæœ‰å¤§çº¦300msçš„å»¶è¿Ÿï¼ˆåŒ…æ‹¬é“¾æ¥çš„ç‚¹å‡»ï¼Œè¡¨å•çš„æäº¤ï¼Œæ§ä»¶çš„äº¤äº’ç­‰ä»»ä½•ç”¨æˆ·ç‚¹å‡»è¡Œä¸ºï¼‰ã€‚ è§£å†³æ€è·¯å‚è€ƒé“¾æ¥: fastclick ä¸‰ã€åœ¨iosä¸­ï¼Œè¾“å…¥çŠ¶æ€æ—¶ï¼Œh5å®šä½å±æ€§fixedå¤±æ•ˆ```12345678910111213141516171819&lt;div&gt; &lt;!-- fixedå®šä½çš„å¤´éƒ¨ --&gt; &lt;header class=\"header\"&gt; æˆ‘æ˜¯å¤´éƒ¨ &lt;/header&gt; &lt;!-- å¯ä»¥æ»šåŠ¨çš„åŒºåŸŸ --&gt; &lt;main class=\"main\"&gt; &lt;!-- å†…å®¹åœ¨è¿™é‡Œ... --&gt; &lt;/main&gt; &lt;!-- fixedå®šä½çš„åº•éƒ¨ --&gt; &lt;footer class=\"footer\"&gt; &lt;div class=\"textarea needsclick\" contentEditable=\"true\" suppressContentEditableWarning&gt;&lt;/div&gt; &lt;button onclick=\"handleClick()\"&gt;å‘é€&lt;/button&gt; &lt;/footer&gt;&lt;/div&gt; ç½‘ä¸Šä¹ŸæŸ¥å¾—åˆ°ç›¸å…³è§£å†³æ–¹æ¡ˆæ¯”å¦‚ï¼šhttp://efe.baidu.com/blog/mobile-fixed-layout/ä½†æ˜¯æˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘æŒ‰è¿™ä¸ªæ€è·¯æ¥ï¼Œè¿˜æ˜¯è§£å†³ä¸äº†è¿™ä¸ªé—®é¢˜ï¼Œæœ‰äº›äººè¯´å¯ä»¥è§£å†³ï¼Œæœ‰äº›äººè¯´è§£å†³ä¸äº†ï¼Œå°±æ˜¯è¿™ä¹ˆçš„å¥‡è‘©ï¼Œæˆ–è®¸æ˜¯æˆ‘å§¿åŠ¿ä¸å¯¹å§ã€‚=_=!! soï¼Œè¿˜æ˜¯è‡ªå·±å°è¯•æ‘¸ç´¢è§£å†³ï¼Œæˆ‘çš„å¸ƒå±€headerå’Œfooteræ˜¯fixedï¼Œä¸­é—´å¯æ»šåŠ¨çš„åŒºåŸŸæ˜¯relativeï¼Œç®—äº†ä¸è¯´äº†ï¼Œç›´æ¥ä¸Šä»£ç å§ã€‚12345678910111213141516171819202122// listenFocuså’ŒlistenBluræ˜¯ç»™å¯ç¼–è¾‘divæ·»åŠ çš„èšç„¦å’Œå¤±ç„¦çš„äº‹ä»¶ç›‘å¬listenFocus = () =&gt; &#123; if (isiOS) &#123; let clientHeight = document.querySelector('.main').clientHeight // é«˜ä¿çœŸç»™çš„æ˜¯2xçš„å›¾ï¼Œå¤´éƒ¨å’Œåº•éƒ¨çš„é«˜åº¦éƒ½æ˜¯100pxï¼Œæ‰€ä»¥ä¸­é—´çš„å¯è§†é«˜åº¦å¦‚ä¸‹ let availHeight = (clientHeight - 200) / 2 // æ­¤å®šä½è§£å†³æ–¹æ¡ˆï¼Œå½“å†…å®¹è¾¾ä¸åˆ°æ»šåŠ¨æ—¶ï¼Œè¾“å…¥æ¡†å°±ä¼šç§»åŠ¨ï¼Œæ‰€ä»¥åˆ¤æ–­ä¸‹å†…å®¹é«˜åº¦æ˜¯å¦è¾¾åˆ°æ»šåŠ¨æ¡ä»¶ if (availHeight &gt; window.screen.availHeight) &#123; // å·¨å‘å•Šï¼fuck thisï¼fixedå±æ€§å¤±æ•ˆï¼Œåƒè¾›ä¸‡è‹¦æ‘¸ç´¢å®šä½è§£å†³ document.querySelector('.footer').style.position = 'relative' document.querySelector('.main').style.paddingBottom = '0' &#125; // åŸç”Ÿé”®ç›˜å¼¹èµ·å, æ“ä½œæ—¶é«˜åº¦ä¼šä¸ä¸€æ ·ï¼Œä½¿è¾“å…¥æ¡†å§‹ç»ˆä¸ä¼šè¢«é”®ç›˜é®æŒ¡ timerId = setInterval(function() &#123; document.body.scrollTop = document.body.scrollHeight &#125;, 100) &#125;&#125; listenBlur = () =&gt; &#123; if (isiOS) &#123; clearInterval(timerId) &#125; å»ºè®®ç§»åŠ¨ç«¯ç”¨flexå¸ƒå±€ å››ã€åœ¨iosä¸­ï¼Œh5åº•éƒ¨è¾“å…¥æ¡†è¢«åŸç”Ÿé”®ç›˜é®æŒ¡é—®é¢˜å‚è€ƒé“¾æ¥ https://segmentfault.com/a/1190000006243816é¡¹ç›®ä¸­è§£å†³ä»£ç 123456789/** * åŸç”Ÿé”®ç›˜å¼¹èµ·å, æ“ä½œæ—¶é«˜åº¦ä¼šä¸ä¸€æ ·ï¼Œä½¿è¾“å…¥æ¡†å§‹ç»ˆä¸ä¼šè¢«é”®ç›˜é®æŒ¡ */ timeoutToInterval = () =&gt; &#123; this.timerId = setTimeout(() =&gt; &#123; document.body.scrollTop = document.body.scrollHeight this.timeoutToInterval() &#125;, 100)&#125; äº”ã€iosç³»ç»Ÿ11ä»¥ä¸Šï¼Œå¦‚æœæœ‰åŸç”Ÿåº•éƒ¨æ çš„è¯ï¼Œåº•éƒ¨å°±ä¼šè¢«æŠ¬é«˜å…·ä½“æ“ä½œæ˜¯åŸç”ŸscrollViewé‡Œçš„contentInsetAdjustmentBehaviorå¯¼è‡´çš„ä¸‹é¢æ˜¯ocä»£ç ï¼š12345if (version &gt; 11) &#123; self.webview.scrollView.contentInsetAdjustmentBehavior = UIScrollViewContentInsetAdjustmentNever;&#125;else&#123; self.automaticallyAdjustsScrollViewInsets = NO;&#125;","tags":[{"name":"ç§»åŠ¨ç«¯","slug":"ç§»åŠ¨ç«¯","permalink":"//zhoujingchao.github.io/tags/ç§»åŠ¨ç«¯/"}]},{"title":"ä¸€é“ç»å…¸çš„jsé¢è¯•é¢˜","date":"2017-03-24T02:08:51.000Z","path":"2017/03/24/ä¸€é“ç»å…¸çš„jsé¢è¯•é¢˜/","text":"åºŸè¯ä¸å¤šè¯´ï¼Œç›´åˆ‡ä¸»é¢˜ 1234567for (var i = 0; i &lt; 5; i++) &#123; setTimeout(function() &#123; console.log(new Date, i); &#125;, 1000);&#125;console.log(new Date, i); è¾“å‡ºï¼Ÿ 123456Wed Jan 24 2018 10:13:53 GMT+0800 (CST) 5Wed Jan 24 2018 10:13:54 GMT+0800 (CST) 5Wed Jan 24 2018 10:13:54 GMT+0800 (CST) 5Wed Jan 24 2018 10:13:54 GMT+0800 (CST) 5Wed Jan 24 2018 10:13:54 GMT+0800 (CST) 5Wed Jan 24 2018 10:13:54 GMT+0800 (CST) 5 å¾ªç¯æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå‡ ä¹åŒæ—¶è®¾ç½®äº†5ä¸ªå®šæ—¶å™¨ï¼Œè¿™äº›å®šæ—¶å™¨ä¸€èˆ¬æƒ…å†µä¸‹éƒ½ä¼šåœ¨1ç§’ä¹‹åè§¦å‘ï¼Œè€Œå¾ªç¯å®Œçš„è¾“å‡ºæ˜¯ç«‹å³æ‰§è¡Œçš„ã€‚æ‰€ä»¥å…ˆè¾“å‡ºäº†5ï¼Œ1ç§’ä¹‹åè¾“å‡º5ä¸ª5ã€‚è¿™é‡Œè€ƒæŸ¥äº†jså¼‚æ­¥ä»£ç ï¼Œå˜é‡ä½œç”¨åŸŸï¼Œå®šæ—¶å™¨å·¥ä½œæœºåˆ¶çš„ç†è§£ã€‚ å¦‚æœæœŸæœ›ä»£ç è¾“å‡ºï¼š5 -&gt; 0,1,2,3,4ï¼Œè¯¥æ€ä¹ˆæ”¹é€ ï¼Ÿç†Ÿæ‚‰é—­åŒ…çš„åŒå­¦å¾ˆå¿«èƒ½ç»™å‡ºä¸‹é¢çš„è§£å†³æ–¹æ¡ˆï¼š 123456789for (var i = 0; i &lt; 5; i++) &#123; (function(j) &#123; setTimeout(function() &#123; console.log(new Date, j); &#125;, 1000); &#125;)(i);&#125;console.log(new Date, i); è¿™é‡Œåˆ©ç”¨äº†ç«‹å³æ‰§è¡Œå‡½æ•°çš„è¡¨è¾¾å¼æ¥è§£å†³é—­åŒ…ï¼Œå½“ç„¶è¿˜å¯ä»¥åˆ©ç”¨jsä¸­åŸºæœ¬ç±»å‹çš„å‚æ•°æ˜¯æŒ‰å€¼ä¼ é€’çš„ç‰¹å¾æ¥æ”¹é€ ï¼š 1234567891011var output = function (i) &#123; setTimeout(function() &#123; console.log(new Date, i); &#125;, 1000);&#125;;for (var i = 0; i &lt; 5; i++) &#123; output(i);&#125;console.log(new Date, i); æ¥ç€è¿˜å¯ä»¥è¡ç”Ÿå‡ºES6çš„è€ƒå¯Ÿï¼š 1234567for (let i = 0; i &lt; 5; i++) &#123; setTimeout(function() &#123; console.log(new Date, i); &#125;, 1000);&#125;console.log(new Date, i); è¿™é‡Œåªæœ‰ä¸ªéå¸¸ç»†å¾®çš„å˜åŠ¨ï¼Œå³ä½¿ç”¨ ES6 å—çº§ä½œç”¨åŸŸ ä¸­çš„ let æ›¿ä»£äº† varï¼Œä½†æ˜¯ä»£ç åœ¨å®é™…è¿è¡Œæ—¶ç¬¬äºŒæ®µ console.log(new Date, i) ä¼šæŠ¥é”™ï¼Œå› ä¸ºæœ€åé‚£ä¸ªè¾“å‡ºä½¿ç”¨çš„ i åœ¨å…¶æ‰€åœ¨çš„ä½œç”¨åŸŸä¸­å¹¶ä¸å­˜åœ¨ï¼Œi åªå­˜åœ¨äºå¾ªç¯å†…éƒ¨ã€‚ ä¸‹é¢å†è¿›è¡Œæ‰©å±•è¦æ±‚å¾ªç¯å’Œä¸¤å¤„ console ä¸å˜ï¼Œè¦æ±‚ä»£ç æ‰§è¡Œæ—¶ç«‹å³è¾“å‡º0ï¼Œä¹‹åæ¯éš”1ç§’ä¾æ¬¡è¾“å‡º1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œå¾ªç¯ç»“æŸåï¼Œå¤§æ¦‚åœ¨ç¬¬5ç§’è¾“å‡º5 12345678910111213141516171819202122232425let tasks = [];// let output = (i) =&gt; new Promise(resolve =&gt; &#123;// setTimeout(() =&gt; &#123;// console.log(new Date, i);// resolve();// &#125;, 1000 * i);// &#125;)for (var i = 0; i &lt; 5; i++) &#123; // tasks.push(output(i)); ((j) =&gt; &#123; tasks.push(new Promise((resolve) =&gt; &#123; setTimeout(() =&gt; &#123; console.log(new Date, j); resolve(); &#125;, 1000 * j); &#125;)); &#125;)(i);&#125;Promise.all(tasks).then(() =&gt; &#123; setTimeout(() =&gt; &#123; console.log(new Date, i); &#125;, 1000);&#125;); æ—¢ç„¶åˆ° Promise äº†ï¼Œé‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯åº”è¯¥ç”¨ä¸‹ ES7 ä¸­çš„ async await ç‰¹æ€§æ¥å®ç°ä¸€ä¸‹ä¸‹å‘¢ã€‚ 12345678910111213const asyncFn = (time) =&gt; new Promise((resolve) =&gt; &#123; setTimeout(resolve, time);&#125;); // è¿™ä¸ªåˆ†å·å¿…é¡»å†™ï¼Œä¸ç„¶ä¸‹é¢çš„ç«‹å³è¡¨è¾¾å¼ä¼šèåˆåˆ°setTimeoutå‡½æ•°ä¸­ï¼Œå¦‚æœä½¿ç”¨å¤§æ‹¬å·return new promiseä½¿ä¹‹é—­åˆï¼Œå°±ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜äº†(async () =&gt; &#123; for (var i = 0; i &lt; 5; i++) &#123; await asyncFn(1000); console.log(new Date, i); &#125; await asyncFn(1000); console.log(new Date, i);&#125;)();","tags":[{"name":"js","slug":"js","permalink":"//zhoujingchao.github.io/tags/js/"}]},{"title":"JSåŸºæœ¬é¢è¯•é¢˜","date":"2017-03-13T07:32:31.000Z","path":"2017/03/13/JSåŸºæœ¬é¢è¯•é¢˜/","text":"1ã€typeof a === â€˜objectâ€™ æ¥ç¡®å®šaæ˜¯å¦æ˜¯å¯¹è±¡çš„é—®é¢˜?åœ¨jsä¸­ï¼Œnullè¿™ä¸ªæ•°æ®ç±»å‹ä¹Ÿè¢«è®¤ä¸ºæ˜¯å¯¹è±¡ 12let a = nullconsole.log(typeof a === 'object') // true 2ã€ä¸‹é¢ä»£ç æ§åˆ¶å°è¾“å‡ºä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆï¼Ÿ12345(function()&#123; let a = b = 3&#125;)()console.log(\"a: \" + (typeof a !== 'undefined'))console.log(\"b: \" + (typeof b !== 'undefined')) å¤§éƒ¨åˆ†å¼€å‘äººå‘˜ä¼šç†è§£æˆ 12let b = 3let a = b äº‹å®ä¸Šæ˜¯ 12b = 3let a = b æ‰€ä»¥ä½ ä¸ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼çš„è¯ï¼Œè¯¥ä»£ç è¾“å‡º 12a: falseb: true use strictä¸‹ï¼Œå°±ä¼šæŠ¥errorï¼ŒReferenceError: b is not defined 3ã€ä¸‹é¢ä»£ç æ§åˆ¶å°è¾“å‡ºä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆï¼Ÿ12345678910111213let obj = &#123; a: 'a', func: function() &#123; var _this = this console.log(\"outer func: this.a = \" + this.a) console.log(\"outer func: _this.a = \" + _this.a) (function() &#123; console.log(\"inner func: this.a = \" + this.a) console.log(\"inner func: _this.a = \" + _this.a) &#125;()) &#125;&#125;obj.func() è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š 1234outer func: this.a = aouter func: _this.a = ainner func: this.a = undefinedinner func: _this.a = a åœ¨outerå‡½æ•°ä¸­ï¼Œthiså’Œ_thiséƒ½æŒ‡å‘äº†objï¼Œæ‰€ä»¥èƒ½æ­£ç¡®å¼•ç”¨ï¼Œåœ¨innerå‡½æ•°ä¸­ï¼Œthisçš„æŒ‡å‘æ˜¯windowï¼Œ_thisçš„æŒ‡å‘è¿˜æ˜¯objã€‚ 4ã€å°è£…JavaScriptæºæ–‡ä»¶çš„å…¨éƒ¨å†…å®¹åˆ°ä¸€ä¸ªå‡½æ•°å—æœ‰ä»€ä¹ˆæ„ä¹‰åŠç†ç”±ï¼Ÿè¿™æ˜¯å¿…é¡»è¿™ä¹ˆåšçš„ï¼Œç°åœ¨çš„jsåº“å®åœ¨æ˜¯å¤ªå¤šäº†å¹¶ä¸”è¿˜ä¼šè¶Šæ¥è¶Šå¤šï¼Œåƒè¿™æ ·åˆ›å»ºçš„é—­åŒ…ï¼Œå°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªç§æœ‰çš„å‘½åç©ºé—´ï¼Œä»è€Œé¿å…æ¨¡å—ä¸åº“ä¹‹é—´çš„å‘½åå†²çªã€‚ç‰¹ç‚¹æ˜¯ï¼Œå…è®¸ä¸€ä¸ªæ˜“äºå¼•ç”¨çš„åˆ«åç”¨äºå…¨å±€å˜é‡ï¼Œä¾‹å¦‚ 1(function(yourSymbol) &#123; /* yourPluginName plugin code */ &#125; )(yourPluginName) 5ã€åœ¨JavaScriptæºæ–‡ä»¶çš„å¼€å¤´åŒ…å« â€˜use strictâ€™ æœ‰ä»€ä¹ˆæ„ä¹‰å’Œå¥½å¤„ï¼Ÿuse strict æ˜¯ä¸€ç§åœ¨jsä»£ç è¿è¡Œæ—¶è‡ªåŠ¨å®è¡Œæ›´ä¸¥æ ¼è§£æå’Œé”™è¯¯å¤„ç†çš„æ–¹æ³•ã€‚ä¼˜ç‚¹ï¼š ä½¿è°ƒè¯•æ›´åŠ å®¹æ˜“ï¼Œé‚£äº›è¢«å¿½ç•¥æˆ–é»˜é»˜å¤±è´¥äº†çš„ä»£ç é”™è¯¯ï¼Œä¼šäº§ç”Ÿé”™è¯¯æˆ–æŠ›å‡ºå¼‚å¸¸ï¼Œå› æ­¤å°½æ—©æé†’ä½ ä»£ç ä¸­çš„é—®é¢˜ï¼Œä½ æ‰èƒ½æ›´å¿«åœ°æŒ‡å¼•åˆ°å®ƒä»¬çš„æºä»£ç ã€‚ é˜²æ­¢æ„å¤–çš„å…¨å±€å˜é‡ã€‚å¦‚æœæ²¡æœ‰ä¸¥æ ¼æ¨¡å¼ï¼Œå°†å€¼åˆ†é…ç»™ä¸€ä¸ªæœªå£°æ˜çš„å˜é‡ä¼šè‡ªåŠ¨åˆ›å»ºè¯¥åç§°çš„å…¨å±€å˜é‡ã€‚è¿™æ˜¯JavaScriptä¸­æœ€å¸¸è§çš„é”™è¯¯ä¹‹ä¸€ã€‚åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œè¿™æ ·åšçš„è¯ä¼šæŠ›å‡ºé”™è¯¯ã€‚ æ¶ˆé™¤ this å¼ºåˆ¶ã€‚å¦‚æœæ²¡æœ‰ä¸¥æ ¼æ¨¡å¼ï¼Œå¼•ç”¨nullæˆ–æœªå®šä¹‰çš„å€¼åˆ° this å€¼ä¼šè‡ªåŠ¨å¼ºåˆ¶åˆ°å…¨å±€å˜é‡ã€‚åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå¼•ç”¨ nullæˆ–æœªå®šä¹‰çš„ this å€¼ä¼šæŠ›å‡ºé”™è¯¯ã€‚ ä¸å…è®¸é‡å¤çš„å±æ€§åç§°æˆ–å‚æ•°å€¼ã€‚å½“æ£€æµ‹åˆ°å¯¹è±¡ï¼ˆä¾‹å¦‚ï¼Œvar obj = {foo: â€œbarâ€, foo: â€œbazâ€}ï¼‰ä¸­é‡å¤å‘½åçš„å±æ€§ï¼Œæˆ–æ£€æµ‹åˆ°å‡½æ•°ä¸­ï¼ˆä¾‹å¦‚ï¼Œfunction foo(val1, val2, val1){}ï¼‰é‡å¤å‘½åçš„å‚æ•°æ—¶ï¼Œä¸¥æ ¼æ¨¡å¼ä¼šæŠ›å‡ºé”™è¯¯ï¼Œå› æ­¤æ•æ‰å‡ ä¹å¯ä»¥è‚¯å®šæ˜¯ä»£ç ä¸­çš„bugå¯ä»¥é¿å…æµªè´¹å¤§é‡çš„è·Ÿè¸ªæ—¶é—´ã€‚ ä½¿eval() æ›´å®‰å…¨ã€‚åœ¨ä¸¥æ ¼æ¨¡å¼å’Œéä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œeval() çš„è¡Œä¸ºæ–¹å¼æœ‰æ‰€ä¸åŒã€‚æœ€æ˜¾è€Œæ˜“è§çš„æ˜¯ï¼Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå˜é‡å’Œå£°æ˜åœ¨eval() è¯­å¥å†…éƒ¨çš„å‡½æ•°ä¸ä¼šåœ¨åŒ…å«èŒƒå›´å†…åˆ›å»ºï¼ˆå®ƒä»¬ä¼šåœ¨éä¸¥æ ¼æ¨¡å¼ä¸‹çš„åŒ…å«èŒƒå›´ä¸­è¢«åˆ›å»ºï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¸¸è§çš„é—®é¢˜æºï¼‰ã€‚ åœ¨deleteä½¿ç”¨æ— æ•ˆæ—¶æŠ›å‡ºé”™è¯¯ã€‚deleteæ“ä½œç¬¦ï¼ˆç”¨äºä»å¯¹è±¡ä¸­åˆ é™¤å±æ€§ï¼‰ä¸èƒ½ç”¨åœ¨å¯¹è±¡ä¸å¯é…ç½®çš„å±æ€§ä¸Šã€‚å½“è¯•å›¾åˆ é™¤ä¸€ä¸ªä¸å¯é…ç½®çš„å±æ€§æ—¶ï¼Œéä¸¥æ ¼ä»£ç å°†é»˜é»˜åœ°å¤±è´¥ï¼Œè€Œä¸¥æ ¼æ¨¡å¼å°†åœ¨è¿™æ ·çš„æƒ…å†µä¸‹æŠ›å‡ºå¼‚å¸¸ã€‚ 6ã€ä»¥ä¸‹ä¸¤ä¸ªå‡½æ•°ã€‚å®ƒä»¬ä¼šè¿”å›ç›¸åŒçš„ä¸œè¥¿å—ï¼Ÿ ä¸ºä»€ä¹ˆç›¸åŒæˆ–ä¸ºä»€ä¹ˆä¸ç›¸åŒï¼Ÿ12345678910111213function fn1() &#123; return &#123; dog: 'hello' &#125;&#125;function fn2() &#123; return &#123; dog: 'hello' &#125;&#125;console.log(fn1())console.log(fn2()) ç»“æœå¦‚ä¸‹ï¼š 12&#123;dog: \"hello\"&#125;undefined åŸå› æ˜¯åœ¨jsä¸­ï¼Œreturnè¯­å¥çš„ä»£ç è¡Œ\båé¢æ²¡æœ‰å…¶ä»–ä»£ç çš„æ—¶å€™ï¼Œåˆ†å·ä¼šè‡ªåŠ¨æ’å…¥åˆ°è¿”å›è¯­å¥ä¹‹åï¼Œå› æ­¤ä¹Ÿä¸ä¼šæŠ›å‡ºé”™è¯¯ï¼Œfn2()é‡Œreturnä¸‹é¢çš„ä»£ç å°±æ˜¯ä¸€ä¸ªæœªä½¿ç”¨å¾—ä»£ç å—ã€‚ 7ã€ä¸‹åˆ—ä»£ç è¾“å‡ºä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ12console.log(0.1 + 0.2)console.log(0.1 + 0.2 == 0.3) æœ¬é¢˜è€ƒæŸ¥çš„æ˜¯jsä¸­æµ®ç‚¹æ•°çš„è®¡ç®—ç²¾åº¦é—®é¢˜å…ˆçœ‹ä¸‹è¾“å‡º 120.30000000000000004false è¿™ä¸æ˜¯è¯­è¨€çš„bugæˆ–è€…å®¿ä¸»ç¯å¢ƒçš„bugã€‚ç›®å‰æ‰€æœ‰çš„ç¨‹åºè®¾è®¡è¯­è¨€åœ¨å¯¹æµ®ç‚¹æ•°è¿›è¡Œå››åˆ™è¿ç®—æ—¶ï¼Œéƒ½ä¼šæ¶‰åŠåˆ°æµ®ç‚¹æ•°ç²¾ç¡®åº¦çš„é—®é¢˜ã€‚æˆ‘ä»¬çŸ¥é“åœ¨è®¡ç®—æœºçš„ä¸–ç•Œä¸­ï¼Œè®¡ç®—æœºåªè®¤è¯†0ï¼Œ1ï¼Œæˆ‘ä»¬ä¼ å…¥çš„åè¿›åˆ¶æ•°å­—å¹¶ä¸ä¼šè¢«è®¡ç®—æœºç›´æ¥è¯†åˆ«ã€‚è®¡ç®—æœºä¼šå…ˆå°†å…¶è½¬æ¢æˆäºŒè¿›åˆ¶ï¼Œç„¶åä½¿ç”¨è½¬æ¢åçš„äºŒè¿›åˆ¶è¿›è¡Œè®¡ç®—ã€‚é‚£ä¹ˆ0.1å’Œ0.2è½¬æ¢æˆäºŒè¿›åˆ¶åˆ†åˆ«æ˜¯ï¼Œ (0.1) =&gt; 0.0001 1001 1001 1001 1001 1001 1001 1001 1001 1001 1001 1001 1001 101 (0.2) =&gt; 0.0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 01 ç„¶åå¯¹ä¸Šé¢çš„ä¸¤ä¸ªäºŒè¿›åˆ¶æ•°å­—åšåŠ æ³•ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ï¼Œ 0.0100 1100 1100 1100 1100 1100 1100 1100 1100 1100 1100 1100 1101 01 å†æŠŠè¿™ä¸ªäºŒè¿›åˆ¶è½¬æ¢æˆåè¿›åˆ¶ï¼Œå°±æ˜¯æˆ‘ä»¬å‰é¢çš„ç»“æœ0.30000000000000004äº†ã€‚ 8ã€ ä¸‹åˆ—ä»£ç è¡Œ1-4å¦‚ä½•æ’åºï¼Œä¸ºä»€ä¹ˆï¼Ÿ123456(function() &#123; console.log(1) setTimeout(function()&#123;console.log(2)&#125;, 1000) setTimeout(function()&#123;console.log(3)&#125;, 0) console.log(4)&#125;)() ç»“æœå¦‚ä¸‹ï¼š 12341432 \bsetTimeout() ä¼šæŠŠå…¶å¼•ç”¨çš„å‡½æ•°çš„æ‰§è¡Œæ”¾åˆ°äº‹ä»¶é˜Ÿåˆ—ä¸­ï¼Œå½“å®ƒçš„ç¬¬äºŒä¸ªå‚æ•°ä¸º0æ—¶ï¼Œæ„æ€æ˜¯å°½å¿«æ‰§è¡ŒæŒ‡å®šçš„å‡½æ•°ï¼Œå…·ä½“è€Œè¨€ï¼Œå‡½æ•°çš„æ‰§è¡Œä¼šæ”¾ç½®åœ¨äº‹ä»¶é˜Ÿåˆ—çš„ä¸‹ä¸€ä¸ªè®¡æ—¶å™¨å¼€å§‹ï¼Œä½†æ˜¯è¯·æ³¨æ„ï¼Œè¿™ä¸æ˜¯ç«‹å³æ‰§è¡Œï¼Œå‡½æ•°ä¸ä¼šè¢«æ‰§è¡Œé™¤éä¸‹ä¸€ä¸ªè®¡æ—¶å™¨å¼€å§‹ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨ä¸Šè¿°çš„ä¾‹å­ä¸­ï¼Œç”¨ console.log(4) å‘ç”Ÿåœ¨è°ƒç”¨ console.log(3) ä¹‹å‰ï¼ˆå› ä¸ºè°ƒç”¨ console.log(3) æ˜¯é€šè¿‡setTimeoutè¢«è°ƒç”¨çš„ï¼Œå› æ­¤ä¼šç¨å¾®å»¶è¿Ÿï¼‰ 9ã€å†™ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼ˆè¶Šç®€æ´è¶Šå¥½ï¼‰ï¼Œè¦æ±‚è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼æŒ‡æ˜å­—ç¬¦ä¸²æ˜¯å¦ä¸ºå›æ–‡ç»“æ„ã€‚123456\bfunction isPalindrome(str) &#123; // æ’é™¤\béå•è¯å­—ç¬¦ str = str.replace(/W/g, '').toLowerCaxe() str.split('').reverse().join('') return str&#125; 10ã€å†™ä¸€ä¸ªaddæ–¹æ³•ï¼Œä¸‹é¢çš„è°ƒç”¨ï¼Œéƒ½èƒ½æ­£å¸¸è¾“å‡º12console.log(add(2, 3)) //5console.log(add(2)(3)) //5 123456789function add(x, y) &#123; if (y) &#123; return x + y &#125; else &#123; return function(y) &#123; return x + y &#125; &#125;&#125; 11ã€\bè¯·çœ‹ä¸‹é¢ä»£ç ç‰‡æ®µ12345678for (var i = 0; i &lt; 5; i++) &#123; let btn = document.createElement('button') btn.appendChild(document.createTextNode('button ' + i)) btn.addEventListener('click', function() &#123; console.log(i) &#125;) document.body.appendChild(btn)&#125; 1)å½“ç”¨æˆ·ç‚¹å‡»\bbutton4çš„æ—¶å€™ä¼šè¾“å‡ºä»€ä¹ˆåˆ°æ§åˆ¶å°ï¼Œä¸ºä»€ä¹ˆï¼Ÿ æ— è®ºç‚¹å‡»å“ªä¸ªæŒ‰é’®ï¼Œæ•°å­—5å°†æ€»ä¼šè¾“å‡ºåˆ°æ§åˆ¶å°ã€‚è¿™æ˜¯å› ä¸ºï¼Œå½“ onclick æ–¹æ³•è¢«è°ƒç”¨ï¼ˆå¯¹äºä»»ä½•æŒ‰é’®ï¼‰çš„æ—¶å€™ï¼Œ for å¾ªç¯å·²ç»ç»“æŸï¼Œå˜é‡ i å·²ç»è·å¾—äº†5çš„å€¼ 2ï¼‰æä¾›ä¸€ä¸ªæˆ–å¤šä¸ªå¤‡ç”¨çš„å¯æŒ‰é¢„æœŸå·¥ä½œçš„å®ç°æ–¹æ¡ˆã€‚ è¦è®©ä»£ç å·¥ä½œçš„å…³é”®æ˜¯ï¼Œé€šè¿‡ä¼ é€’åˆ°ä¸€ä¸ªæ–°åˆ›å»ºçš„å‡½æ•°å¯¹è±¡ï¼Œåœ¨æ¯æ¬¡ä¼ é€’é€šè¿‡ for å¾ªç¯æ—¶ï¼Œæ•æ‰åˆ° i å€¼ã€‚ä¸‹é¢æ˜¯ä¸‰ç§å¯èƒ½å®ç°çš„æ–¹æ³•ï¼š 12345btn.addEventListener('click', (function(i) &#123; return function() &#123; console.log(i) &#125;&#125;)(i)) 12345(function(i) &#123; brn.addEventListener('click', function() &#123; console.log(i) &#125;)&#125;)(i) 123456['a', 'b', 'c', 'd', 'e'].forEach(function (value, i) &#123; let btn = document.createElement('button') btn.appendChild(document.createTextNode('button ' + i)) btn.addEventListener('click', function() &#123; console.log(i) &#125;) document.body.appendChild(btn)&#125;); 12ã€ä¸‹é¢çš„ä»£ç è¾“å‡ºä»€ä¹ˆåˆ°æ§åˆ¶å°ï¼Œä¸ºä»€ä¹ˆï¼Ÿ123456let arr1 = 'john'.split('')let arr2 = arr1.reverse()let arr3 = 'jones'.split('')arr2.push(arr3)console.log('arr1.length: ' + arr1.length + ' last=' + arr1.slice(-1))console.log('arr2.length: ' + arr2.length + ' last=' + arr2.slice(-1)) ç»“æœå¦‚ä¸‹ï¼š 12arr1.length: last=j,o,n,e,sarr2.length: last=j,o,n,e,s \barr1å’Œarr2æ‰§è¡Œå®Œåï¼Œä¸¤è€…ç›¸åŒï¼ŒåŸå› å¦‚ä¸‹ï¼š è°ƒç”¨æ•°ç»„å¯¹è±¡çš„ reverse() æ–¹æ³•å¹¶ä¸åªè¿”å›åé¡ºåºçš„é˜µåˆ—ï¼Œå®ƒä¹Ÿåè½¬äº†æ•°ç»„æœ¬èº«çš„é¡ºåº reverse() æ–¹æ³•è¿”å›ä¸€ä¸ªåˆ°æ•°ç»„æœ¬èº«çš„å¼•ç”¨ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹å³ï¼Œarr1ï¼‰ã€‚å…¶ç»“æœä¸ºï¼Œarr2 ä»…ä»…æ˜¯ä¸€ä¸ªåˆ° arr1çš„å¼•ç”¨ï¼ˆè€Œä¸æ˜¯å‰¯æœ¬ï¼‰ã€‚å› æ­¤ï¼Œå½“å¯¹ arr2åšäº†ä»»ä½•äº‹æƒ…ï¼ˆå³å½“æˆ‘ä»¬è°ƒç”¨ arr2.push(arr3);ï¼‰æ—¶ï¼Œarr1 ä¹Ÿä¼šå—åˆ°å½±å“ï¼Œå› ä¸º arr1 å’Œ arr2 å¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚ 13ã€ä¸‹é¢çš„ä»£ç è¾“å‡ºä»€ä¹ˆåˆ°æ§åˆ¶å°ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ123456console.log(1 + '2' + '2')console.log(1 + +'2' + '2')console.log(1 + -'1' + '2')console.log(+'1' + '1' + '2')console.log( 'A' - 'B' + '2')console.log( 'A' - 'B' + 2) ç»“æœå¦‚ä¸‹ï¼š 123456\b1223202112NaN2NaN","tags":[{"name":"js","slug":"js","permalink":"//zhoujingchao.github.io/tags/js/"}]},{"title":"CSSç›’æ¨¡å‹çš„è®¤è¯†","date":"2017-02-21T07:21:37.000Z","path":"2017/02/21/CSSç›’æ¨¡å‹çš„è®¤è¯†/","text":"å‰è¨€CSSæ˜¯å‰ç«¯å·¥ç¨‹å¸ˆç»•ä¸å¼€çš„è¯é¢˜ï¼Œå‘ˆç°åœ¨äººä»¬çœ¼å‰çš„ç½‘é¡µå¸ƒå±€ï¼Œå¯éƒ½ç¦»ä¸å¼€å®ƒçš„åŠŸåŠ³ã€‚ ä»Šå¤©æˆ‘ä»¬å°±æ¥æ¢è®¨ä¸€ä¸‹å¯¹CSSç›’æ¨¡å‹çš„è®¤è¯†ã€‚ ä½•ä¸ºCSSç›’æ¨¡å‹ç½‘é¡µè®¾è®¡ä¸­å¸¸å¬çš„å±æ€§åï¼šå†…å®¹(content)ã€å¡«å……(padding)ã€è¾¹æ¡†(border)ã€è¾¹ç•Œ(margin)ï¼Œ CSSç›’å­æ¨¡å¼éƒ½å…·å¤‡è¿™äº›å±æ€§ã€‚è¿™äº›å±æ€§æˆ‘ä»¬å¯ä»¥ç”¨æ—¥å¸¸ç”Ÿæ´»ä¸­çš„å¸¸è§äº‹ç‰©â€”â€”ç›’å­ä½œä¸€ä¸ªæ¯”å–»æ¥ç†è§£ï¼Œæ‰€ä»¥å«å®ƒç›’å­æ¨¡å¼ã€‚CSSç›’å­æ¨¡å‹å°±æ˜¯åœ¨ç½‘é¡µè®¾è®¡ä¸­ç»å¸¸ç”¨åˆ°çš„CSSæŠ€æœ¯æ‰€ä½¿ç”¨çš„ä¸€ç§æ€ç»´æ¨¡å‹ã€‚ åŸºæœ¬æ¦‚å¿µæµè§ˆå™¨è§£æCSSæœ‰ä¸¤ç§æ¨¡å¼ï¼šæ ‡å‡†æ¨¡å¼(strict mode) å’Œ æ€ªå¼‚æ¨¡å¼(quirks mode)ã€‚å› æ­¤å°±äº§ç”Ÿäº†ä¸¤ç§ç›’æ¨¡å‹ æ ‡å‡†ç›’æ¨¡å‹ å’Œ IEç›’æ¨¡å‹ã€‚ æ ‡å‡†æ¨¡å¼ï¼šæµè§ˆå™¨æŒ‰W3Cæ ‡å‡†è§£ææ‰§è¡Œä»£ç ã€‚ç¤ºæ„å›¾å¦‚ä¸‹ï¼š æ€ªå¼‚æ¨¡å¼ï¼šä½¿ç”¨æµè§ˆå™¨è‡ªå·±çš„æ–¹å¼è§£ææ‰§è¡Œä»£ç ï¼Œå› ä¸ºä¸åŒæµè§ˆå™¨è§£ææ‰§è¡Œçš„æ–¹å¼ä¸ä¸€æ ·ï¼Œæ‰€ä»¥ç§°ä¹‹ä¸ºæ€ªå¼‚æ¨¡å¼ã€‚ç¤ºæ„å›¾å¦‚ä¸‹ï¼š æµè§ˆå™¨è§£ææ—¶ä½¿ç”¨æ ‡å‡†æ¨¡å¼è¿˜æ˜¯æ€ªå¼‚æ¨¡å¼ï¼Œä¸ç½‘é¡µä¸­çš„DTDï¼ˆDocument Type Definationï¼‰å£°æ˜ç›´æ¥ç›¸å…³ï¼ŒDTDå£°æ˜å®šä¹‰äº†æ ‡å‡†æ–‡æ¡£çš„ç±»å‹ï¼ˆæ ‡å‡†æ¨¡å¼è§£æï¼‰æ–‡æ¡£ç±»å‹ï¼Œä¼šä½¿æµè§ˆå™¨ä½¿ç”¨ç›¸å…³çš„æ–¹å¼åŠ è½½ç½‘é¡µå¹¶æ˜¾ç¤ºï¼Œå¿½ç•¥DTDå£°æ˜ï¼Œå°†ä½¿ç½‘é¡µè¿›å…¥æ€ªå¼‚æ¨¡å¼ã€‚ å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡cssæ¥è®¾ç½®ç›’æ¨¡å‹ï¼šbox-sizing: content-box;box-sizing: border-box;å‰è€…å°±æ˜¯æ ‡å‡†æ¨¡å‹ï¼Œåè€…æ˜¯IEæ¨¡å‹ã€‚ JSå¦‚ä½•è·å–ç›’æ¨¡å‹çš„å®½å’Œé«˜domä¸ºhtmlé‡Œè·å–åˆ°çš„èŠ‚ç‚¹ dom.style.width/heightï¼Œé€šè¿‡domèŠ‚ç‚¹çš„styleå±æ€§æ‹¿åˆ° dom.currentStyle.width/heightï¼Œæµè§ˆå™¨æ¸²æŸ“åçš„å®½é«˜ï¼Œä»…IEæ”¯æŒ window.getComputedStyle(dom).width/heightï¼ŒåŸç†åŒç¬¬äºŒæ¡ï¼Œå…¼å®¹ç¬¬äºŒç§å†™æ³• dom.getBoundingClientRect().width/heightï¼Œç”¨ä¸è®¡ç®—å…ƒç´ çš„ç»å¯¹ä½ç½®ï¼Œä¹Ÿèƒ½æ‹¿åˆ°å®½é«˜ ç›’æ¨¡å‹çš„è¾¹è·é‡å  å‡å¦‚è¿™é‡Œæœ‰ä¸¤ä¸ªå…ƒç´ ï¼Œå­å…ƒç´ é«˜åº¦100pxï¼Œmargin-topä¸º10pxï¼Œé‚£ä¹ˆå®ƒçš„çˆ¶å…ƒç´ é«˜åº¦æ˜¯å¤šå°‘å‘¢ï¼Ÿè¿™é‡Œæˆ‘æš‚æ—¶å…ˆä¸ç»™ç­”æ¡ˆï¼Œåé¢å†ç»™ã€‚ 12345678910111213141516171819202122232425262728&lt;!DOCTYPE html&gt;&lt;html lang=\"en\"&gt;&lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt; &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt; &lt;title&gt;Document&lt;/title&gt; &lt;style&gt; * &#123; margin: 0; padding: 0; &#125; .parent &#123; background: #ff9999; &#125; .child &#123; background: #ffcc99; height: 100px; margin-top: 10px; &#125; &lt;/style&gt;&lt;/head&gt;&lt;body&gt; &lt;div class=\"parent\"&gt; &lt;div class=\"child\"&gt;&lt;/div&gt; &lt;/div&gt;&lt;/body&gt;&lt;/html&gt; å¯ä»¥çœ‹åˆ°çˆ¶å…ƒç´ æ˜¯100pxï¼Œæ˜¯å§ï¼Œå—¯ï¼Œæ²¡æ¯›ç—…ã€‚æ¥ç€åœ¨çˆ¶å…ƒç´ parentä¸ŠåŠ ä¸Š overflow: hidden å±æ€§æˆ‘ä»¬å†çœ‹çœ‹æ•ˆæœ çˆ¶å…ƒç´ æ˜¯ä¸æ˜¯å˜æˆ110pxäº†ï¼Œå—¯ï¼Ÿï¼Œä½ æ¥ç€è¯´ï¼Œæˆ‘åœ¨å¬â€¦è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå…¶å®ç»™çˆ¶çº§åŠ äº† overflow: hidden å³ç»™è¿™ä¸ªå…ƒç´ åˆ›å»ºäº† BFCã€‚ BFCé‚£ä¹ˆä»€ä¹ˆæ˜¯ BFC å‘¢ï¼ŸBFC å³ Block Formatting Contexts (å—çº§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡)å…·æœ‰ BFC ç‰¹æ€§çš„å…ƒç´ å¯ä»¥çœ‹ä½œæ˜¯éš”ç¦»äº†çš„ç‹¬ç«‹å®¹å™¨ï¼Œå®¹å™¨é‡Œé¢çš„å…ƒç´ ä¸ä¼šåœ¨å¸ƒå±€ä¸Šå½±å“åˆ°å¤–é¢çš„å…ƒç´ ï¼Œå¹¶ä¸” BFC å…·æœ‰æ™®é€šå®¹å™¨æ‰€æ²¡æœ‰çš„ä¸€äº›ç‰¹æ€§é€šä¿—ä¸€ç‚¹æ¥è®²ï¼Œå¯ä»¥æŠŠ BFC ç†è§£ä¸ºä¸€ä¸ªå°é—­çš„å¤§ç®±å­ï¼Œç®±å­å†…éƒ¨çš„å…ƒç´ æ— è®ºå¦‚ä½•ç¿»æ±Ÿå€’æµ·ï¼Œéƒ½ä¸ä¼šå½±å“åˆ°å¤–éƒ¨ã€‚ åªè¦å…ƒç´ æ»¡è¶³ä¸‹é¢ä»»ä¸€æ¡ä»¶å³å¯è§¦å‘ BFC ç‰¹æ€§ï¼š body æ ¹å…ƒç´  æµ®åŠ¨å…ƒç´ ï¼šfloat é™¤ none ä»¥å¤–çš„å€¼ ç»å¯¹å®šä½å…ƒç´ ï¼šposition (absoluteã€fixed) display ä¸º inline-blockã€table-cellsã€flex overflow é™¤äº† visible ä»¥å¤–çš„å€¼ (hiddenã€autoã€scroll) 1234567891011121314151617181920212223242526272829303132&lt;!DOCTYPE html&gt;&lt;html lang=\"en\"&gt;&lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt; &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt; &lt;title&gt;Document&lt;/title&gt; &lt;style&gt; * &#123; margin: 0; padding: 0; &#125; .parent &#123; background: #ff9999; overflow: hidden; &#125; .parent &gt; p &#123; background: #ffcc99; margin: 5px auto 20px; text-align: center; &#125; &lt;/style&gt;&lt;/head&gt;&lt;body&gt; &lt;!-- BFCå‚ç›´æ–¹å‘è¾¹è·é‡å  --&gt; &lt;div class=\"parent\"&gt; &lt;p&gt;A&lt;/p&gt; &lt;p&gt;B&lt;/p&gt; &lt;p&gt;C&lt;/p&gt; &lt;/div&gt;&lt;/body&gt;&lt;/html&gt; æ˜¯ä¸æ˜¯å¯ä»¥å‘ç° B çš„ä¸Šè¾¹è·å’Œ A çš„ä¸‹è¾¹è·å‘ç”Ÿäº†é‡å ï¼ŒæŒ‰ç…§é‡å åŸåˆ™ä¼šå–æœ€å¤§çš„åƒç´ å³æ—¶å¦‚ä¸Š20pxã€‚é‚£ä¹ˆè¦å¦‚ä½•è§£å†³è¿™ä¸ªå‘¢ï¼Œä¸è®©ä»–ä»¬é‡å ï¼Œé‚£å°±æ˜¯ç»™å…ƒç´ åˆ›å»º BFCã€‚ 12345678910&lt;body&gt; &lt;!-- BFCå‚ç›´æ–¹å‘è¾¹è·é‡å  --&gt; &lt;div class=\"parent\"&gt; &lt;p&gt;A&lt;/p&gt; &lt;div style=\"overflow: hidden;\"&gt; &lt;p&gt;B&lt;/p&gt; &lt;/div&gt; &lt;p&gt;C&lt;/p&gt; &lt;/div&gt;&lt;/body&gt; ç›¸ä¿¡åˆ°è¿™é‡Œï¼Œå¤§å®¶å·²ç»å¯¹ BFC æœ‰ä¸ªç†è§£äº†å§ã€‚ä¸‹é¢æˆ‘ä»¬å°±åˆ›å»ºä¸€ä¸ª BFC ä¸Šæœ‰å…³å¸ƒå±€çš„åº”ç”¨ä¾¿äºåŠ æ·±å°è±¡ 1234567891011121314151617181920212223242526272829303132333435363738394041&lt;!DOCTYPE html&gt;&lt;html lang=\"en\"&gt;&lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt; &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt; &lt;title&gt;Document&lt;/title&gt; &lt;style&gt; * &#123; margin: 0; padding: 0; &#125; .parent &#123; background: #ff9999; &#125; .parent .left &#123; background: #ffcc99; width: 100px; height: 100px; float: left; &#125; .parent .right &#123; background: #ffccee; height: 110px; &#125; &lt;/style&gt;&lt;/head&gt;&lt;body&gt; &lt;!-- BFCä¸ä¸floaté‡å  --&gt; &lt;div class=\"parent\"&gt; &lt;div class=\"left\"&gt;&lt;/div&gt; &lt;div class=\"right\"&gt;&lt;/div&gt; &lt;/div&gt;&lt;/body&gt;&lt;/html&gt; ç»™ .right åŠ ä¸Š overflow: hidden ç±»ä¼¼äºæ¸…é™¤æµ®åŠ¨çš„æ“ä½œï¼Œåœ¨è¿™é‡Œå°±ä¸å¤šæè¿°äº†ï¼Œå¯¹æ¸…é™¤æµ®åŠ¨ä¸ç†Ÿæ‚‰çš„ç«¥é‹ è¯·å¾€è¿™é‡Œèµ° æ˜¯ä¸æ˜¯å‘ç° BFC å…ƒç´ ä¸ä¸ float å…ƒç´ ç›¸é‡å äº†ã€‚ å¥½äº†ï¼Œè¯´äº†è¿™ä¹ˆå¤šï¼Œå¸Œæœ›å°ä¼™ä¼´ä»¬å¯¹ CSSç›’æ¨¡å‹ æœ‰ä¸ªäº†è§£å’Œè®¤è¯†ï¼Œæœ‰è®²å¾—ä¸å¯¹çš„åœ°æ–¹å¸Œæœ›å„ä½ç«¥é‹å¤šå¤šæŒ‡æ­£ï¼Œå…±åŒè¿›æ­¥ã€‚","tags":[{"name":"css","slug":"css","permalink":"//zhoujingchao.github.io/tags/css/"}]},{"title":"Hello World","date":"2017-01-05T14:59:57.000Z","path":"2017/01/05/hello-world/","text":"åœ¨æœ‹å‹çš„ä»‹ç»ä¸‹ï¼Œè¿™ä¸ªåšå®¢å¾ˆå¿«å°±æ­å»ºèµ·æ¥äº†ã€‚ å½“çœ‹è§å®ƒåŠ è½½ä¸‹æ¥çš„æ—¶å€™ï¼Œå†…å¿ƒè¿˜æ˜¯å¾ˆå–œæ‚¦çš„ï¼Œæœ‰äº†è‡ªå·±çš„ä¸€å°å—é¢†åœ°ï¼Œè¿™ç§æ„Ÿè§‰å¾ˆå¥‡å¦™ï¼Œç°åœ¨æƒ³æƒ³éƒ½è¿˜æœ‰ç‚¹å°åˆºæ¿€å‘¢ã€‚å¯¹æˆ‘è¿™ç§è¯­æ–‡æ˜¯ä½“è‚²è€å¸ˆæ•™çš„å®å®ï¼Œæƒ³æƒ³è¦å†™ä½œï¼Œæˆ‘å°±ä¸è‡ªè§‰çš„åœ¨å·ç¬‘ï¼Œå•Šå“ˆå“ˆ =_=å¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´ï¼Œè¯·æ‰“å¼€å­¦ä¹ æ—…ç¨‹å§ï¼ å½“ç„¶è¿™ä¸ªè‰²è°ƒå’Œä¸»é¢˜ç”šæ˜¯å–œæ¬¢å•Šï¼Œæ„Ÿè°¢littenå¤§è™¾çš„ç¥ä½œã€‚","tags":[{"name":"æ‚è°ˆ","slug":"æ‚è°ˆ","permalink":"//zhoujingchao.github.io/tags/æ‚è°ˆ/"}]}]