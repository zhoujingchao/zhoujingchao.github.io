<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Hybrid App的理解与思考 | Zhoujc&#39;s blog</title>
    <meta name="generator" content="VuePress 1.6.0">
    
    <meta name="description" content="知识沉淀，好记性不如烂笔头">
    <link rel="preload" href="/assets/css/0.styles.a748b10c.css" as="style"><link rel="preload" href="/assets/js/app.ebc66fdf.js" as="script"><link rel="preload" href="/assets/js/2.d4b9d712.js" as="script"><link rel="preload" href="/assets/js/25.87e00c33.js" as="script"><link rel="prefetch" href="/assets/js/10.28e2e44c.js"><link rel="prefetch" href="/assets/js/100.6737e622.js"><link rel="prefetch" href="/assets/js/101.d01e975f.js"><link rel="prefetch" href="/assets/js/102.66a1ad64.js"><link rel="prefetch" href="/assets/js/103.0b7ae2db.js"><link rel="prefetch" href="/assets/js/104.20427db9.js"><link rel="prefetch" href="/assets/js/105.dd6e0546.js"><link rel="prefetch" href="/assets/js/106.71296a63.js"><link rel="prefetch" href="/assets/js/107.c378d5f1.js"><link rel="prefetch" href="/assets/js/11.e6454622.js"><link rel="prefetch" href="/assets/js/12.0e09de73.js"><link rel="prefetch" href="/assets/js/13.eb107cd6.js"><link rel="prefetch" href="/assets/js/14.6e619cc0.js"><link rel="prefetch" href="/assets/js/15.e0635319.js"><link rel="prefetch" href="/assets/js/16.a8da7a87.js"><link rel="prefetch" href="/assets/js/17.fbe39a52.js"><link rel="prefetch" href="/assets/js/18.bd853f5f.js"><link rel="prefetch" href="/assets/js/19.c8bd314a.js"><link rel="prefetch" href="/assets/js/20.3c574518.js"><link rel="prefetch" href="/assets/js/21.99a75cd7.js"><link rel="prefetch" href="/assets/js/22.42934391.js"><link rel="prefetch" href="/assets/js/23.8b82970c.js"><link rel="prefetch" href="/assets/js/24.7e974840.js"><link rel="prefetch" href="/assets/js/26.8b357711.js"><link rel="prefetch" href="/assets/js/27.4b69f932.js"><link rel="prefetch" href="/assets/js/28.766b5a05.js"><link rel="prefetch" href="/assets/js/29.aac35f3d.js"><link rel="prefetch" href="/assets/js/3.c3a1c082.js"><link rel="prefetch" href="/assets/js/30.ad955432.js"><link rel="prefetch" href="/assets/js/31.e4e4890f.js"><link rel="prefetch" href="/assets/js/32.6b284fe4.js"><link rel="prefetch" href="/assets/js/33.a22f85f8.js"><link rel="prefetch" href="/assets/js/34.5ac595eb.js"><link rel="prefetch" href="/assets/js/35.01736eef.js"><link rel="prefetch" href="/assets/js/36.63d4161d.js"><link rel="prefetch" href="/assets/js/37.ac568153.js"><link rel="prefetch" href="/assets/js/38.6ab48214.js"><link rel="prefetch" href="/assets/js/39.73e8152b.js"><link rel="prefetch" href="/assets/js/4.272a9fbd.js"><link rel="prefetch" href="/assets/js/40.2c194813.js"><link rel="prefetch" href="/assets/js/41.fe37b6f6.js"><link rel="prefetch" href="/assets/js/42.6f73345b.js"><link rel="prefetch" href="/assets/js/43.adc53b2c.js"><link rel="prefetch" href="/assets/js/44.310ae361.js"><link rel="prefetch" href="/assets/js/45.32e660b6.js"><link rel="prefetch" href="/assets/js/46.04890be7.js"><link rel="prefetch" href="/assets/js/47.4a68ffe5.js"><link rel="prefetch" href="/assets/js/48.90a9137b.js"><link rel="prefetch" href="/assets/js/49.58b6c3b6.js"><link rel="prefetch" href="/assets/js/5.f83283dc.js"><link rel="prefetch" href="/assets/js/50.043bd85d.js"><link rel="prefetch" href="/assets/js/51.c53db7d0.js"><link rel="prefetch" href="/assets/js/52.b419676d.js"><link rel="prefetch" href="/assets/js/53.36f713df.js"><link rel="prefetch" href="/assets/js/54.8002161b.js"><link rel="prefetch" href="/assets/js/55.cc1fc344.js"><link rel="prefetch" href="/assets/js/56.05a6ea6d.js"><link rel="prefetch" href="/assets/js/57.90a9d9ee.js"><link rel="prefetch" href="/assets/js/58.7b07447f.js"><link rel="prefetch" href="/assets/js/59.c17fc2f2.js"><link rel="prefetch" href="/assets/js/6.8a86adbf.js"><link rel="prefetch" href="/assets/js/60.66b80346.js"><link rel="prefetch" href="/assets/js/61.3a7ccc82.js"><link rel="prefetch" href="/assets/js/62.fb35378d.js"><link rel="prefetch" href="/assets/js/63.27e61864.js"><link rel="prefetch" href="/assets/js/64.64d01d10.js"><link rel="prefetch" href="/assets/js/65.a80a9fc0.js"><link rel="prefetch" href="/assets/js/66.5dc463c7.js"><link rel="prefetch" href="/assets/js/67.4a805afa.js"><link rel="prefetch" href="/assets/js/68.8287eee7.js"><link rel="prefetch" href="/assets/js/69.892294f6.js"><link rel="prefetch" href="/assets/js/7.5465fa65.js"><link rel="prefetch" href="/assets/js/70.e0ec7ddd.js"><link rel="prefetch" href="/assets/js/71.7256a53d.js"><link rel="prefetch" href="/assets/js/72.f96155a0.js"><link rel="prefetch" href="/assets/js/73.5a0eb88e.js"><link rel="prefetch" href="/assets/js/74.23636aea.js"><link rel="prefetch" href="/assets/js/75.50267214.js"><link rel="prefetch" href="/assets/js/76.56bf8931.js"><link rel="prefetch" href="/assets/js/77.50bf124e.js"><link rel="prefetch" href="/assets/js/78.16447a1c.js"><link rel="prefetch" href="/assets/js/79.04aa7ebf.js"><link rel="prefetch" href="/assets/js/8.87101dd9.js"><link rel="prefetch" href="/assets/js/80.5d01a188.js"><link rel="prefetch" href="/assets/js/81.f8607d18.js"><link rel="prefetch" href="/assets/js/82.34e8cb67.js"><link rel="prefetch" href="/assets/js/83.947a3b57.js"><link rel="prefetch" href="/assets/js/84.1c193059.js"><link rel="prefetch" href="/assets/js/85.8b1b503f.js"><link rel="prefetch" href="/assets/js/86.c530b306.js"><link rel="prefetch" href="/assets/js/87.06e6da51.js"><link rel="prefetch" href="/assets/js/88.10805f35.js"><link rel="prefetch" href="/assets/js/89.60cd520b.js"><link rel="prefetch" href="/assets/js/9.4e64f5b9.js"><link rel="prefetch" href="/assets/js/90.5d7e2d93.js"><link rel="prefetch" href="/assets/js/91.ddff81c9.js"><link rel="prefetch" href="/assets/js/92.d7928325.js"><link rel="prefetch" href="/assets/js/93.33fd0965.js"><link rel="prefetch" href="/assets/js/94.560df3d9.js"><link rel="prefetch" href="/assets/js/95.283a51cc.js"><link rel="prefetch" href="/assets/js/96.a8d91103.js"><link rel="prefetch" href="/assets/js/97.fe4a7179.js"><link rel="prefetch" href="/assets/js/98.064d454e.js"><link rel="prefetch" href="/assets/js/99.f6443506.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a748b10c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Zhoujc's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/front-end/" class="nav-link router-link-active">
  前端相关
</a></div><div class="nav-item"><a href="/node/" class="nav-link">
  Node实践
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  数据结构与算法
</a></div><div class="nav-item"><a href="/ai/" class="nav-link">
  AI
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/front-end/" class="nav-link router-link-active">
  前端相关
</a></div><div class="nav-item"><a href="/node/" class="nav-link">
  Node实践
</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  数据结构与算法
</a></div><div class="nav-item"><a href="/ai/" class="nav-link">
  AI
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/front-end/" aria-current="page" class="sidebar-link">前端系列</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React深入系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端工程化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器和网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端安全</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>移动端</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/front-end/mobile/rem/" class="sidebar-link">移动端适配方案</a></li><li><a href="/front-end/mobile/jsbridge/" aria-current="page" class="active sidebar-link">Hybrid App的理解与思考</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front-end/mobile/jsbridge/#hybrid-app是什么" class="sidebar-link">Hybrid App是什么？</a></li><li class="sidebar-sub-header"><a href="/front-end/mobile/jsbridge/#三大类app比较" class="sidebar-link">三大类App比较</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front-end/mobile/jsbridge/#web-app" class="sidebar-link">Web App</a></li><li class="sidebar-sub-header"><a href="/front-end/mobile/jsbridge/#native-app" class="sidebar-link">Native App</a></li><li class="sidebar-sub-header"><a href="/front-end/mobile/jsbridge/#hybrid-app" class="sidebar-link">Hybrid App</a></li></ul></li><li class="sidebar-sub-header"><a href="/front-end/mobile/jsbridge/#hybrid-app适用场景" class="sidebar-link">Hybrid App适用场景</a></li><li class="sidebar-sub-header"><a href="/front-end/mobile/jsbridge/#开始前的思考" class="sidebar-link">开始前的思考</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front-end/mobile/jsbridge/#为了html5而hybrid-app" class="sidebar-link">为了HTML5而Hybrid App？</a></li><li class="sidebar-sub-header"><a href="/front-end/mobile/jsbridge/#忽略关键因素" class="sidebar-link">忽略关键因素</a></li><li class="sidebar-sub-header"><a href="/front-end/mobile/jsbridge/#交互体验一致性" class="sidebar-link">交互体验一致性</a></li></ul></li><li class="sidebar-sub-header"><a href="/front-end/mobile/jsbridge/#架构" class="sidebar-link">架构</a></li><li class="sidebar-sub-header"><a href="/front-end/mobile/jsbridge/#核心原理" class="sidebar-link">核心原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front-end/mobile/jsbridge/#与android通信" class="sidebar-link">与Android通信</a></li><li class="sidebar-sub-header"><a href="/front-end/mobile/jsbridge/#与ios通信" class="sidebar-link">与IOS通信</a></li><li class="sidebar-sub-header"><a href="/front-end/mobile/jsbridge/#对比" class="sidebar-link">对比</a></li></ul></li><li class="sidebar-sub-header"><a href="/front-end/mobile/jsbridge/#总结" class="sidebar-link">总结</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>小程序</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>绘图</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="hybrid-app的理解与思考"><a href="#hybrid-app的理解与思考" class="header-anchor">#</a> Hybrid App的理解与思考</h1> <h2 id="hybrid-app是什么"><a href="#hybrid-app是什么" class="header-anchor">#</a> Hybrid App是什么？</h2> <p><code>Hybrid App</code>（混合模式移动应用）是指介于<code>Web App</code>、<code>Native App</code>这两者之间的<code>App</code>，通过不同的应用商店进行打包与分发，应用的特性更接近原生应用而且又区别与<code>Web</code>应用。在开发过程中同时使用了<code>Web</code>技术，所以开发成本大大降低，兼具“Native App良好用户交互体验的优势”和“Web App跨平台开发的优势”。</p> <h2 id="三大类app比较"><a href="#三大类app比较" class="header-anchor">#</a> 三大类App比较</h2> <h3 id="web-app"><a href="#web-app" class="header-anchor">#</a> Web App</h3> <p>定义：将所有功能都放在<code>Web</code>上展现，运行基于本地浏览器。在此将给<code>Web</code>简单的套一层App外壳的应用也归入<code>Web App</code>。完全采用<code>HTML/CSS/JS</code>编写，专为触摸操作进行了优化。目前<code>iOS</code>已禁止简单的套壳App上架。</p> <ul><li>优点：开发速度快，跨平台，成本低，实时迭代无需用户更新。</li> <li>缺点：网络速度要求高无法离线、服务器压力大，系统级别API调用难度大，用户体验差、用户留存度低。</li></ul> <h3 id="native-app"><a href="#native-app" class="header-anchor">#</a> Native App</h3> <p>定义：是基于手机本地操作系统并使用原生语言编写的。因为位于平台层上方，向下访问和兼容的能力会比较好一些，可以支持在线或离线访问，消息推送或本地资源访问，摄像拨号功能的调取。但是由于设备碎片化，<code>App</code>的开发成本要高很多，维持多个版本的更新升级比较麻烦，用户的安装门槛也比较高。</p> <ul><li>优点：用户体验佳、交互风格与系统吻合，节省流量，可访问本地资源可离线，速度快，用户留存度高。</li> <li>缺点：成本高，版本迭代慢，需要过审时间不定。</li></ul> <h3 id="hybrid-app"><a href="#hybrid-app" class="header-anchor">#</a> Hybrid App</h3> <p>定义：介于<code>Web App</code>与<code>Native App</code>的一种折中方案，底层(框架)部分由<code>iOS/Android</code>开发人员处理，上层(内容展现)部分由<code>Web</code>前端人员处理，用户界面操作逻辑及部分静态资源驻留本地，使得<code>Web App</code>可以对操作迅速反应并在很大程度上实现离线访问。<code>Hybrid App</code>追求趋近于原生App的体验，但目前还较困难。</p> <ul><li>优点：跨平台，成本低，可访问设备的多种功能，可离线。</li> <li>缺点：用户体验不如Native App，性能稍慢。</li></ul> <h2 id="hybrid-app适用场景"><a href="#hybrid-app适用场景" class="header-anchor">#</a> Hybrid App适用场景</h2> <ul><li>快速原型，验证产品功能。</li> <li>对性能要求没有那么高的场景，比如内容类的应用，csdn的app，就是采用<code>hbuilder</code>混合方案实现的。</li> <li>......</li></ul> <h2 id="开始前的思考"><a href="#开始前的思考" class="header-anchor">#</a> 开始前的思考</h2> <h3 id="为了html5而hybrid-app"><a href="#为了html5而hybrid-app" class="header-anchor">#</a> 为了HTML5而Hybrid App？</h3> <p><code>Html5</code>只是技术实现手段而已，要根据公司的实际业务场景，以及人员配比综合考虑，不能因为某项开发模式或者技术比较火，就必须要在公司推行这种实现方案，我个人觉得为技术而技术是不可取的。</p> <h3 id="忽略关键因素"><a href="#忽略关键因素" class="header-anchor">#</a> 忽略关键因素</h3> <p><code>Hybrid App</code>本质上还是基于PC的一种开发模式，开发者使用PC浏览器模拟App中的<code>WebView</code>进行调试。PC浏览器与手机<code>WebView</code>的区别是巨大的，包括能支配的CPU资源，最大占有的内存，运行的网络环境，<code>click</code>和<code>touch</code>事件的区别，浏览器对<code>CSS/JS</code>的解析和对事件处理，等等。</p> <p>原生工程师考虑比较多的是内存的问题，这些在web开发时候是很少考虑的。另外，就是网络环境方面，虽然现在3g 4g覆盖率越来越高，但是移动终端的访问和pc还是有很大差距，wifi和蜂窝网络的切换，基站变化等诸多因素都会导致网络间歇性断开，web开发对于这种不稳定网络环境问题的处理上都有所欠缺。</p> <h3 id="交互体验一致性"><a href="#交互体验一致性" class="header-anchor">#</a> 交互体验一致性</h3> <p><code>ios</code>和<code>android</code>的交互设计是两套规范，虽然有相似的地方，但是从操作习惯上，就已经决定了，我们想用一套交互设计，适配两个平台是很难的，包括包括视觉风格，界面切换，操作习惯等。</p> <p>所以说<code>Hybrid App</code>方案是一把双刃剑，一方面它平衡了<code>Native App</code>和<code>Web</code>页面的优缺点，一定程度上解决了<code>Native App</code>开发过程中迭代慢，版本依赖，<code>Native</code>开发资源不足的问题，但另一个方面过度依赖<code>Hybrid</code>方案会造成Web前端开发成本快速上升，甚至造成App整体体验下降，甚至造成功能缺失。</p> <p>总之“不要为了<code>Hybrid</code>而<code>Hybrid</code>“，根据实际场景，控制好方案中<code>Native</code>和<code>Web</code>的边界，是很重要的。</p> <h2 id="架构"><a href="#架构" class="header-anchor">#</a> 架构</h2> <p><img src="data:image/png;base64,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" alt=""></p> <h2 id="核心原理"><a href="#核心原理" class="header-anchor">#</a> 核心原理</h2> <p><img src="/assets/img/jsbridge.dfb44f0e.jpg" alt=""></p> <h3 id="与android通信"><a href="#与android通信" class="header-anchor">#</a> 与Android通信</h3> <h4 id="拦截url-schema"><a href="#拦截url-schema" class="header-anchor">#</a> 拦截url schema</h4> <p>整个<code>Web</code>页面都是运行在<code>Java</code>提供的<code>Webview</code>实例当中。<code>Javascript</code>执行以下四种行为会被<code>Webview</code>监听到，箭头后面是对应触发的<code>Java</code>方法。</p> <ul><li>window.alert =&gt; onJSAlert</li> <li>window.confirm =&gt; onJSConfirm</li> <li>window.prompt =&gt; onJsPrompt</li> <li>window.location =&gt; shouldOverrideUrlLoading</li></ul> <p>以上就是监听方式，最重要的就是通过<code>schema</code>方式，使用<code>shouldOverrideUrlLoading</code>方法对<code>url</code>协议进行解析。说到通信协议，我们首先想到的是<code>http</code>协议，没错，我们可以仿照<code>http</code>协议制定我们自己的协议。比如<code>http</code>协议是这样子的: <code>http://www.baidu.com?param</code>。而要实现<code>js</code>与<code>java</code>通信，我们就需要制定自己的协议比如: <code>bridge://toast?message</code> 其中<code>bridge</code>是<code>scheme</code>，代表我们自定义的协议，后面的<code>toast</code>,<code>message</code>就可以代表方法名和所需参数。</p> <h4 id="注入-api"><a href="#注入-api" class="header-anchor">#</a> 注入 API</h4> <p>原生可以通过<code>WebView</code>提供的接口，向<code>JavaScript</code>的<code>Context（window）</code>中注入对象或者方法，让 <code>JavaScript</code>调用时，直接执行相应的<code>Native</code>代码逻辑，达到<code>JavaScript</code>调用<code>Native</code>的目的。
比如原生注入进来一个类名<code>JsBridge</code>，里面有个<code>openPicture</code>打开相册的方法，<code>js</code>就可以直接调用<code>window.JsBridge.openPicture()</code>。</p> <h3 id="与ios通信"><a href="#与ios通信" class="header-anchor">#</a> 与IOS通信</h3> <p>同理，与<code>ios</code>通信的方式是与上面<code>android</code>的使用方式是一样的。唯一的区别就是拦截<code>url schema</code>的底层机制不一样。</p> <p><code>android</code>是通过监听<code>shouldOverrideUrlLoading</code>方式。而<code>ios</code>没有现成的<code>API</code>拿来用，而是需要间接地通过一些方法来实现。<code>UIWebView</code>有个特性：在<code>UIWebView内发起的所有网络请求</code>，都可以通过<code>delegate</code>函数在<code>Native</code>层得到通知。因此，我们就可以在<code>UIWebView</code>内发起一个自定义的网络请求，格式和上面的<code>android</code>方式一致。</p> <p>常见封装方法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">postWebviewData</span><span class="token punctuation">(</span><span class="token parameter">fname<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> yourSchema <span class="token operator">=</span> <span class="token string">'jsbridge'</span>
  <span class="token keyword">const</span> base <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>yourSchema<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>fname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>

  <span class="token keyword">let</span> src
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> data <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    src <span class="token operator">=</span> base
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> data <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>base<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>base<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> wvIframe <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span>
  wvIframe<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span>
  waiframe<span class="token punctuation">.</span>src <span class="token operator">=</span> src
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>wvIframe<span class="token punctuation">)</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>wvIframe<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="对比"><a href="#对比" class="header-anchor">#</a> 对比</h3> <p>拦截 url 的方式的优点：</p> <ul><li><code>JavaScript</code>端可以确定<code>JSBridge</code>的存在，直接调用即可。</li></ul> <p>拦截 url 的方式的缺陷：</p> <ul><li>长度可能会是隐患。</li> <li>不要为了方便选择直接<code>locaiton.href</code>调用，最好统一通过<code>iframe.src</code>去调用。因为如果通过<code>location.href</code>连续调用<code>Native</code>，会丢失你之前的调用。</li> <li>创建请求，需要一定的耗时，比注入<code>API</code>的方式调用同样的功能，耗时会较长。</li> <li>如果桥的实现方式有更改，<code>JSBridge</code>需要兼容多版本的<code>Native Bridge</code>或者<code>Native Bridge</code>兼容多版本的<code>JSBridge</code>。</li></ul> <p>注入 API 的方式的优点：</p> <ul><li>桥的版本很容易与<code>Native</code>保持一致，<code>Native</code>端不用对不同版本的<code>JSBridge</code>进行兼容。</li></ul> <p>注入 API 的方式的缺陷：</p> <ul><li>注入时机不确定，需要实现注入失败后重试的机制，保证注入的成功率，同时<code>JavaScript</code>端在调用接口时，需要优先判断<code>JSBridge</code>是否已经注入成功。</li></ul> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>个人推荐使用注入 API 的方式。因为不管从易用性，维护性，合理性等方面考虑，它更胜一筹。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/front-end/mobile/rem/" class="prev">
        移动端适配方案
      </a></span> <span class="next"><a href="/front-end/miniapp/build/">
        工程化落地实践
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ebc66fdf.js" defer></script><script src="/assets/js/2.d4b9d712.js" defer></script><script src="/assets/js/25.87e00c33.js" defer></script>
  </body>
</html>
