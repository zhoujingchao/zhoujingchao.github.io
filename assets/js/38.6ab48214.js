(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{488:function(t,s,a){t.exports=a.p+"assets/img/nrm-ls.67a0933d.png"},592:function(t,s,a){"use strict";a.r(s);var e=a(42),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"puppeteer实战系列-介绍及安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#puppeteer实战系列-介绍及安装"}},[t._v("#")]),t._v(" puppeteer实战系列-介绍及安装")]),t._v(" "),e("h2",{attrs:{id:"前言"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/GoogleChrome/puppeteer",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("Puppeteer")]),e("OutboundLink")],1),t._v(" 是一个"),e("code",[t._v("Node")]),t._v("库，它提供了一个高级"),e("code",[t._v("API")]),t._v("来控制"),e("code",[t._v("DevTools")]),t._v("协议上的"),e("code",[t._v("Chrome")]),t._v("或"),e("code",[t._v("Chromium")]),t._v("。"),e("code",[t._v("Puppeteer")]),t._v("默认运行无头，但可以配置为运行完整（非无头）"),e("code",[t._v("Chrome")]),t._v("或"),e("code",[t._v("Chromium")]),t._v("。")]),t._v(" "),e("h2",{attrs:{id:"用处"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#用处"}},[t._v("#")]),t._v(" 用处")]),t._v(" "),e("p",[t._v("可以在浏览器中手动执行的大多数事情都可以使用 "),e("code",[t._v("Puppeteer")]),t._v(" 完成！以下是一些可以入门的示例：")]),t._v(" "),e("ol",[e("li",[t._v("生成页面的屏幕截图和PDF")]),t._v(" "),e("li",[t._v("爬取SPA应用，并生成预渲染内容（即 "),e("code",[t._v("SSR")]),t._v(" 服务端渲染）")]),t._v(" "),e("li",[t._v("自动化表单提交，UI测试，键盘输入等")]),t._v(" "),e("li",[t._v("创建最新的自动化测试环境。使用最新的 "),e("code",[t._v("JavaScript")]),t._v(" 和浏览器功能直接在最新版本的Chrome中运行测试")]),t._v(" "),e("li",[t._v("捕获网站的时间线跟踪，以帮助诊断性能问题")]),t._v(" "),e("li",[t._v("测试Chrome扩展程序")])]),t._v(" "),e("h2",{attrs:{id:"安装及部署"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装及部署"}},[t._v("#")]),t._v(" 安装及部署")]),t._v(" "),e("p",[t._v("本地 MacOS ：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("yarn add puppeteer\n")])])]),e("p",[t._v("down不下来就试试换源，推荐 "),e("code",[t._v("nrm")]),t._v(" 工具")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("yarn global add nrm\n")])])]),e("p",[e("img",{attrs:{src:a(488),alt:""}})]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("nrm use taobao\n")])])]),e("p",[t._v("Centos 7 ：\n需要安装以下依赖，确保任务可以正常执行，相关字体依赖是解决截图后中文乱码问题的。（"),e("a",{attrs:{href:"https://github.com/GoogleChrome/puppeteer/blob/master/docs/troubleshooting.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("更多运行上的问题也可以查看此链接"),e("OutboundLink")],1),t._v("）")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("yum install pango.x86_64 libXcomposite.x86_64 libXcursor.x86_64 libXdamage.x86_64 libXext.x86_64 libXi.x86_64 libXtst.x86_64 cups-libs.x86_64 libXScrnSaver.x86_64 libXrandr.x86_64 GConf2.x86_64 alsa-lib.x86_64 atk.x86_64 gtk3.x86_64 ipa-gothic-fonts xorg-x11-fonts-100dpi xorg-x11-fonts-75dpi xorg-x11-utils xorg-x11-fonts-cyrillic xorg-x11-fonts-Type1 xorg-x11-fonts-misc\n")])])]),e("p",[t._v("再设置")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" browser "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" puppeteer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("launch")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  args"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'--no-sandbox'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'--disable-setuid-sandbox'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("p",[t._v("Docker :")]),t._v(" "),e("p",[t._v("官方推荐使用\nargs参数：--disable-dev-shm-usage\n默认情况下，Docker运行一个/dev/shm共享内存空间为64MB 的容器。这通常对Chrome来说太小，并且会导致Chrome在渲染大页面时崩溃。要修复，必须运行容器 docker run --shm-size=1gb 以增加/dev/shm的容量。从Chrome 65开始，使用--disable-dev-shm-usage标志启动浏览器即可，这将会写入共享内存文件/tmp而不是/dev/shm")]),t._v(" "),e("p",[t._v("注⚠️：\n在某些情况下（例如在Docker中）很难正确终止Chrome。如果你遇到很多僵尸Chrome进程，那么 "),e("a",{attrs:{href:"https://github.com/Yelp/dumb-init",target:"_blank",rel:"noopener noreferrer"}},[t._v("dumb-init"),e("OutboundLink")],1),t._v(" 值得一试。对于PID = 1的进程有特殊处理，")]),t._v(" "),e("p",[t._v("最后\n如果还是down不下来puppeteer，那么请戳这里"),e("a",{attrs:{href:"https://pkgs.org/download/chromium",target:"_blank",rel:"noopener noreferrer"}},[t._v("下载Chromium"),e("OutboundLink")],1),t._v("，放入对应的环境或者项目里。\n再设置 "),e("code",[t._v(".npmrc")]),t._v(" 跳过下载 Chromium")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("puppeteer_skip_chromium_download = true\n")])])]),e("p",[t._v("再启动浏览器")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" options "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  headless"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  timeout"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  args"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'--no-sandbox'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'--disable-setuid-sandbox'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  ignoreHTTPSErrors"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" platform "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" os"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("platform")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("toLocaleLowerCase")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 你所存放的路径")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("platform "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'linux'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  options"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("executablePath "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" path"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../../../chrome-linux/chrome'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" browser "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" puppeteer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("launch")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("Have fun ！")])])}),[],!1,null,null,null);s.default=n.exports}}]);