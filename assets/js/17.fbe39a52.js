(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{470:function(t,s,a){t.exports=a.p+"assets/img/tree-2.a4a999b0.png"},471:function(t,s,a){t.exports=a.p+"assets/img/tree-1.2c464485.png"},472:function(t,s,a){t.exports=a.p+"assets/img/tree-3.862eea84.png"},473:function(t,s,a){t.exports=a.p+"assets/img/tree-4.92380942.png"},574:function(t,s,a){"use strict";a.r(s);var r=a(42),n=Object(r.a)({},(function(){var t=this,s=t.$createElement,r=t._self._c||s;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h1",{attrs:{id:"react虚拟dom和diff算法"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#react虚拟dom和diff算法"}},[t._v("#")]),t._v(" React虚拟DOM和Diff算法")]),t._v(" "),r("h2",{attrs:{id:"什么是虚拟dom"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#什么是虚拟dom"}},[t._v("#")]),t._v(" 什么是虚拟DOM")]),t._v(" "),r("p",[t._v("你的组件dom结构是这样的：")]),t._v(" "),r("div",{staticClass:"language-js extra-class"},[r("pre",{pre:!0,attrs:{class:"language-js"}},[r("code",[r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("ul id"),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[t._v("'list'")]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("li "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[t._v("'item'")]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("li"),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("li "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[t._v("'item'")]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("li"),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("li "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[t._v("'item'")]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("li"),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("ul"),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),r("p",[t._v("当你打印这个react组件的时候，你会发现是这样的：")]),t._v(" "),r("div",{staticClass:"language-js extra-class"},[r("pre",{pre:!0,attrs:{class:"language-js"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  tagName"),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ul'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 节点标签名")]),t._v("\n  props"),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("       "),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// DOM的属性，用一个对象存储键值对")]),t._v("\n    id"),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v("'list'")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  children"),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("    "),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 该节点的子节点")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("tagName"),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v("'li'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" props"),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v("'item'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" children"),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),r("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("tagName"),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v("'li'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" props"),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v("'item'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" children"),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),r("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("tagName"),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v("'li'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" props"),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v("'item'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" children"),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),r("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),r("p",[t._v("对你没有看错，虚拟DOM就是使用js对象来描述真实的DOM，它是一个树形结构。")]),t._v(" "),r("h2",{attrs:{id:"为什么要使用虚拟dom"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#为什么要使用虚拟dom"}},[t._v("#")]),t._v(" 为什么要使用虚拟DOM")]),t._v(" "),r("p",[t._v("众所周知，浏览器操作dom这个成本是很昂贵的，这里不展开，想钻研的自行搜索浏览器渲染机制原理。react频繁的setState更新组件，直接操作真实dom的话，就毫无性能可言，会非常卡顿。所以虚拟DOM只保留了真实DOM节点的一些基本属性，和节点之间的层次关系，它相当于建立在js和DOM之间的一层“缓存”。")]),t._v(" "),r("h2",{attrs:{id:"什么是diff算法"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#什么是diff算法"}},[t._v("#")]),t._v(" 什么是Diff算法")]),t._v(" "),r("p",[t._v("React需要同时维护两棵虚拟DOM树：一棵表示当前的DOM结构，另一棵在React状态变更将要重新渲染时生成。React通过比较这两棵树的差异，决定是否需要修改DOM结构，以及如何修改。这种算法称作Diff算法。")]),t._v(" "),r("p",[t._v("传统的Diff算法是一直都有的，但是它的时间复杂度为O(n^3)，意思是：在React中更新10个元素则需要进行1000次的比较，假如1000个，那就是10亿！")]),t._v(" "),r("p",[t._v("所以React内部通过一些精妙的手段，优化了此算法，将 O(n^3) 复杂度转换成 O(n) 复杂度：")]),t._v(" "),r("ol",[r("li",[t._v("两个不同类型的元素会产生出不同的树")]),t._v(" "),r("li",[t._v("对于同一层级的一组子节点，它们可以通过唯一 key 进行区分")])]),t._v(" "),r("h3",{attrs:{id:"特性"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#特性"}},[t._v("#")]),t._v(" 特性")]),t._v(" "),r("p",[t._v("一、将新旧两颗虚拟DOM树。按照层级对应的关系，从头到尾的遍历一遍，就能找到那些元素是需要更新的。")]),t._v(" "),r("p",[r("img",{attrs:{src:a(470),alt:""}})]),t._v(" "),r("p",[t._v("像图上颜色标注的那样，进行同级节点比较，当发现节点不存在了，就删除该节点和此节点下的所有子节点。")]),t._v(" "),r("p",[t._v("举个例子🌰：")]),t._v(" "),r("p",[r("img",{attrs:{src:a(471),alt:""}})]),t._v(" "),r("p",[t._v("这会先创建A，后创建B和C，最后删除A。")]),t._v(" "),r("p",[t._v("二、同一层级中元素之间的对比\n在类型相同的组件内，再继续对比组件内部的元素，查看内部元素是否相同，如果需要修改，找到需要修改的元素，进行针对性的修改。")]),t._v(" "),r("p",[r("img",{attrs:{src:a(472),alt:""}})]),t._v(" "),r("p",[t._v("如图所示，这块具体操作过程将会是：\nB 不等于 A，则创建并插入 B，删除 A；以此类推，创建并插入 A、D、C，删除 B、C、D。")]),t._v(" "),r("p",[t._v("为了进一步优化上面这个算法，所以又产生了 key 属性")]),t._v(" "),r("p",[r("img",{attrs:{src:a(473),alt:""}})]),t._v(" "),r("p",[t._v("这时候就省去了B，D的对比和节点插删操作，只是将A，C进行了移动。")]),t._v(" "),r("h2",{attrs:{id:"总结"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),r("p",[t._v("保持完整的结构，有利于性能的提升。尽量使用相同类型组件，妥善利用key属性，不要瞎写key值")])])}),[],!1,null,null,null);s.default=n.exports}}]);